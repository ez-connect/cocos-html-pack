System.register([],(function(e,t){"use strict";return{execute:function(){e({BitMask:Ze,CCClass:Wt,CacheMode:void 0,DebugMode:void 0,Enum:Qe,Eventify:ui,HorizontalTextAlignment:void 0,InstanceMaterialType:void 0,Overflow:void 0,SystemEventType:void 0,VerticalTextAlignment:void 0,WorldNode3DToLocalNodeUI:py,WorldNode3DToWorldNodeUI:my,absMax:pn,absMaxComponent:dn,approx:Qt,assert:m,assertID:I,bezier:hL,bezierByTime:vL,ccenum:et,clamp:Jt,clamp01:$t,color:vn,computeRatioByType:TL,createDefaultPipeline:FC,deserialize:Ed,earcut:tX,equals:Zt,error:p,errorID:b,find:DP,fragmentText:tH,getBaselineOffset:function(){return 0},getError:P,getPathFromRoot:function(e,t){for(var n=e,i="";null!==n&&n!==t;)i=n.name+"/"+i,n=n.parent;return i.slice(0,-1)},getWorldTransformUntilRoot:function(e,t,n){for(Mn.identity(n);e!==t;)Mn.fromRTS(LB,e.rotation,e.position,e.scale),Mn.multiply(n,LB,n),e=e.parent;return n},instantiate:Cw,inverseLerp:fn,isCustomTargetModifier:kB,isDisplayStats:O,isElementModifier:GB,isPropertyModifier:HB,isUnicodeCJK:QU,isUnicodeSpace:JU,isValid:ni,lerp:en,log:f,logID:T,markAsWarning:void 0,mat4:Fn,murmurhash2_32_gc:mc,nextPow2:un,pingPong:_n,pseudoRandom:sn,pseudoRandomRange:cn,pseudoRandomRangeInt:ln,quat:Dn,randomRange:on,randomRangeInt:an,rect:Yn,removeProperty:void 0,repeat:hn,replaceProperty:void 0,safeMeasureText:$U,sampleAnimationCurve:EL,setDefaultLogTimes:function(e){e>0&&(V=e)},setDisplayStats:D,size:qn,toDegree:nn,toRadian:tn,tween:iU,tweenUtil:rU,v2:Gn,v3:Tn,v4:Vn,warn:d,warnID:A});var n="undefined"==typeof window?global:window,i=e("cclegacy",{_global:n});i.internal={},n.CC_BUILD=!0,n.CC_TEST=!1,n.CC_EDITOR=false,n.CC_PREVIEW=!1,n.CC_DEV=!1,n.CC_DEBUG=!1,n.CC_JSB=!1,n.CC_BYTEDANCE=!1,n.CC_WECHAT=!1,n.CC_ALIPAY=!1,n.CC_XIAOMI=!1,n.CC_BAIDU=!1,n.CC_COCOSPLAY=!1,n.CC_HUAWEI=!1,n.CC_OPPO=!1,n.CC_VIVO=!1,n.CC_MINIGAME=!1,n.CC_RUNTIME_BASED=!1,n.CC_SUPPORT_JIT=!0;var r=e("VERSION","3.2.0");n.CocosEngine=i.ENGINE_VERSION=r,n.cc=i;var o="https://github.com/cocos-creator/engine/blob/3d/EngineErrorMap.md",a=null,s=console.log.bind(console),c=s,l=s,u=function(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];console.log("ASSERT: "+_.apply(void 0,[t].concat(i)))}},h=s;function _(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return i.js.formatStr.apply(null,[e].concat(n))}function f(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return s.apply(void 0,[e].concat(n))}function d(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return c.apply(void 0,[e].concat(n))}function p(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return l.apply(void 0,[e].concat(n))}function m(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return u.apply(void 0,[e,t].concat(i))}function g(){return h.apply(void 0,arguments)}function v(e){if(s=c=l=u=h=function(){},e!==w.NONE){if(e>w.ERROR){var t=function(e){if(i.game.canvas){if(!a){var t=document.createElement("Div");t.setAttribute("id","logInfoDiv"),t.setAttribute("width","200"),t.setAttribute("height",i.game.canvas.height);var n=t.style;n.zIndex="99999",n.position="absolute",n.top=n.left="0",(a=document.createElement("textarea")).setAttribute("rows","20"),a.setAttribute("cols","30"),a.setAttribute("disabled","true");var r=a.style;r.backgroundColor="transparent",r.borderBottom="1px solid #cccccc",r.borderTopWidth=r.borderLeftWidth=r.borderRightWidth="0px",r.borderTopStyle=r.borderLeftStyle=r.borderRightStyle="none",r.padding="0px",r.margin="0px",t.appendChild(a),i.game.canvas.parentNode.appendChild(t)}a.value=a.value+e+"\r\n",a.scrollTop=a.scrollHeight}};l=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t("ERROR :  "+_.apply(void 0,[e].concat(i)))},u=function(e,n){if(!e){for(var i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];t("ASSERT: "+_.apply(void 0,[n].concat(r)))}},e!==w.ERROR_FOR_WEB_PAGE&&(c=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t("WARN :  "+_.apply(void 0,[e].concat(i)))}),e===w.INFO_FOR_WEB_PAGE&&(s=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t(_.apply(void 0,[e].concat(i)))})}else console&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),l=console.error.bind?console.error.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.error.apply(console,[e].concat(n))},u=function(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var o=_.apply(void 0,[t].concat(i));throw new Error(o)}});if(e!==w.ERROR&&(c=console.warn.bind?console.warn.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.warn.apply(console,[e].concat(n))}),e===w.INFO&&(s=console.log.bind?console.log.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.log.apply(console,[e].concat(n))}),e<=w.VERBOSE&&"function"==typeof console.debug){var n=console.debug;h=function(){return n.apply(void 0,arguments)}}}}function y(e){p(e.stack||e)}function S(e){return function(t){for(var n=e+" "+t+", please go to "+o+"#"+t+" to see details.",i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return 0===r.length?n:n+" Arguments: "+r.join(", ")}}var E=S("Log");function T(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];f(E.apply(void 0,[e].concat(n)))}var x=S("Warning");function A(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];d(x.apply(void 0,[e].concat(n)))}var C=S("Error");function b(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];p(C.apply(void 0,[e].concat(n)))}var w,R=S("Assert");function I(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];m(!1,R.apply(void 0,[t].concat(i)))}}function P(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return C.apply(void 0,[e].concat(n))}function O(){return!!i.profiler&&i.profiler.isShowingStats()}function D(e){i.profiler&&(e?i.profiler.showStats():i.profiler.hideStats(),i.game.config.showFPS=!!e)}!function(e){e[e.NONE=0]="NONE",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.INFO_FOR_WEB_PAGE=5]="INFO_FOR_WEB_PAGE",e[e.WARN_FOR_WEB_PAGE=6]="WARN_FOR_WEB_PAGE",e[e.ERROR_FOR_WEB_PAGE=7]="ERROR_FOR_WEB_PAGE"}(w||(w=e("DebugMode",{})));var N=Object.freeze({__proto__:null,log:f,warn:d,error:p,assert:m,debug:g,_resetDebugSetting:v,_throw:y,logID:T,warnID:A,errorID:b,assertID:I,get DebugMode(){return w},getError:P,isDisplayStats:O,setDisplayStats:D});function M(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}var L=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,i=t,r=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--r;e[t]=i<<r&255}}(L);var B=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:2147483647,INT_MIN:-2147483648,sign:function(e){return(e>0)-(e<0)},abs:function(e){var t=e>>31;return(e^t)-t},min:function(e,t){return t^(e^t)&-(e<t)},max:function(e,t){return e^(e^t)&-(e<t)},isPow2:function(e){return!(e&e-1||!e)},log2:function(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1},log10:function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},popCount:function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},countTrailingZeros:M,nextPow2:function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)},prevPow2:function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},parity:function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1},reverse:function(e){return L[255&e]<<24|L[e>>>8&255]<<16|L[e>>>16&255]<<8|L[e>>>24&255]},interleave2:function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},deinterleave2:function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},interleave3:function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},deinterleave3:function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},nextCombination:function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>M(e)+1}});e("bits",B);var F,z,U,H,G,k,V=10,W=0,j=new Map;function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function X(e,t,n){return t&&q(e.prototype,t),n&&q(e,n),e}function Y(){return(Y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function K(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Z(e,t)}function Z(e,t){return(Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function $(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function ee(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function te(e,t,n,i,r){var o={};return Object.keys(i).forEach((function(e){o[e]=i[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}H=function(e,t,n,i,r,o,a){var s=j.get(o);s&&s.logTimes>s.count&&(r("'%s' is deprecated, please use '%s' instead. "+a,e+"."+t,n+"."+i),s.count++)},F=e("replaceProperty",(function(e,t,n){null!=e&&n.forEach((function(n){var i=W++;j.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:V});var r=null!=n.target?n.target:e,o=null!=n.newName?n.newName:n.name,a=null!=n.targetName?n.targetName:t,s=r===e,c=n.suggest?"("+n.suggest+")":"";if(null!=n.customFunction)e[n.name]=function(){var e;return H(t,n.name,a,o,d,i,c),(e=n.customFunction).call.apply(e,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=n.customSetter||null!=n.customGetter){var l=null!=n.customSetter,u=null!=n.customGetter;l&&u?Object.defineProperty(e,n.name,{get:function(){return H(t,n.name,a,o,d,i,c),n.customGetter.call(this)},set:function(e){H(t,n.name,a,o,d,i,c),n.customSetter.call(this,e)},enumerable:!1}):l?Object.defineProperty(e,n.name,{set:function(e){H(t,n.name,a,o,d,i,c),n.customSetter.call(this,e)},enumerable:!1}):u&&Object.defineProperty(e,n.name,{get:function(){return H(t,n.name,a,o,d,i,c),n.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(e,n.name,{get:function(){return H(t,n.name,a,o,d,i,c),s?this[o]:r[o]},set:function(e){H(t,n.name,a,o,d,i,c),s?this[o]=e:r[o]=e},enumerable:!1})}))})),k=function(e,t,n,i,r){var o=j.get(i);o&&o.logTimes>o.count&&(n("'%s' has been removed. "+r,e+"."+t),o.count++)},z=e("removeProperty",(function(e,t,n){null!=e&&n.forEach((function(n){var i=W++;j.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:V});var r=n.suggest?"("+n.suggest+")":"";Object.defineProperty(e,n.name,{get:function(){return k(t,n.name,p,i,r)},set:function(){k(t,n.name,p,i,r)},enumerable:!1})}))})),G=function(e,t,n,i,r){var o=j.get(i);o&&o.logTimes>o.count&&(n("'%s' is deprecated. "+r,e+"."+t),o.count++)},U=e("markAsWarning",(function(e,t,n){if(null!=e){var i=function(t,n,i,r,o,a){if(t.get){var s=t.get;t.get=function(){return G(n,i,r,o,a),s.call(this)}}if(t.set){var c=t.set;t.set=function(e){G(n,i,r,o,a),c.call(this,e)}}Object.defineProperty(e,i,t)};n.forEach((function(n){var r=n.name,o=Object.getOwnPropertyDescriptor(e,r);if(o&&o.configurable){var a=W++;j.set(a,{id:a,count:0,logTimes:void 0!==n.logTimes?n.logTimes:V});var s=n.suggest?"("+n.suggest+")":"";if(null!=o.value)if("function"==typeof o.value){var c=o.value;e[r]=function(){return G(t,r,d,a,s),c.call.apply(c,[this].concat(Array.prototype.slice.call(arguments)))}}else i(o,t,r,d,a,s);else i(o,t,r,d,a,s);Object.defineProperty(e,r,{enumerable:!1})}}))}}));var ne=function(){function e(e){this.i=0,this.array=e}var t=e.prototype;return t.remove=function(e){var t=this.array.indexOf(e);t>=0&&this.removeAt(t)},t.removeAt=function(e){this.array.splice(e,1),e<=this.i&&--this.i},t.fastRemove=function(e){var t=this.array.indexOf(e);t>=0&&this.fastRemoveAt(t)},t.fastRemoveAt=function(e){var t=this.array;t[e]=t[t.length-1],--t.length,e<=this.i&&--this.i},t.push=function(e){this.array.push(e)},X(e,[{key:"length",get:function(){return this.array.length},set:function(e){this.array.length=e,this.i>=e&&(this.i=e-1)}}]),e}();function ie(e,t){e.splice(t,1)}function re(e,t){var n=e.length;t<0||t>=n||(e[t]=e[n-1],e.length=n-1)}function oe(e,t){var n=e.indexOf(t);return n>=0&&(ie(e,n),!0)}function ae(e,t){return e.indexOf(t)>=0}var se=Object.freeze({__proto__:null,removeAt:ie,fastRemoveAt:re,remove:oe,fastRemove:function(e,t){var n=e.indexOf(t);n>=0&&(e[n]=e[e.length-1],--e.length)},removeIf:function(e,t){var n=e.findIndex(t);if(n>=0){var i=e[n];return ie(e,n),i}},verifyType:function(e,t){if(e&&e.length>0)for(var n,i=$(e);!(n=i()).done;)if(!(n.value instanceof t))return T(1300),!1;return!0},removeArray:function(e,t){for(var n=0,i=t.length;n<i;n++)oe(e,t[n])},appendObjectsAt:function(e,t,n){return e.splice.apply(e,[n,0].concat(t)),e},contains:ae,copy:function(e){for(var t=e.length,n=new Array(t),i=0;i<t;i+=1)n[i]=e[i];return n},MutableForwardIterator:ne}),ce=function(){function e(e){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=e?e+".":""}return e.prototype.getNewId=function(){return this.prefix+ ++this.id},e}();ce.global=new ce("global");var le=new ce("TmpCId."),ue="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),he="__cid__";function _e(e){return"number"==typeof e||e instanceof Number}function fe(e){return"string"==typeof e||e instanceof String}function de(e){for(var t in e)return!1;return!0}var pe,me=(pe={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(e,t,n,i,r){pe.value=n,pe.writable=i,pe.enumerable=r,Object.defineProperty(e,t,pe),pe.value=void 0}),ge=function(){var e={get:void 0,set:void 0,enumerable:!1};return function(t,n,i,r,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1),"boolean"==typeof r&&(o=r,r=void 0),e.get=i,e.set=r,e.enumerable=o,e.configurable=a,Object.defineProperty(t,n,e),e.get=void 0,e.set=void 0}}(),ve=function(){var e={get:void 0,enumerable:!1,configurable:!1};return function(t,n,i,r,o){e.get=i,e.enumerable=r,e.configurable=o,Object.defineProperty(t,n,e),e.get=void 0}}(),ye=function(){var e={set:void 0,enumerable:!1,configurable:!1};return function(t,n,i,r,o){e.set=i,e.enumerable=r,e.configurable=o,Object.defineProperty(t,n,e),e.set=void 0}}();function Se(e){var t=Object.create(null);return e&&(t["."]=1,t["/"]=1,delete t["."],delete t["/"]),t}function Ee(e){if("function"==typeof e){var t=e.prototype;if(t&&t.hasOwnProperty("__classname__")&&t.__classname__)return t.__classname__;var n="";if(e.name&&(n=e.name),e.toString){var i,r=e.toString();(i="["===r.charAt(0)?r.match(/\[\w+\s*(\w+)\]/):r.match(/function\s*(\w+)/))&&2===i.length&&(n=i[1])}return"Object"!==n?n:""}return e&&e.constructor?Ee(e.constructor):""}function Te(e,t,n,i){var r=/([^.]+)$/,o=r.exec(t)[0],a=r.exec(n)[0];function s(){return this[a]}i?ge(e,o,s,(function(e){this[a]=e})):ve(e,o,s)}function xe(e,t,n,i){for(var r in n)Te(e,t+"."+r,n[r],i)}var Ae=/(%d)|(%s)/,Ce=/%s/;function be(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(0===arguments.length)return"";if(0===n.length)return""+e;var r="string"==typeof e&&Ae.test(e);if(r)for(var o,a=$(n);!(o=a()).done;){var s=o.value,c="number"==typeof s?Ae:Ce;if(c.test(e)){var l=""+s;e=e.replace(c,l)}else e+=" "+s}else for(var u,h=$(n);!(u=h()).done;){var _=u.value;e+=" "+_}return e}function we(){for(var e=arguments.length-1,t=new Array(e),n=0;n<e;++n)t[n]=arguments[n+1];return t}function Re(e,t){for(;e;){var n=Object.getOwnPropertyDescriptor(e,t);if(n)return n;e=Object.getPrototypeOf(e)}return null}function Ie(e,t,n){var i=Re(t,e);i&&Object.defineProperty(n,e,i)}function Pe(e){e=e||{};for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];if(a){if("object"!=typeof a){b(5402,a);continue}for(var s in a)s in e||Ie(s,a,e)}}return e}function Oe(e){e=e||{};for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];if(a){if("object"!=typeof a){b(5403,a);continue}for(var s in a)Ie(s,a,e)}}return e}function De(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e.prototype=Object.create(t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),e}function Ne(e){var t=e.prototype,n=t&&Object.getPrototypeOf(t);return n&&n.constructor}function Me(e,t){if(e&&t){if("function"!=typeof e)return!1;if("function"!=typeof t)return!1;if(e===t)return!0;for(;;){if(!(e=Ne(e)))return!1;if(e===t)return!0}}return!1}function Le(e){for(var t=0,n=Object.keys(e);t<n.length;t++)delete e[n[t]]}var Be=Se(!0),Fe=Se(!0);function ze(e,t){return function(n,i){if(i.prototype.hasOwnProperty(e)&&delete t[i.prototype[e]],me(i.prototype,e,n),n){var r=t[n];r&&r!==i?p("A Class already exists with the same "+e+' : "'+n+'".'):t[n]=i}}}var Ue=ze("__cid__",Be),He=ze("__classname__",Fe);function Ge(e,t){if(He(e,t),!t.prototype.hasOwnProperty(he)){var n=e||le.getNewId();n&&Ue(n,t)}}function ke(e,t){var n=Fe[t],i=Be[t],r=!0;if(n&&n!==e&&(p('"'+t+'" has already been set as name or alias of another class.'),r=!1),i&&i!==e&&(p('"'+t+'" has already been set as id or alias of another class.'),r=!1),r){var o=e[ue];o||(o=[],e[ue]=o),o.push(t),Fe[t]=e,Be[t]=e}}function Ve(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0,r=t;i<r.length;i++){var o=r[i],a=o.prototype,s=a.__cid__;s&&delete Be[s];var c=a.__classname__;c&&delete Fe[c];var l=a[ue];if(l)for(var u=0;u<l.length;++u){var h=l[u];delete Fe[h],delete Be[h]}}}function We(e){return Be[e]}function je(e){return Fe[e]}function qe(e,t){if(t=void 0===t||t,"function"==typeof e&&e.prototype.hasOwnProperty(he))return e.prototype.__cid__;if(e&&e.constructor){var n=e.constructor.prototype;if(n&&n.hasOwnProperty(he))return e.__cid__}return""}var Xe=function(){var e=t.prototype;function t(e,t){this.count=void 0,this._pool=void 0,this._cleanup=void 0;var n=void 0===t?e:t,i=void 0===t?null:e;this.count=0,this._pool=new Array(n),this._cleanup=i}return e.get=function(){return this._get()},e._get=function(){if(this.count>0){--this.count;var e=this._pool[this.count];return this._pool[this.count]=null,e}return null},e.put=function(e){var t=this._pool;if(this.count<t.length){if(this._cleanup&&!1===this._cleanup(e))return;t[this.count]=e,++this.count}},e.resize=function(e){e>=0&&(this._pool.length=e,this.count>e&&(this.count=e))},t}(),Ye=se,Ke={IDGenerator:ce,Pool:Xe,array:se,isNumber:_e,isString:fe,isEmptyObject:de,getPropertyDescriptor:Re,addon:Pe,mixin:Oe,extend:De,getSuper:Ne,isChildClassOf:Me,clear:Le,value:me,getset:ge,get:ve,set:ye,unregisterClass:Ve,getClassName:Ee,setClassName:Ge,setClassAlias:ke,getClassByName:je,get _registeredClassNames(){return Y({},Fe)},set _registeredClassNames(e){Le(Fe),Object.assign(Fe,e)},get _registeredClassIds(){return Y({},Be)},set _registeredClassIds(e){Le(Be),Object.assign(Be,e)},_getClassId:qe,_setClassId:Ue,_getClassById:We,obsolete:Te,obsoletes:xe,formatStr:be,shiftArguments:we,createMap:Se};function Ze(e){if("__bitmask__"in e)return e;me(e,"__bitmask__",null,!0);for(var t=-1,n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],o=e[r];if(-1===o)o=++t,e[r]=o;else if("number"==typeof o)t=o;else if("string"==typeof o&&Number.isInteger(parseFloat(r)))continue;var a=""+o;r!==a&&me(e,a,r)}return e}function Qe(e){return"__enums__"in e?e:(me(e,"__enums__",null,!0),Qe.update(e))}function Je(e){e.hasOwnProperty("__enums__")}function $e(e){Je(e);var t=e.__enums__||[];for(var n in t.length=0,e){var i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort((function(e,t){return e.value-t.value})),e.__enums__=t,t}function et(e){"__enums__"in e||me(e,"__enums__",null,!0)}i.js=Ke,e("js",Object.freeze({__proto__:null,array:Ye,js:Ke,IDGenerator:ce,Pool:Xe,isNumber:_e,isString:fe,isEmptyObject:de,value:me,getset:ge,get:ve,set:ye,createMap:Se,getClassName:Ee,obsolete:Te,obsoletes:xe,formatStr:be,shiftArguments:we,getPropertyDescriptor:Re,addon:Pe,mixin:Oe,extend:De,getSuper:Ne,isChildClassOf:Me,clear:Le,_idToClass:Be,_nameToClass:Fe,_setClassId:Ue,setClassName:Ge,setClassAlias:ke,unregisterClass:Ve,_getClassById:We,getClassByName:je,_getClassId:qe})),Ze.isBitMask=function(e){return e&&e.hasOwnProperty("__bitmask__")},Ze.getList=function(e){if(e.__bitmask__)return e.__bitmask__;var t=e.__bitmask__=[];for(var n in e){var i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort((function(e,t){return e.value-t.value})),t},i.BitMask=Ze,Qe.update=function(e){for(var t=-1,n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],o=e[r];if(-1===o)o=++t,e[r]=o;else if("number"==typeof o)t=o;else if("string"==typeof o&&Number.isInteger(parseFloat(r)))continue;var a=""+o;r!==a&&me(e,a,r)}return Array.isArray(e.__enums__)&&$e(e),e},Qe||(Qe=e("Enum",{})),Qe.isEnum=function(e){return e&&e.hasOwnProperty("__enums__")},Qe.getList=function(e){return Je(e),e.__enums__?e.__enums__:$e(e)},i.Enum=Qe;var tt=e("ValueType",function(){function e(){}var t=e.prototype;return t.clone=function(){return b(100,Ee(this)+".clone"),this},t.equals=function(){return!1},t.set=function(){b(100,Ee(this)+".set")},t.toString=function(){return""+{}},e}());Ge("cc.ValueType",tt),i.ValueType=tt;var nt=e("macro",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20});i.macro=nt;for(var it=/^(?:cc|dragonBones|sp|ccsg)\..+/,rt=new Array(123),ot=0;ot<123;++ot)rt[ot]=64;for(var at=0;at<64;++at)rt["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(at)]=at;var st=rt;function ct(e,t,n){function i(e,t,n,i){var r=Object.getOwnPropertyDescriptor(e,t);if(r)r.get&&(e[n]=r.get),r.set&&i&&(e[i]=r.set);else{var o=e[n];ge(e,t,o,e[i])}}for(var r,o=e.prototype,a=0;a<t.length;a++){var s=(r=t[a])[0].toUpperCase()+r.slice(1);i(o,r,"get"+s,"set"+s)}for(r in n){var c=n[r];i(o,r,c[0],c[1])}}function lt(e,t,n,i){var r=e[t];r?Array.isArray(r)?i?(r.push(r[0]),r[0]=n):r.push(n):e[t]=i?[n,r]:[r,n]:e[t]=n}function ut(e,t){if("function"==typeof e.contains)return e.contains(t);if("function"==typeof e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));var n=t.parentNode;if(n)do{if(n===e)return!0;n=n.parentNode}while(null!==n);return!1}function ht(e){return"object"==typeof window&&"function"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName}function _t(e,t,n){e&&setTimeout((function(){e(t,n)}),0)}function ft(e){return!(!e||e.constructor!==Object)&&de(e)}function dt(e,t,n){if(t>n){var i=t;t=n,n=i}return e<t?t:e<n?e:n}function pt(e){return e*nt.RAD}function mt(e){return e*nt.DEG}i.misc={BUILTIN_CLASSID_RE:it,BASE64_VALUES:st,propertyDefine:ct,pushToMap:lt,contains:ut,isDomNode:ht,callInNextTick:_t,isPlainEmptyObj_DEV:ft,clampf:dt,degreesToRadians:pt,radiansToDegrees:mt},e("misc",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:it,BASE64_VALUES:st,propertyDefine:ct,pushToMap:lt,contains:ut,isDomNode:ht,callInNextTick:_t,tryCatchFunctor_EDITOR:function(e){return Function("target","try {\n  target."+e+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")},isPlainEmptyObj_DEV:ft,clampf:dt,degreesToRadians:pt,radiansToDegrees:mt}));var gt="$_$";function vt(e,t){var n=t?Object.create(t):{};return me(e,"__attrs__",n),n}function yt(e){if("function"!=typeof e)return vt(e,Et(e.constructor));for(var t,n=i.Class.getInheritanceChain(e),r=n.length-1;r>=0;r--){var o=n[r];o.hasOwnProperty("__attrs__")&&o.__attrs__||vt(o,(t=n[r+1])&&t.__attrs__)}return vt(e,(t=n[0])&&t.__attrs__),e.__attrs__}function St(e,t){var n=Et(e),i=t+gt,r={};for(var o in n)o.startsWith(i)&&(r[o.slice(i.length)]=n[o]);return r}function Et(e){return e.hasOwnProperty("__attrs__")&&e.__attrs__||yt(e)}function Tt(e,t,n,i){Et(e)[t+gt+n]=i}var xt=function(){function e(e,t){this.name=void 0,this.default=void 0,this.name=e,this.default=t}return e.prototype.toString=function(){return this.name},e}(),At=e("CCInteger",new xt("Integer",0));i.Integer=At,i.CCInteger=At;var Ct=e("CCFloat",new xt("Float",0));i.Float=Ct,i.CCFloat=Ct;var bt=e("CCBoolean",new xt("Boolean",!1));i.Boolean=bt,i.CCBoolean=bt;var wt=e("CCString",new xt("String",""));function Rt(e,t){return function(n,i){var r='"'+Ee(n)+"."+i+'"',o=St(n,i),a=o.type;if(a===At||a===Ct?a="Number":a!==wt&&a!==bt||(a=""+a),a===e){if(o.hasOwnProperty("default")){var s=o.default;if(void 0!==s&&!Array.isArray(s)&&!ft(s)){var c=typeof s,l=e.toLowerCase();if(c===l)if("object"===l){if(!s||s instanceof o.ctor)return;A(3605,r,Ee(o.ctor))}else"Number"!==e&&A(3606,t,r,e);else{if("function"===c)return;e===wt.default&&null==s?A(3607,r):A(3611,t,r,c)}delete o.type}}}else A(3604,r)}}i.String=wt,i.CCString=wt;var It=Object.freeze({__proto__:null,DELIMETER:gt,createAttrsSingle:vt,createAttrs:yt,attr:St,getClassAttrs:Et,setClassAttr:Tt,PrimitiveType:xt,CCInteger:At,CCFloat:Ct,CCBoolean:bt,CCString:wt,getTypeChecker_ET:Rt,getObjTypeChecker_ET:function(e){return function(t,n){Rt("Object","type")(t,n);var r=Et(t)[n+gt+"default"],o=i.Class.getDefault(r);if(!Array.isArray(o)&&Me(e,i.ValueType)){var a=Ee(e),s=be('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',Ee(t),n,a);r?f(s):A(3612,s,a,Ee(t),n,a)}}}}),Pt={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function Ot(e,t,n,i){if(!e.get&&!e.set&&e.hasOwnProperty("default")){var r="_N$"+t;e.get=function(){return this[r]},e.set=function(e){var t=this[r];this[r]=e,n.call(this,t)};var o={};for(var a in i[r]=o,Pt){var s=Pt[a];e.hasOwnProperty(a)&&(o[a]=e[a],s.canUsedInGet||delete e[a])}}}function Dt(e,t,n,r){if(Array.isArray(t)){if(!(t.length>0))return b(5508,n,r);e.type=t=t[0]}"function"==typeof t&&(t===String?e.type=i.String:t===Boolean?e.type=i.Boolean:t===Number&&(e.type=i.Float))}function Nt(e,t,n){var i=e?{_short:!0}:{_short:!0,default:t};return n&&(i.type=n),i}function Mt(e,t){if(!e||e.constructor!==Object){if(Array.isArray(e)&&e.length>0)return Nt(t,[],e);if("function"==typeof e){var n=e;return Nt(t,Me(n,i.ValueType)?new n:null,n)}return Nt(t,e instanceof xt?e.default:e)}return null}var Lt=[];function Bt(){return Lt[Lt.length-1]}i._RF={push:function(e,t,n,i){void 0===n&&(n=t,t=""),Lt.push({uuid:t,script:n,module:e,exports:e.exports,beh:null,importMeta:i})},pop:function(){var e=Lt.pop(),t=e.module,n=t.exports;if(n===e.exports){for(var i in n)return;t.exports=n=e.cls}},peek:Bt};var Ft=gt,zt={datas:null,push:function(e){if(this.datas)this.datas.push(e);else{this.datas=[e];var t=this;setTimeout((function(){t.init()}),0)}},init:function(){var e=this.datas;if(e){for(var t=0;t<e.length;++t){var n=e[t],i=n.cls,r=n.props;"function"==typeof r&&(r=r());var o=Ee(i);r?Vt(i,o,r,i.$super,n.mixins):b(3633,o)}this.datas=null}}};function Ut(e,t,n,i){!function(e,t){!function(e,t){e.indexOf(t)<0&&e.push(t)}(e.__props__,t)}(e,n),qt(e,i,t,n)}function Ht(e,t,n,i){var r=i.get;i.set,r&&(qt(e,i,t,n),Tt(e,n,"serializable",!1))}function Gt(e){return"function"==typeof e?e():e}function kt(e,t,n){for(var i in t)e.hasOwnProperty(i)||n&&!n(i)||Object.defineProperty(e,i,Re(t,i))}function Vt(e,t,n,i,r){if(e.__props__=[],i&&i.__props__&&(e.__props__=i.__props__.slice()),r)for(var o=0;o<r.length;++o){var a=r[o];a.__props__&&(e.__props__=e.__props__.concat(a.__props__.filter((function(t){return e.__props__.indexOf(t)<0}))))}if(n)for(var s in function(e,t){for(var n in e){var i=e[n],r=Mt(i,!1);if(r&&(i=e[n]=r),i){var o=i.notify;o&&Ot(i,n,o,e),"type"in i&&Dt(i,i.type,t,n)}}}(n,t),n){var c=n[s];c.get||c.set?Ht(e,t,s,c):Ut(e,t,s,c)}var l=Et(e);e.__values__=e.__props__.filter((function(e){return!1!==l[e+Ft+"serializable"]}))}function Wt(e){var t=e.name,n=e.extends,r=e.mixins,o=function(e,t,n,r){var o=i.Component,a=Bt();if(a&&Me(t,o)){if(Me(a.cls,o))return b(3615),null;e=e||a.script}var s=function(e,t,n,i){var r=i.ctor,o=[r],a=r;me(a,"__ctors__",o.length>0?o:null,!0);var s=a.prototype;if(t&&(a.$super=t),n){for(var c=n.length-1;c>=0;c--){var l=n[c];kt(s,l.prototype),Wt._isCCClass(l)&&kt(Et(a),Et(l))}s.constructor=a}return Ge(e,a),a}(e,t,n,r);if(a)if(Me(t,o)){var c=a.uuid;c&&Ue(c,s),a.cls=s}else Me(a.cls,o)||(a.cls=s);return s}(t,n,r,e);t||(t=i.js.getClassName(o)),o._sealed=!0,n&&(n._sealed=!1);var a=e.properties;"function"==typeof a||n&&null===n.__props__||r&&r.some((function(e){return null===e.__props__}))?(zt.push({cls:o,props:a,mixins:r}),o.__props__=o.__values__=null):Vt(o,t,a,n,e.mixins);var s=e.editor;return s&&Me(n,i.Component)&&i.Component._registerEditorProps(o,s),o}Wt._isCCClass=function(e){var t;return null==e||null===(t=e.hasOwnProperty)||void 0===t?void 0:t.call(e,"__ctors__")},Wt.fastDefine=function(e,t,n){Ge(e,t);for(var i=t.__props__=t.__values__=Object.keys(n),r=Et(t),o=0;o<i.length;o++){var a=i[o];r[a+Ft+"visible"]=!1,r[a+Ft+"default"]=n[a]}},Wt.Attr=It,Wt.attr=St,Wt.getInheritanceChain=function(e){for(var t=[];e=Ne(e);)e!==Object&&t.push(e);return t};var jt={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function qt(e,t,n,i){var r=null,o="";function a(){return o=i+Ft,r=Et(e)}"type"in t&&void 0===t.type&&A(3660,i,n);var s=t.type;s&&(jt[s]?(r||a())[o+"type"]=s:"Object"===s||("object"==typeof s?Qe.isEnum(s)?((r||a())[o+"type"]="Enum",r[o+"enumList"]=Qe.getList(s)):Ze.isBitMask(s)&&((r||a())[o+"type"]="BitMask",r[o+"bitmaskList"]=Ze.getList(s)):"function"==typeof s&&((r||a())[o+"type"]="Object",r[o+"ctor"]=s))),"default"in t&&((r||a())[o+"default"]=t.default);var c,l=function(e,n){if(e in t){var i=t[e];typeof i===n&&((r||a())[o+e]=i)}};t.editorOnly&&((r||a())[o+"editorOnly"]=!0),t.__noImplicit?(r||a())[o+"serializable"]=null!==(c=t.serializable)&&void 0!==c&&c:!1===t.serializable&&((r||a())[o+"serializable"]=!1),l("formerlySerializedAs","string");var u=t.range;u&&Array.isArray(u)&&u.length>=2&&((r||a())[o+"min"]=u[0],r[o+"max"]=u[1],u.length>2&&(r[o+"step"]=u[2])),l("min","number"),l("max","number"),l("step","number")}Wt.isArray=function(e){return e=Gt(e),Array.isArray(e)},Wt.getDefault=Gt,Wt.escapeForJS=function(e){return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},Wt.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,Wt.getNewValueTypeCode=function(e){for(var t=Ee(e),n=e.constructor,i="new "+t+"(",r=0;r<n.__props__.length;r++)i+=e[n.__props__[r]],r<n.__props__.length-1&&(i+=",");return i+")"},i.Class=Wt;var Xt=Math.PI/180,Yt=180/Math.PI,Kt=e("EPSILON",1e-6);function Zt(e,t){return Math.abs(e-t)<=Kt*Math.max(1,Math.abs(e),Math.abs(t))}function Qt(e,t,n){return n=n||Kt,Math.abs(e-t)<=n}function Jt(e,t,n){if(t>n){var i=t;t=n,n=i}return e<t?t:e>n?n:e}function $t(e){return e<0?0:e>1?1:e}function en(e,t,n){return e+(t-e)*n}function tn(e){return e*Xt}function nn(e){return e*Yt}var rn=e("random",Math.random);function on(e,t){return Math.random()*(t-e)+e}function an(e,t){return Math.floor(on(e,t))}function sn(e){return(e=(9301*e+49297)%233280)/233280}function cn(e,t,n){return sn(e)*(n-t)+t}function ln(e,t,n){return Math.floor(cn(e,t,n))}function un(e){return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function hn(e,t){return e-Math.floor(e/t)*t}function _n(e,t){return e=hn(e,2*t),t-Math.abs(e-t)}function fn(e,t,n){return(n-e)/(t-e)}function dn(e){return Math.abs(e.x)>Math.abs(e.y)?Math.abs(e.x)>Math.abs(e.z)?e.x:e.z:Math.abs(e.y)>Math.abs(e.z)?e.y:e.z}function pn(e,t){return Math.abs(e)>Math.abs(t)?e:t}var mn=1/255,gn=e("Color",function(e){function t(t,n,i,r){var o;return(o=e.call(this)||this)._val=0,"string"==typeof t?o.fromHEX(t):void 0!==n?o.set(t,n,i,r):o.set(t),o}K(t,e),t.clone=function(e){var n=new t;return e._val?n._val=e._val:n._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,n},t.copy=function(e,t){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,e},t.set=function(e,t,n,i,r){return e.r=t,e.g=n,e.b=i,e.a=r,e},t.fromHEX=function(e,t){return t=0===t.indexOf("#")?t.substring(1):t,e.r=parseInt(t.substr(0,2),16)||0,e.g=parseInt(t.substr(2,2),16)||0,e.b=parseInt(t.substr(4,2),16)||0,e.a=parseInt(t.substr(6,2),16)||255,e._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,e},t.add=function(e,t,n){return e.r=t.r+n.r,e.g=t.g+n.g,e.b=t.b+n.b,e.a=t.a+n.a,e},t.subtract=function(e,t,n){return e.r=t.r-n.r,e.g=t.g-n.g,e.b=t.b-n.b,e.a=t.a-n.a,e},t.multiply=function(e,t,n){return e.r=t.r*n.r,e.g=t.g*n.g,e.b=t.b*n.b,e.a=t.a*n.a,e},t.divide=function(e,t,n){return e.r=t.r/n.r,e.g=t.g/n.g,e.b=t.b/n.b,e.a=t.a/n.a,e},t.scale=function(e,t,n){return e.r=t.r*n,e.g=t.g*n,e.b=t.b*n,e.a=t.a*n,e},t.lerp=function(e,t,n,i){var r=t.r,o=t.g,a=t.b,s=t.a;return r+=(n.r-r)*i,o+=(n.g-o)*i,a+=(n.b-a)*i,s+=(n.a-s)*i,e._val=Math.floor((s<<24>>>0)+(a<<16)+(o<<8)+r),e},t.toArray=function(e,n,i){void 0===i&&(i=0);var r=n instanceof t||n.a>1?1/255:1;return e[i+0]=n.r*r,e[i+1]=n.g*r,e[i+2]=n.b*r,e[i+3]=n.a*r,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),t.r=255*e[n+0],t.g=255*e[n+1],t.b=255*e[n+2],t.a=255*e[n+3],t},t.strictEquals=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a},t.equals=function(e,t,n){return void 0===n&&(n=Kt),Math.abs(e.r-t.r)<=n*Math.max(1,Math.abs(e.r),Math.abs(t.r))&&Math.abs(e.g-t.g)<=n*Math.max(1,Math.abs(e.g),Math.abs(t.g))&&Math.abs(e.b-t.b)<=n*Math.max(1,Math.abs(e.b),Math.abs(t.b))&&Math.abs(e.a-t.a)<=n*Math.max(1,Math.abs(e.a),Math.abs(t.a))},t.hex=function(e){return(255*e.r<<24|255*e.g<<16|255*e.b<<8|255*e.a)>>>0};var n=t.prototype;return n.clone=function(){var e=new t;return e._val=this._val,e},n.equals=function(e){return e&&this._val===e._val},n.lerp=function(e,t){var n=this.r,i=this.g,r=this.b,o=this.a;return n+=(e.r-n)*t,i+=(e.g-i)*t,r+=(e.b-r)*t,o+=(e.a-o)*t,this._val=Math.floor((o<<24>>>0)+(r<<16)+(i<<8)+n),this},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.toCSS=function(e){return void 0===e&&(e="rgba"),"rgba"===e?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*mn).toFixed(2)+")":"rgb"===e?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(e)},n.fromHEX=function(e){e=0===e.indexOf("#")?e.substring(1):e;var t=parseInt(e.substr(0,2),16)||0,n=parseInt(e.substr(2,2),16)||0,i=parseInt(e.substr(4,2),16)||0,r=parseInt(e.substr(6,2),16)||255;return this._val=(r<<24>>>0)+(i<<16)+(n<<8)+(0|t),this},n.toHEX=function(e){void 0===e&&(e="#rrggbb");var t="0",n=[(this.r<16?t:"")+this.r.toString(16),(this.g<16?t:"")+this.g.toString(16),(this.b<16?t:"")+this.b.toString(16)];return"#rgb"===e?(n[0]=n[0][0],n[1]=n[1][0],n[2]=n[2][0]):"#rrggbbaa"===e&&n.push((this.a<16?t:"")+this.a.toString(16)),n.join("")},n.toRGBValue=function(){return 16777215&this._val},n.fromHSV=function(e,t,n){var i=0,r=0,o=0;if(0===t)i=r=o=n;else if(0===n)i=r=o=0;else{1===e&&(e=0),e*=6;var a=Math.floor(e),s=e-a,c=n*(1-t),l=n*(1-t*s),u=n*(1-t*(1-s));switch(a){case 0:i=n,r=u,o=c;break;case 1:i=l,r=n,o=c;break;case 2:i=c,r=n,o=u;break;case 3:i=c,r=l,o=n;break;case 4:i=u,r=c,o=n;break;case 5:i=n,r=c,o=l}}return i*=255,r*=255,o*=255,this._val=(this.a<<24>>>0)+(o<<16)+(r<<8)+(0|i),this},n.toHSV=function(){var e=this.r*mn,t=this.g*mn,n=this.b*mn,i={h:0,s:0,v:0},r=Math.max(e,t,n),o=Math.min(e,t,n),a=0;return i.v=r,i.s=r?(r-o)/r:0,i.s?(a=r-o,i.h=e===r?(t-n)/a:t===r?2+(n-e)/a:4+(e-t)/a,i.h/=6,i.h<0&&(i.h+=1)):i.h=0,i},n.set=function(e,t,n,i){return"object"==typeof e?null!=e._val?this._val=e._val:(t=e.g||0,n=e.b||0,i="number"==typeof e.a?e.a:255,e=e.r||0,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)):(e=e||0,t=t||0,n=n||0,i="number"==typeof i?i:255,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)),this},n.multiply=function(e){var t=(255&this._val)*e.r>>8,n=(65280&this._val)*e.g>>8,i=(16711680&this._val)*e.b>>8,r=((4278190080&this._val)>>>8)*e.a;return this._val=4278190080&r|16711680&i|65280&n|255&t,this},n._set_r_unsafe=function(e){return this._val=(4294967040&this._val|e)>>>0,this},n._set_g_unsafe=function(e){return this._val=(4294902015&this._val|e<<8)>>>0,this},n._set_b_unsafe=function(e){return this._val=(4278255615&this._val|e<<16)>>>0,this},n._set_a_unsafe=function(e){return this._val=(16777215&this._val|e<<24)>>>0,this},X(t,[{key:"r",get:function(){return 255&this._val},set:function(e){e=~~Jt(e,0,255),this._val=(4294967040&this._val|e)>>>0}},{key:"g",get:function(){return(65280&this._val)>>8},set:function(e){e=~~Jt(e,0,255),this._val=(4294902015&this._val|e<<8)>>>0}},{key:"b",get:function(){return(16711680&this._val)>>16},set:function(e){e=~~Jt(e,0,255),this._val=(4278255615&this._val|e<<16)>>>0}},{key:"a",get:function(){return(4278190080&this._val)>>>24},set:function(e){e=~~Jt(e,0,255),this._val=(16777215&this._val|e<<24)>>>0}},{key:"x",get:function(){return this.r*mn},set:function(e){this.r=255*e}},{key:"y",get:function(){return this.g*mn},set:function(e){this.g=255*e}},{key:"z",get:function(){return this.b*mn},set:function(e){this.b=255*e}},{key:"w",get:function(){return this.a*mn},set:function(e){this.a=255*e}}]),t}(tt));function vn(e,t,n,i){return new gn(e,t,n,i)}gn.WHITE=Object.freeze(new gn(255,255,255,255)),gn.GRAY=Object.freeze(new gn(127,127,127,255)),gn.BLACK=Object.freeze(new gn(0,0,0,255)),gn.TRANSPARENT=Object.freeze(new gn(0,0,0,0)),gn.RED=Object.freeze(new gn(255,0,0,255)),gn.GREEN=Object.freeze(new gn(0,255,0,255)),gn.BLUE=Object.freeze(new gn(0,0,255,255)),gn.CYAN=Object.freeze(new gn(0,255,255,255)),gn.MAGENTA=Object.freeze(new gn(255,0,255,255)),gn.YELLOW=Object.freeze(new gn(255,255,0,255)),Wt.fastDefine("cc.Color",gn,{r:0,g:0,b:0,a:255}),i.Color=gn,i.color=vn;var yn=e("Vec3",function(e){function t(t,n,i){var r;return r=e.call(this)||this,t&&"object"==typeof t?(r.x=t.x,r.y=t.y,r.z=t.z):(r.x=t||0,r.y=n||0,r.z=i||0),r}K(t,e),t.zero=function(e){return e.x=0,e.y=0,e.z=0,e},t.clone=function(e){return new t(e.x,e.y,e.z)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e},t.set=function(e,t,n,i){return e.x=t,e.y=n,e.z=i,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return Math.sqrt(n*n+i*i+r*r)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return n*n+i*i+r*r},t.len=function(e){var t=e.x,n=e.y,i=e.z;return Math.sqrt(t*t+n*n+i*i)},t.lengthSqr=function(e){var t=e.x,n=e.y,i=e.z;return t*t+n*n+i*i},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e},t.invert=function(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e},t.invertSafe=function(e,t){var n=t.x,i=t.y,r=t.z;return Math.abs(n)<Kt?e.x=0:e.x=1/n,Math.abs(i)<Kt?e.y=0:e.y=1/i,Math.abs(r)<Kt?e.z=0:e.z=1/r,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=t.z,o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),e.x=n*o,e.y=i*o,e.z=r*o),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.cross=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.x,s=n.y,c=n.z;return e.x=r*c-o*s,e.y=o*a-i*c,e.z=i*s-r*a,e},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e},t.random=function(e,t){t=t||1;var n=2*rn()*Math.PI,i=2*rn()-1,r=Math.sqrt(1-i*i);return e.x=r*Math.cos(n)*t,e.y=r*Math.sin(n)*t,e.z=i*t,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.m03*i+n.m07*r+n.m11*o+n.m15;return a=a?Math.abs(1/a):1,e.x=(n.m00*i+n.m04*r+n.m08*o+n.m12)*a,e.y=(n.m01*i+n.m05*r+n.m09*o+n.m13)*a,e.z=(n.m02*i+n.m06*r+n.m10*o+n.m14)*a,e},t.transformMat4Normal=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.m03*i+n.m07*r+n.m11*o;return a=a?Math.abs(1/a):1,e.x=(n.m00*i+n.m04*r+n.m08*o)*a,e.y=(n.m01*i+n.m05*r+n.m09*o)*a,e.z=(n.m02*i+n.m06*r+n.m10*o)*a,e},t.transformMat3=function(e,t,n){var i=t.x,r=t.y,o=t.z;return e.x=i*n.m00+r*n.m03+o*n.m06,e.y=i*n.m01+r*n.m04+o*n.m07,e.z=i*n.m02+r*n.m05+o*n.m08,e},t.transformAffine=function(e,t,n){var i=t.x,r=t.y,o=t.z;return e.x=n.m00*i+n.m04*r+n.m08*o+n.m12,e.y=n.m01*i+n.m05*r+n.m09*o+n.m13,e.x=n.m02*i+n.m06*r+n.m10*o+n.m14,e},t.transformQuat=function(e,t,n){var i=n.w*t.x+n.y*t.z-n.z*t.y,r=n.w*t.y+n.z*t.x-n.x*t.z,o=n.w*t.z+n.x*t.y-n.y*t.x,a=-n.x*t.x-n.y*t.y-n.z*t.z;return e.x=i*n.w+a*-n.x+r*-n.z-o*-n.y,e.y=r*n.w+a*-n.y+o*-n.x-i*-n.z,e.z=o*n.w+a*-n.z+i*-n.y-r*-n.x,e},t.transformRTS=function(e,t,n,i,r){var o=t.x*r.x,a=t.y*r.y,s=t.z*r.z,c=n.w*o+n.y*s-n.z*a,l=n.w*a+n.z*o-n.x*s,u=n.w*s+n.x*a-n.y*o,h=-n.x*o-n.y*a-n.z*s;return e.x=c*n.w+h*-n.x+l*-n.z-u*-n.y+i.x,e.y=l*n.w+h*-n.y+u*-n.x-c*-n.z+i.y,e.z=u*n.w+h*-n.z+c*-n.y-l*-n.x+i.z,e},t.transformInverseRTS=function(e,t,n,i,r){var o=t.x-i.x,a=t.y-i.y,s=t.z-i.z,c=n.w*o-n.y*s+n.z*a,l=n.w*a-n.z*o+n.x*s,u=n.w*s-n.x*a+n.y*o,h=n.x*o+n.y*a+n.z*s;return e.x=(c*n.w+h*n.x+l*n.z-u*n.y)/r.x,e.y=(l*n.w+h*n.y+u*n.x-c*n.z)/r.y,e.z=(u*n.w+h*n.z+c*n.y-l*n.x)/r.z,e},t.rotateX=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r,u=o*s-a*c,h=o*c+a*s;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.rotateY=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=a*c+r*s,u=o,h=a*s-r*c;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.rotateZ=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r*s-o*c,u=r*c+o*s,h=a;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z},t.equals=function(e,t,n){void 0===n&&(n=Kt);var i=e.x,r=e.y,o=e.z,a=t.x,s=t.y,c=t.z;return Math.abs(i-a)<=n*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-s)<=n*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-c)<=n*Math.max(1,Math.abs(o),Math.abs(c))},t.angle=function(e,n){t.normalize(Sn,e),t.normalize(En,n);var i=t.dot(Sn,En);return i>1?0:i<-1?Math.PI:Math.acos(i)},t.projectOnPlane=function(e,n,i){return t.subtract(e,n,t.project(e,n,i))},t.project=function(e,n,i){var r=t.lengthSqr(i);return r<1e-6?t.set(e,0,0,0):t.multiplyScalar(e,i,t.dot(n,i)/r)};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z)},n.set=function(e,t,n){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e||0,this.y=t||0,this.z=n||0),this},n.equals=function(e,t){return void 0===t&&(t=Kt),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))},n.equals3f=function(e,t,n,i){return void 0===i&&(i=Kt),Math.abs(this.x-e)<=i*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=i*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-n)<=i*Math.max(1,Math.abs(this.z),Math.abs(n))},n.strictEquals=function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},n.strictEquals3f=function(e,t,n){return this.x===e&&this.y===t&&this.z===n},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},n.lerp=function(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this.z+=t*(e.z-this.z),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},n.add3f=function(e,t,n){return this.x+=e,this.y+=t,this.z+=n,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},n.subtract3f=function(e,t,n){return this.x-=e,this.y-=t,this.z-=n,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x*=e,this.y*=e,this.z*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this.z*=e.z,this},n.multiply3f=function(e,t,n){return this.x*=e,this.y*=t,this.z*=n,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},n.divide3f=function(e,t,n){return this.x/=e,this.y/=t,this.z/=n,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.clampf=function(e,t){return this.x=Jt(this.x,e.x,t.x),this.y=Jt(this.y,e.y,t.y),this.z=Jt(this.z,e.z,t.z),this},n.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},n.cross=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-i*o,this.y=i*r-t*a,this.z=t*o-n*r,this},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.normalize=function(){var e=this.x,t=this.y,n=this.z,i=e*e+t*t+n*n;return i>0&&(i=1/Math.sqrt(i),this.x=e*i,this.y=t*i,this.z=n*i),this},n.transformMat4=function(e){var t=this.x,n=this.y,i=this.z,r=e.m03*t+e.m07*n+e.m11*i+e.m15;return r=r?1/r:1,this.x=(e.m00*t+e.m04*n+e.m08*i+e.m12)*r,this.y=(e.m01*t+e.m05*n+e.m09*i+e.m13)*r,this.z=(e.m02*t+e.m06*n+e.m10*i+e.m14)*r,this},t}(tt));yn.UNIT_X=Object.freeze(new yn(1,0,0)),yn.UNIT_Y=Object.freeze(new yn(0,1,0)),yn.UNIT_Z=Object.freeze(new yn(0,0,1)),yn.RIGHT=Object.freeze(new yn(1,0,0)),yn.UP=Object.freeze(new yn(0,1,0)),yn.FORWARD=Object.freeze(new yn(0,0,-1)),yn.ZERO=Object.freeze(new yn(0,0,0)),yn.ONE=Object.freeze(new yn(1,1,1)),yn.NEG_ONE=Object.freeze(new yn(-1,-1,-1));var Sn=new yn,En=new yn;function Tn(e,t,n){return new yn(e,t,n)}Wt.fastDefine("cc.Vec3",yn,{x:0,y:0,z:0}),i.Vec3=yn,i.v3=Tn;var xn=e("Mat3",function(e){function t(t,n,i,r,o,a,s,c,l){var u;return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),u=e.call(this)||this,"object"==typeof t?(u.m00=t.m00,u.m01=t.m01,u.m02=t.m02,u.m03=t.m03,u.m04=t.m04,u.m05=t.m05,u.m06=t.m06,u.m07=t.m07,u.m08=t.m08):(u.m00=t,u.m01=n,u.m02=i,u.m03=r,u.m04=o,u.m05=a,u.m06=s,u.m07=c,u.m08=l),u}K(t,e),t.clone=function(e){return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08)},t.copy=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e},t.set=function(e,t,n,i,r,o,a,s,c,l){return e.m00=t,e.m01=n,e.m02=i,e.m03=r,e.m04=o,e.m05=a,e.m06=s,e.m07=c,e.m08=l,e},t.identity=function(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.transpose=function(e,t){if(e===t){var n=t.m01,i=t.m02,r=t.m05;e.m01=t.m03,e.m02=t.m06,e.m03=n,e.m05=t.m07,e.m06=i,e.m07=r}else e.m00=t.m00,e.m01=t.m03,e.m02=t.m06,e.m03=t.m01,e.m04=t.m04,e.m05=t.m07,e.m06=t.m02,e.m07=t.m05,e.m08=t.m08;return e},t.invert=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=u*a-s*l,_=-u*o+s*c,f=l*o-a*c,d=n*h+i*_+r*f;return 0===d?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e):(d=1/d,e.m00=h*d,e.m01=(-u*i+r*l)*d,e.m02=(s*i-r*a)*d,e.m03=_*d,e.m04=(u*n-r*c)*d,e.m05=(-s*n+r*o)*d,e.m06=f*d,e.m07=(-l*n+i*c)*d,e.m08=(a*n-i*o)*d,e)},t.determinant=function(e){var t=e.m00,n=e.m01,i=e.m02,r=e.m03,o=e.m04,a=e.m05,s=e.m06,c=e.m07,l=e.m08;return t*(l*o-a*c)+n*(-l*r+a*s)+i*(c*r-o*s)},t.multiply=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.m00,f=n.m01,d=n.m02,p=n.m03,m=n.m04,g=n.m05,v=n.m06,y=n.m07,S=n.m08;return e.m00=_*i+f*a+d*l,e.m01=_*r+f*s+d*u,e.m02=_*o+f*c+d*h,e.m03=p*i+m*a+g*l,e.m04=p*r+m*s+g*u,e.m05=p*o+m*c+g*h,e.m06=v*i+y*a+S*l,e.m07=v*r+y*s+S*u,e.m08=v*o+y*c+S*h,e},t.multiplyMat4=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.m00,f=n.m01,d=n.m02,p=n.m04,m=n.m05,g=n.m06,v=n.m08,y=n.m09,S=n.m10;return e.m00=_*i+f*a+d*l,e.m01=_*r+f*s+d*u,e.m02=_*o+f*c+d*h,e.m03=p*i+m*a+g*l,e.m04=p*r+m*s+g*u,e.m05=p*o+m*c+g*h,e.m06=v*i+y*a+S*l,e.m07=v*r+y*s+S*u,e.m08=v*o+y*c+S*h,e},t.transform=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.x,f=n.y;return e.m00=i,e.m01=r,e.m02=o,e.m03=a,e.m04=s,e.m05=c,e.m06=_*i+f*a+l,e.m07=_*r+f*s+u,e.m08=_*o+f*c+h,e},t.scale=function(e,t,n){var i=n.x,r=n.y;return e.m00=i*t.m00,e.m01=i*t.m01,e.m02=i*t.m02,e.m03=r*t.m03,e.m04=r*t.m04,e.m05=r*t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e},t.rotate=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=Math.sin(n),f=Math.cos(n);return e.m00=f*i+_*a,e.m01=f*r+_*s,e.m02=f*o+_*c,e.m03=f*a-_*i,e.m04=f*s-_*r,e.m05=f*c-_*o,e.m06=l,e.m07=u,e.m08=h,e},t.fromMat4=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m04,e.m04=t.m05,e.m05=t.m06,e.m06=t.m08,e.m07=t.m09,e.m08=t.m10,e},t.fromViewUp=function(e,n,i){return yn.lengthSqr(n)<Kt*Kt?(t.identity(e),e):(i=i||yn.UNIT_Y,yn.normalize(An,yn.cross(An,i,n)),yn.lengthSqr(An)<Kt*Kt?(t.identity(e),e):(yn.cross(Cn,n,An),t.set(e,An.x,An.y,An.z,Cn.x,Cn.y,Cn.z,n.x,n.y,n.z),e))},t.fromTranslation=function(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=t.x,e.m07=t.y,e.m08=1,e},t.fromScaling=function(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=t.y,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=-n,e.m04=i,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.fromQuat=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n+n,s=i+i,c=r+r,l=n*a,u=i*a,h=i*s,_=r*a,f=r*s,d=r*c,p=o*a,m=o*s,g=o*c;return e.m00=1-h-d,e.m03=u-g,e.m06=_+m,e.m01=u+g,e.m04=1-l-d,e.m07=f-p,e.m02=_-m,e.m05=f+p,e.m08=1-l-h,e},t.inverseTransposeMat4=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,d=t.m12,p=t.m13,m=t.m14,g=t.m15,v=n*s-i*a,y=n*c-r*a,S=n*l-o*a,E=i*c-r*s,T=i*l-o*s,x=r*l-o*c,A=u*p-h*d,C=u*m-_*d,b=u*g-f*d,w=h*m-_*p,R=h*g-f*p,I=_*g-f*m,P=v*I-y*R+S*w+E*b-T*C+x*A;return P?(P=1/P,e.m00=(s*I-c*R+l*w)*P,e.m01=(c*b-a*I-l*C)*P,e.m02=(a*R-s*b+l*A)*P,e.m03=(r*R-i*I-o*w)*P,e.m04=(n*I-r*b+o*C)*P,e.m05=(i*b-n*R-o*A)*P,e.m06=(p*x-m*T+g*E)*P,e.m07=(m*S-d*x-g*y)*P,e.m08=(d*T-p*S+g*v)*P,e):null},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e},t.add=function(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e},t.subtract=function(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e},t.multiplyScalar=function(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e.m00=n.m00*i+t.m00,e.m01=n.m01*i+t.m01,e.m02=n.m02*i+t.m02,e.m03=n.m03*i+t.m03,e.m04=n.m04*i+t.m04,e.m05=n.m05*i+t.m05,e.m06=n.m06*i+t.m06,e.m07=n.m07*i+t.m07,e.m08=n.m08*i+t.m08,e},t.strictEquals=function(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08},t.equals=function(e,t,n){return void 0===n&&(n=Kt),Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))};var n=t.prototype;return n.clone=function(){var e=this;return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08)},n.set=function(e,t,n,i,r,o,a,s,c){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=1),"object"==typeof e?(this.m00=e.m00,this.m01=e.m01,this.m02=e.m02,this.m03=e.m03,this.m04=e.m04,this.m05=e.m05,this.m06=e.m06,this.m07=e.m07,this.m08=e.m08):(this.m00=e,this.m01=t,this.m02=n,this.m03=i,this.m04=r,this.m05=o,this.m06=a,this.m07=s,this.m08=c),this},n.equals=function(e,t){return void 0===t&&(t=Kt),Math.abs(this.m00-e.m00)<=t*Math.max(1,Math.abs(this.m00),Math.abs(e.m00))&&Math.abs(this.m01-e.m01)<=t*Math.max(1,Math.abs(this.m01),Math.abs(e.m01))&&Math.abs(this.m02-e.m02)<=t*Math.max(1,Math.abs(this.m02),Math.abs(e.m02))&&Math.abs(this.m03-e.m03)<=t*Math.max(1,Math.abs(this.m03),Math.abs(e.m03))&&Math.abs(this.m04-e.m04)<=t*Math.max(1,Math.abs(this.m04),Math.abs(e.m04))&&Math.abs(this.m05-e.m05)<=t*Math.max(1,Math.abs(this.m05),Math.abs(e.m05))&&Math.abs(this.m06-e.m06)<=t*Math.max(1,Math.abs(this.m06),Math.abs(e.m06))&&Math.abs(this.m07-e.m07)<=t*Math.max(1,Math.abs(this.m07),Math.abs(e.m07))&&Math.abs(this.m08-e.m08)<=t*Math.max(1,Math.abs(this.m08),Math.abs(e.m08))},n.strictEquals=function(e){return this.m00===e.m00&&this.m01===e.m01&&this.m02===e.m02&&this.m03===e.m03&&this.m04===e.m04&&this.m05===e.m05&&this.m06===e.m06&&this.m07===e.m07&&this.m08===e.m08},n.toString=function(){var e=this;return"[\n"+e.m00+", "+e.m01+", "+e.m02+",\n"+e.m03+",\n"+e.m04+", "+e.m05+",\n"+e.m06+", "+e.m07+",\n"+e.m08+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this},n.transpose=function(){var e=this.m01,t=this.m02,n=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=e,this.m05=this.m07,this.m06=t,this.m07=n,this},n.invert=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=c*r-o*s,u=-c*i+o*a,h=s*i-r*a,_=e*l+t*u+n*h;return 0===_?(this.set(0,0,0,0,0,0,0,0,0),this):(_=1/_,this.m00=l*_,this.m01=(-c*t+n*s)*_,this.m02=(o*t-n*r)*_,this.m03=u*_,this.m04=(c*e-n*a)*_,this.m05=(-o*e+n*i)*_,this.m06=h*_,this.m07=(-s*e+t*a)*_,this.m08=(r*e-t*i)*_,this)},n.determinant=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08;return e*(c*r-o*s)+t*(-c*i+o*a)+n*(s*i-r*a)},n.add=function(e){return this.m00+=e.m00,this.m01+=e.m01,this.m02+=e.m02,this.m03+=e.m03,this.m04+=e.m04,this.m05+=e.m05,this.m06+=e.m06,this.m07+=e.m07,this.m08+=e.m08,this},n.subtract=function(e){return this.m00-=e.m00,this.m01-=e.m01,this.m02-=e.m02,this.m03-=e.m03,this.m04-=e.m04,this.m05-=e.m05,this.m06-=e.m06,this.m07-=e.m07,this.m08-=e.m08,this},n.multiply=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=e.m00,h=e.m01,_=e.m02,f=e.m03,d=e.m04,p=e.m05,m=e.m06,g=e.m07,v=e.m08;return this.m00=u*t+h*r+_*s,this.m01=u*n+h*o+_*c,this.m02=u*i+h*a+_*l,this.m03=f*t+d*r+p*s,this.m04=f*n+d*o+p*c,this.m05=f*i+d*a+p*l,this.m06=m*t+g*r+v*s,this.m07=m*n+g*o+v*c,this.m08=m*i+g*a+v*l,this},n.multiplyScalar=function(e){return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=e,this.m05*=e,this.m06*=e,this.m07*=e,this.m08*=e,this},n.scale=function(e){var t=e.x,n=e.y;return this.m00=t*this.m00,this.m01=t*this.m01,this.m02=t*this.m02,this.m03=n*this.m03,this.m04=n*this.m04,this.m05=n*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this},n.rotate=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=Math.sin(e),h=Math.cos(e);return this.m00=h*t+u*r,this.m01=h*n+u*o,this.m02=h*i+u*a,this.m03=h*r-u*t,this.m04=h*o-u*n,this.m05=h*a-u*i,this.m06=s,this.m07=c,this.m08=l,this},n.fromQuat=function(e){var t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,a=n+n,s=i+i,c=t*o,l=n*o,u=n*a,h=i*o,_=i*a,f=i*s,d=r*o,p=r*a,m=r*s;return this.m00=1-u-f,this.m03=l-m,this.m06=h+p,this.m01=l+m,this.m04=1-c-f,this.m07=_-d,this.m02=h-p,this.m05=_+d,this.m08=1-c-u,this},t}(tt));xn.IDENTITY=Object.freeze(new xn);var An=new yn,Cn=new yn;Wt.fastDefine("cc.Mat3",xn,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),i.Mat3=xn;var bn=e("Quat",function(e){function t(t,n,i,r){var o;return o=e.call(this)||this,t&&"object"==typeof t?(o.x=t.x,o.y=t.y,o.z=t.z,o.w=t.w):(o.x=t||0,o.y=n||0,o.z=i||0,o.w=null!=r?r:1),o}K(t,e),t.clone=function(e){return new t(e.x,e.y,e.z,e.w)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},t.set=function(e,t,n,i,r){return e.x=t,e.y=n,e.z=i,e.w=r,e},t.identity=function(e){return e.x=0,e.y=0,e.z=0,e.w=1,e},t.rotationTo=function(e,n,i){var r=yn.dot(n,i);return r<-.999999?(yn.cross(In,yn.UNIT_X,n),In.length()<1e-6&&yn.cross(In,yn.UNIT_Y,n),yn.normalize(In,In),t.fromAxisAngle(e,In,Math.PI),e):r>.999999?(e.x=0,e.y=0,e.z=0,e.w=1,e):(yn.cross(In,n,i),e.x=In.x,e.y=In.y,e.z=In.z,e.w=1+r,t.normalize(e,e))},t.getAxisAngle=function(e,t){var n=2*Math.acos(t.w),i=Math.sin(n/2);return 0!==i?(e.x=t.x/i,e.y=t.y/i,e.z=t.z/i):(e.x=1,e.y=0,e.z=0),n},t.multiply=function(e,t,n){var i=t.x*n.w+t.w*n.x+t.y*n.z-t.z*n.y,r=t.y*n.w+t.w*n.y+t.z*n.x-t.x*n.z,o=t.z*n.w+t.w*n.z+t.x*n.y-t.y*n.x,a=t.w*n.w-t.x*n.x-t.y*n.y-t.z*n.z;return e.x=i,e.y=r,e.z=o,e.w=a,e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e},t.rotateX=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r+c*i,e.y=a*r+s*i,e.z=s*r-a*i,e.w=c*r-o*i,e},t.rotateY=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r-s*i,e.y=a*r+c*i,e.z=s*r+o*i,e.w=c*r-a*i,e},t.rotateZ=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r+a*i,e.y=a*r-o*i,e.z=s*r+c*i,e.w=c*r-s*i,e},t.rotateAround=function(e,n,i,r){return t.invert(wn,n),yn.transformQuat(In,i,wn),t.fromAxisAngle(wn,In,r),t.multiply(e,n,wn),e},t.rotateAroundLocal=function(e,n,i,r){return t.fromAxisAngle(wn,i,r),t.multiply(e,n,wn),e},t.calculateW=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=Math.sqrt(Math.abs(1-t.x*t.x-t.y*t.y-t.z*t.z)),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e},t.slerp=function(e,t,n,i){var r=0,o=0,a=n.x,s=n.y,c=n.z,l=n.w,u=t.x*n.x+t.y*n.y+t.z*n.z+t.w*n.w;if(u<0&&(u=-u,a=-a,s=-s,c=-c,l=-l),1-u>1e-6){var h=Math.acos(u),_=Math.sin(h);r=Math.sin((1-i)*h)/_,o=Math.sin(i*h)/_}else r=1-i,o=i;return e.x=r*t.x+o*a,e.y=r*t.y+o*s,e.z=r*t.z+o*c,e.w=r*t.w+o*l,e},t.sqlerp=function(e,n,i,r,o,a){return t.slerp(wn,n,o,a),t.slerp(Rn,i,r,a),t.slerp(e,wn,Rn,2*a*(1-a)),e},t.invert=function(e,t){var n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w,i=n?1/n:0;return e.x=-t.x*i,e.y=-t.y*i,e.z=-t.z*i,e.w=t.w*i,e},t.conjugate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=t.w,e},t.len=function(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w)},t.lengthSqr=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},t.normalize=function(e,t){var n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w;return n>0&&(n=1/Math.sqrt(n),e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n),e},t.fromAxes=function(e,n,i,r){return xn.set(Pn,n.x,n.y,n.z,i.x,i.y,i.z,r.x,r.y,r.z),t.normalize(e,t.fromMat3(e,Pn))},t.fromViewUp=function(e,n,i){return xn.fromViewUp(Pn,n,i),t.normalize(e,t.fromMat3(e,Pn))},t.fromAxisAngle=function(e,t,n){n*=.5;var i=Math.sin(n);return e.x=i*t.x,e.y=i*t.y,e.z=i*t.z,e.w=Math.cos(n),e},t.fromMat3=function(e,t){var n=t.m00,i=t.m03,r=t.m06,o=t.m01,a=t.m04,s=t.m07,c=t.m02,l=t.m05,u=t.m08,h=n+a+u;if(h>0){var _=.5/Math.sqrt(h+1);e.w=.25/_,e.x=(l-s)*_,e.y=(r-c)*_,e.z=(o-i)*_}else if(n>a&&n>u){var f=2*Math.sqrt(1+n-a-u);e.w=(l-s)/f,e.x=.25*f,e.y=(i+o)/f,e.z=(r+c)/f}else if(a>u){var d=2*Math.sqrt(1+a-n-u);e.w=(r-c)/d,e.x=(i+o)/d,e.y=.25*d,e.z=(s+l)/d}else{var p=2*Math.sqrt(1+u-n-a);e.w=(o-i)/p,e.x=(r+c)/p,e.y=(s+l)/p,e.z=.25*p}return e},t.fromEuler=function(e,t,n,i){t*=On,n*=On,i*=On;var r=Math.sin(t),o=Math.cos(t),a=Math.sin(n),s=Math.cos(n),c=Math.sin(i),l=Math.cos(i);return e.x=r*s*l+o*a*c,e.y=o*a*l+r*s*c,e.z=o*s*c-r*a*l,e.w=o*s*l-r*a*c,e},t.fromAngleZ=function(e,t){return t*=On,e.x=e.y=0,e.z=Math.sin(t),e.w=Math.cos(t),e},t.toAxisX=function(e,t){var n=2*t.y,i=2*t.z;return e.x=1-n*t.y-i*t.z,e.y=n*t.x+i*t.w,e.z=i*t.x+n*t.w,e},t.toAxisY=function(e,t){var n=2*t.x,i=2*t.y,r=2*t.z;return e.x=i*t.x-r*t.w,e.y=1-n*t.x-r*t.z,e.z=r*t.y+n*t.w,e},t.toAxisZ=function(e,t){var n=2*t.x,i=2*t.y,r=2*t.z;return e.x=r*t.x-i*t.w,e.y=r*t.y-n*t.w,e.z=1-n*t.x-i*t.y,e},t.toEuler=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w,s=0,c=0,l=0,u=i*r+o*a;if(u>.499999)s=0,c=nn(2*Math.atan2(i,a)),l=90;else if(u<-.499999)s=0,c=-nn(2*Math.atan2(i,a)),l=-90;else{var h=i*i,_=r*r,f=o*o;s=nn(Math.atan2(2*i*a-2*r*o,1-2*h-2*f)),c=nn(Math.atan2(2*r*a-2*i*o,1-2*_-2*f)),l=nn(Math.asin(2*u)),n&&(s=-180*Math.sign(s+1e-6)+s,c=-180*Math.sign(c+1e-6)+c,l=180*Math.sign(l+1e-6)-l)}return e.x=s,e.y=c,e.z=l,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},t.equals=function(e,t,n){return void 0===n&&(n=Kt),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z,this.w)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=null!=i?i:1),this},n.equals=function(e,t){return void 0===t&&(t=Kt),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))&&Math.abs(this.w-e.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(e.w))},n.strictEquals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},n.getEulerAngles=function(e){return t.toEuler(e,this)},n.lerp=function(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this.z+=t*(e.z-this.z),this.w+=t*(e.w-this.w),this},n.slerp=function(e,n){return t.slerp(this,this,e,n)},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t}(tt));bn.IDENTITY=Object.freeze(new bn);var wn=new bn,Rn=new bn,In=new yn,Pn=new xn,On=.5*Math.PI/180;function Dn(e,t,n,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),new bn(e,t,n,i)}Wt.fastDefine("cc.Quat",bn,{x:0,y:0,z:0,w:1}),i.Quat=bn,i.quat=Dn;var Nn=Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])]),Mn=e("Mat4",function(e){function t(t,n,i,r,o,a,s,c,l,u,h,_,f,d,p,m){var g;return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=1),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===p&&(p=0),void 0===m&&(m=1),(g=e.call(this)||this).m00=void 0,g.m01=void 0,g.m02=void 0,g.m03=void 0,g.m04=void 0,g.m05=void 0,g.m06=void 0,g.m07=void 0,g.m08=void 0,g.m09=void 0,g.m10=void 0,g.m11=void 0,g.m12=void 0,g.m13=void 0,g.m14=void 0,g.m15=void 0,"object"==typeof t?(g.m00=t.m00,g.m01=t.m01,g.m02=t.m02,g.m03=t.m03,g.m04=t.m04,g.m05=t.m05,g.m06=t.m06,g.m07=t.m07,g.m08=t.m08,g.m09=t.m09,g.m10=t.m10,g.m11=t.m11,g.m12=t.m12,g.m13=t.m13,g.m14=t.m14,g.m15=t.m15):(g.m00=t,g.m01=n,g.m02=i,g.m03=r,g.m04=o,g.m05=a,g.m06=s,g.m07=c,g.m08=l,g.m09=u,g.m10=h,g.m11=_,g.m12=f,g.m13=d,g.m14=p,g.m15=m),g}K(t,e),t.clone=function(e){return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08,e.m09,e.m10,e.m11,e.m12,e.m13,e.m14,e.m15)},t.copy=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e},t.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,p,m){return e.m00=t,e.m01=n,e.m02=i,e.m03=r,e.m04=o,e.m05=a,e.m06=s,e.m07=c,e.m08=l,e.m09=u,e.m10=h,e.m11=_,e.m12=f,e.m13=d,e.m14=p,e.m15=m,e},t.identity=function(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.transpose=function(e,t){if(e===t){var n=t.m01,i=t.m02,r=t.m03,o=t.m06,a=t.m07,s=t.m11;e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=n,e.m06=t.m09,e.m07=t.m13,e.m08=i,e.m09=o,e.m11=t.m14,e.m12=r,e.m13=a,e.m14=s}else e.m00=t.m00,e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=t.m01,e.m05=t.m05,e.m06=t.m09,e.m07=t.m13,e.m08=t.m02,e.m09=t.m06,e.m10=t.m10,e.m11=t.m14,e.m12=t.m03,e.m13=t.m07,e.m14=t.m11,e.m15=t.m15;return e},t.invert=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,d=t.m12,p=t.m13,m=t.m14,g=t.m15,v=n*s-i*a,y=n*c-r*a,S=n*l-o*a,E=i*c-r*s,T=i*l-o*s,x=r*l-o*c,A=u*p-h*d,C=u*m-_*d,b=u*g-f*d,w=h*m-_*p,R=h*g-f*p,I=_*g-f*m,P=v*I-y*R+S*w+E*b-T*C+x*A;return 0===P?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=0,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=0,e):(P=1/P,e.m00=(s*I-c*R+l*w)*P,e.m01=(r*R-i*I-o*w)*P,e.m02=(p*x-m*T+g*E)*P,e.m03=(_*T-h*x-f*E)*P,e.m04=(c*b-a*I-l*C)*P,e.m05=(n*I-r*b+o*C)*P,e.m06=(m*S-d*x-g*y)*P,e.m07=(u*x-_*S+f*y)*P,e.m08=(a*R-s*b+l*A)*P,e.m09=(i*b-n*R-o*A)*P,e.m10=(d*T-p*S+g*v)*P,e.m11=(h*S-u*T-f*v)*P,e.m12=(s*C-a*w-c*A)*P,e.m13=(n*w-i*C+r*A)*P,e.m14=(p*y-d*E-m*v)*P,e.m15=(u*E-h*y+_*v)*P,e)},t.determinant=function(e){var t=e.m00,n=e.m01,i=e.m02,r=e.m03,o=e.m04,a=e.m05,s=e.m06,c=e.m07,l=e.m08,u=e.m09,h=e.m10,_=e.m11,f=e.m12,d=e.m13,p=e.m14,m=e.m15;return(t*a-n*o)*(h*m-_*p)-(t*s-i*o)*(u*m-_*d)+(t*c-r*o)*(u*p-h*d)+(n*s-i*a)*(l*m-_*f)-(n*c-r*a)*(l*p-h*f)+(i*c-r*s)*(l*d-u*f)},t.multiply=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=t.m09,f=t.m10,d=t.m11,p=t.m12,m=t.m13,g=t.m14,v=t.m15,y=n.m00,S=n.m01,E=n.m02,T=n.m03;return e.m00=y*i+S*s+E*h+T*p,e.m01=y*r+S*c+E*_+T*m,e.m02=y*o+S*l+E*f+T*g,e.m03=y*a+S*u+E*d+T*v,y=n.m04,S=n.m05,E=n.m06,T=n.m07,e.m04=y*i+S*s+E*h+T*p,e.m05=y*r+S*c+E*_+T*m,e.m06=y*o+S*l+E*f+T*g,e.m07=y*a+S*u+E*d+T*v,y=n.m08,S=n.m09,E=n.m10,T=n.m11,e.m08=y*i+S*s+E*h+T*p,e.m09=y*r+S*c+E*_+T*m,e.m10=y*o+S*l+E*f+T*g,e.m11=y*a+S*u+E*d+T*v,y=n.m12,S=n.m13,E=n.m14,T=n.m15,e.m12=y*i+S*s+E*h+T*p,e.m13=y*r+S*c+E*_+T*m,e.m14=y*o+S*l+E*f+T*g,e.m15=y*a+S*u+E*d+T*v,e},t.transform=function(e,t,n){var i=n.x,r=n.y,o=n.z;if(t===e)e.m12=t.m00*i+t.m04*r+t.m08*o+t.m12,e.m13=t.m01*i+t.m05*r+t.m09*o+t.m13,e.m14=t.m02*i+t.m06*r+t.m10*o+t.m14,e.m15=t.m03*i+t.m07*r+t.m11*o+t.m15;else{var a=t.m00,s=t.m01,c=t.m02,l=t.m03,u=t.m04,h=t.m05,_=t.m06,f=t.m07,d=t.m08,p=t.m09,m=t.m10,g=t.m11;t.m12,t.m13,t.m14,t.m15,e.m00=a,e.m01=s,e.m02=c,e.m03=l,e.m04=u,e.m05=h,e.m06=_,e.m07=f,e.m08=d,e.m09=p,e.m10=m,e.m11=g,e.m12=a*i+u*r+d*o+t.m12,e.m13=s*i+h*r+p*o+t.m13,e.m14=c*i+_*r+m*o+t.m14,e.m15=l*i+f*r+g*o+t.m15}return e},t.translate=function(e,t,n){return console.warn("function changed"),t===e?(e.m12+=n.x,e.m13+=n.y,e.m14+=n.z):(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12+=n.x,e.m13+=n.y,e.m14+=n.z,e.m15=t.m15),e},t.scale=function(e,t,n){var i=n.x,r=n.y,o=n.z;return e.m00=t.m00*i,e.m01=t.m01*i,e.m02=t.m02*i,e.m03=t.m03*i,e.m04=t.m04*r,e.m05=t.m05*r,e.m06=t.m06*r,e.m07=t.m07*r,e.m08=t.m08*o,e.m09=t.m09*o,e.m10=t.m10*o,e.m11=t.m11*o,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e},t.rotate=function(e,t,n,i){var r=i.x,o=i.y,a=i.z,s=Math.sqrt(r*r+o*o+a*a);if(Math.abs(s)<Kt)return null;r*=s=1/s,o*=s,a*=s;var c=Math.sin(n),l=Math.cos(n),u=1-l,h=t.m00,_=t.m01,f=t.m02,d=t.m03,p=t.m04,m=t.m05,g=t.m06,v=t.m07,y=t.m08,S=t.m09,E=t.m10,T=t.m11,x=r*r*u+l,A=o*r*u+a*c,C=a*r*u-o*c,b=r*o*u-a*c,w=o*o*u+l,R=a*o*u+r*c,I=r*a*u+o*c,P=o*a*u-r*c,O=a*a*u+l;return e.m00=h*x+p*A+y*C,e.m01=_*x+m*A+S*C,e.m02=f*x+g*A+E*C,e.m03=d*x+v*A+T*C,e.m04=h*b+p*w+y*R,e.m05=_*b+m*w+S*R,e.m06=f*b+g*w+E*R,e.m07=d*b+v*w+T*R,e.m08=h*I+p*P+y*O,e.m09=_*I+m*P+S*O,e.m10=f*I+g*P+E*O,e.m11=d*I+v*P+T*O,t!==e&&(e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e},t.rotateX=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m04,a=t.m05,s=t.m06,c=t.m07,l=t.m08,u=t.m09,h=t.m10,_=t.m11;return t!==e&&(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m04=o*r+l*i,e.m05=a*r+u*i,e.m06=s*r+h*i,e.m07=c*r+_*i,e.m08=l*r-o*i,e.m09=u*r-a*i,e.m10=h*r-s*i,e.m11=_*r-c*i,e},t.rotateY=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m00,a=t.m01,s=t.m02,c=t.m03,l=t.m08,u=t.m09,h=t.m10,_=t.m11;return t!==e&&(e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=o*r-l*i,e.m01=a*r-u*i,e.m02=s*r-h*i,e.m03=c*r-_*i,e.m08=o*i+l*r,e.m09=a*i+u*r,e.m10=s*i+h*r,e.m11=c*i+_*r,e},t.rotateZ=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m00,a=t.m01,s=t.m02,c=t.m03,l=t.m04,u=t.m05,h=t.m06,_=t.m07;return t!==e&&(e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=o*r+l*i,e.m01=a*r+u*i,e.m02=s*r+h*i,e.m03=c*r+_*i,e.m04=l*r-o*i,e.m05=u*r-a*i,e.m06=h*r-s*i,e.m07=_*r-c*i,e},t.fromTranslation=function(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=t.x,e.m13=t.y,e.m14=t.z,e.m15=1,e},t.fromScaling=function(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=t.y,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=t.z,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromRotation=function(e,t,n){var i=n.x,r=n.y,o=n.z,a=Math.sqrt(i*i+r*r+o*o);if(Math.abs(a)<Kt)return null;i*=a=1/a,r*=a,o*=a;var s=Math.sin(t),c=Math.cos(t),l=1-c;return e.m00=i*i*l+c,e.m01=r*i*l+o*s,e.m02=o*i*l-r*s,e.m03=0,e.m04=i*r*l-o*s,e.m05=r*r*l+c,e.m06=o*r*l+i*s,e.m07=0,e.m08=i*o*l+r*s,e.m09=r*o*l-i*s,e.m10=o*o*l+c,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromXRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=i,e.m06=n,e.m07=0,e.m08=0,e.m09=-n,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromYRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=0,e.m02=-n,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=n,e.m09=0,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromZRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=0,e.m04=-n,e.m05=i,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromRT=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w,s=i+i,c=r+r,l=o+o,u=i*s,h=i*c,_=i*l,f=r*c,d=r*l,p=o*l,m=a*s,g=a*c,v=a*l;return e.m00=1-(f+p),e.m01=h+v,e.m02=_-g,e.m03=0,e.m04=h-v,e.m05=1-(u+p),e.m06=d+m,e.m07=0,e.m08=_+g,e.m09=d-m,e.m10=1-(u+f),e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e},t.getTranslation=function(e,t){return e.x=t.m12,e.y=t.m13,e.z=t.m14,e},t.getScaling=function(e,t){var n=Bn.m00=t.m00,i=Bn.m01=t.m01,r=Bn.m02=t.m02,o=Bn.m03=t.m04,a=Bn.m04=t.m05,s=Bn.m05=t.m06,c=Bn.m06=t.m08,l=Bn.m07=t.m09,u=Bn.m08=t.m10;return e.x=Math.sqrt(n*n+i*i+r*r),e.y=Math.sqrt(o*o+a*a+s*s),e.z=Math.sqrt(c*c+l*l+u*u),xn.determinant(Bn)<0&&(e.x*=-1),e},t.getRotation=function(e,t){var n=t.m00+t.m05+t.m10,i=0;return n>0?(i=2*Math.sqrt(n+1),e.w=.25*i,e.x=(t.m06-t.m09)/i,e.y=(t.m08-t.m02)/i,e.z=(t.m01-t.m04)/i):t.m00>t.m05&&t.m00>t.m10?(i=2*Math.sqrt(1+t.m00-t.m05-t.m10),e.w=(t.m06-t.m09)/i,e.x=.25*i,e.y=(t.m01+t.m04)/i,e.z=(t.m08+t.m02)/i):t.m05>t.m10?(i=2*Math.sqrt(1+t.m05-t.m00-t.m10),e.w=(t.m08-t.m02)/i,e.x=(t.m01+t.m04)/i,e.y=.25*i,e.z=(t.m06+t.m09)/i):(i=2*Math.sqrt(1+t.m10-t.m00-t.m05),e.w=(t.m01-t.m04)/i,e.x=(t.m08+t.m02)/i,e.y=(t.m06+t.m09)/i,e.z=.25*i),e},t.toRTS=function(e,t,n,i){i.x=yn.set(Ln,e.m00,e.m01,e.m02).length(),Bn.m00=e.m00/i.x,Bn.m01=e.m01/i.x,Bn.m02=e.m02/i.x,i.y=yn.set(Ln,e.m04,e.m05,e.m06).length(),Bn.m03=e.m04/i.y,Bn.m04=e.m05/i.y,Bn.m05=e.m06/i.y,i.z=yn.set(Ln,e.m08,e.m09,e.m10).length(),Bn.m06=e.m08/i.z,Bn.m07=e.m09/i.z,Bn.m08=e.m10/i.z,xn.determinant(Bn)<0&&(i.x*=-1,Bn.m00*=-1,Bn.m01*=-1,Bn.m02*=-1),bn.fromMat3(t,Bn),yn.set(n,e.m12,e.m13,e.m14)},t.fromRTS=function(e,t,n,i){var r=t.x,o=t.y,a=t.z,s=t.w,c=r+r,l=o+o,u=a+a,h=r*c,_=r*l,f=r*u,d=o*l,p=o*u,m=a*u,g=s*c,v=s*l,y=s*u,S=i.x,E=i.y,T=i.z;return e.m00=(1-(d+m))*S,e.m01=(_+y)*S,e.m02=(f-v)*S,e.m03=0,e.m04=(_-y)*E,e.m05=(1-(h+m))*E,e.m06=(p+g)*E,e.m07=0,e.m08=(f+v)*T,e.m09=(p-g)*T,e.m10=(1-(h+d))*T,e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e},t.fromRTSOrigin=function(e,t,n,i,r){var o=t.x,a=t.y,s=t.z,c=t.w,l=o+o,u=a+a,h=s+s,_=o*l,f=o*u,d=o*h,p=a*u,m=a*h,g=s*h,v=c*l,y=c*u,S=c*h,E=i.x,T=i.y,x=i.z,A=r.x,C=r.y,b=r.z;return e.m00=(1-(p+g))*E,e.m01=(f+S)*E,e.m02=(d-y)*E,e.m03=0,e.m04=(f-S)*T,e.m05=(1-(_+g))*T,e.m06=(m+v)*T,e.m07=0,e.m08=(d+y)*x,e.m09=(m-v)*x,e.m10=(1-(_+p))*x,e.m11=0,e.m12=n.x+A-(e.m00*A+e.m04*C+e.m08*b),e.m13=n.y+C-(e.m01*A+e.m05*C+e.m09*b),e.m14=n.z+b-(e.m02*A+e.m06*C+e.m10*b),e.m15=1,e},t.fromQuat=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n+n,s=i+i,c=r+r,l=n*a,u=i*a,h=i*s,_=r*a,f=r*s,d=r*c,p=o*a,m=o*s,g=o*c;return e.m00=1-h-d,e.m01=u+g,e.m02=_-m,e.m03=0,e.m04=u-g,e.m05=1-l-d,e.m06=f+p,e.m07=0,e.m08=_+m,e.m09=f-p,e.m10=1-l-h,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.frustum=function(e,t,n,i,r,o,a){var s=1/(n-t),c=1/(r-i),l=1/(o-a);return e.m00=2*o*s,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=2*o*c,e.m06=0,e.m07=0,e.m08=(n+t)*s,e.m09=(r+i)*c,e.m10=(a+o)*l,e.m11=-1,e.m12=0,e.m13=0,e.m14=a*o*2*l,e.m15=0,e},t.perspective=function(e,t,n,i,r,o,a,s,c){void 0===o&&(o=!0),void 0===a&&(a=-1),void 0===s&&(s=1),void 0===c&&(c=0);var l=1/Math.tan(t/2),u=1/(i-r),h=o?l/n:l,_=(o?l:l*n)*s,f=Nn[c];return e.m00=h*f[0],e.m01=h*f[1],e.m02=0,e.m03=0,e.m04=_*f[2],e.m05=_*f[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=(r-a*i)*u,e.m11=-1,e.m12=0,e.m13=0,e.m14=r*i*u*(1-a),e.m15=0,e},t.ortho=function(e,t,n,i,r,o,a,s,c,l){void 0===s&&(s=-1),void 0===c&&(c=1),void 0===l&&(l=0);var u=1/(t-n),h=1/(i-r)*c,_=1/(o-a),f=-2*u,d=-2*h,p=(t+n)*u,m=(r+i)*h,g=Nn[l];return e.m00=f*g[0],e.m01=f*g[1],e.m02=0,e.m03=0,e.m04=d*g[2],e.m05=d*g[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=_*(1-s),e.m11=0,e.m12=p*g[0]+m*g[2],e.m13=p*g[1]+m*g[3],e.m14=(o-s*a)*_,e.m15=1,e},t.lookAt=function(e,t,n,i){var r=t.x,o=t.y,a=t.z,s=i.x,c=i.y,l=i.z,u=r-n.x,h=o-n.y,_=a-n.z,f=1/Math.sqrt(u*u+h*h+_*_),d=c*(_*=f)-l*(h*=f),p=l*(u*=f)-s*_,m=s*h-c*u,g=h*(m*=f=1/Math.sqrt(d*d+p*p+m*m))-_*(p*=f),v=_*(d*=f)-u*m,y=u*p-h*d;return e.m00=d,e.m01=g,e.m02=u,e.m03=0,e.m04=p,e.m05=v,e.m06=h,e.m07=0,e.m08=m,e.m09=y,e.m10=_,e.m11=0,e.m12=-(d*r+p*o+m*a),e.m13=-(g*r+v*o+y*a),e.m14=-(u*r+h*o+_*a),e.m15=1,e},t.inverseTranspose=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,d=t.m12,p=t.m13,m=t.m14,g=t.m15,v=n*s-i*a,y=n*c-r*a,S=n*l-o*a,E=i*c-r*s,T=i*l-o*s,x=r*l-o*c,A=u*p-h*d,C=u*m-_*d,b=u*g-f*d,w=h*m-_*p,R=h*g-f*p,I=_*g-f*m,P=v*I-y*R+S*w+E*b-T*C+x*A;return P?(P=1/P,e.m00=(s*I-c*R+l*w)*P,e.m01=(c*b-a*I-l*C)*P,e.m02=(a*R-s*b+l*A)*P,e.m03=0,e.m04=(r*R-i*I-o*w)*P,e.m05=(n*I-r*b+o*C)*P,e.m06=(i*b-n*R-o*A)*P,e.m07=0,e.m08=(p*x-m*T+g*E)*P,e.m09=(m*S-d*x-g*y)*P,e.m10=(d*T-p*S+g*v)*P,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e):null},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e[n+9]=t.m09,e[n+10]=t.m10,e[n+11]=t.m11,e[n+12]=t.m12,e[n+13]=t.m13,e[n+14]=t.m14,e[n+15]=t.m15,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e.m09=t[n+9],e.m10=t[n+10],e.m11=t[n+11],e.m12=t[n+12],e.m13=t[n+13],e.m14=t[n+14],e.m15=t[n+15],e},t.add=function(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e.m09=t.m09+n.m09,e.m10=t.m10+n.m10,e.m11=t.m11+n.m11,e.m12=t.m12+n.m12,e.m13=t.m13+n.m13,e.m14=t.m14+n.m14,e.m15=t.m15+n.m15,e},t.subtract=function(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e.m09=t.m09-n.m09,e.m10=t.m10-n.m10,e.m11=t.m11-n.m11,e.m12=t.m12-n.m12,e.m13=t.m13-n.m13,e.m14=t.m14-n.m14,e.m15=t.m15-n.m15,e},t.multiplyScalar=function(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e.m09=t.m09*n,e.m10=t.m10*n,e.m11=t.m11*n,e.m12=t.m12*n,e.m13=t.m13*n,e.m14=t.m14*n,e.m15=t.m15*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e.m00=t.m00+n.m00*i,e.m01=t.m01+n.m01*i,e.m02=t.m02+n.m02*i,e.m03=t.m03+n.m03*i,e.m04=t.m04+n.m04*i,e.m05=t.m05+n.m05*i,e.m06=t.m06+n.m06*i,e.m07=t.m07+n.m07*i,e.m08=t.m08+n.m08*i,e.m09=t.m09+n.m09*i,e.m10=t.m10+n.m10*i,e.m11=t.m11+n.m11*i,e.m12=t.m12+n.m12*i,e.m13=t.m13+n.m13*i,e.m14=t.m14+n.m14*i,e.m15=t.m15+n.m15*i,e},t.strictEquals=function(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08&&e.m09===t.m09&&e.m10===t.m10&&e.m11===t.m11&&e.m12===t.m12&&e.m13===t.m13&&e.m14===t.m14&&e.m15===t.m15},t.equals=function(e,t,n){return void 0===n&&(n=Kt),Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))&&Math.abs(e.m09-t.m09)<=n*Math.max(1,Math.abs(e.m09),Math.abs(t.m09))&&Math.abs(e.m10-t.m10)<=n*Math.max(1,Math.abs(e.m10),Math.abs(t.m10))&&Math.abs(e.m11-t.m11)<=n*Math.max(1,Math.abs(e.m11),Math.abs(t.m11))&&Math.abs(e.m12-t.m12)<=n*Math.max(1,Math.abs(e.m12),Math.abs(t.m12))&&Math.abs(e.m13-t.m13)<=n*Math.max(1,Math.abs(e.m13),Math.abs(t.m13))&&Math.abs(e.m14-t.m14)<=n*Math.max(1,Math.abs(e.m14),Math.abs(t.m14))&&Math.abs(e.m15-t.m15)<=n*Math.max(1,Math.abs(e.m15),Math.abs(t.m15))};var n=t.prototype;return n.clone=function(){return new t(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},n.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,p){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===p&&(p=1),"object"==typeof e?(this.m01=e.m01,this.m02=e.m02,this.m03=e.m03,this.m04=e.m04,this.m05=e.m05,this.m06=e.m06,this.m07=e.m07,this.m08=e.m08,this.m09=e.m09,this.m10=e.m10,this.m11=e.m11,this.m12=e.m12,this.m13=e.m13,this.m14=e.m14,this.m15=e.m15,this.m00=e.m00):(this.m01=t,this.m02=n,this.m03=i,this.m04=r,this.m05=o,this.m06=a,this.m07=s,this.m08=c,this.m09=l,this.m10=u,this.m11=h,this.m12=_,this.m13=f,this.m14=d,this.m15=p,this.m00=e),this},n.equals=function(e,t){return void 0===t&&(t=Kt),Math.abs(this.m00-e.m00)<=t*Math.max(1,Math.abs(this.m00),Math.abs(e.m00))&&Math.abs(this.m01-e.m01)<=t*Math.max(1,Math.abs(this.m01),Math.abs(e.m01))&&Math.abs(this.m02-e.m02)<=t*Math.max(1,Math.abs(this.m02),Math.abs(e.m02))&&Math.abs(this.m03-e.m03)<=t*Math.max(1,Math.abs(this.m03),Math.abs(e.m03))&&Math.abs(this.m04-e.m04)<=t*Math.max(1,Math.abs(this.m04),Math.abs(e.m04))&&Math.abs(this.m05-e.m05)<=t*Math.max(1,Math.abs(this.m05),Math.abs(e.m05))&&Math.abs(this.m06-e.m06)<=t*Math.max(1,Math.abs(this.m06),Math.abs(e.m06))&&Math.abs(this.m07-e.m07)<=t*Math.max(1,Math.abs(this.m07),Math.abs(e.m07))&&Math.abs(this.m08-e.m08)<=t*Math.max(1,Math.abs(this.m08),Math.abs(e.m08))&&Math.abs(this.m09-e.m09)<=t*Math.max(1,Math.abs(this.m09),Math.abs(e.m09))&&Math.abs(this.m10-e.m10)<=t*Math.max(1,Math.abs(this.m10),Math.abs(e.m10))&&Math.abs(this.m11-e.m11)<=t*Math.max(1,Math.abs(this.m11),Math.abs(e.m11))&&Math.abs(this.m12-e.m12)<=t*Math.max(1,Math.abs(this.m12),Math.abs(e.m12))&&Math.abs(this.m13-e.m13)<=t*Math.max(1,Math.abs(this.m13),Math.abs(e.m13))&&Math.abs(this.m14-e.m14)<=t*Math.max(1,Math.abs(this.m14),Math.abs(e.m14))&&Math.abs(this.m15-e.m15)<=t*Math.max(1,Math.abs(this.m15),Math.abs(e.m15))},n.strictEquals=function(e){return this.m00===e.m00&&this.m01===e.m01&&this.m02===e.m02&&this.m03===e.m03&&this.m04===e.m04&&this.m05===e.m05&&this.m06===e.m06&&this.m07===e.m07&&this.m08===e.m08&&this.m09===e.m09&&this.m10===e.m10&&this.m11===e.m11&&this.m12===e.m12&&this.m13===e.m13&&this.m14===e.m14&&this.m15===e.m15},n.toString=function(){return"[\n"+this.m00+", "+this.m01+", "+this.m02+", "+this.m03+",\n"+this.m04+", "+this.m05+", "+this.m06+", "+this.m07+",\n"+this.m08+", "+this.m09+", "+this.m10+", "+this.m11+",\n"+this.m12+", "+this.m13+", "+this.m14+", "+this.m15+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},n.zero=function(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this},n.transpose=function(){var e=this.m01,t=this.m02,n=this.m03,i=this.m06,r=this.m07,o=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=e,this.m06=this.m09,this.m07=this.m13,this.m08=t,this.m09=i,this.m11=this.m14,this.m12=n,this.m13=r,this.m14=o,this},n.invert=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,_=this.m12,f=this.m13,d=this.m14,p=this.m15,m=e*o-t*r,g=e*a-n*r,v=e*s-i*r,y=t*a-n*o,S=t*s-i*o,E=n*s-i*a,T=c*f-l*_,x=c*d-u*_,A=c*p-h*_,C=l*d-u*f,b=l*p-h*f,w=u*p-h*d,R=m*w-g*b+v*C+y*A-S*x+E*T;return 0===R?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(R=1/R,this.m00=(o*w-a*b+s*C)*R,this.m01=(n*b-t*w-i*C)*R,this.m02=(f*E-d*S+p*y)*R,this.m03=(u*S-l*E-h*y)*R,this.m04=(a*A-r*w-s*x)*R,this.m05=(e*w-n*A+i*x)*R,this.m06=(d*v-_*E-p*g)*R,this.m07=(c*E-u*v+h*g)*R,this.m08=(r*b-o*A+s*T)*R,this.m09=(t*A-e*b-i*T)*R,this.m10=(_*S-f*v+p*m)*R,this.m11=(l*v-c*S-h*m)*R,this.m12=(o*x-r*C-a*T)*R,this.m13=(e*C-t*x+n*T)*R,this.m14=(f*g-_*y-d*m)*R,this.m15=(c*y-l*g+u*m)*R,this)},n.determinant=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,_=this.m12,f=this.m13,d=this.m14,p=this.m15;return(e*o-t*r)*(u*p-h*d)-(e*a-n*r)*(l*p-h*f)+(e*s-i*r)*(l*d-u*f)+(t*a-n*o)*(c*p-h*_)-(t*s-i*o)*(c*d-u*_)+(n*s-i*a)*(c*f-l*_)},n.add=function(e){return this.m00+=e.m00,this.m01+=e.m01,this.m02+=e.m02,this.m03+=e.m03,this.m04+=e.m04,this.m05+=e.m05,this.m06+=e.m06,this.m07+=e.m07,this.m08+=e.m08,this.m09+=e.m09,this.m10+=e.m10,this.m11+=e.m11,this.m12+=e.m12,this.m13+=e.m13,this.m14+=e.m14,this.m15+=e.m15,this},n.subtract=function(e){return this.m00-=e.m00,this.m01-=e.m01,this.m02-=e.m02,this.m03-=e.m03,this.m04-=e.m04,this.m05-=e.m05,this.m06-=e.m06,this.m07-=e.m07,this.m08-=e.m08,this.m09-=e.m09,this.m10-=e.m10,this.m11-=e.m11,this.m12-=e.m12,this.m13-=e.m13,this.m14-=e.m14,this.m15-=e.m15,this},n.multiply=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=this.m09,h=this.m10,_=this.m11,f=this.m12,d=this.m13,p=this.m14,m=this.m15,g=e.m00,v=e.m01,y=e.m02,S=e.m03;return this.m00=g*t+v*o+y*l+S*f,this.m01=g*n+v*a+y*u+S*d,this.m02=g*i+v*s+y*h+S*p,this.m03=g*r+v*c+y*_+S*m,g=e.m04,v=e.m05,y=e.m06,S=e.m07,this.m04=g*t+v*o+y*l+S*f,this.m05=g*n+v*a+y*u+S*d,this.m06=g*i+v*s+y*h+S*p,this.m07=g*r+v*c+y*_+S*m,g=e.m08,v=e.m09,y=e.m10,S=e.m11,this.m08=g*t+v*o+y*l+S*f,this.m09=g*n+v*a+y*u+S*d,this.m10=g*i+v*s+y*h+S*p,this.m11=g*r+v*c+y*_+S*m,g=e.m12,v=e.m13,y=e.m14,S=e.m15,this.m12=g*t+v*o+y*l+S*f,this.m13=g*n+v*a+y*u+S*d,this.m14=g*i+v*s+y*h+S*p,this.m15=g*r+v*c+y*_+S*m,this},n.multiplyScalar=function(e){return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=e,this.m05*=e,this.m06*=e,this.m07*=e,this.m08*=e,this.m09*=e,this.m10*=e,this.m11*=e,this.m12*=e,this.m13*=e,this.m14*=e,this.m15*=e,this},n.translate=function(e){return console.warn("function changed"),this.m12+=e.x,this.m13+=e.y,this.m14+=e.z,this},n.scale=function(e){var t=e.x,n=e.y,i=e.z;return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=n,this.m05*=n,this.m06*=n,this.m07*=n,this.m08*=i,this.m09*=i,this.m10*=i,this.m11*=i,this},n.rotate=function(e,t){var n=t.x,i=t.y,r=t.z,o=Math.sqrt(n*n+i*i+r*r);if(Math.abs(o)<Kt)return null;n*=o=1/o,i*=o,r*=o;var a=Math.sin(e),s=Math.cos(e),c=1-s,l=this.m00,u=this.m01,h=this.m02,_=this.m03,f=this.m04,d=this.m05,p=this.m06,m=this.m07,g=this.m08,v=this.m09,y=this.m10,S=this.m11,E=n*n*c+s,T=i*n*c+r*a,x=r*n*c-i*a,A=n*i*c-r*a,C=i*i*c+s,b=r*i*c+n*a,w=n*r*c+i*a,R=i*r*c-n*a,I=r*r*c+s;return this.m00=l*E+f*T+g*x,this.m01=u*E+d*T+v*x,this.m02=h*E+p*T+y*x,this.m03=_*E+m*T+S*x,this.m04=l*A+f*C+g*b,this.m05=u*A+d*C+v*b,this.m06=h*A+p*C+y*b,this.m07=_*A+m*C+S*b,this.m08=l*w+f*R+g*I,this.m09=u*w+d*R+v*I,this.m10=h*w+p*R+y*I,this.m11=_*w+m*R+S*I,this},n.getTranslation=function(e){return e.x=this.m12,e.y=this.m13,e.z=this.m14,e},n.getScale=function(e){var t=Bn.m00=this.m00,n=Bn.m01=this.m01,i=Bn.m02=this.m02,r=Bn.m03=this.m04,o=Bn.m04=this.m05,a=Bn.m05=this.m06,s=Bn.m06=this.m08,c=Bn.m07=this.m09,l=Bn.m08=this.m10;return e.x=Math.sqrt(t*t+n*n+i*i),e.y=Math.sqrt(r*r+o*o+a*a),e.z=Math.sqrt(s*s+c*c+l*l),xn.determinant(Bn)<0&&(e.x*=-1),e},n.getRotation=function(e){var t=this.m00+this.m05+this.m10,n=0;return t>0?(n=2*Math.sqrt(t+1),e.w=.25*n,e.x=(this.m06-this.m09)/n,e.y=(this.m08-this.m02)/n,e.z=(this.m01-this.m04)/n):this.m00>this.m05&&this.m00>this.m10?(n=2*Math.sqrt(1+this.m00-this.m05-this.m10),e.w=(this.m06-this.m09)/n,e.x=.25*n,e.y=(this.m01+this.m04)/n,e.z=(this.m08+this.m02)/n):this.m05>this.m10?(n=2*Math.sqrt(1+this.m05-this.m00-this.m10),e.w=(this.m08-this.m02)/n,e.x=(this.m01+this.m04)/n,e.y=.25*n,e.z=(this.m06+this.m09)/n):(n=2*Math.sqrt(1+this.m10-this.m00-this.m05),e.w=(this.m01-this.m04)/n,e.x=(this.m08+this.m02)/n,e.y=(this.m06+this.m09)/n,e.z=.25*n),e},n.fromRTS=function(e,t,n){var i=e.x,r=e.y,o=e.z,a=e.w,s=i+i,c=r+r,l=o+o,u=i*s,h=i*c,_=i*l,f=r*c,d=r*l,p=o*l,m=a*s,g=a*c,v=a*l,y=n.x,S=n.y,E=n.z;return this.m00=(1-(f+p))*y,this.m01=(h+v)*y,this.m02=(_-g)*y,this.m03=0,this.m04=(h-v)*S,this.m05=(1-(u+p))*S,this.m06=(d+m)*S,this.m07=0,this.m08=(_+g)*E,this.m09=(d-m)*E,this.m10=(1-(u+f))*E,this.m11=0,this.m12=t.x,this.m13=t.y,this.m14=t.z,this.m15=1,this},n.fromQuat=function(e){var t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,a=n+n,s=i+i,c=t*o,l=n*o,u=n*a,h=i*o,_=i*a,f=i*s,d=r*o,p=r*a,m=r*s;return this.m00=1-u-f,this.m01=l+m,this.m02=h-p,this.m03=0,this.m04=l-m,this.m05=1-c-f,this.m06=_+d,this.m07=0,this.m08=h+p,this.m09=_-d,this.m10=1-c-u,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},t}(tt));Mn.IDENTITY=Object.freeze(new Mn);var Ln=new yn,Bn=new xn;function Fn(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,p){return new Mn(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,p)}Wt.fastDefine("cc.Mat4",Mn,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),i.Mat4=Mn,i.mat4=Fn;var zn=e("Vec2",function(e){function t(t,n){var i;return i=e.call(this)||this,t&&"object"==typeof t?(i.x=t.x,i.y=t.y):(i.x=t||0,i.y=n||0),i}K(t,e),t.clone=function(e){return new t(e.x,e.y)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e},t.set=function(e,t,n){return e.x=t,e.y=n,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i},t.len=function(e){var t=e.x,n=e.y;return Math.sqrt(t*t+n*n)},t.lengthSqr=function(e){var t=e.x,n=e.y;return t*t+n*n},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e},t.inverse=function(e,t){return e.x=1/t.x,e.y=1/t.y,e},t.inverseSafe=function(e,t){var n=t.x,i=t.y;return Math.abs(n)<Kt?e.x=0:e.x=1/n,Math.abs(i)<Kt?e.y=0:e.y=1/i,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),e.x=n*r,e.y=i*r),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y},t.cross=function(e,t,n){return e.x=e.y=0,e.z=t.x*n.y-t.y*n.x,e},t.lerp=function(e,t,n,i){var r=t.x,o=t.y;return e.x=r+i*(n.x-r),e.y=o+i*(n.y-o),e},t.random=function(e,t){t=t||1;var n=2*rn()*Math.PI;return e.x=Math.cos(n)*t,e.y=Math.sin(n)*t,e},t.transformMat3=function(e,t,n){var i=t.x,r=t.y;return e.x=n.m00*i+n.m03*r+n.m06,e.y=n.m01*i+n.m04*r+n.m07,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y;return e.x=n.m00*i+n.m04*r+n.m12,e.y=n.m01*i+n.m05*r+n.m13,e},t.str=function(e){return"Vec2("+e.x+", "+e.y+")"},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y},t.equals=function(e,t,n){return void 0===n&&(n=Kt),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))},t.angle=function(e,n){t.normalize(Un,e),t.normalize(Hn,n);var i=t.dot(Un,Hn);return i>1?0:i<-1?Math.PI:Math.acos(i)};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y)},n.set=function(e,t){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0),this},n.equals=function(e,t){return void 0===t&&(t=Kt),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))},n.equals2f=function(e,t,n){return void 0===n&&(n=Kt),Math.abs(this.x-e)<=n*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=n*Math.max(1,Math.abs(this.y),Math.abs(t))},n.strictEquals=function(e){return e&&this.x===e.x&&this.y===e.y},n.strictEquals2f=function(e,t){return this.x===e&&this.y===t},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},n.lerp=function(e,t){var n=this.x,i=this.y;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this},n.clampf=function(e,t){return this.x=Jt(this.x,e.x,t.x),this.y=Jt(this.y,e.y,t.y),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.add2f=function(e,t){return this.x+=e,this.y+=t,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},n.subtract2f=function(e,t){return this.x-=e,this.y-=t,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=e,this.y*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this},n.multiply2f=function(e,t){return this.x*=e,this.y*=t,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this},n.divide2f=function(e,t){return this.x/=e,this.y/=t,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this},n.dot=function(e){return this.x*e.x+this.y*e.y},n.cross=function(e){return this.x*e.y-this.y*e.x},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y},n.normalize=function(){var e=this.x,t=this.y,n=e*e+t*t;return n>0&&(n=1/Math.sqrt(n),this.x*=n,this.y*=n),this},n.angle=function(e){var t=this.lengthSqr(),n=e.lengthSqr();if(0===t||0===n)return console.warn("Can't get angle between zero vector"),0;var i=this.dot(e)/Math.sqrt(t*n);return i=Jt(i,-1,1),Math.acos(i)},n.signAngle=function(e){var t=this.angle(e);return this.cross(e)<0?-t:t},n.rotate=function(e){var t=this.x,n=this.y,i=Math.sin(e),r=Math.cos(e);return this.x=r*t-i*n,this.y=i*t+r*n,this},n.project=function(e){var t=this.dot(e)/e.dot(e);return this.x=e.x*t,this.y=e.y*t,this},n.transformMat4=function(e){var t=this.x,n=this.y;return this.x=e.m00*t+e.m04*n+e.m12,this.y=e.m01*t+e.m05*n+e.m13,this},t}(tt));zn.ZERO=Object.freeze(new zn(0,0)),zn.ONE=Object.freeze(new zn(1,1)),zn.NEG_ONE=Object.freeze(new zn(-1,-1)),zn.UNIT_X=Object.freeze(new zn(1,0)),zn.UNIT_Y=Object.freeze(new zn(0,1));var Un=new zn,Hn=new zn;function Gn(e,t){return new zn(e,t)}Wt.fastDefine("cc.Vec2",zn,{x:0,y:0}),i.Vec2=zn,i.v2=Gn;var kn=e("Vec4",function(e){function t(t,n,i,r){var o;return o=e.call(this)||this,t&&"object"==typeof t?(o.x=t.x,o.y=t.y,o.z=t.z,o.w=t.w):(o.x=t||0,o.y=n||0,o.z=i||0,o.w=r||0),o}K(t,e),t.clone=function(e){return new t(e.x,e.y,e.z,e.w)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},t.set=function(e,t,n,i,r){return e.x=t,e.y=n,e.z=i,e.w=r,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e.w=t.w+n.w,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e.w=t.w-n.w,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e.w=t.w*n.w,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e.w=t.w/n.w,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e.w=Math.ceil(t.w),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e.w=Math.floor(t.w),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e.w=Math.min(t.w,n.w),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e.w=Math.max(t.w,n.w),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e.w=Math.round(t.w),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z,o=t.w-e.w;return Math.sqrt(n*n+i*i+r*r+o*o)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z,o=t.w-e.w;return n*n+i*i+r*r+o*o},t.len=function(e){var t=e.x,n=e.y,i=e.z,r=e.w;return Math.sqrt(t*t+n*n+i*i+r*r)},t.lengthSqr=function(e){var t=e.x,n=e.y,i=e.z,r=e.w;return t*t+n*n+i*i+r*r},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=-t.w,e},t.inverse=function(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e.w=1/t.w,e},t.inverseSafe=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w;return Math.abs(n)<Kt?e.x=0:e.x=1/n,Math.abs(i)<Kt?e.y=0:e.y=1/i,Math.abs(r)<Kt?e.z=0:e.z=1/r,Math.abs(o)<Kt?e.w=0:e.w=1/o,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n*n+i*i+r*r+o*o;return a>0&&(a=1/Math.sqrt(a),e.x=n*a,e.y=i*a,e.z=r*a,e.w=o*a),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e},t.random=function(e,t){t=t||1;var n=2*rn()*Math.PI,i=2*rn()-1,r=Math.sqrt(1-i*i);return e.x=r*Math.cos(n)*t,e.y=r*Math.sin(n)*t,e.z=i*t,e.w=0,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w;return e.x=n.m00*i+n.m04*r+n.m08*o+n.m12*a,e.y=n.m01*i+n.m05*r+n.m09*o+n.m13*a,e.z=n.m02*i+n.m06*r+n.m10*o+n.m14*a,e.w=n.m03*i+n.m07*r+n.m11*o+n.m15*a,e},t.transformAffine=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w;return e.x=n.m00*i+n.m01*r+n.m02*o+n.m03*a,e.y=n.m04*i+n.m05*r+n.m06*o+n.m07*a,e.x=n.m08*i+n.m09*r+n.m10*o+n.m11*a,e.w=t.w,e},t.transformQuat=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.x,s=n.y,c=n.z,l=n.w,u=l*i+s*o-c*r,h=l*r+c*i-a*o,_=l*o+a*r-s*i,f=-a*i-s*r-c*o;return e.x=u*l+f*-a+h*-c-_*-s,e.y=h*l+f*-s+_*-a-u*-c,e.z=_*l+f*-c+u*-s-h*-a,e.w=t.w,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},t.equals=function(e,t,n){return void 0===n&&(n=Kt),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z,this.w)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=i||0),this},n.equals=function(e,t){return void 0===t&&(t=Kt),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))&&Math.abs(this.w-e.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(e.w))},n.equals4f=function(e,t,n,i,r){return void 0===r&&(r=Kt),Math.abs(this.x-e)<=r*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=r*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-n)<=r*Math.max(1,Math.abs(this.z),Math.abs(n))&&Math.abs(this.w-i)<=r*Math.max(1,Math.abs(this.w),Math.abs(i))},n.strictEquals=function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},n.strictEquals4f=function(e,t,n,i){return this.x===e&&this.y===t&&this.z===n&&this.w===i},n.lerp=function(e,t){var n=this.x,i=this.y,r=this.z,o=this.w;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this.z=r+t*(e.z-r),this.w=o+t*(e.w-o),this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},n.clampf=function(e,t){return this.x=Jt(this.x,e.x,t.x),this.y=Jt(this.y,e.y,t.y),this.z=Jt(this.z,e.z,t.z),this.w=Jt(this.w,e.w,t.w),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},n.add4f=function(e,t,n,i){return this.x+=e,this.y+=t,this.z+=n,this.w+=i,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},n.subtract4f=function(e,t,n,i){return this.x-=e,this.y-=t,this.z-=n,this.w-=i,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},n.multiply4f=function(e,t,n,i){return this.x*=e,this.y*=t,this.z*=n,this.w*=i,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this},n.divide4f=function(e,t,n,i){return this.x/=e,this.y/=t,this.z/=n,this.w/=i,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},n.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},n.cross=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-i*o,this.y=i*r-t*a,this.z=t*o-n*r,this},n.length=function(){var e=this.x,t=this.y,n=this.z,i=this.w;return Math.sqrt(e*e+t*t+n*n+i*i)},n.lengthSqr=function(){var e=this.x,t=this.y,n=this.z,i=this.w;return e*e+t*t+n*n+i*i},n.normalize=function(){var e=this.x,t=this.y,n=this.z,i=this.w,r=e*e+t*t+n*n+i*i;return r>0&&(r=1/Math.sqrt(r),this.x=e*r,this.y=t*r,this.z=n*r,this.w=i*r),this},n.transformMat4=function(e){var t=this.x,n=this.y,i=this.z,r=this.w;return this.x=e.m00*t+e.m04*n+e.m08*i+e.m12*r,this.y=e.m01*t+e.m05*n+e.m09*i+e.m13*r,this.z=e.m02*t+e.m06*n+e.m10*i+e.m14*r,this.w=e.m03*t+e.m07*n+e.m11*i+e.m15*r,this},t}(tt));function Vn(e,t,n,i){return new kn(e,t,n,i)}kn.ZERO=Object.freeze(new kn(0,0,0,0)),kn.ONE=Object.freeze(new kn(1,1,1,1)),kn.NEG_ONE=Object.freeze(new kn(-1,-1,-1,-1)),Wt.fastDefine("cc.Vec4",kn,{x:0,y:0,z:0,w:0}),i.Vec4=kn,i.v4=Vn,F(zn,"Vec2",[{name:"sub",newName:"subtract",target:zn,targetName:"Vec2"},{name:"mul",newName:"multiply",target:zn,targetName:"Vec2"},{name:"div",newName:"divide",target:zn,targetName:"Vec2"},{name:"dist",newName:"distance",target:zn,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:zn,targetName:"Vec2"},{name:"mag",newName:"len",target:zn,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:zn,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:zn,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:zn,targetName:"Vec2"}]),F(zn.prototype,"Vec2",[{name:"mag",newName:"length",target:zn.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:zn.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:zn.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:zn.prototype,targetName:"Vec2"}]),F(yn,"Vec3",[{name:"sub",newName:"subtract",target:yn,targetName:"Vec3"},{name:"mul",newName:"multiply",target:yn,targetName:"Vec3"},{name:"div",newName:"divide",target:yn,targetName:"Vec3"},{name:"dist",newName:"distance",target:yn,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:yn,targetName:"Vec3"},{name:"mag",newName:"len",target:yn,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:yn,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:yn,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:yn,targetName:"Vec3"}]),F(yn.prototype,"Vec3",[{name:"mag",newName:"length",target:yn.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:yn.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:yn.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:yn.prototype,targetName:"Vec3"}]),F(kn,"Vec4",[{name:"sub",newName:"subtract",target:kn,targetName:"Vec4"},{name:"mul",newName:"multiply",target:kn,targetName:"Vec4"},{name:"div",newName:"divide",target:kn,targetName:"Vec4"},{name:"dist",newName:"distance",target:kn,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:kn,targetName:"Vec4"},{name:"mag",newName:"len",target:kn,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:kn,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:kn,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:kn,targetName:"Vec4"}]),F(kn.prototype,"Vec4",[{name:"mag",newName:"length",target:kn.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:kn.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:kn.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:kn.prototype,targetName:"Vec4"}]),F(bn,"Quat",[{name:"mag",newName:"len",target:bn,targetName:"Quat"},{name:"mul",newName:"multiply",target:bn,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:bn,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:bn,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:bn,targetName:"Quat"}]),F(bn.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:bn.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:bn.prototype,targetName:"Quat"}]),F(gn,"Color",[{name:"sub",newName:"subtract",target:gn,targetName:"Color"},{name:"mul",newName:"multiply",target:gn,targetName:"Color"},{name:"div",newName:"divide",target:gn,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:gn,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[1].toString(16);return i.Color.fromHEX(t[0],r)}}]),F(xn,"Mat3",[{name:"sub",newName:"subtract",target:xn,targetName:"Mat3"},{name:"mul",newName:"multiply",target:xn,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:xn,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:xn,targetName:"Mat3"}]),F(xn.prototype,"Mat3",[{name:"sub",newName:"subtract",target:xn.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:xn.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:xn.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:xn.prototype,targetName:"Mat3"}]),F(Mn,"Mat4",[{name:"sub",newName:"subtract",target:Mn,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Mn,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Mn,targetName:"Mat4"}]),F(Mn.prototype,"Mat4",[{name:"sub",newName:"subtract",target:Mn.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Mn.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:Mn.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Mn.prototype,targetName:"Mat4"}]);var Wn=e("AffineTransform",function(){function e(e,t,n,i,r,o){void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=0),this.a=e,this.b=t,this.c=n,this.d=i,this.tx=r,this.ty=o}return e.identity=function(){return new e},e.clone=function(t){return new e(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.concat=function(e,t,n){var i=t.a,r=t.b,o=t.c,a=t.d,s=t.tx,c=t.ty;e.a=i*n.a+r*n.c,e.b=i*n.b+r*n.d,e.c=o*n.a+a*n.c,e.d=o*n.b+a*n.d,e.tx=s*n.a+c*n.c+n.tx,e.ty=s*n.b+c*n.d+n.ty},e.invert=function(e,t){var n=1/(t.a*t.d-t.b*t.c);e.a=n*t.d,e.b=-n*t.b,e.c=-n*t.c,e.d=n*t.a,e.tx=n*(t.c*t.ty-t.d*t.tx),e.ty=n*(t.b*t.tx-t.a*t.ty)},e.fromMat4=function(e,t){e.a=t.m00,e.b=t.m01,e.c=t.m04,e.d=t.m05,e.tx=t.m12,e.ty=t.m13},e.transformVec2=function(e,t,n,i){var r,o;void 0===i?(i=n,r=t.x,o=t.y):(r=t,o=n),e.x=i.a*r+i.c*o+i.tx,e.y=i.b*r+i.d*o+i.ty},e.transformSize=function(e,t,n){e.width=n.a*t.width+n.c*t.height,e.height=n.b*t.width+n.d*t.height},e.transformRect=function(e,t,n){var i=t.x+t.width,r=t.y+t.height,o=n.a*t.x+n.c*t.y+n.tx,a=n.b*t.x+n.d*t.y+n.ty,s=n.a*i+n.c*t.y+n.tx,c=n.b*i+n.d*t.y+n.ty,l=n.a*t.x+n.c*r+n.tx,u=n.b*t.x+n.d*r+n.ty,h=n.a*i+n.c*r+n.tx,_=n.b*i+n.d*r+n.ty,f=Math.min(o,s,l,h),d=Math.max(o,s,l,h),p=Math.min(a,c,u,_),m=Math.max(a,c,u,_);e.x=f,e.y=p,e.width=d-f,e.height=m-p},e.transformObb=function(e,t,n,i,r,o){var a=o.a*r.x+o.c*r.y+o.tx,s=o.b*r.x+o.d*r.y+o.ty,c=o.a*r.width,l=o.b*r.width,u=o.c*r.height,h=o.d*r.height;t.x=a,t.y=s,n.x=c+a,n.y=l+s,e.x=u+a,e.y=h+s,i.x=c+u+a,i.y=l+h+s},e}());i.AffineTransform=Wn;var jn=e("Size",function(e){function t(t,n){var i;return i=e.call(this)||this,t&&"object"==typeof t?(i.width=t.width,i.height=t.height):(i.width=t||0,i.height=n||0),i}K(t,e),t.lerp=function(e,t,n,i){return e.width=t.width+(n.width-t.width)*i,e.height=t.height+(n.height-t.height)*i,e};var n=t.prototype;return n.clone=function(){return new t(this.width,this.height)},n.set=function(e,t){return e&&"object"==typeof e?(this.height=e.height,this.width=e.width):(this.width=e||0,this.height=t||0),this},n.equals=function(e){return this.width===e.width&&this.height===e.height},n.lerp=function(e,t){return this.width+=(e.width-this.width)*t,this.height+=(e.height-this.height)*t,this},n.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},X(t,[{key:"x",get:function(){return this.width},set:function(e){this.width=e}},{key:"y",get:function(){return this.height},set:function(e){this.height=e}}]),t}(tt));function qn(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),new jn(e,t)}jn.ZERO=Object.freeze(new jn(0,0)),jn.ONE=Object.freeze(new jn(1,1)),Wt.fastDefine("cc.Size",jn,{width:0,height:0}),i.size=qn,i.Size=jn;var Xn=e("Rect",function(e){function t(t,n,i,r){var o;return o=e.call(this)||this,t&&"object"==typeof t?(o.y=t.y,o.width=t.width,o.height=t.height,o.x=t.x):(o.x=t||0,o.y=n||0,o.width=i||0,o.height=r||0),o}K(t,e),t.fromMinMax=function(e,t,n){var i=Math.min(t.x,n.x),r=Math.min(t.y,n.y),o=Math.max(t.x,n.x),a=Math.max(t.y,n.y);return e.x=i,e.y=r,e.width=o-i,e.height=a-r,e},t.lerp=function(e,t,n,i){var r=t.x,o=t.y,a=t.width,s=t.height;return e.x=r+(n.x-r)*i,e.y=o+(n.y-o)*i,e.width=a+(n.width-a)*i,e.height=s+(n.height-s)*i,e},t.intersection=function(e,t,n){var i=t.x,r=t.y,o=t.x+t.width,a=t.y+t.height,s=n.x,c=n.y,l=n.x+n.width,u=n.y+n.height;return e.x=Math.max(i,s),e.y=Math.max(r,c),e.width=Math.min(o,l)-e.x,e.height=Math.min(a,u)-e.y,e},t.union=function(e,t,n){var i=t.x,r=t.y,o=t.width,a=t.height,s=n.x,c=n.y,l=n.width,u=n.height;return e.x=Math.min(i,s),e.y=Math.min(r,c),e.width=Math.max(i+o,s+l)-e.x,e.height=Math.max(r+a,c+u)-e.y,e};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.width,this.height)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.y=e.y,this.width=e.width,this.height=e.height,this.x=e.x):(this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0),this},n.equals=function(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height},n.lerp=function(e,t){var n=this.x,i=this.y,r=this.width,o=this.height;return this.x=n+(e.x-n)*t,this.y=i+(e.y-i)*t,this.width=r+(e.width-r)*t,this.height=o+(e.height-o)*t,this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n.intersects=function(e){var t=this.x+this.width,n=this.y+this.height,i=e.x+e.width,r=e.y+e.height;return!(t<e.x||i<this.x||n<e.y||r<this.y)},n.contains=function(e){return this.x<=e.x&&this.x+this.width>=e.x&&this.y<=e.y&&this.y+this.height>=e.y},n.containsRect=function(e){return this.x<=e.x&&this.x+this.width>=e.x+e.width&&this.y<=e.y&&this.y+this.height>=e.y+e.height},n.transformMat4=function(e){var t=this.x,n=this.y,i=t+this.width,r=n+this.height,o=e.m00*t+e.m04*n+e.m12,a=e.m01*t+e.m05*n+e.m13,s=e.m00*i+e.m04*n+e.m12,c=e.m01*i+e.m05*n+e.m13,l=e.m00*t+e.m04*r+e.m12,u=e.m01*t+e.m05*r+e.m13,h=e.m00*i+e.m04*r+e.m12,_=e.m01*i+e.m05*r+e.m13,f=Math.min(o,s,l,h),d=Math.max(o,s,l,h),p=Math.min(a,c,u,_),m=Math.max(a,c,u,_);return this.x=f,this.y=p,this.width=d-f,this.height=m-p,this},n.transformMat4ToPoints=function(e,t,n,i,r){var o=this.x,a=this.y,s=o+this.width,c=a+this.height;t.x=e.m00*o+e.m04*a+e.m12,t.y=e.m01*o+e.m05*a+e.m13,r.x=e.m00*s+e.m04*a+e.m12,r.y=e.m01*s+e.m05*a+e.m13,n.x=e.m00*o+e.m04*c+e.m12,n.y=e.m01*o+e.m05*c+e.m13,i.x=e.m00*s+e.m04*c+e.m12,i.y=e.m01*s+e.m05*c+e.m13},X(t,[{key:"xMin",get:function(){return this.x},set:function(e){this.width+=this.x-e,this.x=e}},{key:"yMin",get:function(){return this.y},set:function(e){this.height+=this.y-e,this.y=e}},{key:"xMax",get:function(){return this.x+this.width},set:function(e){this.width=e-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(e){this.height=e-this.y}},{key:"center",get:function(){return new zn(this.x+.5*this.width,this.y+.5*this.height)},set:function(e){this.x=e.x-.5*this.width,this.y=e.y-.5*this.height}},{key:"origin",get:function(){return new zn(this.x,this.y)},set:function(e){this.x=e.x,this.y=e.y}},{key:"size",get:function(){return new jn(this.width,this.height)},set:function(e){this.width=e.width,this.height=e.height}},{key:"z",get:function(){return this.width},set:function(e){this.width=e}},{key:"w",get:function(){return this.height},set:function(e){this.height=e}}]),t}(tt));function Yn(e,t,n,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),new Xn(e,t,n,i)}Wt.fastDefine("cc.Rect",Xn,{x:0,y:0,width:0,height:0}),i.Rect=Xn,i.rect=Yn;var Kn=Object.freeze({__proto__:null,bits:B,Vec2:zn,v2:Gn,Vec3:yn,v3:Tn,Vec4:kn,v4:Vn,Quat:bn,quat:Dn,Mat3:xn,Mat4:Mn,mat4:Fn,AffineTransform:Wn,Size:jn,size:qn,Rect:Xn,rect:Yn,Color:gn,color:vn,EPSILON:Kt,equals:Zt,approx:Qt,clamp:Jt,clamp01:$t,lerp:en,toRadian:tn,toDegree:nn,random:rn,randomRange:on,randomRangeInt:an,pseudoRandom:sn,pseudoRandomRange:cn,pseudoRandomRangeInt:ln,nextPow2:un,repeat:hn,pingPong:_n,inverseLerp:fn,absMaxComponent:dn,absMax:pn});e("math",Kn);var Zn=e("Pool",function(){function e(e,t){this._ctor=void 0,this._elementsPerBatch=void 0,this._nextAvail=void 0,this._freepool=[],this._ctor=e,this._elementsPerBatch=Math.max(t,1),this._nextAvail=this._elementsPerBatch-1;for(var n=0;n<this._elementsPerBatch;++n)this._freepool.push(e())}var t=e.prototype;return t.alloc=function(){if(this._nextAvail<0){for(var e=this._elementsPerBatch,t=0;t<e;t++)this._freepool.push(this._ctor());this._nextAvail=e-1}var n=this._freepool[this._nextAvail--];return this._freepool.length--,n},t.free=function(e){this._freepool.push(e),this._nextAvail++},t.freeArray=function(e){Array.prototype.push.apply(this._freepool,e),this._nextAvail+=e.length},t.destroy=function(e){if(e)for(var t=0;t<=this._nextAvail;t++)e(this._freepool[t]);this._freepool.length=0,this._nextAvail=-1},e}()),Qn=e("RecyclePool",function(){function e(e,t){this._fn=void 0,this._count=0,this._data=void 0,this._fn=e,this._data=new Array(t);for(var n=0;n<t;++n)this._data[n]=e()}var t=e.prototype;return t.reset=function(){this._count=0},t.resize=function(e){if(e>this._data.length)for(var t=this._data.length;t<e;++t)this._data[t]=this._fn()},t.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},t.removeAt=function(e){if(!(e>=this._count)){var t=this._count-1,n=this._data[e];this._data[e]=this._data[t],this._data[t]=n,this._count-=1}},X(e,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),e}()),Jn=e("CachedArray",function(){function e(e,t){this.array=void 0,this.length=0,this._compareFn=void 0,this.array=new Array(e),this.length=0,this._compareFn=void 0!==t?t:function(e,t){return e-t}}var t=e.prototype;return t.push=function(e){this.array[this.length++]=e},t.pop=function(){return this.array[--this.length]},t.get=function(e){return this.array[e]},t.clear=function(){this.length=0},t.destroy=function(){this.length=0,this.array.length=0},t.sort=function(){this.array.length=this.length,this.array.sort(this._compareFn)},t.concat=function(e){for(var t=0;t<e.length;++t)this.array[this.length++]=e[t]},t.fastRemove=function(e){if(!(e>=this.length||e<0)){var t=--this.length;this.array[e]=this.array[t]}},t.indexOf=function(e){return this.array.indexOf(e)},e}());e("memop",Object.freeze({__proto__:null,Pool:Zn,RecyclePool:Qn,CachedArray:Jn}));var $n=[],ei=e("CCObject",function(){function e(e){void 0===e&&(e=""),this._objFlags=void 0,this._name=void 0,this._name=e,this._objFlags=0}e._deferredDestroy=function(){for(var e=$n.length,t=0;t<e;++t){var n=$n[t];1&n._objFlags||n._destroyImmediate()}e===$n.length?$n.length=0:$n.splice(0,e)};var t=e.prototype;return t.destroy=function(){return 1&this._objFlags?(A(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,$n.push(this),0))},t._destruct=function(){var e=this.constructor,t=e.__destruct__;t||(t=function(e,t){var n,r=e instanceof i._BaseNode||e instanceof i.Component,o=r?"_id":null,a={};for(n in e)if(e.hasOwnProperty(n)){if(n===o)continue;switch(typeof e[n]){case"string":a[n]="";break;case"object":case"function":a[n]=null}}if(Wt._isCCClass(t))for(var s=i.Class.Attr.getClassAttrs(t),c=t.__props__,l=0;l<c.length;l++){var u=(n=c[l])+i.Class.Attr.DELIMETER+"default";if(u in s){if(r&&"_id"===n)continue;switch(typeof s[u]){case"string":a[n]="";break;case"object":case"function":a[n]=null;break;case"undefined":a[n]=void 0}}}var h="";for(n in a){var _;_=Wt.IDENTIFIER_RE.test(n)?"o."+n+"=":"o["+Wt.escapeForJS(n)+"]=";var f=a[n];""===f&&(f='""'),h+=_+f+";\n"}return Function("o",h)}(this,e),me(e,"__destruct__",t,!0)),t(this)},t._destroyImmediate=function(){1&this._objFlags?b(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},X(e,[{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"hideFlags",get:function(){return this._objFlags&e.Flags.AllHideMasks},set:function(t){var n=t&e.Flags.AllHideMasks;this._objFlags=this._objFlags&~e.Flags.AllHideMasks|n}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),e}()),ti=ei.prototype;function ni(e,t){return"object"==typeof e?!(!e||e._objFlags&(t?5:1)):void 0!==e}ti._deserialize=null,ti._onPreDestroy=null,Wt.fastDefine("cc.Object",ei,{_name:"",_objFlags:0}),me(ei,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,AllHideMasks:1560,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20}),i.isValid=ni,i.Object=ei;var ii=Ye.fastRemoveAt;function ri(){}var oi=function(){function e(){this.callback=ri,this.target=void 0,this.once=!1}var t=e.prototype;return t.set=function(e,t,n){this.callback=e||ri,this.target=t,this.once=!!n},t.reset=function(){this.target=void 0,this.callback=ri,this.once=!1},t.check=function(){return!(this.target instanceof ei&&!ni(this.target,!0))},e}(),ai=new Zn((function(){return new oi}),32),si=function(){function e(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var t=e.prototype;return t.removeByCallback=function(e){for(var t=0;t<this.callbackInfos.length;++t){var n=this.callbackInfos[t];n&&n.callback===e&&(n.reset(),ai.free(n),ii(this.callbackInfos,t),--t)}},t.removeByTarget=function(e){for(var t=0;t<this.callbackInfos.length;++t){var n=this.callbackInfos[t];n&&n.target===e&&(n.reset(),ai.free(n),ii(this.callbackInfos,t),--t)}},t.cancel=function(e){var t=this.callbackInfos[e];t&&(t.reset(),this.isInvoking?this.callbackInfos[e]=null:ii(this.callbackInfos,e),ai.free(t)),this.containCanceled=!0},t.cancelAll=function(){for(var e=0;e<this.callbackInfos.length;e++){var t=this.callbackInfos[e];t&&(t.reset(),ai.free(t),this.callbackInfos[e]=null)}this.containCanceled=!0},t.purgeCanceled=function(){for(var e=this.callbackInfos.length-1;e>=0;--e)this.callbackInfos[e]||ii(this.callbackInfos,e);this.containCanceled=!1},t.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},e}(),ci=new Zn((function(){return new si}),16),li=function(){function e(){this._callbackTable=Se(!0)}var t=e.prototype;return t.on=function(e,t,n,i){if(!this.hasEventListener(e,t,n)){var r=this._callbackTable[e];r||(r=this._callbackTable[e]=ci.alloc());var o=ai.alloc();o.set(t,n,i),r.callbackInfos.push(o)}return t},t.hasEventListener=function(e,t,n){var i=this._callbackTable&&this._callbackTable[e];if(!i)return!1;var r=i.callbackInfos;if(!t){if(i.isInvoking){for(var o=0;o<r.length;++o)if(r[o])return!0;return!1}return r.length>0}for(var a=0;a<r.length;++a){var s=r[a];if(s&&s.check()&&s.callback===t&&s.target===n)return!0}return!1},t.removeAll=function(e){if("string"==typeof e){var t=this._callbackTable&&this._callbackTable[e];t&&(t.isInvoking?t.cancelAll():(t.clear(),ci.free(t),delete this._callbackTable[e]))}else if(e)for(var n in this._callbackTable){var i=this._callbackTable[n];if(i.isInvoking)for(var r=i.callbackInfos,o=0;o<r.length;++o){var a=r[o];a&&a.target===e&&i.cancel(o)}else i.removeByTarget(e)}},t.off=function(e,t,n){var i=this._callbackTable&&this._callbackTable[e];if(i){var r=i.callbackInfos;if(t)for(var o=0;o<r.length;++o){var a=r[o];if(a&&a.callback===t&&a.target===n){i.cancel(o);break}}else this.removeAll(e)}},t.emit=function(e,t,n,i,r,o){var a=this._callbackTable&&this._callbackTable[e];if(a){var s=!a.isInvoking;a.isInvoking=!0;for(var c=a.callbackInfos,l=0,u=c.length;l<u;++l){var h=c[l];if(h){var _=h.callback,f=h.target;h.once&&this.off(e,_,f),h.check()?f?_.call(f,t,n,i,r,o):_(t,n,i,r,o):this.off(e,_,f)}}s&&(a.isInvoking=!1,a.containCanceled&&a.purgeCanceled())}},t.clear=function(){for(var e in this._callbackTable){var t=this._callbackTable[e];t&&(t.clear(),ci.free(t),delete this._callbackTable[e])}},e}();function ui(e){for(var t=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._callbackTable=Se(!0),t}K(t,e);var n=t.prototype;return n.once=function(e,t,n){return this.on(e,t,n,!0)},n.targetOff=function(e){this.removeAll(e)},t}(e),n=li.prototype,i=Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n)),r=0;r<i.length;++r){var o=i[r];if(!(o in t.prototype)){var a=Object.getOwnPropertyDescriptor(n,o);a&&Object.defineProperty(t.prototype,o,a)}}return t}var hi,_i,fi,di,pi,mi,gi,vi=e("EventTarget",ui((function(){})));i.EventTarget=vi,function(e){e.UNKNOWN="unknown",e.WECHAT="wechat",e.ANDROID="androidbrowser",e.IE="ie",e.EDGE="edge",e.QQ="qqbrowser",e.MOBILE_QQ="mqqbrowser",e.UC="ucbrowser",e.UCBS="ucbs",e.BROWSER_360="360browser",e.BAIDU_APP="baiduboxapp",e.BAIDU="baidubrowser",e.MAXTHON="maxthon",e.OPERA="opera",e.OUPENG="oupeng",e.MIUI="miuibrowser",e.FIREFOX="firefox",e.SAFARI="safari",e.CHROME="chrome",e.LIEBAO="liebao",e.QZONE="qzone",e.SOUGOU="sogou",e.HUAWEI="huawei"}(hi||(hi={})),function(e){e.HIDE="hide",e.SHOW="show",e.RESIZE="resize",e.ORIENTATION_CHANGE="orientation_change"}(_i||(_i={})),function(e){e.UNKNOWN="unknown",e.ENGLISH="en",e.CHINESE="zh",e.FRENCH="fr",e.ITALIAN="it",e.GERMAN="de",e.SPANISH="es",e.DUTCH="du",e.RUSSIAN="ru",e.KOREAN="ko",e.JAPANESE="ja",e.HUNGARIAN="hu",e.PORTUGUESE="pt",e.ARABIC="ar",e.NORWEGIAN="no",e.POLISH="pl",e.TURKISH="tr",e.UKRAINIAN="uk",e.ROMANIAN="ro",e.BULGARIAN="bg"}(fi||(fi={})),function(e){e[e.NONE=0]="NONE",e[e.LAN=1]="LAN",e[e.WWAN=2]="WWAN"}(di||(di={})),function(e){e.UNKNOWN="Unknown",e.IOS="iOS",e.ANDROID="Android",e.WINDOWS="Windows",e.LINUX="Linux",e.OSX="OS X",e.OHOS="OHOS"}(pi||(pi={})),function(e){e[e.PORTRAIT=1]="PORTRAIT",e[e.PORTRAIT_UPSIDE_DOWN=2]="PORTRAIT_UPSIDE_DOWN",e[e.LANDSCAPE_LEFT=4]="LANDSCAPE_LEFT",e[e.LANDSCAPE_RIGHT=8]="LANDSCAPE_RIGHT",e[e.LANDSCAPE=12]="LANDSCAPE"}(mi||(mi={})),function(e){e.UNKNOWN="UNKNOWN",e.EDITOR_PAGE="EDITOR_PAGE",e.EDITOR_CORE="EDITOR_CORE",e.MOBILE_BROWSER="MOBILE_BROWSER",e.DESKTOP_BROWSER="DESKTOP_BROWSER",e.WIN32="WIN32",e.ANDROID="ANDROID",e.IOS="IOS",e.MACOS="MACOS",e.OHOS="OHOS",e.WECHAT_GAME="WECHAT_GAME",e.BAIDU_MINI_GAME="BAIDU_MINI_GAME",e.XIAOMI_QUICK_GAME="XIAOMI_QUICK_GAME",e.ALIPAY_MINI_GAME="ALIPAY_MINI_GAME",e.BYTEDANCE_MINI_GAME="BYTEDANCE_MINI_GAME",e.OPPO_MINI_GAME="OPPO_MINI_GAME",e.VIVO_MINI_GAME="VIVO_MINI_GAME",e.HUAWEI_QUICK_GAME="HUAWEI_QUICK_GAME",e.COCOSPLAY="COCOSPLAY",e.LINKSURE_MINI_GAME="LINKSURE_MINI_GAME",e.QTT_MINI_GAME="QTT_MINI_GAME"}(gi||(gi={}));var yi=new(function(){function e(){var e,t=this;this.networkType=void 0,this.isNative=void 0,this.isBrowser=void 0,this.isMobile=void 0,this.isLittleEndian=void 0,this.platform=void 0,this.language=void 0,this.nativeLanguage=void 0,this.os=void 0,this.osVersion=void 0,this.osMainVersion=void 0,this.browserType=void 0,this.browserVersion=void 0,this.pixelRatio=void 0,this.supportCapability=void 0,this._eventTarget=new vi,this._html=void 0,this._battery=void 0;var n,i=window.navigator,r=i.userAgent.toLowerCase();this._html=document.getElementsByTagName("html")[0],null===(e=i.getBattery)||void 0===e||e.call(i).then((function(e){t._battery=e})),this.networkType=di.LAN,this.isNative=!1,this.isBrowser=!0,this.isMobile=/mobile|android|iphone|ipad/.test(r),this.platform=this.isMobile?gi.MOBILE_BROWSER:gi.DESKTOP_BROWSER,this.isLittleEndian=(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),256===new Int16Array(n)[0]);var o=i.language;this.nativeLanguage=o.toLowerCase(),o=(o=o||i.browserLanguage)?o.split("-")[0]:fi.ENGLISH,this.language=o;var a=!1,s=!1,c="",l=0,u=/android\s*(\d+(?:\.\d+)*)/i.exec(r)||/android\s*(\d+(?:\.\d+)*)/i.exec(i.platform);u&&(a=!0,c=u[1]||"",l=parseInt(c)||0),(u=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(r))?(s=!0,c=u[2]||"",l=parseInt(c)||0):(/(iPhone|iPad|iPod)/.exec(i.platform)||"MacIntel"===i.platform&&i.maxTouchPoints&&i.maxTouchPoints>1)&&(s=!0,c="",l=0);var h=pi.UNKNOWN;-1!==i.appVersion.indexOf("Win")?h=pi.WINDOWS:s?h=pi.IOS:-1!==i.appVersion.indexOf("Mac")?h=pi.OSX:-1!==i.appVersion.indexOf("X11")&&-1===i.appVersion.indexOf("Linux")?h=pi.LINUX:a?h=pi.ANDROID:-1===i.appVersion.indexOf("Linux")&&-1===r.indexOf("ubuntu")||(h=pi.LINUX),this.os=h,this.osVersion=c,this.osMainVersion=l,this.browserType=hi.UNKNOWN;var _=/wechat|weixin|micromessenger/i.exec(r)||/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(r)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(r)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(r),f=_?_[0].toLowerCase():pi.UNKNOWN;("safari"===f&&a||"qq"===f&&/android.*applewebkit/i.test(r))&&(f=hi.ANDROID);var d={micromessenger:hi.WECHAT,wechat:hi.WECHAT,weixin:hi.WECHAT,trident:hi.IE,edge:hi.EDGE,"360 aphone":hi.BROWSER_360,mxbrowser:hi.MAXTHON,"opr/":hi.OPERA,ubrowser:hi.UC,huaweibrowser:hi.HUAWEI};this.browserType=d[f]||f,this.browserVersion="";var p=/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i.exec(r);p||(p=/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i.exec(r)),this.browserVersion=p?p[4]:"",this.pixelRatio=window.devicePixelRatio||1;var m,g=document.createElement("canvas"),v=!!g.getContext("2d"),y=!1;window.WebGLRenderingContext&&(y=!0);try{m=g.toDataURL("image/webp").startsWith("data:image/webp")}catch(e){m=!1}var S=!1;"undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob&&(g.width=g.height=2,createImageBitmap(g,{}).then((function(e){S=!0,null==e||e.close()})).catch((function(){}))),this.supportCapability={webp:m,gl:y,canvas:v,imageBitmap:S},this._registerEvent()}var t=e.prototype;return t._registerEvent=function(){var e=this;window.addEventListener("resize",(function(){e._eventTarget.emit(_i.RESIZE)})),window.addEventListener("orientationchange",(function(){e._eventTarget.emit(_i.ORIENTATION_CHANGE)})),this._registerVisibilityEvent()},t._registerVisibilityEvent=function(){var e,t=this;e=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":"hidden";var n=!1,i=function(){n||(n=!0,t._eventTarget.emit(_i.HIDE))},r=function(e,i,r,o,a){n&&(n=!1,t._eventTarget.emit(_i.SHOW,e,i,r,o,a))};if(e)for(var o=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],a=0;a<o.length;a++)document.addEventListener(o[a],(function(t){var n=document[e];(n=n||t.hidden)?i():r()}));else window.addEventListener("blur",i),window.addEventListener("focus",r);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(window.onfocus=r),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pagehide",i),window.addEventListener("pageshow",r),document.addEventListener("pagehide",i),document.addEventListener("pageshow",r))},t.getViewSize=function(){var e=document.getElementById("GameDiv");return this.isMobile||!e||e===this._html?new jn(window.innerWidth,window.innerHeight):new jn(e.clientWidth,e.clientHeight)},t.getOrientation=function(){throw new Error("TODO")},t.getSafeAreaEdge=function(){return{top:0,bottom:0,left:0,right:0}},t.getBatteryLevel=function(){return this._battery?this._battery.level:1},t.triggerGC=function(){},t.openURL=function(e){window.open(e)},t.now=function(){return Date.now?Date.now():+new Date},t.restartJSVM=function(){},t.onHide=function(e){this._eventTarget.on(_i.HIDE,e)},t.onShow=function(e){this._eventTarget.on(_i.SHOW,e)},t.onViewResize=function(e){this._eventTarget.on(_i.RESIZE,e)},t.onOrientationChange=function(e){this._eventTarget.on(_i.ORIENTATION_CHANGE,e)},t.offHide=function(e){this._eventTarget.off(_i.HIDE,e)},t.offShow=function(e){this._eventTarget.off(_i.SHOW,e)},t.offViewResize=function(e){this._eventTarget.off(_i.RESIZE,e)},t.offOrientationChange=function(e){this._eventTarget.off(_i.ORIENTATION_CHANGE,e)},e}()),Si=/(\.[^\.\/\?\\]*)(\?.*)?$/,Ei=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,Ti=/[^\.\/]+\/\.\.\//;function xi(){for(var e="",t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];e=(e+(""===e?"":"/")+a).replace(/(\/|\\\\)$/,"")}return e}function Ai(e){var t=Si.exec(e);return t?t[1]:""}function Ci(e){if(e){var t=e.lastIndexOf(".");if(-1!==t)return e.substring(0,t)}return e}function bi(e,t){var n=e.indexOf("?");n>0&&(e=e.substring(0,n));var i=/(\/|\\)([^\/\\]+)$/g.exec(e.replace(/(\/|\\)$/,""));if(!i)return e;var r=i[2];return t&&e.substring(e.length-t.length).toLowerCase()===t.toLowerCase()?r.substring(0,r.length-t.length):r}function wi(e){var t=Ei.exec(e);return t?t[2]:""}function Ri(e,t){t=t||"";var n=e.indexOf("?"),i="";return n>0&&(i=e.substring(n),e=e.substring(0,n)),(n=e.lastIndexOf("."))<0?e+t+i:e.substring(0,n)+t+i}function Ii(e,t,n){if(0===t.indexOf("."))return Ri(e,t);var i=e.indexOf("?"),r="",o=n?Ai(e):"";return i>0&&(r=e.substring(i),e=e.substring(0,i)),i=(i=e.lastIndexOf("/"))<=0?0:i+1,e.substring(0,i)+t+o+r}function Pi(e){var t=e=String(e);do{t=e,e=e.replace(Ti,"")}while(t.length!==e.length);return e}function Oi(e){return e.replace(/[\/\\]$/,"")}function Di(){return yi.os===pi.WINDOWS?"\\":"/"}e("path",Object.freeze({__proto__:null,join:xi,extname:Ai,mainFileName:Ci,basename:bi,dirname:wi,changeExtname:Ri,changeBasename:Ii,_normalize:Pi,stripSep:Oi,getSeperator:Di})),i.log=f,i.warn=d,i.error=p,i.assert=m,i._throw=y,i.logID=T,i.warnID=A,i.errorID=b,i.assertID=I,i.debug=N,i.path={join:xi,extname:Ai,mainFileName:Ci,basename:bi,dirname:wi,changeExtname:Ri,changeBasename:Ii,_normalize:Pi,stripSep:Oi,get sep(){return Di()}};var Ni,Mi,Li,Bi,Fi,zi,Ui,Hi,Gi,ki,Vi,Wi,ji,qi,Xi,Yi,Ki,Zi,Qi,Ji,$i,er,tr,nr,ir,rr=0,or={},ar=function(){function e(e,t,n){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=n*(1<<t)}return e.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},e}(),sr=function(){function e(){}return e.prototype.bind=function(){},e}(),cr=function(){function e(){}var t=e.prototype;return t.alloc=function(e,t){return new ArrayBuffer(t)},t.free=function(){},e}();!function(e){e[e.UINT32=0]="UINT32",e[e.FLOAT32=1]="FLOAT32",e[e.NEVER=2]="NEVER"}(ir||(ir={}));var lr,ur=function(){function e(e,t,n,i){void 0===i&&(i=8),this._dataType=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freelists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=n.COUNT,this._entryBits=i,this._dataType=t,this._stride=4*this._elementCount,this._entriesPerChunk=1<<i,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new ar(e,i,this._stride);var r=ir.NEVER,o=!1,a=!1;for(var s in t){if(o=this._hasFloat32,(a=this._hasUint32)&&o)break;r=t[s],o||r!==ir.FLOAT32?a||r!==ir.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var t=e.prototype;return t.alloc=function(){for(var e=0;e<this._freelists.length;e++){var t=this._freelists[e];if(t.length){var n=t[t.length-1];return t.length--,(e<<this._entryBits)+n+this._poolFlag}}for(var i=this._nativePool.allocateNewChunk(),r=[],o=[],a=[],s=this._hasFloat32,c=this._hasUint32,l=0;l<this._entriesPerChunk;l++)s&&r.push(new Float32Array(i,this._stride*l,this._elementCount)),c&&o.push(new Uint32Array(i,this._stride*l,this._elementCount)),l&&a.push(l);return this._arrayBuffers.push(i),c&&this._uint32BufferViews.push(o),s&&this._float32BufferViews.push(r),this._freelists.push(a),(e<<this._entryBits)+this._poolFlag},t.get=function(e,t){var n=(this._chunkMask&e)>>this._entryBits,i=this._entryMask&e;return(this._dataType[t]===ir.UINT32?this._uint32BufferViews:this._float32BufferViews)[n][i][t]},t.set=function(e,t,n){var i=(this._chunkMask&e)>>this._entryBits,r=this._entryMask&e;(this._dataType[t]===ir.UINT32?this._uint32BufferViews:this._float32BufferViews)[i][r][t]=n},t.setVec2=function(){},t.setVec3=function(){},t.getVec3=function(){},t.setVec4=function(){},t.getVec4=function(){},t.setMat4=function(){},t.free=function(e){var t=(this._chunkMask&e)>>this._entryBits,n=this._entryMask&e;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[t][n].fill(0),this._freelists[t].push(n)},e}(),hr=function(){function e(e,t,n){this._ctor=void 0,this._dtor=void 0,this._indexMask=void 0,this._poolFlag=void 0,this._array=[],this._freelist=[],this._nativePool=void 0,this._ctor=t,n&&(this._dtor=n),this._poolFlag=1<<29,this._indexMask=~this._poolFlag,this._nativePool=new sr(e,this._array)}var t=e.prototype;return t.alloc=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this._freelist,r=-1;if(i.length)r=i[i.length-1],i.length--,this._array[r]=this._ctor(arguments,this._array[r]);else{r=this._array.length;var o=this._ctor(arguments);if(!o)return 0;this._array.push(o)}return r+this._poolFlag},t.get=function(e){var t=this._indexMask&e;return this._array[t]},t.free=function(e){var t=this._indexMask&e;this._dtor&&(this._array[t]=this._dtor(this._array[t])),this._freelist.push(t)},e}(),_r=function(){function e(e){this._nativeBufferAllocator=void 0,this._buffers=new Map,this._nextBufferIdx=0,this._poolFlag=void 0,this._bufferIdxMask=void 0,this._freelist=[],this._poolFlag=1<<30,this._bufferIdxMask=~this._poolFlag,this._nativeBufferAllocator=new cr(e)}var t=e.prototype;return t.alloc=function(e){var t=this._freelist,n=-1;t.length?(n=t[t.length-1],t.length--):n=this._nextBufferIdx++;var i=this._nativeBufferAllocator.alloc(n,e);return this._buffers.set(n,i),n|this._poolFlag},t.free=function(e){var t=this._bufferIdxMask&e;this._buffers.get(t)&&(this._nativeBufferAllocator.free(t),this._buffers.delete(t),this._freelist.push(t))},t.getBuffer=function(e){var t=this._bufferIdxMask&e;return this._buffers.get(t)||null},e}(),fr=function(e){function t(t,n,i,r){var o;return(o=e.call(this,t)||this)._viewCtor=void 0,o._size=void 0,o._step=void 0,o._viewCtor=n,o._size=i*n.BYTES_PER_ELEMENT,o._step=r||i,o}K(t,e);var n=t.prototype;return n.alloc=function(){var e=this._nextBufferIdx++,t=this._nativeBufferAllocator.alloc(e,this._size);return this._buffers.set(e,new this._viewCtor(t)),e|this._poolFlag},n.getBuffer=function(){return null},n.assign=function(e,t,n){var i=this._bufferIdxMask&e,r=this._buffers.get(i);if(r){var o=t+1;if(o>=r.length){for(var a=r.length;o>=a;)a+=this._step;a*=this._viewCtor.BYTES_PER_ELEMENT;var s=new this._viewCtor(this._nativeBufferAllocator.alloc(i,a));s.set(r),r=s,this._buffers.set(i,r)}r[o]=n;var c=r[0];r[0]=o>c?o:c}},n.erase=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);if(i&&!(t>=i[0])){for(var r=t+1;r<i[0];++r)i[r]=i[r+1];--i[0]}},n.push=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);i&&this.assign(e,i[0],t)},n.pop=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);n&&0!==n[0]&&--n[0]},n.clear=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);n&&(n[0]=0)},n.get=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);return!i||t>=i[0]?0:i[t+1]},n.length=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);return n?n[0]:0},t}(_r);function dr(e,t,n,i){void 0===i&&(i=!0);for(var r=t.length(e),o=0;o<r;o++){var a=t.get(e,o);a&&n.free(a)}i?t.free(e):t.clear(e)}!function(e){e[e.ATTRIBUTE=0]="ATTRIBUTE",e[e.DESCRIPTOR_SETS=1]="DESCRIPTOR_SETS",e[e.SHADER=2]="SHADER",e[e.INPUT_ASSEMBLER=3]="INPUT_ASSEMBLER",e[e.PIPELINE_LAYOUT=4]="PIPELINE_LAYOUT",e[e.FRAMEBUFFER=5]="FRAMEBUFFER",e[e.PASS=100]="PASS",e[e.SUB_MODEL=101]="SUB_MODEL",e[e.MODEL=102]="MODEL",e[e.SCENE=103]="SCENE",e[e.CAMERA=104]="CAMERA",e[e.NODE=105]="NODE",e[e.ROOT=106]="ROOT",e[e.AABB=107]="AABB",e[e.RENDER_WINDOW=108]="RENDER_WINDOW",e[e.FRUSTUM=109]="FRUSTUM",e[e.AMBIENT=110]="AMBIENT",e[e.FOG=111]="FOG",e[e.SKYBOX=112]="SKYBOX",e[e.SHADOW=113]="SHADOW",e[e.LIGHT=114]="LIGHT",e[e.SPHERE=115]="SPHERE",e[e.INSTANCED_ATTRIBUTE=116]="INSTANCED_ATTRIBUTE",e[e.FLAT_BUFFER=117]="FLAT_BUFFER",e[e.SUB_MESH=118]="SUB_MESH",e[e.RASTERIZER_STATE=119]="RASTERIZER_STATE",e[e.DEPTH_STENCIL_STATE=120]="DEPTH_STENCIL_STATE",e[e.BLEND_TARGET=121]="BLEND_TARGET",e[e.BLEND_STATE=122]="BLEND_STATE",e[e.BATCH_2D=123]="BATCH_2D",e[e.PIPELINE_SCENE_DATA=124]="PIPELINE_SCENE_DATA",e[e.SUB_MODEL_ARRAY=200]="SUB_MODEL_ARRAY",e[e.MODEL_ARRAY=201]="MODEL_ARRAY",e[e.ATTRIBUTE_ARRAY=202]="ATTRIBUTE_ARRAY",e[e.FLAT_BUFFER_ARRAY=203]="FLAT_BUFFER_ARRAY",e[e.INSTANCED_BUFFER_ARRAY=204]="INSTANCED_BUFFER_ARRAY",e[e.LIGHT_ARRAY=205]="LIGHT_ARRAY",e[e.BLEND_TARGET_ARRAY=206]="BLEND_TARGET_ARRAY",e[e.BATCH_ARRAY_2D=207]="BATCH_ARRAY_2D",e[e.RAW_BUFFER=300]="RAW_BUFFER",e[e.RAW_OBJECT=400]="RAW_OBJECT"}(lr||(lr={}));var pr,mr=new hr(lr.SHADER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createShader(e[1])}),(function(e){return e&&e.destroy(),e})),gr=new hr(lr.DESCRIPTOR_SETS,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createDescriptorSet(e[1])}),(function(e){return e&&e.destroy(),e})),vr=new hr(lr.INPUT_ASSEMBLER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createInputAssembler(e[1])}),(function(e){return e&&e.destroy(),e})),yr=new hr(lr.PIPELINE_LAYOUT,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createPipelineLayout(e[1])}),(function(e){return e&&e.destroy(),e})),Sr=new hr(lr.FRAMEBUFFER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createFramebuffer(e[1])}),(function(e){return e&&e.destroy(),e})),Er=new fr(lr.SUB_MODEL_ARRAY,Uint32Array,8,4),Tr=new fr(lr.MODEL_ARRAY,Uint32Array,32,16),xr=new fr(lr.ATTRIBUTE_ARRAY,Uint32Array,8,4),Ar=new fr(lr.FLAT_BUFFER_ARRAY,Uint32Array,8,4),Cr=new fr(lr.LIGHT_ARRAY,Uint32Array,8,4),br=new fr(lr.BLEND_TARGET_ARRAY,Uint32Array,8,4),wr=new fr(lr.BATCH_ARRAY_2D,Uint32Array,32,16),Rr=new _r(lr.RAW_BUFFER),Ir=new hr(lr.RAW_OBJECT,(function(e){return e[0]||{}}),(function(){}));!function(e){e[e.PRIORITY=0]="PRIORITY",e[e.STAGE=1]="STAGE",e[e.PHASE=2]="PHASE",e[e.BATCHING_SCHEME=3]="BATCHING_SCHEME",e[e.PRIMITIVE=4]="PRIMITIVE",e[e.DYNAMIC_STATES=5]="DYNAMIC_STATES",e[e.HASH=6]="HASH",e[e.RASTERIZER_STATE=7]="RASTERIZER_STATE",e[e.DEPTH_STENCIL_STATE=8]="DEPTH_STENCIL_STATE",e[e.BLEND_STATE=9]="BLEND_STATE",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.PIPELINE_LAYOUT=11]="PIPELINE_LAYOUT",e[e.COUNT=12]="COUNT"}(pr||(pr={}));var Pr,Or=((Ni={})[pr.PRIORITY]=ir.UINT32,Ni[pr.STAGE]=ir.UINT32,Ni[pr.PHASE]=ir.UINT32,Ni[pr.BATCHING_SCHEME]=ir.UINT32,Ni[pr.PRIMITIVE]=ir.UINT32,Ni[pr.DYNAMIC_STATES]=ir.UINT32,Ni[pr.HASH]=ir.UINT32,Ni[pr.RASTERIZER_STATE]=ir.UINT32,Ni[pr.DEPTH_STENCIL_STATE]=ir.UINT32,Ni[pr.BLEND_STATE]=ir.UINT32,Ni[pr.DESCRIPTOR_SET]=ir.UINT32,Ni[pr.PIPELINE_LAYOUT]=ir.UINT32,Ni[pr.COUNT]=ir.NEVER,Ni),Dr=new ur(lr.PASS,Or,pr);!function(e){e[e.PRIORITY=0]="PRIORITY",e[e.PASS_COUNT=1]="PASS_COUNT",e[e.PASS_0=2]="PASS_0",e[e.PASS_1=3]="PASS_1",e[e.PASS_2=4]="PASS_2",e[e.PASS_3=5]="PASS_3",e[e.PASS_4=6]="PASS_4",e[e.PASS_5=7]="PASS_5",e[e.PASS_6=8]="PASS_6",e[e.PASS_7=9]="PASS_7",e[e.SHADER_0=10]="SHADER_0",e[e.SHADER_1=11]="SHADER_1",e[e.SHADER_2=12]="SHADER_2",e[e.SHADER_3=13]="SHADER_3",e[e.SHADER_4=14]="SHADER_4",e[e.SHADER_5=15]="SHADER_5",e[e.SHADER_6=16]="SHADER_6",e[e.SHADER_7=17]="SHADER_7",e[e.PLANAR_SHADER=18]="PLANAR_SHADER",e[e.PLANAR_INSTANCE_SHADER=19]="PLANAR_INSTANCE_SHADER",e[e.DESCRIPTOR_SET=20]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=21]="INPUT_ASSEMBLER",e[e.SUB_MESH=22]="SUB_MESH",e[e.COUNT=23]="COUNT"}(Pr||(Pr={}));var Nr,Mr=((Mi={})[Pr.PRIORITY]=ir.UINT32,Mi[Pr.PASS_COUNT]=ir.UINT32,Mi[Pr.PASS_0]=ir.UINT32,Mi[Pr.PASS_1]=ir.UINT32,Mi[Pr.PASS_2]=ir.UINT32,Mi[Pr.PASS_3]=ir.UINT32,Mi[Pr.PASS_4]=ir.UINT32,Mi[Pr.PASS_5]=ir.UINT32,Mi[Pr.PASS_6]=ir.UINT32,Mi[Pr.PASS_7]=ir.UINT32,Mi[Pr.SHADER_0]=ir.UINT32,Mi[Pr.SHADER_1]=ir.UINT32,Mi[Pr.SHADER_2]=ir.UINT32,Mi[Pr.SHADER_3]=ir.UINT32,Mi[Pr.SHADER_4]=ir.UINT32,Mi[Pr.SHADER_5]=ir.UINT32,Mi[Pr.SHADER_6]=ir.UINT32,Mi[Pr.SHADER_7]=ir.UINT32,Mi[Pr.PLANAR_SHADER]=ir.UINT32,Mi[Pr.PLANAR_INSTANCE_SHADER]=ir.UINT32,Mi[Pr.DESCRIPTOR_SET]=ir.UINT32,Mi[Pr.INPUT_ASSEMBLER]=ir.UINT32,Mi[Pr.SUB_MESH]=ir.UINT32,Mi[Pr.COUNT]=ir.NEVER,Mi),Lr=new ur(lr.SUB_MODEL,Mr,Pr);!function(e){e[e.ENABLED=0]="ENABLED",e[e.VIS_FLAGS=1]="VIS_FLAGS",e[e.CAST_SHADOW=2]="CAST_SHADOW",e[e.RECEIVE_SHADOW=3]="RECEIVE_SHADOW",e[e.WORLD_BOUNDS=4]="WORLD_BOUNDS",e[e.NODE=5]="NODE",e[e.TRANSFORM=6]="TRANSFORM",e[e.SUB_MODEL_ARRAY=7]="SUB_MODEL_ARRAY",e[e.INSTANCED_BUFFER=8]="INSTANCED_BUFFER",e[e.INSTANCED_ATTR_ARRAY=9]="INSTANCED_ATTR_ARRAY",e[e.COUNT=10]="COUNT"}(Nr||(Nr={}));var Br,Fr=((Li={})[Nr.ENABLED]=ir.UINT32,Li[Nr.VIS_FLAGS]=ir.UINT32,Li[Nr.CAST_SHADOW]=ir.UINT32,Li[Nr.RECEIVE_SHADOW]=ir.UINT32,Li[Nr.WORLD_BOUNDS]=ir.UINT32,Li[Nr.NODE]=ir.UINT32,Li[Nr.TRANSFORM]=ir.UINT32,Li[Nr.SUB_MODEL_ARRAY]=ir.UINT32,Li[Nr.INSTANCED_BUFFER]=ir.UINT32,Li[Nr.INSTANCED_ATTR_ARRAY]=ir.UINT32,Li[Nr.COUNT]=ir.NEVER,Li),zr=new ur(lr.MODEL,Fr,Nr);!function(e){e[e.VIS_FLAGS=0]="VIS_FLAGS",e[e.PASS_COUNT=1]="PASS_COUNT",e[e.PASS_0=2]="PASS_0",e[e.PASS_1=3]="PASS_1",e[e.PASS_2=4]="PASS_2",e[e.PASS_3=5]="PASS_3",e[e.SHADER_0=6]="SHADER_0",e[e.SHADER_1=7]="SHADER_1",e[e.SHADER_2=8]="SHADER_2",e[e.SHADER_3=9]="SHADER_3",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",e[e.COUNT=12]="COUNT"}(Br||(Br={}));var Ur,Hr=((Bi={})[Br.VIS_FLAGS]=ir.UINT32,Bi[Br.PASS_COUNT]=ir.UINT32,Bi[Br.PASS_0]=ir.UINT32,Bi[Br.PASS_1]=ir.UINT32,Bi[Br.PASS_2]=ir.UINT32,Bi[Br.PASS_3]=ir.UINT32,Bi[Br.SHADER_0]=ir.UINT32,Bi[Br.SHADER_1]=ir.UINT32,Bi[Br.SHADER_2]=ir.UINT32,Bi[Br.SHADER_3]=ir.UINT32,Bi[Br.DESCRIPTOR_SET]=ir.UINT32,Bi[Br.INPUT_ASSEMBLER]=ir.UINT32,Bi[Br.COUNT]=ir.NEVER,Bi),Gr=new ur(lr.BATCH_2D,Hr,Br);!function(e){e[e.CENTER=0]="CENTER",e[e.HALF_EXTENSION=3]="HALF_EXTENSION",e[e.COUNT=6]="COUNT"}(Ur||(Ur={}));var kr,Vr=((Fi={})[Ur.CENTER]=ir.FLOAT32,Fi[Ur.HALF_EXTENSION]=ir.FLOAT32,Fi[Ur.COUNT]=ir.NEVER,Fi),Wr=new ur(lr.AABB,Vr,Ur);!function(e){e[e.MAIN_LIGHT=0]="MAIN_LIGHT",e[e.MODEL_ARRAY=1]="MODEL_ARRAY",e[e.SPHERE_LIGHT_ARRAY=2]="SPHERE_LIGHT_ARRAY",e[e.SPOT_LIGHT_ARRAY=3]="SPOT_LIGHT_ARRAY",e[e.BATCH_ARRAY_2D=4]="BATCH_ARRAY_2D",e[e.COUNT=5]="COUNT"}(kr||(kr={}));var jr,qr=((zi={})[kr.MAIN_LIGHT]=ir.UINT32,zi[kr.MODEL_ARRAY]=ir.UINT32,zi[kr.SPHERE_LIGHT_ARRAY]=ir.UINT32,zi[kr.SPOT_LIGHT_ARRAY]=ir.UINT32,zi[kr.BATCH_ARRAY_2D]=ir.UINT32,zi[kr.COUNT]=ir.NEVER,zi),Xr=new ur(lr.SCENE,qr,kr);!function(e){e[e.WIDTH=0]="WIDTH",e[e.HEIGHT=1]="HEIGHT",e[e.EXPOSURE=2]="EXPOSURE",e[e.CLEAR_FLAGS=3]="CLEAR_FLAGS",e[e.CLEAR_DEPTH=4]="CLEAR_DEPTH",e[e.CLEAR_STENCIL=5]="CLEAR_STENCIL",e[e.VISIBILITY=6]="VISIBILITY",e[e.NODE=7]="NODE",e[e.SCENE=8]="SCENE",e[e.FRUSTUM=9]="FRUSTUM",e[e.WINDOW=10]="WINDOW",e[e.FORWARD=11]="FORWARD",e[e.POSITION=14]="POSITION",e[e.VIEW_PORT=17]="VIEW_PORT",e[e.CLEAR_COLOR=21]="CLEAR_COLOR",e[e.MAT_VIEW=25]="MAT_VIEW",e[e.MAT_VIEW_PROJ=41]="MAT_VIEW_PROJ",e[e.MAT_VIEW_PROJ_INV=57]="MAT_VIEW_PROJ_INV",e[e.MAT_PROJ=73]="MAT_PROJ",e[e.MAT_PROJ_INV=89]="MAT_PROJ_INV",e[e.MAT_VIEW_PROJ_OFFSCREEN=105]="MAT_VIEW_PROJ_OFFSCREEN",e[e.MAT_VIEW_PROJ_INV_OFFSCREEN=121]="MAT_VIEW_PROJ_INV_OFFSCREEN",e[e.MAT_PROJ_OFFSCREEN=137]="MAT_PROJ_OFFSCREEN",e[e.MAT_PROJ_INV_OFFSCREEN=153]="MAT_PROJ_INV_OFFSCREEN",e[e.COUNT=169]="COUNT"}(jr||(jr={}));var Yr,Kr=((Ui={})[jr.WIDTH]=ir.UINT32,Ui[jr.HEIGHT]=ir.UINT32,Ui[jr.EXPOSURE]=ir.FLOAT32,Ui[jr.CLEAR_FLAGS]=ir.UINT32,Ui[jr.CLEAR_DEPTH]=ir.FLOAT32,Ui[jr.CLEAR_STENCIL]=ir.UINT32,Ui[jr.VISIBILITY]=ir.UINT32,Ui[jr.NODE]=ir.UINT32,Ui[jr.SCENE]=ir.UINT32,Ui[jr.FRUSTUM]=ir.UINT32,Ui[jr.WINDOW]=ir.UINT32,Ui[jr.FORWARD]=ir.FLOAT32,Ui[jr.POSITION]=ir.FLOAT32,Ui[jr.VIEW_PORT]=ir.FLOAT32,Ui[jr.CLEAR_COLOR]=ir.FLOAT32,Ui[jr.MAT_VIEW]=ir.FLOAT32,Ui[jr.MAT_VIEW_PROJ]=ir.FLOAT32,Ui[jr.MAT_VIEW_PROJ_INV]=ir.FLOAT32,Ui[jr.MAT_PROJ]=ir.FLOAT32,Ui[jr.MAT_PROJ_INV]=ir.FLOAT32,Ui[jr.MAT_VIEW_PROJ_OFFSCREEN]=ir.FLOAT32,Ui[jr.MAT_VIEW_PROJ_INV_OFFSCREEN]=ir.FLOAT32,Ui[jr.MAT_PROJ_OFFSCREEN]=ir.FLOAT32,Ui[jr.MAT_PROJ_INV_OFFSCREEN]=ir.FLOAT32,Ui[jr.COUNT]=ir.NEVER,Ui),Zr=new ur(lr.CAMERA,Kr,jr);!function(e){e[e.FLAGS_CHANGED=0]="FLAGS_CHANGED",e[e.LAYER=1]="LAYER",e[e.WORLD_SCALE=2]="WORLD_SCALE",e[e.WORLD_POSITION=5]="WORLD_POSITION",e[e.WORLD_ROTATION=8]="WORLD_ROTATION",e[e.WORLD_MATRIX=12]="WORLD_MATRIX",e[e.COUNT=28]="COUNT"}(Yr||(Yr={}));var Qr=((Hi={})[Yr.FLAGS_CHANGED]=ir.UINT32,Hi[Yr.LAYER]=ir.UINT32,Hi[Yr.WORLD_SCALE]=ir.FLOAT32,Hi[Yr.WORLD_POSITION]=ir.FLOAT32,Hi[Yr.WORLD_ROTATION]=ir.FLOAT32,Hi[Yr.WORLD_MATRIX]=ir.FLOAT32,Hi[Yr.COUNT]=ir.NEVER,Hi);delete Yr[Yr.COUNT],Yr[Yr.COUNT=Yr.LAYER+1]="COUNT";var Jr,$r=new ur(lr.NODE,Qr,Yr);!function(e){e[e.CUMULATIVE_TIME=0]="CUMULATIVE_TIME",e[e.FRAME_TIME=1]="FRAME_TIME",e[e.COUNT=2]="COUNT"}(Jr||(Jr={}));var eo,to=((Gi={})[Jr.CUMULATIVE_TIME]=ir.FLOAT32,Gi[Jr.FRAME_TIME]=ir.FLOAT32,Gi[Jr.COUNT]=ir.NEVER,Gi),no=new ur(lr.ROOT,to,Jr,1);!function(e){e[e.HAS_ON_SCREEN_ATTACHMENTS=0]="HAS_ON_SCREEN_ATTACHMENTS",e[e.HAS_OFF_SCREEN_ATTACHMENTS=1]="HAS_OFF_SCREEN_ATTACHMENTS",e[e.FRAMEBUFFER=2]="FRAMEBUFFER",e[e.COUNT=3]="COUNT"}(eo||(eo={}));var io,ro=((ki={})[eo.HAS_ON_SCREEN_ATTACHMENTS]=ir.UINT32,ki[eo.HAS_OFF_SCREEN_ATTACHMENTS]=ir.UINT32,ki[eo.FRAMEBUFFER]=ir.UINT32,ki[eo.COUNT]=ir.NEVER,ki),oo=new ur(lr.RENDER_WINDOW,ro,eo,2);!function(e){e[e.VERTICES=0]="VERTICES",e[e.PLANES=24]="PLANES",e[e.COUNT=48]="COUNT"}(io||(io={}));var ao,so=((Vi={})[io.VERTICES]=ir.FLOAT32,Vi[io.PLANES]=ir.FLOAT32,Vi[io.COUNT]=ir.NEVER,Vi),co=new ur(lr.FRUSTUM,so,io);!function(e){e[e.ENABLE=0]="ENABLE",e[e.ILLUM=1]="ILLUM",e[e.SKY_COLOR=2]="SKY_COLOR",e[e.GROUND_ALBEDO=6]="GROUND_ALBEDO",e[e.COUNT=10]="COUNT"}(ao||(ao={}));var lo=((Wi={})[ao.ENABLE]=ir.UINT32,Wi[ao.ILLUM]=ir.FLOAT32,Wi[ao.SKY_COLOR]=ir.FLOAT32,Wi[ao.GROUND_ALBEDO]=ir.FLOAT32,Wi[ao.COUNT]=ir.NEVER,Wi);delete ao[ao.COUNT],ao[ao.COUNT=ao.ILLUM+1]="COUNT";var uo,ho=new ur(lr.AMBIENT,lo,ao,1);!function(e){e[e.ENABLE=0]="ENABLE",e[e.IS_RGBE=1]="IS_RGBE",e[e.USE_IBL=2]="USE_IBL",e[e.MODEL=3]="MODEL",e[e.COUNT=4]="COUNT"}(uo||(uo={}));var _o,fo=((ji={})[uo.ENABLE]=ir.UINT32,ji[uo.IS_RGBE]=ir.UINT32,ji[uo.USE_IBL]=ir.UINT32,ji[uo.MODEL]=ir.UINT32,ji[uo.COUNT]=ir.NEVER,ji),po=new ur(lr.SKYBOX,fo,uo,1);!function(e){e[e.ENABLE=0]="ENABLE",e[e.TYPE=1]="TYPE",e[e.DENSITY=2]="DENSITY",e[e.START=3]="START",e[e.END=4]="END",e[e.ATTEN=5]="ATTEN",e[e.TOP=6]="TOP",e[e.RANGE=7]="RANGE",e[e.COLOR=8]="COLOR",e[e.COUNT=12]="COUNT"}(_o||(_o={}));var mo=((qi={})[_o.ENABLE]=ir.UINT32,qi[_o.TYPE]=ir.UINT32,qi[_o.DENSITY]=ir.FLOAT32,qi[_o.START]=ir.FLOAT32,qi[_o.END]=ir.FLOAT32,qi[_o.ATTEN]=ir.FLOAT32,qi[_o.TOP]=ir.FLOAT32,qi[_o.RANGE]=ir.FLOAT32,qi[_o.COLOR]=ir.FLOAT32,qi[_o.COUNT]=ir.NEVER,qi);delete _o[_o.COUNT],_o[_o.COUNT=_o.RANGE+1]="COUNT";var go,vo=new ur(lr.FOG,mo,_o);!function(e){e[e.ENABLE=0]="ENABLE",e[e.DIRTY=1]="DIRTY",e[e.TYPE=2]="TYPE",e[e.DISTANCE=3]="DISTANCE",e[e.INSTANCE_PASS=4]="INSTANCE_PASS",e[e.PLANAR_PASS=5]="PLANAR_PASS",e[e.NEAR=6]="NEAR",e[e.FAR=7]="FAR",e[e.ASPECT=8]="ASPECT",e[e.PCF_TYPE=9]="PCF_TYPE",e[e.SHADOW_MAP_DIRTY=10]="SHADOW_MAP_DIRTY",e[e.BIAS=11]="BIAS",e[e.PACKING=12]="PACKING",e[e.LINEAR=13]="LINEAR",e[e.SELF_SHADOW=14]="SELF_SHADOW",e[e.NORMAL_BIAS=15]="NORMAL_BIAS",e[e.ORTHO_SIZE=16]="ORTHO_SIZE",e[e.AUTO_ADAPT=17]="AUTO_ADAPT",e[e.COLOR=18]="COLOR",e[e.SIZE=22]="SIZE",e[e.NORMAL=24]="NORMAL",e[e.MAT_LIGHT=27]="MAT_LIGHT",e[e.COUNT=43]="COUNT"}(go||(go={}));var yo=((Xi={})[go.ENABLE]=ir.UINT32,Xi[go.DIRTY]=ir.UINT32,Xi[go.TYPE]=ir.UINT32,Xi[go.DISTANCE]=ir.FLOAT32,Xi[go.INSTANCE_PASS]=ir.UINT32,Xi[go.PLANAR_PASS]=ir.UINT32,Xi[go.NEAR]=ir.FLOAT32,Xi[go.FAR]=ir.FLOAT32,Xi[go.ASPECT]=ir.FLOAT32,Xi[go.PCF_TYPE]=ir.UINT32,Xi[go.SHADOW_MAP_DIRTY]=ir.UINT32,Xi[go.BIAS]=ir.FLOAT32,Xi[go.PACKING]=ir.UINT32,Xi[go.LINEAR]=ir.UINT32,Xi[go.SELF_SHADOW]=ir.UINT32,Xi[go.NORMAL_BIAS]=ir.FLOAT32,Xi[go.ORTHO_SIZE]=ir.FLOAT32,Xi[go.AUTO_ADAPT]=ir.UINT32,Xi[go.COLOR]=ir.FLOAT32,Xi[go.SIZE]=ir.FLOAT32,Xi[go.NORMAL]=ir.FLOAT32,Xi[go.MAT_LIGHT]=ir.FLOAT32,Xi[go.COUNT]=ir.NEVER,Xi);delete go[go.COUNT],go[go.COUNT=go.AUTO_ADAPT+1]="COUNT";var So,Eo=new ur(lr.SHADOW,yo,go,1);!function(e){e[e.SHADOW=0]="SHADOW",e[e.SKYBOX=1]="SKYBOX",e[e.AMBIENT=2]="AMBIENT",e[e.FOG=3]="FOG",e[e.IS_HDR=4]="IS_HDR",e[e.SHADING_SCALE=5]="SHADING_SCALE",e[e.FP_SCALE=6]="FP_SCALE",e[e.DEFERRED_LIGHT_PASS=7]="DEFERRED_LIGHT_PASS",e[e.DEFERRED_LIGHT_PASS_SHADER=8]="DEFERRED_LIGHT_PASS_SHADER",e[e.DEFERRED_POST_PASS=9]="DEFERRED_POST_PASS",e[e.DEFERRED_POST_PASS_SHADER=10]="DEFERRED_POST_PASS_SHADER",e[e.COUNT=11]="COUNT"}(So||(So={}));var To,xo=((Yi={})[So.SHADOW]=ir.UINT32,Yi[So.SKYBOX]=ir.UINT32,Yi[So.AMBIENT]=ir.UINT32,Yi[So.FOG]=ir.UINT32,Yi[So.IS_HDR]=ir.UINT32,Yi[So.SHADING_SCALE]=ir.UINT32,Yi[So.FP_SCALE]=ir.UINT32,Yi[So.DEFERRED_LIGHT_PASS]=ir.UINT32,Yi[So.DEFERRED_LIGHT_PASS_SHADER]=ir.UINT32,Yi[So.DEFERRED_POST_PASS]=ir.UINT32,Yi[So.DEFERRED_POST_PASS_SHADER]=ir.UINT32,Yi[So.COUNT]=ir.NEVER,Yi),Ao=new ur(lr.PIPELINE_SCENE_DATA,xo,So,1);!function(e){e[e.USE_COLOR_TEMPERATURE=0]="USE_COLOR_TEMPERATURE",e[e.ILLUMINANCE=1]="ILLUMINANCE",e[e.NODE=2]="NODE",e[e.RANGE=3]="RANGE",e[e.TYPE=4]="TYPE",e[e.AABB=5]="AABB",e[e.FRUSTUM=6]="FRUSTUM",e[e.SIZE=7]="SIZE",e[e.SPOT_ANGLE=8]="SPOT_ANGLE",e[e.ASPECT=9]="ASPECT",e[e.DIRECTION=10]="DIRECTION",e[e.COLOR=13]="COLOR",e[e.COLOR_TEMPERATURE_RGB=16]="COLOR_TEMPERATURE_RGB",e[e.POSITION=19]="POSITION",e[e.COUNT=22]="COUNT"}(To||(To={}));var Co,bo=((Ki={})[To.USE_COLOR_TEMPERATURE]=ir.UINT32,Ki[To.ILLUMINANCE]=ir.FLOAT32,Ki[To.NODE]=ir.UINT32,Ki[To.RANGE]=ir.FLOAT32,Ki[To.TYPE]=ir.UINT32,Ki[To.AABB]=ir.UINT32,Ki[To.FRUSTUM]=ir.UINT32,Ki[To.SIZE]=ir.FLOAT32,Ki[To.SPOT_ANGLE]=ir.FLOAT32,Ki[To.ASPECT]=ir.FLOAT32,Ki[To.DIRECTION]=ir.FLOAT32,Ki[To.COLOR]=ir.FLOAT32,Ki[To.COLOR_TEMPERATURE_RGB]=ir.FLOAT32,Ki[To.POSITION]=ir.FLOAT32,Ki[To.COUNT]=ir.NEVER,Ki),wo=new ur(lr.LIGHT,bo,To,3);!function(e){e[e.RADIUS=0]="RADIUS",e[e.CENTER=1]="CENTER",e[e.COUNT=4]="COUNT"}(Co||(Co={}));var Ro=((Zi={})[Co.RADIUS]=ir.FLOAT32,Zi[Co.CENTER]=ir.FLOAT32,Zi[Co.COUNT]=ir.NEVER,Zi);delete Co[Co.COUNT],Co[Co.COUNT=Co.RADIUS+1]="COUNT";var Io,Po=new ur(lr.SPHERE,Ro,Co,3);!function(e){e[e.STRIDE=0]="STRIDE",e[e.AMOUNT=1]="AMOUNT",e[e.BUFFER=2]="BUFFER",e[e.COUNT=3]="COUNT"}(Io||(Io={}));var Oo,Do=((Qi={})[Io.STRIDE]=ir.UINT32,Qi[Io.AMOUNT]=ir.UINT32,Qi[Io.BUFFER]=ir.UINT32,Qi[Io.COUNT]=ir.NEVER,Qi),No=new ur(lr.FLAT_BUFFER,Do,Io,3);!function(e){e[e.FLAT_BUFFER_ARRAY=0]="FLAT_BUFFER_ARRAY",e[e.COUNT=1]="COUNT"}(Oo||(Oo={}));var Mo,Lo=((Ji={})[Oo.FLAT_BUFFER_ARRAY]=ir.UINT32,Ji[Oo.COUNT]=ir.NEVER,Ji),Bo=new ur(lr.SUB_MESH,Lo,Oo,3);!function(e){e[e.IS_DISCARD=0]="IS_DISCARD",e[e.POLYGO_MODEL=1]="POLYGO_MODEL",e[e.SHADE_MODEL=2]="SHADE_MODEL",e[e.CULL_MODE=3]="CULL_MODE",e[e.IS_FRONT_FACE_CCW=4]="IS_FRONT_FACE_CCW",e[e.DEPTH_BIAS_ENABLED=5]="DEPTH_BIAS_ENABLED",e[e.DEPTH_BIAS=6]="DEPTH_BIAS",e[e.DEPTH_BIAS_CLAMP=7]="DEPTH_BIAS_CLAMP",e[e.DEPTH_BIAS_SLOP=8]="DEPTH_BIAS_SLOP",e[e.IS_DEPTH_CLIP=9]="IS_DEPTH_CLIP",e[e.IS_MULTI_SAMPLE=10]="IS_MULTI_SAMPLE",e[e.LINE_WIDTH=11]="LINE_WIDTH",e[e.COUNT=12]="COUNT"}(Mo||(Mo={}));var Fo,zo=(($i={})[Mo.IS_DISCARD]=ir.UINT32,$i[Mo.POLYGO_MODEL]=ir.UINT32,$i[Mo.SHADE_MODEL]=ir.UINT32,$i[Mo.CULL_MODE]=ir.UINT32,$i[Mo.IS_FRONT_FACE_CCW]=ir.UINT32,$i[Mo.DEPTH_BIAS_ENABLED]=ir.UINT32,$i[Mo.DEPTH_BIAS]=ir.FLOAT32,$i[Mo.DEPTH_BIAS_CLAMP]=ir.FLOAT32,$i[Mo.DEPTH_BIAS_SLOP]=ir.FLOAT32,$i[Mo.IS_DEPTH_CLIP]=ir.UINT32,$i[Mo.IS_MULTI_SAMPLE]=ir.UINT32,$i[Mo.LINE_WIDTH]=ir.FLOAT32,$i[Mo.COUNT]=ir.NEVER,$i),Uo=new ur(lr.RASTERIZER_STATE,zo,Mo,9);!function(e){e[e.DEPTH_TEST=0]="DEPTH_TEST",e[e.DEPTH_WRITE=1]="DEPTH_WRITE",e[e.DEPTH_FUNC=2]="DEPTH_FUNC",e[e.STENCIL_TEST_FRONT=3]="STENCIL_TEST_FRONT",e[e.STENCIL_FUNC_FRONT=4]="STENCIL_FUNC_FRONT",e[e.STENCIL_READ_MASK_FRONT=5]="STENCIL_READ_MASK_FRONT",e[e.STENCIL_WRITE_MASK_FRONT=6]="STENCIL_WRITE_MASK_FRONT",e[e.STENCIL_FAIL_OP_FRONT=7]="STENCIL_FAIL_OP_FRONT",e[e.STENCIL_Z_FAIL_OP_FRONT=8]="STENCIL_Z_FAIL_OP_FRONT",e[e.STENCIL_PASS_OP_FRONT=9]="STENCIL_PASS_OP_FRONT",e[e.STENCIL_REF_FRONT=10]="STENCIL_REF_FRONT",e[e.STENCIL_TEST_BACK=11]="STENCIL_TEST_BACK",e[e.STENCIL_FUNC_BACK=12]="STENCIL_FUNC_BACK",e[e.STENCIL_READ_MADK_BACK=13]="STENCIL_READ_MADK_BACK",e[e.STENCIL_WRITE_MASK_BACK=14]="STENCIL_WRITE_MASK_BACK",e[e.STENCIL_FAIL_OP_BACK=15]="STENCIL_FAIL_OP_BACK",e[e.STENCIL_Z_FAIL_OP_BACK=16]="STENCIL_Z_FAIL_OP_BACK",e[e.STENCIL_PASS_OP_BACK=17]="STENCIL_PASS_OP_BACK",e[e.STENCIL_REF_BACK=18]="STENCIL_REF_BACK",e[e.COUNT=19]="COUNT"}(Fo||(Fo={}));var Ho,Go=((er={})[Fo.DEPTH_TEST]=ir.UINT32,er[Fo.DEPTH_WRITE]=ir.UINT32,er[Fo.DEPTH_FUNC]=ir.UINT32,er[Fo.STENCIL_TEST_FRONT]=ir.UINT32,er[Fo.STENCIL_FUNC_FRONT]=ir.UINT32,er[Fo.STENCIL_READ_MASK_FRONT]=ir.UINT32,er[Fo.STENCIL_WRITE_MASK_FRONT]=ir.UINT32,er[Fo.STENCIL_FAIL_OP_FRONT]=ir.UINT32,er[Fo.STENCIL_Z_FAIL_OP_FRONT]=ir.UINT32,er[Fo.STENCIL_PASS_OP_FRONT]=ir.UINT32,er[Fo.STENCIL_REF_FRONT]=ir.UINT32,er[Fo.STENCIL_TEST_BACK]=ir.UINT32,er[Fo.STENCIL_FUNC_BACK]=ir.UINT32,er[Fo.STENCIL_READ_MADK_BACK]=ir.UINT32,er[Fo.STENCIL_WRITE_MASK_BACK]=ir.UINT32,er[Fo.STENCIL_FAIL_OP_BACK]=ir.UINT32,er[Fo.STENCIL_Z_FAIL_OP_BACK]=ir.UINT32,er[Fo.STENCIL_PASS_OP_BACK]=ir.UINT32,er[Fo.STENCIL_REF_BACK]=ir.UINT32,er[Fo.COUNT]=ir.NEVER,er),ko=new ur(lr.DEPTH_STENCIL_STATE,Go,Fo,9);!function(e){e[e.BLEND=0]="BLEND",e[e.BLEND_SRC=1]="BLEND_SRC",e[e.BLEND_DST=2]="BLEND_DST",e[e.BLEND_EQ=3]="BLEND_EQ",e[e.BLEND_SRC_ALPHA=4]="BLEND_SRC_ALPHA",e[e.BLEND_DST_ALPHA=5]="BLEND_DST_ALPHA",e[e.BLEND_ALPHA_EQ=6]="BLEND_ALPHA_EQ",e[e.BLEND_COLOR_MASK=7]="BLEND_COLOR_MASK",e[e.COUNT=8]="COUNT"}(Ho||(Ho={})),(tr={})[Ho.BLEND]=ir.UINT32,tr[Ho.BLEND_SRC]=ir.UINT32,tr[Ho.BLEND_DST]=ir.UINT32,tr[Ho.BLEND_EQ]=ir.UINT32,tr[Ho.BLEND_SRC_ALPHA]=ir.UINT32,tr[Ho.BLEND_DST_ALPHA]=ir.UINT32,tr[Ho.BLEND_ALPHA_EQ]=ir.UINT32,tr[Ho.BLEND_COLOR_MASK]=ir.UINT32,tr[Ho.COUNT]=ir.NEVER;var Vo,Wo=new ur(lr.BLEND_TARGET,Go,Ho,9);!function(e){e[e.IS_A2C=0]="IS_A2C",e[e.IS_INDEPEND=1]="IS_INDEPEND",e[e.BLEND_COLOR=2]="BLEND_COLOR",e[e.BLEND_TARGET=6]="BLEND_TARGET",e[e.COUNT=7]="COUNT"}(Vo||(Vo={}));var jo=((nr={})[Vo.IS_A2C]=ir.UINT32,nr[Vo.IS_INDEPEND]=ir.UINT32,nr[Vo.BLEND_COLOR]=ir.FLOAT32,nr[Vo.BLEND_TARGET]=ir.UINT32,nr[Vo.COUNT]=ir.NEVER,nr),qo=new ur(lr.BLEND_STATE,jo,Vo,9),Xo=function(){function e(){this._skyColor=new gn(51,128,204,1),this._groundAlbedo=new gn(51,51,51,255),this._albedoArray=Float32Array.from([.2,.2,.2,1]),this._colorArray=Float32Array.from([.2,.5,.8,1]),this._handle=0,this._handle=ho.alloc()}var t=e.prototype;return t.initialize=function(e){this._skyColor.set(e.skyColor),this._groundAlbedo.set(e.groundAlbedo),gn.toArray(this._colorArray,this._skyColor),yn.toArray(this._albedoArray,this._groundAlbedo),ho.setVec4(this._handle,ao.SKY_COLOR,this._skyColor),ho.setVec4(this._handle,ao.GROUND_ALBEDO,this._groundAlbedo),ho.set(this._handle,ao.ILLUM,e.skyIllum)},t.destroy=function(){this._handle&&(ho.free(this._handle),this._handle=0)},X(e,[{key:"colorArray",get:function(){return this._colorArray}},{key:"albedoArray",get:function(){return this._albedoArray}},{key:"enabled",get:function(){return ho.get(this._handle,ao.ENABLE)},set:function(e){ho.set(this._handle,ao.ENABLE,e?1:0)}},{key:"skyColor",get:function(){return this._skyColor},set:function(e){this._skyColor.set(e),gn.toArray(this._colorArray,this._skyColor),ho.setVec4(this._handle,ao.SKY_COLOR,this._skyColor)}},{key:"skyIllum",get:function(){return ho.get(this._handle,ao.ILLUM)},set:function(e){ho.set(this._handle,ao.ILLUM,e)}},{key:"groundAlbedo",get:function(){return this._groundAlbedo},set:function(e){this._groundAlbedo.set(e),yn.toArray(this._albedoArray,this._groundAlbedo),ho.setVec4(this._handle,ao.GROUND_ALBEDO,this._groundAlbedo)}},{key:"handle",get:function(){return this._handle}}]),e}();Xo.SUN_ILLUM=65e3,Xo.SKY_ILLUM=2e4,i.Ambient=Xo;var Yo=new yn,Ko=new yn,Zo=new yn,Qo=new yn,Jo=new yn,$o=new yn,ea=new Array(3),ta=new Array(3);function na(e,t){return yn.dot(t.n,e)-t.d}function ia(e,t,n){return yn.copy(e,t),yn.subtract(Jo,n.center,n.halfExtents),yn.add($o,n.center,n.halfExtents),e.x=e.x<Jo.x?Jo.x:e.x,e.y=e.y<Jo.y?Jo.y:e.y,e.z=e.z<Jo.z?Jo.z:e.z,e.x=e.x>$o.x?$o.x:e.x,e.y=e.y>$o.y?$o.y:e.y,e.z=e.z>$o.z?$o.z:e.z,e}function ra(e,t,n){yn.set(Yo,n.orientation.m00,n.orientation.m01,n.orientation.m02),yn.set(Ko,n.orientation.m03,n.orientation.m04,n.orientation.m05),yn.set(Zo,n.orientation.m06,n.orientation.m07,n.orientation.m08),ea[0]=Yo,ea[1]=Ko,ea[2]=Zo,ta[0]=n.halfExtents.x,ta[1]=n.halfExtents.y,ta[2]=n.halfExtents.z,yn.subtract(Qo,t,n.center),yn.set(e,n.center.x,n.center.y,n.center.z);for(var i=0;i<3;i++){var r=yn.dot(Qo,ea[i]);r>ta[i]&&(r=ta[i]),r<-ta[i]&&(r=-ta[i]),e.x+=r*ea[i].x,e.y+=r*ea[i].y,e.z+=r*ea[i].z}return e}var oa=Object.freeze({__proto__:null,point_plane:na,pt_point_plane:function(e,t,n){var i=na(t,n);return yn.subtract(e,t,yn.multiplyScalar(e,n.n,i))},pt_point_aabb:ia,pt_point_obb:ra,pt_point_line:function(e,t,n,i){yn.subtract(Yo,n,i);var r=Yo,o=yn.lengthSqr(r);if(0==o)yn.copy(e,n);else{yn.subtract(Yo,t,n);var a=yn.dot(Yo,r)/o;a<0?yn.copy(e,n):a>1?yn.copy(e,i):yn.scaleAndAdd(e,n,r,a)}}}),aa={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512},sa=function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=aa.SHAPE_LINE,this.s=new yn(e,t,n),this.e=new yn(i,r,o)}return e.create=function(t,n,i,r,o,a){return new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.s.x,t.s.y,t.s.z,t.e.x,t.e.y,t.e.z)},e.copy=function(e,t){return yn.copy(e.s,t.s),yn.copy(e.e,t.e),e},e.fromPoints=function(e,t,n){return yn.copy(e.s,t),yn.copy(e.e,n),e},e.set=function(e,t,n,i,r,o,a){return e.s.x=t,e.s.y=n,e.s.z=i,e.e.x=r,e.e.y=o,e.e.z=a,e},e.len=function(e){return yn.distance(e.s,e.e)},e.prototype.length=function(){return yn.distance(this.s,this.e)},X(e,[{key:"type",get:function(){return this._type}}]),e}(),ca=function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=aa.SHAPE_RAY,this.o=new yn(e,t,n),this.d=new yn(i,r,o)}return e.create=function(t,n,i,r,o,a){return void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=1),new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z)},e.copy=function(e,t){return yn.copy(e.o,t.o),yn.copy(e.d,t.d),e},e.fromPoints=function(e,t,n){return yn.copy(e.o,t),yn.normalize(e.d,yn.subtract(e.d,n,t)),e},e.set=function(e,t,n,i,r,o,a){return e.o.x=t,e.o.y=n,e.o.z=i,e.d.x=r,e.d.y=o,e.d.z=a,e},e.prototype.computeHit=function(e,t){yn.normalize(e,this.d),yn.scaleAndAdd(e,this.o,e,t)},X(e,[{key:"type",get:function(){return this._type}}]),e}(),la=new yn,ua=new yn,ha=new yn,_a=new yn;function fa(e){return Math.max(Math.max(e.x,e.y),e.z)}var da,pa,ma,ga,va,ya,Sa,Ea,Ta,xa,Aa,Ca,ba,wa,Ra,Ia,Pa,Oa,Da,Na,Ma,La,Ba,Fa,za,Ua,Ha,Ga,ka,Va,Wa,ja,qa,Xa,Ya,Ka,Za,Qa,Ja=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),this._center=new yn(0,0,0),this._poolHandle=0,this._type=void 0,this._type=aa.SHAPE_SPHERE,this._center=new yn(e,t,n),this._poolHandle=Po.alloc(),Po.setVec3(this._poolHandle,Co.CENTER,this._center),Po.set(this._poolHandle,Co.RADIUS,i)}e.create=function(t,n,i,r){return new e(t,n,i,r)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.radius)},e.copy=function(e,t){return yn.copy(e.center,t.center),e.radius=t.radius,e},e.fromPoints=function(e,t,n){return yn.multiplyScalar(e.center,yn.add(la,t,n),.5),e.radius=.5*yn.subtract(la,n,t).length(),e},e.set=function(e,t,n,i,r){return e.center.x=t,e.center.y=n,e.center.z=i,e.radius=r,e},e.mergePoint=function(e,t,n){if(t.radius<0)return e.center.set(n),e.radius=0,e;yn.subtract(ua,n,t.center);var i=ua.length();if(i>t.radius){var r=.5*(i-t.radius);e.radius+=r,yn.multiplyScalar(ua,ua,r/i),yn.add(e.center,e.center,ua)}return e},e.mergeAABB=function(t,n,i){return i.getBoundary(ha,_a),e.mergePoint(t,n,ha),e.mergePoint(t,n,_a),t};var t=e.prototype;return t.destroy=function(){this._poolHandle&&(Po.free(this._poolHandle),this._poolHandle=0)},t.clone=function(){return e.clone(this)},t.copy=function(t){return e.copy(this,t)},t.getBoundary=function(e,t){yn.set(e,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),yn.set(t,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},t.transform=function(e,t,n,i,r){yn.transformMat4(r.center,this.center,e),r.radius=this.radius*fa(i)},t.translateAndRotate=function(e,t,n){yn.transformMat4(n.center,this.center,e)},t.setScale=function(e,t){t.radius=this.radius*fa(e)},X(e,[{key:"center",get:function(){return this._center},set:function(e){this._center=e,Po.setVec3(this._poolHandle,Co.CENTER,this._center)}},{key:"radius",get:function(){return Po.get(this._poolHandle,Co.RADIUS)},set:function(e){Po.set(this._poolHandle,Co.RADIUS,e)}},{key:"handle",get:function(){return this._poolHandle}},{key:"type",get:function(){return this._type}}]),e}(),$a=function(){function e(e,t,n,i,r,o,a,s,c){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=1),void 0===c&&(c=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=aa.SHAPE_TRIANGLE,this.a=new yn(e,t,n),this.b=new yn(i,r,o),this.c=new yn(a,s,c)}return e.create=function(t,n,i,r,o,a,s,c,l){return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),new e(t,n,i,r,o,a,s,c,l)},e.clone=function(t){return new e(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z)},e.copy=function(e,t){return yn.copy(e.a,t.a),yn.copy(e.b,t.b),yn.copy(e.c,t.c),e},e.fromPoints=function(e,t,n,i){return yn.copy(e.a,t),yn.copy(e.b,n),yn.copy(e.c,i),e},e.set=function(e,t,n,i,r,o,a,s,c,l){return e.a.x=t,e.a.y=n,e.a.z=i,e.b.x=r,e.b.y=o,e.b.z=a,e.c.x=s,e.c.y=c,e.c.z=l,e},X(e,[{key:"type",get:function(){return this._type}}]),e}(),es=function(e,t,n){for(var i=0;i<t.length;++i)e.length<=i&&e.push(new n),e[i].copy(t[i]);e.length=t.length};!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BUFFER=1]="BUFFER",e[e.TEXTURE=2]="TEXTURE",e[e.RENDER_PASS=3]="RENDER_PASS",e[e.FRAMEBUFFER=4]="FRAMEBUFFER",e[e.SAMPLER=5]="SAMPLER",e[e.SHADER=6]="SHADER",e[e.DESCRIPTOR_SET_LAYOUT=7]="DESCRIPTOR_SET_LAYOUT",e[e.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",e[e.PIPELINE_STATE=9]="PIPELINE_STATE",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",e[e.COMMAND_BUFFER=12]="COMMAND_BUFFER",e[e.QUEUE=13]="QUEUE",e[e.GLOBAL_BARRIER=14]="GLOBAL_BARRIER",e[e.TEXTURE_BARRIER=15]="TEXTURE_BARRIER",e[e.BUFFER_BARRIER=16]="BUFFER_BARRIER"}(da||(da={})),function(e){e[e.UNREADY=0]="UNREADY",e[e.FAILED=1]="FAILED",e[e.SUCCESS=2]="SUCCESS"}(pa||(pa={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.GLES2=1]="GLES2",e[e.GLES3=2]="GLES3",e[e.METAL=3]="METAL",e[e.VULKAN=4]="VULKAN",e[e.WEBGL=5]="WEBGL",e[e.WEBGL2=6]="WEBGL2",e[e.WEBGPU=7]="WEBGPU"}(ma||(ma={})),function(e){e[e.IDENTITY=0]="IDENTITY",e[e.ROTATE_90=1]="ROTATE_90",e[e.ROTATE_180=2]="ROTATE_180",e[e.ROTATE_270=3]="ROTATE_270"}(ga||(ga={})),function(e){e[e.COLOR_FLOAT=0]="COLOR_FLOAT",e[e.COLOR_HALF_FLOAT=1]="COLOR_HALF_FLOAT",e[e.TEXTURE_FLOAT=2]="TEXTURE_FLOAT",e[e.TEXTURE_HALF_FLOAT=3]="TEXTURE_HALF_FLOAT",e[e.TEXTURE_FLOAT_LINEAR=4]="TEXTURE_FLOAT_LINEAR",e[e.TEXTURE_HALF_FLOAT_LINEAR=5]="TEXTURE_HALF_FLOAT_LINEAR",e[e.FORMAT_R11G11B10F=6]="FORMAT_R11G11B10F",e[e.FORMAT_D16=7]="FORMAT_D16",e[e.FORMAT_D16S8=8]="FORMAT_D16S8",e[e.FORMAT_D24=9]="FORMAT_D24",e[e.FORMAT_D24S8=10]="FORMAT_D24S8",e[e.FORMAT_D32F=11]="FORMAT_D32F",e[e.FORMAT_D32FS8=12]="FORMAT_D32FS8",e[e.FORMAT_ETC1=13]="FORMAT_ETC1",e[e.FORMAT_ETC2=14]="FORMAT_ETC2",e[e.FORMAT_DXT=15]="FORMAT_DXT",e[e.FORMAT_PVRTC=16]="FORMAT_PVRTC",e[e.FORMAT_ASTC=17]="FORMAT_ASTC",e[e.FORMAT_RGB8=18]="FORMAT_RGB8",e[e.MSAA=19]="MSAA",e[e.ELEMENT_INDEX_UINT=20]="ELEMENT_INDEX_UINT",e[e.INSTANCED_ARRAYS=21]="INSTANCED_ARRAYS",e[e.MULTIPLE_RENDER_TARGETS=22]="MULTIPLE_RENDER_TARGETS",e[e.BLEND_MINMAX=23]="BLEND_MINMAX",e[e.DEPTH_BOUNDS=24]="DEPTH_BOUNDS",e[e.LINE_WIDTH=25]="LINE_WIDTH",e[e.STENCIL_WRITE_MASK=26]="STENCIL_WRITE_MASK",e[e.STENCIL_COMPARE_MASK=27]="STENCIL_COMPARE_MASK",e[e.MULTITHREADED_SUBMISSION=28]="MULTITHREADED_SUBMISSION",e[e.COMPUTE_SHADER=29]="COMPUTE_SHADER",e[e.COUNT=30]="COUNT"}(va||(va={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A8=1]="A8",e[e.L8=2]="L8",e[e.LA8=3]="LA8",e[e.R8=4]="R8",e[e.R8SN=5]="R8SN",e[e.R8UI=6]="R8UI",e[e.R8I=7]="R8I",e[e.R16F=8]="R16F",e[e.R16UI=9]="R16UI",e[e.R16I=10]="R16I",e[e.R32F=11]="R32F",e[e.R32UI=12]="R32UI",e[e.R32I=13]="R32I",e[e.RG8=14]="RG8",e[e.RG8SN=15]="RG8SN",e[e.RG8UI=16]="RG8UI",e[e.RG8I=17]="RG8I",e[e.RG16F=18]="RG16F",e[e.RG16UI=19]="RG16UI",e[e.RG16I=20]="RG16I",e[e.RG32F=21]="RG32F",e[e.RG32UI=22]="RG32UI",e[e.RG32I=23]="RG32I",e[e.RGB8=24]="RGB8",e[e.SRGB8=25]="SRGB8",e[e.RGB8SN=26]="RGB8SN",e[e.RGB8UI=27]="RGB8UI",e[e.RGB8I=28]="RGB8I",e[e.RGB16F=29]="RGB16F",e[e.RGB16UI=30]="RGB16UI",e[e.RGB16I=31]="RGB16I",e[e.RGB32F=32]="RGB32F",e[e.RGB32UI=33]="RGB32UI",e[e.RGB32I=34]="RGB32I",e[e.RGBA8=35]="RGBA8",e[e.BGRA8=36]="BGRA8",e[e.SRGB8_A8=37]="SRGB8_A8",e[e.RGBA8SN=38]="RGBA8SN",e[e.RGBA8UI=39]="RGBA8UI",e[e.RGBA8I=40]="RGBA8I",e[e.RGBA16F=41]="RGBA16F",e[e.RGBA16UI=42]="RGBA16UI",e[e.RGBA16I=43]="RGBA16I",e[e.RGBA32F=44]="RGBA32F",e[e.RGBA32UI=45]="RGBA32UI",e[e.RGBA32I=46]="RGBA32I",e[e.R5G6B5=47]="R5G6B5",e[e.R11G11B10F=48]="R11G11B10F",e[e.RGB5A1=49]="RGB5A1",e[e.RGBA4=50]="RGBA4",e[e.RGB10A2=51]="RGB10A2",e[e.RGB10A2UI=52]="RGB10A2UI",e[e.RGB9E5=53]="RGB9E5",e[e.D16=54]="D16",e[e.D16S8=55]="D16S8",e[e.D24=56]="D24",e[e.D24S8=57]="D24S8",e[e.D32F=58]="D32F",e[e.D32F_S8=59]="D32F_S8",e[e.BC1=60]="BC1",e[e.BC1_ALPHA=61]="BC1_ALPHA",e[e.BC1_SRGB=62]="BC1_SRGB",e[e.BC1_SRGB_ALPHA=63]="BC1_SRGB_ALPHA",e[e.BC2=64]="BC2",e[e.BC2_SRGB=65]="BC2_SRGB",e[e.BC3=66]="BC3",e[e.BC3_SRGB=67]="BC3_SRGB",e[e.BC4=68]="BC4",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5=70]="BC5",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.BC6H_UF16=72]="BC6H_UF16",e[e.BC6H_SF16=73]="BC6H_SF16",e[e.BC7=74]="BC7",e[e.BC7_SRGB=75]="BC7_SRGB",e[e.ETC_RGB8=76]="ETC_RGB8",e[e.ETC2_RGB8=77]="ETC2_RGB8",e[e.ETC2_SRGB8=78]="ETC2_SRGB8",e[e.ETC2_RGB8_A1=79]="ETC2_RGB8_A1",e[e.ETC2_SRGB8_A1=80]="ETC2_SRGB8_A1",e[e.ETC2_RGBA8=81]="ETC2_RGBA8",e[e.ETC2_SRGB8_A8=82]="ETC2_SRGB8_A8",e[e.EAC_R11=83]="EAC_R11",e[e.EAC_R11SN=84]="EAC_R11SN",e[e.EAC_RG11=85]="EAC_RG11",e[e.EAC_RG11SN=86]="EAC_RG11SN",e[e.PVRTC_RGB2=87]="PVRTC_RGB2",e[e.PVRTC_RGBA2=88]="PVRTC_RGBA2",e[e.PVRTC_RGB4=89]="PVRTC_RGB4",e[e.PVRTC_RGBA4=90]="PVRTC_RGBA4",e[e.PVRTC2_2BPP=91]="PVRTC2_2BPP",e[e.PVRTC2_4BPP=92]="PVRTC2_4BPP",e[e.ASTC_RGBA_4x4=93]="ASTC_RGBA_4x4",e[e.ASTC_RGBA_5x4=94]="ASTC_RGBA_5x4",e[e.ASTC_RGBA_5x5=95]="ASTC_RGBA_5x5",e[e.ASTC_RGBA_6x5=96]="ASTC_RGBA_6x5",e[e.ASTC_RGBA_6x6=97]="ASTC_RGBA_6x6",e[e.ASTC_RGBA_8x5=98]="ASTC_RGBA_8x5",e[e.ASTC_RGBA_8x6=99]="ASTC_RGBA_8x6",e[e.ASTC_RGBA_8x8=100]="ASTC_RGBA_8x8",e[e.ASTC_RGBA_10x5=101]="ASTC_RGBA_10x5",e[e.ASTC_RGBA_10x6=102]="ASTC_RGBA_10x6",e[e.ASTC_RGBA_10x8=103]="ASTC_RGBA_10x8",e[e.ASTC_RGBA_10x10=104]="ASTC_RGBA_10x10",e[e.ASTC_RGBA_12x10=105]="ASTC_RGBA_12x10",e[e.ASTC_RGBA_12x12=106]="ASTC_RGBA_12x12",e[e.ASTC_SRGBA_4x4=107]="ASTC_SRGBA_4x4",e[e.ASTC_SRGBA_5x4=108]="ASTC_SRGBA_5x4",e[e.ASTC_SRGBA_5x5=109]="ASTC_SRGBA_5x5",e[e.ASTC_SRGBA_6x5=110]="ASTC_SRGBA_6x5",e[e.ASTC_SRGBA_6x6=111]="ASTC_SRGBA_6x6",e[e.ASTC_SRGBA_8x5=112]="ASTC_SRGBA_8x5",e[e.ASTC_SRGBA_8x6=113]="ASTC_SRGBA_8x6",e[e.ASTC_SRGBA_8x8=114]="ASTC_SRGBA_8x8",e[e.ASTC_SRGBA_10x5=115]="ASTC_SRGBA_10x5",e[e.ASTC_SRGBA_10x6=116]="ASTC_SRGBA_10x6",e[e.ASTC_SRGBA_10x8=117]="ASTC_SRGBA_10x8",e[e.ASTC_SRGBA_10x10=118]="ASTC_SRGBA_10x10",e[e.ASTC_SRGBA_12x10=119]="ASTC_SRGBA_12x10",e[e.ASTC_SRGBA_12x12=120]="ASTC_SRGBA_12x12",e[e.COUNT=121]="COUNT"}(ya||(ya={})),function(e){e[e.NONE=0]="NONE",e[e.UNORM=1]="UNORM",e[e.SNORM=2]="SNORM",e[e.UINT=3]="UINT",e[e.INT=4]="INT",e[e.UFLOAT=5]="UFLOAT",e[e.FLOAT=6]="FLOAT"}(Sa||(Sa={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BOOL=1]="BOOL",e[e.BOOL2=2]="BOOL2",e[e.BOOL3=3]="BOOL3",e[e.BOOL4=4]="BOOL4",e[e.INT=5]="INT",e[e.INT2=6]="INT2",e[e.INT3=7]="INT3",e[e.INT4=8]="INT4",e[e.UINT=9]="UINT",e[e.UINT2=10]="UINT2",e[e.UINT3=11]="UINT3",e[e.UINT4=12]="UINT4",e[e.FLOAT=13]="FLOAT",e[e.FLOAT2=14]="FLOAT2",e[e.FLOAT3=15]="FLOAT3",e[e.FLOAT4=16]="FLOAT4",e[e.MAT2=17]="MAT2",e[e.MAT2X3=18]="MAT2X3",e[e.MAT2X4=19]="MAT2X4",e[e.MAT3X2=20]="MAT3X2",e[e.MAT3=21]="MAT3",e[e.MAT3X4=22]="MAT3X4",e[e.MAT4X2=23]="MAT4X2",e[e.MAT4X3=24]="MAT4X3",e[e.MAT4=25]="MAT4",e[e.SAMPLER1D=26]="SAMPLER1D",e[e.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",e[e.SAMPLER2D=28]="SAMPLER2D",e[e.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",e[e.SAMPLER3D=30]="SAMPLER3D",e[e.SAMPLER_CUBE=31]="SAMPLER_CUBE",e[e.SAMPLER=32]="SAMPLER",e[e.TEXTURE1D=33]="TEXTURE1D",e[e.TEXTURE1D_ARRAY=34]="TEXTURE1D_ARRAY",e[e.TEXTURE2D=35]="TEXTURE2D",e[e.TEXTURE2D_ARRAY=36]="TEXTURE2D_ARRAY",e[e.TEXTURE3D=37]="TEXTURE3D",e[e.TEXTURE_CUBE=38]="TEXTURE_CUBE",e[e.IMAGE1D=39]="IMAGE1D",e[e.IMAGE1D_ARRAY=40]="IMAGE1D_ARRAY",e[e.IMAGE2D=41]="IMAGE2D",e[e.IMAGE2D_ARRAY=42]="IMAGE2D_ARRAY",e[e.IMAGE3D=43]="IMAGE3D",e[e.IMAGE_CUBE=44]="IMAGE_CUBE",e[e.SUBPASS_INPUT=45]="SUBPASS_INPUT",e[e.COUNT=46]="COUNT"}(Ea||(Ea={})),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.INDEX=4]="INDEX",e[e.VERTEX=8]="VERTEX",e[e.UNIFORM=16]="UNIFORM",e[e.STORAGE=32]="STORAGE",e[e.INDIRECT=64]="INDIRECT"}(Ta||(Ta={})),function(e){e[e.NONE=0]="NONE"}(xa||(xa={})),function(e){e[e.NONE=0]="NONE",e[e.READ_ONLY=1]="READ_ONLY",e[e.WRITE_ONLY=2]="WRITE_ONLY",e[e.READ_WRITE=3]="READ_WRITE"}(Aa||(Aa={})),function(e){e[e.NONE=0]="NONE",e[e.DEVICE=1]="DEVICE",e[e.HOST=2]="HOST"}(Ca||(Ca={})),function(e){e[e.TEX1D=0]="TEX1D",e[e.TEX2D=1]="TEX2D",e[e.TEX3D=2]="TEX3D",e[e.CUBE=3]="CUBE",e[e.TEX1D_ARRAY=4]="TEX1D_ARRAY",e[e.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(ba||(ba={})),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",e[e.TRANSIENT_ATTACHMENT=64]="TRANSIENT_ATTACHMENT",e[e.INPUT_ATTACHMENT=128]="INPUT_ATTACHMENT"}(wa||(wa={})),function(e){e[e.NONE=0]="NONE",e[e.GEN_MIPMAP=1]="GEN_MIPMAP",e[e.IMMUTABLE=2]="IMMUTABLE"}(Ra||(Ra={})),function(e){e[e.X1=0]="X1",e[e.X2=1]="X2",e[e.X4=2]="X4",e[e.X8=3]="X8",e[e.X16=4]="X16",e[e.X32=5]="X32",e[e.X64=6]="X64"}(Ia||(Ia={})),function(e){e[e.NONE=0]="NONE",e[e.POINT=1]="POINT",e[e.LINEAR=2]="LINEAR",e[e.ANISOTROPIC=3]="ANISOTROPIC"}(Pa||(Pa={})),function(e){e[e.WRAP=0]="WRAP",e[e.MIRROR=1]="MIRROR",e[e.CLAMP=2]="CLAMP",e[e.BORDER=3]="BORDER"}(Oa||(Oa={})),function(e){e[e.NEVER=0]="NEVER",e[e.LESS=1]="LESS",e[e.EQUAL=2]="EQUAL",e[e.LESS_EQUAL=3]="LESS_EQUAL",e[e.GREATER=4]="GREATER",e[e.NOT_EQUAL=5]="NOT_EQUAL",e[e.GREATER_EQUAL=6]="GREATER_EQUAL",e[e.ALWAYS=7]="ALWAYS"}(Da||(Da={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=1]="KEEP",e[e.REPLACE=2]="REPLACE",e[e.INCR=3]="INCR",e[e.DECR=4]="DECR",e[e.INVERT=5]="INVERT",e[e.INCR_WRAP=6]="INCR_WRAP",e[e.DECR_WRAP=7]="DECR_WRAP"}(Na||(Na={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=2]="SRC_ALPHA",e[e.DST_ALPHA=3]="DST_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",e[e.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",e[e.SRC_COLOR=6]="SRC_COLOR",e[e.DST_COLOR=7]="DST_COLOR",e[e.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",e[e.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=11]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(Ma||(Ma={})),function(e){e[e.ADD=0]="ADD",e[e.SUB=1]="SUB",e[e.REV_SUB=2]="REV_SUB",e[e.MIN=3]="MIN",e[e.MAX=4]="MAX"}(La||(La={})),function(e){e[e.NONE=0]="NONE",e[e.R=1]="R",e[e.G=2]="G",e[e.B=4]="B",e[e.A=8]="A",e[e.ALL=15]="ALL"}(Ba||(Ba={})),function(e){e[e.NONE=0]="NONE",e[e.VERTEX=1]="VERTEX",e[e.CONTROL=2]="CONTROL",e[e.EVALUATION=4]="EVALUATION",e[e.GEOMETRY=8]="GEOMETRY",e[e.FRAGMENT=16]="FRAGMENT",e[e.COMPUTE=32]="COMPUTE",e[e.ALL=63]="ALL"}(Fa||(Fa={})),function(e){e[e.LOAD=0]="LOAD",e[e.CLEAR=1]="CLEAR",e[e.DISCARD=2]="DISCARD"}(za||(za={})),function(e){e[e.STORE=0]="STORE",e[e.DISCARD=1]="DISCARD"}(Ua||(Ua={})),function(e){e[e.NONE=0]="NONE",e[e.INDIRECT_BUFFER=1]="INDIRECT_BUFFER",e[e.INDEX_BUFFER=2]="INDEX_BUFFER",e[e.VERTEX_BUFFER=3]="VERTEX_BUFFER",e[e.VERTEX_SHADER_READ_UNIFORM_BUFFER=4]="VERTEX_SHADER_READ_UNIFORM_BUFFER",e[e.VERTEX_SHADER_READ_TEXTURE=5]="VERTEX_SHADER_READ_TEXTURE",e[e.VERTEX_SHADER_READ_OTHER=6]="VERTEX_SHADER_READ_OTHER",e[e.FRAGMENT_SHADER_READ_UNIFORM_BUFFER=7]="FRAGMENT_SHADER_READ_UNIFORM_BUFFER",e[e.FRAGMENT_SHADER_READ_TEXTURE=8]="FRAGMENT_SHADER_READ_TEXTURE",e[e.FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT=9]="FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT",e[e.FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT=10]="FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT",e[e.FRAGMENT_SHADER_READ_OTHER=11]="FRAGMENT_SHADER_READ_OTHER",e[e.COLOR_ATTACHMENT_READ=12]="COLOR_ATTACHMENT_READ",e[e.DEPTH_STENCIL_ATTACHMENT_READ=13]="DEPTH_STENCIL_ATTACHMENT_READ",e[e.COMPUTE_SHADER_READ_UNIFORM_BUFFER=14]="COMPUTE_SHADER_READ_UNIFORM_BUFFER",e[e.COMPUTE_SHADER_READ_TEXTURE=15]="COMPUTE_SHADER_READ_TEXTURE",e[e.COMPUTE_SHADER_READ_OTHER=16]="COMPUTE_SHADER_READ_OTHER",e[e.TRANSFER_READ=17]="TRANSFER_READ",e[e.HOST_READ=18]="HOST_READ",e[e.PRESENT=19]="PRESENT",e[e.VERTEX_SHADER_WRITE=20]="VERTEX_SHADER_WRITE",e[e.FRAGMENT_SHADER_WRITE=21]="FRAGMENT_SHADER_WRITE",e[e.COLOR_ATTACHMENT_WRITE=22]="COLOR_ATTACHMENT_WRITE",e[e.DEPTH_STENCIL_ATTACHMENT_WRITE=23]="DEPTH_STENCIL_ATTACHMENT_WRITE",e[e.COMPUTE_SHADER_WRITE=24]="COMPUTE_SHADER_WRITE",e[e.TRANSFER_WRITE=25]="TRANSFER_WRITE",e[e.HOST_PREINITIALIZED=26]="HOST_PREINITIALIZED",e[e.HOST_WRITE=27]="HOST_WRITE"}(Ha||(Ha={})),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.RAY_TRACING=2]="RAY_TRACING"}(Ga||(Ga={})),function(e){e[e.POINT_LIST=0]="POINT_LIST",e[e.LINE_LIST=1]="LINE_LIST",e[e.LINE_STRIP=2]="LINE_STRIP",e[e.LINE_LOOP=3]="LINE_LOOP",e[e.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",e[e.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",e[e.ISO_LINE_LIST=6]="ISO_LINE_LIST",e[e.TRIANGLE_LIST=7]="TRIANGLE_LIST",e[e.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=9]="TRIANGLE_FAN",e[e.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",e[e.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",e[e.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",e[e.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(ka||(ka={})),function(e){e[e.FILL=0]="FILL",e[e.POINT=1]="POINT",e[e.LINE=2]="LINE"}(Va||(Va={})),function(e){e[e.GOURAND=0]="GOURAND",e[e.FLAT=1]="FLAT"}(Wa||(Wa={})),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK"}(ja||(ja={})),function(e){e[e.NONE=0]="NONE",e[e.VIEWPORT=1]="VIEWPORT",e[e.SCISSOR=2]="SCISSOR",e[e.LINE_WIDTH=4]="LINE_WIDTH",e[e.DEPTH_BIAS=8]="DEPTH_BIAS",e[e.BLEND_CONSTANTS=16]="BLEND_CONSTANTS",e[e.DEPTH_BOUNDS=32]="DEPTH_BOUNDS",e[e.STENCIL_WRITE_MASK=64]="STENCIL_WRITE_MASK",e[e.STENCIL_COMPARE_MASK=128]="STENCIL_COMPARE_MASK"}(qa||(qa={})),function(e){e[e.FRONT=0]="FRONT",e[e.BACK=1]="BACK",e[e.ALL=2]="ALL"}(Xa||(Xa={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",e[e.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",e[e.STORAGE_BUFFER=4]="STORAGE_BUFFER",e[e.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",e[e.SAMPLER_TEXTURE=16]="SAMPLER_TEXTURE",e[e.SAMPLER=32]="SAMPLER",e[e.TEXTURE=64]="TEXTURE",e[e.STORAGE_IMAGE=128]="STORAGE_IMAGE",e[e.INPUT_ATTACHMENT=256]="INPUT_ATTACHMENT"}(Ya||(Ya={})),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.TRANSFER=2]="TRANSFER"}(Ka||(Ka={})),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.SECONDARY=1]="SECONDARY"}(Za||(Za={})),function(e){e[e.NONE=0]="NONE",e[e.COLOR=1]="COLOR",e[e.DEPTH=2]="DEPTH",e[e.STENCIL=4]="STENCIL",e[e.DEPTH_STENCIL=6]="DEPTH_STENCIL",e[e.ALL=7]="ALL"}(Qa||(Qa={}));var ts,ns=function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n}return e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},e}(),is=function(){function e(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,p,m,g,v,y,S,E,T){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===p&&(p=1),void 0===m&&(m=0),void 0===g&&(g=0),void 0===v&&(v=new ns),void 0===y&&(y=new ns),void 0===S&&(S=-1),void 0===E&&(E=1),void 0===T&&(T=1),this.maxVertexAttributes=e,this.maxVertexUniformVectors=t,this.maxFragmentUniformVectors=n,this.maxTextureUnits=i,this.maxImageUnits=r,this.maxVertexTextureUnits=o,this.maxColorRenderTargets=a,this.maxShaderStorageBufferBindings=s,this.maxShaderStorageBlockSize=c,this.maxUniformBufferBindings=l,this.maxUniformBlockSize=u,this.maxTextureSize=h,this.maxCubeMapTextureSize=_,this.depthBits=f,this.stencilBits=d,this.uboOffsetAlignment=p,this.maxComputeSharedMemorySize=m,this.maxComputeWorkGroupInvocations=g,this.maxComputeWorkGroupSize=v,this.maxComputeWorkGroupCount=y,this.clipSpaceMinZ=S,this.screenSpaceSignY=E,this.clipSpaceSignY=T}return e.prototype.copy=function(e){return this.maxVertexAttributes=e.maxVertexAttributes,this.maxVertexUniformVectors=e.maxVertexUniformVectors,this.maxFragmentUniformVectors=e.maxFragmentUniformVectors,this.maxTextureUnits=e.maxTextureUnits,this.maxImageUnits=e.maxImageUnits,this.maxVertexTextureUnits=e.maxVertexTextureUnits,this.maxColorRenderTargets=e.maxColorRenderTargets,this.maxShaderStorageBufferBindings=e.maxShaderStorageBufferBindings,this.maxShaderStorageBlockSize=e.maxShaderStorageBlockSize,this.maxUniformBufferBindings=e.maxUniformBufferBindings,this.maxUniformBlockSize=e.maxUniformBlockSize,this.maxTextureSize=e.maxTextureSize,this.maxCubeMapTextureSize=e.maxCubeMapTextureSize,this.depthBits=e.depthBits,this.stencilBits=e.stencilBits,this.uboOffsetAlignment=e.uboOffsetAlignment,this.maxComputeSharedMemorySize=e.maxComputeSharedMemorySize,this.maxComputeWorkGroupInvocations=e.maxComputeWorkGroupInvocations,this.maxComputeWorkGroupSize.copy(e.maxComputeWorkGroupSize),this.maxComputeWorkGroupCount.copy(e.maxComputeWorkGroupCount),this.clipSpaceMinZ=e.clipSpaceMinZ,this.screenSpaceSignY=e.screenSpaceSignY,this.clipSpaceSignY=e.clipSpaceSignY,this},e}(),rs=function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n}return e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},e}(),os=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=e,this.y=t,this.width=n,this.height=i}return e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},e}(),as=function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),this.width=e,this.height=t,this.depth=n}return e.prototype.copy=function(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this},e}(),ss=function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),this.mipLevel=e,this.baseArrayLayer=t,this.layerCount=n}return e.prototype.copy=function(e){return this.mipLevel=e.mipLevel,this.baseArrayLayer=e.baseArrayLayer,this.layerCount=e.layerCount,this},e}(),cs=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=1),this.baseMipLevel=e,this.levelCount=t,this.baseArrayLayer=n,this.layerCount=i}return e.prototype.copy=function(e){return this.baseMipLevel=e.baseMipLevel,this.levelCount=e.levelCount,this.baseArrayLayer=e.baseArrayLayer,this.layerCount=e.layerCount,this},e}(),ls=function(){function e(e,t,n,i,r){void 0===e&&(e=new ss),void 0===t&&(t=new rs),void 0===n&&(n=new ss),void 0===i&&(i=new rs),void 0===r&&(r=new as),this.srcSubres=e,this.srcOffset=t,this.dstSubres=n,this.dstOffset=i,this.extent=r}return e.prototype.copy=function(e){return this.srcSubres.copy(e.srcSubres),this.srcOffset.copy(e.srcOffset),this.dstSubres.copy(e.dstSubres),this.dstOffset.copy(e.dstOffset),this.extent.copy(e.extent),this},e}(),us=function(){function e(e,t,n,i,r,o){void 0===e&&(e=new ss),void 0===t&&(t=new rs),void 0===n&&(n=new as),void 0===i&&(i=new ss),void 0===r&&(r=new rs),void 0===o&&(o=new as),this.srcSubres=e,this.srcOffset=t,this.srcExtent=n,this.dstSubres=i,this.dstOffset=r,this.dstExtent=o}return e.prototype.copy=function(e){return this.srcSubres.copy(e.srcSubres),this.srcOffset.copy(e.srcOffset),this.srcExtent.copy(e.srcExtent),this.dstSubres.copy(e.dstSubres),this.dstOffset.copy(e.dstOffset),this.dstExtent.copy(e.dstExtent),this},e}(),hs=function(){function e(e,t,n,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=new rs),void 0===i&&(i=new as),void 0===r&&(r=new ss),this.buffStride=e,this.buffTexHeight=t,this.texOffset=n,this.texExtent=i,this.texSubres=r}return e.prototype.copy=function(e){return this.buffStride=e.buffStride,this.buffTexHeight=e.buffTexHeight,this.texOffset.copy(e.texOffset),this.texExtent.copy(e.texExtent),this.texSubres.copy(e.texSubres),this},e}(),_s=function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),this.left=e,this.top=t,this.width=n,this.height=i,this.minDepth=r,this.maxDepth=o}return e.prototype.copy=function(e){return this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,this.minDepth=e.minDepth,this.maxDepth=e.maxDepth,this},e}(),fs=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=e,this.y=t,this.z=n,this.w=i}return e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e}(),ds=function(){function e(e,t,n){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=0),this.bufferOffsets=e,this.samplerOffsets=t,this.flexibleSet=n}return e.prototype.copy=function(e){return this.bufferOffsets=e.bufferOffsets.slice(),this.samplerOffsets=e.samplerOffsets.slice(),this.flexibleSet=e.flexibleSet,this},e}(),ps=function(){function e(e,t,n,i,r){void 0===e&&(e=Ta.NONE),void 0===t&&(t=Ca.NONE),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=xa.NONE),this.usage=e,this.memUsage=t,this.size=n,this.stride=i,this.flags=r}return e.prototype.copy=function(e){return this.usage=e.usage,this.memUsage=e.memUsage,this.size=e.size,this.stride=e.stride,this.flags=e.flags,this},e}(),ms=function(){function e(e,t,n){void 0===e&&(e=null),void 0===t&&(t=0),void 0===n&&(n=0),this.buffer=e,this.offset=t,this.range=n}return e.prototype.copy=function(e){return this.buffer=e.buffer,this.offset=e.offset,this.range=e.range,this},e}(),gs=function(){function e(e,t,n,i,r,o,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),this.vertexCount=e,this.firstVertex=t,this.indexCount=n,this.firstIndex=i,this.vertexOffset=r,this.instanceCount=o,this.firstInstance=a}return e.prototype.copy=function(e){return this.vertexCount=e.vertexCount,this.firstVertex=e.firstVertex,this.indexCount=e.indexCount,this.firstIndex=e.firstIndex,this.vertexOffset=e.vertexOffset,this.instanceCount=e.instanceCount,this.firstInstance=e.firstInstance,this},e}(),vs=function(){function e(e,t,n,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=null),void 0===r&&(r=0),this.groupCountX=e,this.groupCountY=t,this.groupCountZ=n,this.indirectBuffer=i,this.indirectOffset=r}return e.prototype.copy=function(e){return this.groupCountX=e.groupCountX,this.groupCountY=e.groupCountY,this.groupCountZ=e.groupCountZ,this.indirectBuffer=e.indirectBuffer,this.indirectOffset=e.indirectOffset,this},e}(),ys=function(){function e(e){void 0===e&&(e=[]),this.drawInfos=e}return e.prototype.copy=function(e){return es(this.drawInfos,e.drawInfos,gs),this},e}(),Ss=function(){function e(e,t,n,i,r,o,a,s,c,l){void 0===e&&(e=ba.TEX2D),void 0===t&&(t=wa.NONE),void 0===n&&(n=ya.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=Ra.NONE),void 0===a&&(a=1),void 0===s&&(s=1),void 0===c&&(c=Ia.X1),void 0===l&&(l=1),this.type=e,this.usage=t,this.format=n,this.width=i,this.height=r,this.flags=o,this.layerCount=a,this.levelCount=s,this.samples=c,this.depth=l}return e.prototype.copy=function(e){return this.type=e.type,this.usage=e.usage,this.format=e.format,this.width=e.width,this.height=e.height,this.flags=e.flags,this.layerCount=e.layerCount,this.levelCount=e.levelCount,this.samples=e.samples,this.depth=e.depth,this},e}(),Es=function(){function e(e,t,n,i,r,o,a){void 0===e&&(e=null),void 0===t&&(t=ba.TEX2D),void 0===n&&(n=ya.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=1),void 0===o&&(o=0),void 0===a&&(a=1),this.texture=e,this.type=t,this.format=n,this.baseLevel=i,this.levelCount=r,this.baseLayer=o,this.layerCount=a}return e.prototype.copy=function(e){return this.texture=e.texture,this.type=e.type,this.format=e.format,this.baseLevel=e.baseLevel,this.levelCount=e.levelCount,this.baseLayer=e.baseLayer,this.layerCount=e.layerCount,this},e}(),Ts=function(){function e(e,t,n,i,r,o,a,s,c,l){void 0===e&&(e=Pa.LINEAR),void 0===t&&(t=Pa.LINEAR),void 0===n&&(n=Pa.NONE),void 0===i&&(i=Oa.WRAP),void 0===r&&(r=Oa.WRAP),void 0===o&&(o=Oa.WRAP),void 0===a&&(a=0),void 0===s&&(s=Da.ALWAYS),void 0===c&&(c=new fs),void 0===l&&(l=0),this.minFilter=e,this.magFilter=t,this.mipFilter=n,this.addressU=i,this.addressV=r,this.addressW=o,this.maxAnisotropy=a,this.cmpFunc=s,this.borderColor=c,this.mipLODBias=l}return e.prototype.copy=function(e){return this.minFilter=e.minFilter,this.magFilter=e.magFilter,this.mipFilter=e.mipFilter,this.addressU=e.addressU,this.addressV=e.addressV,this.addressW=e.addressW,this.maxAnisotropy=e.maxAnisotropy,this.cmpFunc=e.cmpFunc,this.borderColor.copy(e.borderColor),this.mipLODBias=e.mipLODBias,this},e}(),xs=function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=Ea.UNKNOWN),void 0===n&&(n=0),this.name=e,this.type=t,this.count=n}return e.prototype.copy=function(e){return this.name=e.name,this.type=e.type,this.count=e.count,this},e}(),As=function(){function e(e,t,n,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=[]),void 0===r&&(r=0),this.set=e,this.binding=t,this.name=n,this.members=i,this.count=r}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,es(this.members,e.members,xs),this.count=e.count,this},e}(),Cs=function(){function e(e,t,n,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=Ea.UNKNOWN),void 0===r&&(r=0),this.set=e,this.binding=t,this.name=n,this.type=i,this.count=r}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.type=e.type,this.count=e.count,this},e}(),bs=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=0),this.set=e,this.binding=t,this.name=n,this.count=i}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.count=e.count,this},e}(),ws=function(){function e(e,t,n,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=Ea.UNKNOWN),void 0===r&&(r=0),this.set=e,this.binding=t,this.name=n,this.type=i,this.count=r}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.type=e.type,this.count=e.count,this},e}(),Rs=function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=Ea.UNKNOWN),void 0===r&&(r=0),void 0===o&&(o=Aa.READ_WRITE),this.set=e,this.binding=t,this.name=n,this.type=i,this.count=r,this.memoryAccess=o}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.type=e.type,this.count=e.count,this.memoryAccess=e.memoryAccess,this},e}(),Is=function(){function e(e,t,n,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=0),void 0===r&&(r=Aa.READ_WRITE),this.set=e,this.binding=t,this.name=n,this.count=i,this.memoryAccess=r}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.count=e.count,this.memoryAccess=e.memoryAccess,this},e}(),Ps=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=""),void 0===i&&(i=0),this.set=e,this.binding=t,this.name=n,this.count=i}return e.prototype.copy=function(e){return this.set=e.set,this.binding=e.binding,this.name=e.name,this.count=e.count,this},e}(),Os=function(){function e(e,t){void 0===e&&(e=Fa.NONE),void 0===t&&(t=""),this.stage=e,this.source=t}return e.prototype.copy=function(e){return this.stage=e.stage,this.source=e.source,this},e}(),Ds=function(){function e(e,t,n,i,r,o){void 0===e&&(e=""),void 0===t&&(t=ya.UNKNOWN),void 0===n&&(n=!1),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===o&&(o=0),this.name=e,this.format=t,this.isNormalized=n,this.stream=i,this.isInstanced=r,this.location=o}return e.prototype.copy=function(e){return this.name=e.name,this.format=e.format,this.isNormalized=e.isNormalized,this.stream=e.stream,this.isInstanced=e.isInstanced,this.location=e.location,this},e}(),Ns=function(){function e(e,t,n,i,r,o,a,s,c,l){void 0===e&&(e=""),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=[]),void 0===o&&(o=[]),void 0===a&&(a=[]),void 0===s&&(s=[]),void 0===c&&(c=[]),void 0===l&&(l=[]),this.name=e,this.stages=t,this.attributes=n,this.blocks=i,this.buffers=r,this.samplerTextures=o,this.samplers=a,this.textures=s,this.images=c,this.subpassInputs=l}return e.prototype.copy=function(e){return this.name=e.name,es(this.stages,e.stages,Os),es(this.attributes,e.attributes,Ds),es(this.blocks,e.blocks,As),es(this.buffers,e.buffers,Is),es(this.samplerTextures,e.samplerTextures,Cs),es(this.samplers,e.samplers,bs),es(this.textures,e.textures,ws),es(this.images,e.images,Rs),es(this.subpassInputs,e.subpassInputs,Ps),this},e}(),Ms=function(){function e(e,t,n,i){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=null),this.attributes=e,this.vertexBuffers=t,this.indexBuffer=n,this.indirectBuffer=i}return e.prototype.copy=function(e){return es(this.attributes,e.attributes,Ds),this.vertexBuffers=e.vertexBuffers.slice(),this.indexBuffer=e.indexBuffer,this.indirectBuffer=e.indirectBuffer,this},e}(),Ls=function(){function e(e,t,n,i,r,o){void 0===e&&(e=ya.UNKNOWN),void 0===t&&(t=Ia.X1),void 0===n&&(n=za.CLEAR),void 0===i&&(i=Ua.STORE),void 0===r&&(r=[]),void 0===o&&(o=[Ha.PRESENT]),this.format=e,this.sampleCount=t,this.loadOp=n,this.storeOp=i,this.beginAccesses=r,this.endAccesses=o}return e.prototype.copy=function(e){return this.format=e.format,this.sampleCount=e.sampleCount,this.loadOp=e.loadOp,this.storeOp=e.storeOp,this.beginAccesses=e.beginAccesses.slice(),this.endAccesses=e.endAccesses.slice(),this},e}(),Bs=function(){function e(e,t,n,i,r,o,a,s){void 0===e&&(e=ya.UNKNOWN),void 0===t&&(t=Ia.X1),void 0===n&&(n=za.CLEAR),void 0===i&&(i=Ua.STORE),void 0===r&&(r=za.CLEAR),void 0===o&&(o=Ua.STORE),void 0===a&&(a=[]),void 0===s&&(s=[Ha.DEPTH_STENCIL_ATTACHMENT_WRITE]),this.format=e,this.sampleCount=t,this.depthLoadOp=n,this.depthStoreOp=i,this.stencilLoadOp=r,this.stencilStoreOp=o,this.beginAccesses=a,this.endAccesses=s}return e.prototype.copy=function(e){return this.format=e.format,this.sampleCount=e.sampleCount,this.depthLoadOp=e.depthLoadOp,this.depthStoreOp=e.depthStoreOp,this.stencilLoadOp=e.stencilLoadOp,this.stencilStoreOp=e.stencilStoreOp,this.beginAccesses=e.beginAccesses.slice(),this.endAccesses=e.endAccesses.slice(),this},e}(),Fs=function(){function e(e,t,n,i,r){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=-1),this.inputs=e,this.colors=t,this.resolves=n,this.preserves=i,this.depthStencil=r}return e.prototype.copy=function(e){return this.inputs=e.inputs.slice(),this.colors=e.colors.slice(),this.resolves=e.resolves.slice(),this.preserves=e.preserves.slice(),this.depthStencil=e.depthStencil,this},e}(),zs=function(){function e(e,t,n){void 0===e&&(e=[]),void 0===t&&(t=new Bs),void 0===n&&(n=[]),this.colorAttachments=e,this.depthStencilAttachment=t,this.subpasses=n}return e.prototype.copy=function(e){return es(this.colorAttachments,e.colorAttachments,Ls),this.depthStencilAttachment.copy(e.depthStencilAttachment),es(this.subpasses,e.subpasses,Fs),this},e}(),Us=function(){function e(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.prevAccesses=e,this.nextAccesses=t}return e.prototype.copy=function(e){return this.prevAccesses=e.prevAccesses.slice(),this.nextAccesses=e.nextAccesses.slice(),this},e}(),Hs=function(){function e(e,t,n,i,r){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=!1),void 0===i&&(i=null),void 0===r&&(r=null),this.prevAccesses=e,this.nextAccesses=t,this.discardContents=n,this.srcQueue=i,this.dstQueue=r}return e.prototype.copy=function(e){return this.prevAccesses=e.prevAccesses.slice(),this.nextAccesses=e.nextAccesses.slice(),this.discardContents=e.discardContents,this.srcQueue=e.srcQueue,this.dstQueue=e.dstQueue,this},e}(),Gs=function(){function e(e,t,n,i,r){void 0===e&&(e=null),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=[]),void 0===r&&(r=0),this.renderPass=e,this.colorTextures=t,this.depthStencilTexture=n,this.colorMipmapLevels=i,this.depthStencilMipmapLevel=r}return e.prototype.copy=function(e){return this.renderPass=e.renderPass,this.colorTextures=e.colorTextures.slice(),this.depthStencilTexture=e.depthStencilTexture,this.colorMipmapLevels=e.colorMipmapLevels.slice(),this.depthStencilMipmapLevel=e.depthStencilMipmapLevel,this},e}(),ks=function(){function e(e,t,n,i,r){void 0===e&&(e=-1),void 0===t&&(t=Ya.UNKNOWN),void 0===n&&(n=0),void 0===i&&(i=Fa.NONE),void 0===r&&(r=[]),this.binding=e,this.descriptorType=t,this.count=n,this.stageFlags=i,this.immutableSamplers=r}return e.prototype.copy=function(e){return this.binding=e.binding,this.descriptorType=e.descriptorType,this.count=e.count,this.stageFlags=e.stageFlags,this.immutableSamplers=e.immutableSamplers.slice(),this},e}(),Vs=function(){function e(e){void 0===e&&(e=[]),this.bindings=e}return e.prototype.copy=function(e){return es(this.bindings,e.bindings,ks),this},e}(),Ws=function(){function e(e){void 0===e&&(e=null),this.layout=e}return e.prototype.copy=function(e){return this.layout=e.layout,this},e}(),js=function(){function e(e){void 0===e&&(e=[]),this.setLayouts=e}return e.prototype.copy=function(e){return this.setLayouts=e.setLayouts.slice(),this},e}(),qs=function(){function e(e){void 0===e&&(e=[]),this.attributes=e}return e.prototype.copy=function(e){return es(this.attributes,e.attributes,Ds),this},e}(),Xs=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=Za.PRIMARY),this.queue=e,this.type=t}return e.prototype.copy=function(e){return this.queue=e.queue,this.type=e.type,this},e}(),Ys=function(){function e(e){void 0===e&&(e=Ka.GRAPHICS),this.type=e}return e.prototype.copy=function(e){return this.type=e.type,this},e}(),Ks=function(e,t,n,i,r,o,a,s){void 0===e&&(e=""),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=Sa.NONE),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),this.name=e,this.size=t,this.count=n,this.type=i,this.hasAlpha=r,this.hasDepth=o,this.hasStencil=a,this.isCompressed=s},Zs=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.bufferSize=e,this.textureSize=t}return e.prototype.copy=function(e){return this.bufferSize=e.bufferSize,this.textureSize=e.textureSize,this},e}(),Qs=function(){function e(e){this._gfxType=da.UNKNOWN,this._gfxType=e}return X(e,[{key:"gfxType",get:function(){return this._gfxType}}]),e}(),Js=function(e,t,n,i,r,o,a){void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),void 0===a&&(a=new ds),this.canvasElm=e,this.isAntialias=t,this.isPremultipliedAlpha=n,this.devicePixelRatio=i,this.nativeWidth=r,this.nativeHeight=o,this.bindingMappingInfo=a};!function(e){e.ATTR_POSITION="a_position",e.ATTR_NORMAL="a_normal",e.ATTR_TANGENT="a_tangent",e.ATTR_BITANGENT="a_bitangent",e.ATTR_WEIGHTS="a_weights",e.ATTR_JOINTS="a_joints",e.ATTR_COLOR="a_color",e.ATTR_COLOR1="a_color1",e.ATTR_COLOR2="a_color2",e.ATTR_TEX_COORD="a_texCoord",e.ATTR_TEX_COORD1="a_texCoord1",e.ATTR_TEX_COORD2="a_texCoord2",e.ATTR_TEX_COORD3="a_texCoord3",e.ATTR_TEX_COORD4="a_texCoord4",e.ATTR_TEX_COORD5="a_texCoord5",e.ATTR_TEX_COORD6="a_texCoord6",e.ATTR_TEX_COORD7="a_texCoord7",e.ATTR_TEX_COORD8="a_texCoord8",e.ATTR_BATCH_ID="a_batch_id",e.ATTR_BATCH_UV="a_batch_uv"}(ts||(ts={}));var $s=Object.freeze([new Ks("UNKNOWN",0,0,Sa.NONE,!1,!1,!1,!1),new Ks("A8",1,1,Sa.UNORM,!0,!1,!1,!1),new Ks("L8",1,1,Sa.UNORM,!1,!1,!1,!1),new Ks("LA8",1,2,Sa.UNORM,!0,!1,!1,!1),new Ks("R8",1,1,Sa.UNORM,!1,!1,!1,!1),new Ks("R8SN",1,1,Sa.SNORM,!1,!1,!1,!1),new Ks("R8UI",1,1,Sa.UINT,!1,!1,!1,!1),new Ks("R8I",1,1,Sa.INT,!1,!1,!1,!1),new Ks("R16F",2,1,Sa.FLOAT,!1,!1,!1,!1),new Ks("R16UI",2,1,Sa.UINT,!1,!1,!1,!1),new Ks("R16I",2,1,Sa.INT,!1,!1,!1,!1),new Ks("R32F",4,1,Sa.FLOAT,!1,!1,!1,!1),new Ks("R32UI",4,1,Sa.UINT,!1,!1,!1,!1),new Ks("R32I",4,1,Sa.INT,!1,!1,!1,!1),new Ks("RG8",2,2,Sa.UNORM,!1,!1,!1,!1),new Ks("RG8SN",2,2,Sa.SNORM,!1,!1,!1,!1),new Ks("RG8UI",2,2,Sa.UINT,!1,!1,!1,!1),new Ks("RG8I",2,2,Sa.INT,!1,!1,!1,!1),new Ks("RG16F",4,2,Sa.FLOAT,!1,!1,!1,!1),new Ks("RG16UI",4,2,Sa.UINT,!1,!1,!1,!1),new Ks("RG16I",4,2,Sa.INT,!1,!1,!1,!1),new Ks("RG32F",8,2,Sa.FLOAT,!1,!1,!1,!1),new Ks("RG32UI",8,2,Sa.UINT,!1,!1,!1,!1),new Ks("RG32I",8,2,Sa.INT,!1,!1,!1,!1),new Ks("RGB8",3,3,Sa.UNORM,!1,!1,!1,!1),new Ks("SRGB8",3,3,Sa.UNORM,!1,!1,!1,!1),new Ks("RGB8SN",3,3,Sa.SNORM,!1,!1,!1,!1),new Ks("RGB8UI",3,3,Sa.UINT,!1,!1,!1,!1),new Ks("RGB8I",3,3,Sa.INT,!1,!1,!1,!1),new Ks("RGB16F",6,3,Sa.FLOAT,!1,!1,!1,!1),new Ks("RGB16UI",6,3,Sa.UINT,!1,!1,!1,!1),new Ks("RGB16I",6,3,Sa.INT,!1,!1,!1,!1),new Ks("RGB32F",12,3,Sa.FLOAT,!1,!1,!1,!1),new Ks("RGB32UI",12,3,Sa.UINT,!1,!1,!1,!1),new Ks("RGB32I",12,3,Sa.INT,!1,!1,!1,!1),new Ks("RGBA8",4,4,Sa.UNORM,!0,!1,!1,!1),new Ks("BGRA8",4,4,Sa.UNORM,!0,!1,!1,!1),new Ks("SRGB8_A8",4,4,Sa.UNORM,!0,!1,!1,!1),new Ks("RGBA8SN",4,4,Sa.SNORM,!0,!1,!1,!1),new Ks("RGBA8UI",4,4,Sa.UINT,!0,!1,!1,!1),new Ks("RGBA8I",4,4,Sa.INT,!0,!1,!1,!1),new Ks("RGBA16F",8,4,Sa.FLOAT,!0,!1,!1,!1),new Ks("RGBA16UI",8,4,Sa.UINT,!0,!1,!1,!1),new Ks("RGBA16I",8,4,Sa.INT,!0,!1,!1,!1),new Ks("RGBA32F",16,4,Sa.FLOAT,!0,!1,!1,!1),new Ks("RGBA32UI",16,4,Sa.UINT,!0,!1,!1,!1),new Ks("RGBA32I",16,4,Sa.INT,!0,!1,!1,!1),new Ks("R5G6B5",2,3,Sa.UNORM,!1,!1,!1,!1),new Ks("R11G11B10F",4,3,Sa.FLOAT,!1,!1,!1,!1),new Ks("RGB5A1",2,4,Sa.UNORM,!0,!1,!1,!1),new Ks("RGBA4",2,4,Sa.UNORM,!0,!1,!1,!1),new Ks("RGB10A2",2,4,Sa.UNORM,!0,!1,!1,!1),new Ks("RGB10A2UI",2,4,Sa.UINT,!0,!1,!1,!1),new Ks("RGB9E5",2,4,Sa.FLOAT,!0,!1,!1,!1),new Ks("D16",2,1,Sa.UINT,!1,!0,!1,!1),new Ks("D16S8",3,2,Sa.UINT,!1,!0,!0,!1),new Ks("D24",3,1,Sa.UINT,!1,!0,!1,!1),new Ks("D24S8",4,2,Sa.UINT,!1,!0,!0,!1),new Ks("D32F",4,1,Sa.FLOAT,!1,!0,!1,!1),new Ks("D32FS8",5,2,Sa.FLOAT,!1,!0,!0,!1),new Ks("BC1",1,3,Sa.UNORM,!1,!1,!1,!0),new Ks("BC1_ALPHA",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("BC1_SRGB",1,3,Sa.UNORM,!1,!1,!1,!0),new Ks("BC1_SRGB_ALPHA",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("BC2",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("BC2_SRGB",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("BC3",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("BC3_SRGB",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("BC4",1,1,Sa.UNORM,!1,!1,!1,!0),new Ks("BC4_SNORM",1,1,Sa.SNORM,!1,!1,!1,!0),new Ks("BC5",1,2,Sa.UNORM,!1,!1,!1,!0),new Ks("BC5_SNORM",1,2,Sa.SNORM,!1,!1,!1,!0),new Ks("BC6H_UF16",1,3,Sa.UFLOAT,!1,!1,!1,!0),new Ks("BC6H_SF16",1,3,Sa.FLOAT,!1,!1,!1,!0),new Ks("BC7",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("BC7_SRGB",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ETC_RGB8",1,3,Sa.UNORM,!1,!1,!1,!0),new Ks("ETC2_RGB8",1,3,Sa.UNORM,!1,!1,!1,!0),new Ks("ETC2_SRGB8",1,3,Sa.UNORM,!1,!1,!1,!0),new Ks("ETC2_RGB8_A1",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ETC2_SRGB8_A1",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ETC2_RGBA8",2,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ETC2_SRGB8_A8",2,4,Sa.UNORM,!0,!1,!1,!0),new Ks("EAC_R11",1,1,Sa.UNORM,!1,!1,!1,!0),new Ks("EAC_R11SN",1,1,Sa.SNORM,!1,!1,!1,!0),new Ks("EAC_RG11",2,2,Sa.UNORM,!1,!1,!1,!0),new Ks("EAC_RG11SN",2,2,Sa.SNORM,!1,!1,!1,!0),new Ks("PVRTC_RGB2",2,3,Sa.UNORM,!1,!1,!1,!0),new Ks("PVRTC_RGBA2",2,4,Sa.UNORM,!0,!1,!1,!0),new Ks("PVRTC_RGB4",2,3,Sa.UNORM,!1,!1,!1,!0),new Ks("PVRTC_RGBA4",2,4,Sa.UNORM,!0,!1,!1,!0),new Ks("PVRTC2_2BPP",2,4,Sa.UNORM,!0,!1,!1,!0),new Ks("PVRTC2_4BPP",2,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_4x4",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_5x4",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_5x5",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_6x5",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_6x6",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_8x5",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_8x6",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_8x8",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_10x5",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_10x6",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_10x8",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_10x10",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_12x10",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_RGBA_12x12",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_4x4",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_5x4",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_5x5",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_6x5",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_6x6",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_8x5",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_8x6",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_8x8",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_10x5",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_10x6",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_10x8",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_10x10",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_12x10",1,4,Sa.UNORM,!0,!1,!1,!0),new Ks("ASTC_SRGBA_12x12",1,4,Sa.UNORM,!0,!1,!1,!0)]),ec=Ya.UNIFORM_BUFFER|Ya.DYNAMIC_UNIFORM_BUFFER|Ya.STORAGE_BUFFER|Ya.DYNAMIC_STORAGE_BUFFER,tc=Ya.SAMPLER_TEXTURE|Ya.SAMPLER|Ya.TEXTURE|Ya.STORAGE_IMAGE|Ya.INPUT_ATTACHMENT,nc=Ya.DYNAMIC_STORAGE_BUFFER|Ya.DYNAMIC_UNIFORM_BUFFER;function ic(e){return e>0&&0==(e&e-1)}function rc(e,t,n,i){if(!$s[e].isCompressed)return t*n*i*$s[e].size;switch(e){case ya.BC1:case ya.BC1_ALPHA:case ya.BC1_SRGB:case ya.BC1_SRGB_ALPHA:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case ya.BC2:case ya.BC2_SRGB:case ya.BC3:case ya.BC3_SRGB:case ya.BC4:case ya.BC4_SNORM:case ya.BC6H_SF16:case ya.BC6H_UF16:case ya.BC7:case ya.BC7_SRGB:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case ya.BC5:case ya.BC5_SNORM:return Math.ceil(t/4)*Math.ceil(n/4)*32*i;case ya.ETC_RGB8:case ya.ETC2_RGB8:case ya.ETC2_SRGB8:case ya.ETC2_RGB8_A1:case ya.EAC_R11:case ya.EAC_R11SN:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case ya.ETC2_RGBA8:case ya.ETC2_SRGB8_A1:case ya.EAC_RG11:case ya.EAC_RG11SN:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case ya.PVRTC_RGB2:case ya.PVRTC_RGBA2:case ya.PVRTC2_2BPP:return Math.ceil(Math.max(t,16)*Math.max(n,8)/4)*i;case ya.PVRTC_RGB4:case ya.PVRTC_RGBA4:case ya.PVRTC2_4BPP:return Math.ceil(Math.max(t,8)*Math.max(n,8)/2)*i;case ya.ASTC_RGBA_4x4:case ya.ASTC_SRGBA_4x4:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case ya.ASTC_RGBA_5x4:case ya.ASTC_SRGBA_5x4:return Math.ceil(t/5)*Math.ceil(n/4)*16*i;case ya.ASTC_RGBA_5x5:case ya.ASTC_SRGBA_5x5:return Math.ceil(t/5)*Math.ceil(n/5)*16*i;case ya.ASTC_RGBA_6x5:case ya.ASTC_SRGBA_6x5:return Math.ceil(t/6)*Math.ceil(n/5)*16*i;case ya.ASTC_RGBA_6x6:case ya.ASTC_SRGBA_6x6:return Math.ceil(t/6)*Math.ceil(n/6)*16*i;case ya.ASTC_RGBA_8x5:case ya.ASTC_SRGBA_8x5:return Math.ceil(t/8)*Math.ceil(n/5)*16*i;case ya.ASTC_RGBA_8x6:case ya.ASTC_SRGBA_8x6:return Math.ceil(t/8)*Math.ceil(n/6)*16*i;case ya.ASTC_RGBA_8x8:case ya.ASTC_SRGBA_8x8:return Math.ceil(t/8)*Math.ceil(n/8)*16*i;case ya.ASTC_RGBA_10x5:case ya.ASTC_SRGBA_10x5:return Math.ceil(t/10)*Math.ceil(n/5)*16*i;case ya.ASTC_RGBA_10x6:case ya.ASTC_SRGBA_10x6:return Math.ceil(t/10)*Math.ceil(n/6)*16*i;case ya.ASTC_RGBA_10x8:case ya.ASTC_SRGBA_10x8:return Math.ceil(t/10)*Math.ceil(n/8)*16*i;case ya.ASTC_RGBA_10x10:case ya.ASTC_SRGBA_10x10:return Math.ceil(t/10)*Math.ceil(n/10)*16*i;case ya.ASTC_RGBA_12x10:case ya.ASTC_SRGBA_12x10:return Math.ceil(t/12)*Math.ceil(n/10)*16*i;case ya.ASTC_RGBA_12x12:case ya.ASTC_SRGBA_12x12:return Math.ceil(t/12)*Math.ceil(n/12)*16*i;default:return 0}}function oc(e,t,n,i,r){for(var o=0,a=0;a<r;++a)o+=rc(e,t,n,i),t=Math.max(t>>1,1),n=Math.max(n>>1,1);return o}var ac=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function sc(e){return ac[e]||0}function cc(e){var t=e.size/e.count;switch(e.type){case Sa.UNORM:case Sa.UINT:switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}break;case Sa.SNORM:case Sa.INT:switch(t){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}break;case Sa.FLOAT:return Float32Array}return Float32Array}var lc=Object.freeze({__proto__:null,get ObjectType(){return da},get Status(){return pa},get API(){return ma},get SurfaceTransform(){return ga},get Feature(){return va},get Format(){return ya},get FormatType(){return Sa},get Type(){return Ea},get BufferUsageBit(){return Ta},get BufferFlagBit(){return xa},get MemoryAccessBit(){return Aa},get MemoryUsageBit(){return Ca},get TextureType(){return ba},get TextureUsageBit(){return wa},get TextureFlagBit(){return Ra},get SampleCount(){return Ia},get Filter(){return Pa},get Address(){return Oa},get ComparisonFunc(){return Da},get StencilOp(){return Na},get BlendFactor(){return Ma},get BlendOp(){return La},get ColorMask(){return Ba},get ShaderStageFlagBit(){return Fa},get LoadOp(){return za},get StoreOp(){return Ua},get AccessType(){return Ha},get PipelineBindPoint(){return Ga},get PrimitiveMode(){return ka},get PolygonMode(){return Va},get ShadeModel(){return Wa},get CullMode(){return ja},get DynamicStateFlagBit(){return qa},get StencilFace(){return Xa},get DescriptorType(){return Ya},get QueueType(){return Ka},get CommandBufferType(){return Za},get ClearFlagBit(){return Qa},Size:ns,DeviceCaps:is,Offset:rs,Rect:os,Extent:as,TextureSubresLayers:ss,TextureSubresRange:cs,TextureCopy:ls,TextureBlit:us,BufferTextureCopy:hs,Viewport:_s,Color:fs,BindingMappingInfo:ds,BufferInfo:ps,BufferViewInfo:ms,DrawInfo:gs,DispatchInfo:vs,IndirectBuffer:ys,TextureInfo:Ss,TextureViewInfo:Es,SamplerInfo:Ts,Uniform:xs,UniformBlock:As,UniformSamplerTexture:Cs,UniformSampler:bs,UniformTexture:ws,UniformStorageImage:Rs,UniformStorageBuffer:Is,UniformInputAttachment:Ps,ShaderStage:Os,Attribute:Ds,ShaderInfo:Ns,InputAssemblerInfo:Ms,ColorAttachment:Ls,DepthStencilAttachment:Bs,SubpassInfo:Fs,RenderPassInfo:zs,GlobalBarrierInfo:Us,TextureBarrierInfo:Hs,FramebufferInfo:Gs,DescriptorSetLayoutBinding:ks,DescriptorSetLayoutInfo:Vs,DescriptorSetInfo:Ws,PipelineLayoutInfo:js,InputState:qs,CommandBufferInfo:Xs,QueueInfo:Ys,FormatInfo:Ks,MemoryStatus:Zs,Obj:Qs,DeviceInfo:Js,get AttributeName(){return ts},FormatInfos:$s,DESCRIPTOR_BUFFER_TYPE:ec,DESCRIPTOR_SAMPLER_TYPE:tc,DESCRIPTOR_DYNAMIC_TYPE:nc,DRAW_INFO_SIZE:28,IsPowerOf2:ic,FormatSize:rc,FormatSurfaceSize:oc,GetTypeSize:sc,getTypedArrayConstructor:cc}),uc=function(e){function t(t){var n;return(n=e.call(this,da.BUFFER)||this)._device=void 0,n._usage=Ta.NONE,n._memUsage=Ca.NONE,n._size=0,n._stride=1,n._count=0,n._flags=xa.NONE,n._indirectBuffer=null,n._isBufferView=!1,n._device=t,n}return K(t,e),X(t,[{key:"usage",get:function(){return this._usage}},{key:"memUsage",get:function(){return this._memUsage}},{key:"size",get:function(){return this._size}},{key:"stride",get:function(){return this._stride}},{key:"count",get:function(){return this._count}},{key:"flags",get:function(){return this._flags}}]),t}(Qs),hc=function(e){function t(t){var n;return(n=e.call(this,da.COMMAND_BUFFER)||this)._device=void 0,n._queue=null,n._type=Za.PRIMARY,n._numDrawCalls=0,n._numInstances=0,n._numTris=0,n._device=t,n}return K(t,e),X(t,[{key:"type",get:function(){return this._type}},{key:"queue",get:function(){return this._queue}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}}]),t}(Qs);et(ya);var _c=function(){function e(){this._canvas=null,this._canvas2D=null,this._gfxAPI=ma.UNKNOWN,this._transform=ga.IDENTITY,this._deviceName="",this._renderer="",this._vendor="",this._version="",this._features=new Array(va.COUNT),this._queue=null,this._cmdBuff=null,this._devicePixelRatio=1,this._width=0,this._height=0,this._nativeWidth=0,this._nativeHeight=0,this._colorFmt=ya.UNKNOWN,this._depthStencilFmt=ya.UNKNOWN,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new Zs,this._caps=new is}return e.prototype.hasFeature=function(e){return this._features[e]},X(e,[{key:"canvas",get:function(){return this._canvas}},{key:"canvas2D",get:function(){return this._canvas2D}},{key:"gfxAPI",get:function(){return this._gfxAPI}},{key:"queue",get:function(){return this._queue}},{key:"commandBuffer",get:function(){return this._cmdBuff}},{key:"devicePixelRatio",get:function(){return this._devicePixelRatio}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"nativeWidth",get:function(){return this._nativeWidth}},{key:"nativeHeight",get:function(){return this._nativeHeight}},{key:"renderer",get:function(){return this._renderer}},{key:"vendor",get:function(){return this._vendor}},{key:"colorFormat",get:function(){return this._colorFmt}},{key:"depthStencilFormat",get:function(){return this._depthStencilFmt}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}},{key:"memoryStatus",get:function(){return this._memoryStatus}},{key:"capabilities",get:function(){return this._caps}},{key:"surfaceTransform",get:function(){return this._transform}}]),e}(),fc=function(e){function t(t){var n;return(n=e.call(this,da.FRAMEBUFFER)||this)._device=void 0,n._renderPass=null,n._colorTextures=[],n._depthStencilTexture=null,n._device=t,n}return K(t,e),X(t,[{key:"renderPass",get:function(){return this._renderPass}},{key:"colorTextures",get:function(){return this._colorTextures}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}}]),t}(Qs),dc=String.prototype.charCodeAt;function pc(e){return this[e]}function mc(e,t){for(var n=e.length,i=t^n,r=0,o="string"==typeof e?dc:pc;n>=4;){var a=255&o.call(e,r)|(255&o.call(e,++r))<<8|(255&o.call(e,++r))<<16|(255&o.call(e,++r))<<24;a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),n-=4,++r}switch(n){case 3:i^=(255&o.call(e,r+2))<<16;case 2:i^=(255&o.call(e,r+1))<<8;case 1:i=1540483477*(65535&(i^=255&o.call(e,r)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}var gc=function(e){function t(t){var n;return(n=e.call(this,da.INPUT_ASSEMBLER)||this)._device=void 0,n._attributes=[],n._vertexBuffers=[],n._indexBuffer=null,n._vertexCount=0,n._firstVertex=0,n._indexCount=0,n._firstIndex=0,n._vertexOffset=0,n._instanceCount=0,n._firstInstance=0,n._attributesHash=0,n._indirectBuffer=null,n._device=t,n}K(t,e);var n=t.prototype;return n.getVertexBuffer=function(e){return void 0===e&&(e=0),e<this._vertexBuffers.length?this._vertexBuffers[e]:null},n.computeAttributesHash=function(){for(var e="attrs",t=0;t<this.attributes.length;++t){var n=this.attributes[t];e+=","+n.name+","+n.format+","+n.isNormalized+","+n.stream+","+n.isInstanced}return mc(e,666)},X(t,[{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"attributes",get:function(){return this._attributes}},{key:"attributesHash",get:function(){return this._attributesHash}},{key:"vertexCount",get:function(){return this._vertexCount},set:function(e){this._vertexCount=e}},{key:"firstVertex",get:function(){return this._firstVertex},set:function(e){this._firstVertex=e}},{key:"indexCount",get:function(){return this._indexCount},set:function(e){this._indexCount=e}},{key:"firstIndex",get:function(){return this._firstIndex},set:function(e){this._firstIndex=e}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(e){this._vertexOffset=e}},{key:"instanceCount",get:function(){return this._instanceCount},set:function(e){this._instanceCount=e}},{key:"firstInstance",get:function(){return this._firstInstance},set:function(e){this._firstInstance=e}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}}]),t}(Qs),vc=function(e){function t(t){var n;return(n=e.call(this,da.DESCRIPTOR_SET)||this)._device=void 0,n._layout=null,n._buffers=[],n._textures=[],n._samplers=[],n._isDirty=!1,n._device=t,n}K(t,e);var n=t.prototype;return n.bindBuffer=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&ec){var o=this._layout.descriptorIndices[e];this._buffers[o+n]!==t&&(this._buffers[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.UNIFORM_BUFFER.")},n.bindSampler=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&tc){var o=this._layout.descriptorIndices[e];this._samplers[o+n]!==t&&(this._samplers[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},n.bindTexture=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&tc){var o=this._layout.descriptorIndices[e];this._textures[o+n]!==t&&(this._textures[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},n.getBuffer=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._buffers[n+t]},n.getSampler=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._samplers[n+t]},n.getTexture=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._textures[n+t]},X(t,[{key:"layout",get:function(){return this._layout}}]),t}(Qs),yc=function(e){function t(t){var n;return(n=e.call(this,da.DESCRIPTOR_SET_LAYOUT)||this)._device=void 0,n._bindings=[],n._bindingIndices=[],n._descriptorIndices=[],n._device=t,n}return K(t,e),X(t,[{key:"bindings",get:function(){return this._bindings}},{key:"bindingIndices",get:function(){return this._bindingIndices}},{key:"descriptorIndices",get:function(){return this._descriptorIndices}}]),t}(Qs),Sc=function(e){function t(t){var n;return(n=e.call(this,da.PIPELINE_LAYOUT)||this)._device=void 0,n._setLayouts=[],n._device=t,n}return K(t,e),X(t,[{key:"setLayouts",get:function(){return this._setLayouts}}]),t}(Qs),Ec=function(){function e(e,t,n,i,r,o,a,s,c,l,u,h){void 0===e&&(e=!1),void 0===t&&(t=Va.FILL),void 0===n&&(n=Wa.GOURAND),void 0===i&&(i=ja.BACK),void 0===r&&(r=!0),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=!0),void 0===u&&(u=!1),void 0===h&&(h=1),this.isDiscard=e,this.polygonMode=t,this.shadeModel=n,this.cullMode=i,this.isFrontFaceCCW=r,this.depthBiasEnabled=o,this.depthBias=a,this.depthBiasClamp=s,this.depthBiasSlop=c,this.isDepthClip=l,this.isMultisample=u,this.lineWidth=h}var t=e.prototype;return t.reset=function(){this.isDiscard=!1,this.polygonMode=Va.FILL,this.shadeModel=Wa.GOURAND,this.cullMode=ja.BACK,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},X(e,[{key:"handle",get:function(){return 0}}]),e}(),Tc=function(){function e(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,p,m,g,v){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=Da.LESS),void 0===i&&(i=!1),void 0===r&&(r=Da.ALWAYS),void 0===o&&(o=65535),void 0===a&&(a=65535),void 0===s&&(s=Na.KEEP),void 0===c&&(c=Na.KEEP),void 0===l&&(l=Na.KEEP),void 0===u&&(u=1),void 0===h&&(h=!1),void 0===_&&(_=Da.ALWAYS),void 0===f&&(f=65535),void 0===d&&(d=65535),void 0===p&&(p=Na.KEEP),void 0===m&&(m=Na.KEEP),void 0===g&&(g=Na.KEEP),void 0===v&&(v=1),this.depthTest=e,this.depthWrite=t,this.depthFunc=n,this.stencilTestFront=i,this.stencilFuncFront=r,this.stencilReadMaskFront=o,this.stencilWriteMaskFront=a,this.stencilFailOpFront=s,this.stencilZFailOpFront=c,this.stencilPassOpFront=l,this.stencilRefFront=u,this.stencilTestBack=h,this.stencilFuncBack=_,this.stencilReadMaskBack=f,this.stencilWriteMaskBack=d,this.stencilFailOpBack=p,this.stencilZFailOpBack=m,this.stencilPassOpBack=g,this.stencilRefBack=v}var t=e.prototype;return t.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=Da.LESS,this.stencilTestFront=!1,this.stencilFuncFront=Da.ALWAYS,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=Na.KEEP,this.stencilZFailOpFront=Na.KEEP,this.stencilPassOpFront=Na.KEEP,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=Da.ALWAYS,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=Na.KEEP,this.stencilZFailOpBack=Na.KEEP,this.stencilPassOpBack=Na.KEEP,this.stencilRefBack=1},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},X(e,[{key:"handle",get:function(){return 0}}]),e}(),xc=function(){function e(e,t,n,i,r,o,a,s){void 0===e&&(e=!1),void 0===t&&(t=Ma.ONE),void 0===n&&(n=Ma.ZERO),void 0===i&&(i=La.ADD),void 0===r&&(r=Ma.ONE),void 0===o&&(o=Ma.ZERO),void 0===a&&(a=La.ADD),void 0===s&&(s=Ba.ALL),this.blend=e,this.blendSrc=t,this.blendDst=n,this.blendEq=i,this.blendSrcAlpha=r,this.blendDstAlpha=o,this.blendAlphaEq=a,this.blendColorMask=s}var t=e.prototype;return t.reset=function(){this.blend=!1,this.blendSrc=Ma.ONE,this.blendDst=Ma.ZERO,this.blendEq=La.ADD,this.blendSrcAlpha=Ma.ONE,this.blendDstAlpha=Ma.ZERO,this.blendAlphaEq=La.ADD,this.blendColorMask=Ba.ALL},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},X(e,[{key:"handle",get:function(){return 0}}]),e}(),Ac=function(){function e(e,t,n,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=new fs),void 0===i&&(i=[new xc]),this.isA2C=e,this.isIndepend=t,this.blendColor=n,this.targets=i}var t=e.prototype;return t.setTarget=function(e,t){var n=this.targets[e];n||(n=this.targets[e]=new xc),Object.assign(n,t)},t.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},t.destroy=function(){},X(e,[{key:"handle",get:function(){return 0}}]),e}(),Cc=function(e,t,n,i,r,o,a,s,c,l){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=new qs),void 0===r&&(r=new Ec),void 0===o&&(o=new Tc),void 0===a&&(a=new Ac),void 0===s&&(s=ka.TRIANGLE_LIST),void 0===c&&(c=qa.NONE),void 0===l&&(l=Ga.GRAPHICS),this.shader=e,this.pipelineLayout=t,this.renderPass=n,this.inputState=i,this.rasterizerState=r,this.depthStencilState=o,this.blendState=a,this.primitive=s,this.dynamicStates=c,this.bindPoint=l},bc=function(e){function t(t){var n;return(n=e.call(this,da.PIPELINE_STATE)||this)._device=void 0,n._shader=null,n._pipelineLayout=null,n._primitive=ka.TRIANGLE_LIST,n._is=null,n._rs=new Ec,n._dss=new Tc,n._bs=new Ac,n._dynamicStates=qa.NONE,n._renderPass=null,n._device=t,n}return K(t,e),X(t,[{key:"shader",get:function(){return this._shader}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"primitive",get:function(){return this._primitive}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"inputState",get:function(){return this._is}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"renderPass",get:function(){return this._renderPass}}]),t}(Qs),wc=function(e){function t(t){var n;return(n=e.call(this,da.QUEUE)||this)._device=void 0,n._type=Ka.GRAPHICS,n._isAsync=!1,n._device=t,n}return K(t,e),t.prototype.isAsync=function(){return this._isAsync},X(t,[{key:"type",get:function(){return this._type}}]),t}(Qs),Rc=function(e){function t(t){var n;return(n=e.call(this,da.RENDER_PASS)||this)._device=void 0,n._colorInfos=[],n._depthStencilInfo=null,n._subpasses=[],n._hash=0,n._device=t,n}return K(t,e),t.prototype.computeHash=function(){var e="";if(this._subpasses.length)for(var t=0;t<this._subpasses.length;++t){var n=this._subpasses[t];if(n.inputs.length){e+="ia";for(var i=0;i<n.inputs.length;++i){var r=this._colorInfos[n.inputs[i]];e+=","+r.format+","+r.sampleCount}}if(n.colors.length){e+="ca";for(var o=0;o<n.inputs.length;++o){var a=this._colorInfos[n.inputs[o]];e+=","+a.format+","+a.sampleCount}}if(n.depthStencil>=0){var s=this._colorInfos[n.depthStencil];e+="ds,"+s.format+","+s.sampleCount}}else{e+="ca";for(var c=0;c<this._colorInfos.length;++c){var l=this._colorInfos[c];e+=","+l.format+","+l.sampleCount}var u=this._depthStencilInfo;u&&(e+="ds,"+u.format+","+u.sampleCount)}return mc(e,666)},X(t,[{key:"colorAttachments",get:function(){return this._colorInfos}},{key:"depthStencilAttachment",get:function(){return this._depthStencilInfo}},{key:"subPasses",get:function(){return this._subpasses}},{key:"hash",get:function(){return this._hash}}]),t}(Qs),Ic=function(e){function t(t){var n;return(n=e.call(this,da.SAMPLER)||this)._device=void 0,n._minFilter=Pa.LINEAR,n._magFilter=Pa.LINEAR,n._mipFilter=Pa.NONE,n._addressU=Oa.WRAP,n._addressV=Oa.WRAP,n._addressW=Oa.WRAP,n._maxAnisotropy=16,n._cmpFunc=Da.NEVER,n._borderColor=new fs,n._mipLODBias=0,n._device=t,n}return K(t,e),X(t,[{key:"minFilter",get:function(){return this._minFilter}},{key:"magFilter",get:function(){return this._magFilter}},{key:"mipFilter",get:function(){return this._mipFilter}},{key:"addressU",get:function(){return this._addressU}},{key:"addressV",get:function(){return this._addressV}},{key:"addressW",get:function(){return this._addressW}},{key:"maxAnisotropy",get:function(){return this._maxAnisotropy}},{key:"cmpFunc",get:function(){return this._cmpFunc}},{key:"borderColor",get:function(){return this._borderColor}},{key:"mipLODBias",get:function(){return this._mipLODBias}}]),t}(Qs),Pc=function(e){function t(n){var i;return(i=e.call(this,da.SHADER)||this)._device=void 0,i._id=void 0,i._name="",i._stages=[],i._attributes=[],i._blocks=[],i._samplers=[],i._device=n,i._id=t._shaderIdGen++,i}return K(t,e),X(t,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"attributes",get:function(){return this._attributes}},{key:"blocks",get:function(){return this._blocks}},{key:"samplers",get:function(){return this._samplers}}]),t}(Qs);Pc._shaderIdGen=0;var Oc=function(e){function t(t){var n;return(n=e.call(this,da.TEXTURE)||this)._device=void 0,n._type=ba.TEX2D,n._usage=wa.NONE,n._format=ya.UNKNOWN,n._width=0,n._height=0,n._depth=1,n._layerCount=1,n._levelCount=1,n._samples=Ia.X1,n._flags=Ra.NONE,n._isPowerOf2=!1,n._size=0,n._device=t,n}return K(t,e),X(t,[{key:"type",get:function(){return this._type}},{key:"usage",get:function(){return this._usage}},{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"depth",get:function(){return this._depth}},{key:"layerCount",get:function(){return this._layerCount}},{key:"levelCount",get:function(){return this._levelCount}},{key:"samples",get:function(){return this._samples}},{key:"flags",get:function(){return this._flags}},{key:"size",get:function(){return this._size}}]),t}(Qs),Dc=function(e){function t(t){var n;return(n=e.call(this,da.GLOBAL_BARRIER)||this)._device=void 0,n._info=new Us,n._device=t,n}return K(t,e),t.prototype.initialize=function(e){return this._info.copy(e),!0},t}(Qs),Nc=function(e){function t(t){var n;return(n=e.call(this,da.TEXTURE_BARRIER)||this)._device=void 0,n._info=new Hs,n._device=t,n}return K(t,e),t.prototype.initialize=function(e){return this._info.copy(e),!0},t}(Qs),Mc={Device:_c,Buffer:uc,Texture:Oc,Sampler:Ic,Shader:Pc,InputAssembler:gc,RenderPass:Rc,Framebuffer:fc,DescriptorSet:vc,DescriptorSetLayout:yc,PipelineLayout:Sc,PipelineState:bc,CommandBuffer:hc,Queue:wc,GlobalBarrier:Dc,TextureBarrier:Nc,RasterizerState:Ec,BlendState:Ac,BlendTarget:xc,DepthStencilState:Tc,PipelineStateInfo:Cc};Object.assign(Mc,lc),i.gfx=Mc;var Lc,Bc={Obj:"GFXObject",DRAW_INFO_SIZE:"GFX_DRAW_INFO_SIZE",DESCRIPTOR_BUFFER_TYPE:"",DESCRIPTOR_SAMPLER_TYPE:"",DESCRIPTOR_DYNAMIC_TYPE:"",getTypedArrayConstructor:""};for(var Fc in i.gfx)if("__esModule"!==Fc){var zc=Bc[Fc];""===zc?zc=Fc:void 0===zc&&(zc="GFX"+Fc),F(i,"cc",[{name:zc,newName:Fc,target:i.gfx,targetName:"cc.gfx"}])}e("gfx",Object.freeze({__proto__:null,DescriptorSet:vc,Buffer:uc,CommandBuffer:hc,get ObjectType(){return da},get Status(){return pa},get API(){return ma},get SurfaceTransform(){return ga},get Feature(){return va},get Format(){return ya},get FormatType(){return Sa},get Type(){return Ea},get BufferUsageBit(){return Ta},get BufferFlagBit(){return xa},get MemoryAccessBit(){return Aa},get MemoryUsageBit(){return Ca},get TextureType(){return ba},get TextureUsageBit(){return wa},get TextureFlagBit(){return Ra},get SampleCount(){return Ia},get Filter(){return Pa},get Address(){return Oa},get ComparisonFunc(){return Da},get StencilOp(){return Na},get BlendFactor(){return Ma},get BlendOp(){return La},get ColorMask(){return Ba},get ShaderStageFlagBit(){return Fa},get LoadOp(){return za},get StoreOp(){return Ua},get AccessType(){return Ha},get PipelineBindPoint(){return Ga},get PrimitiveMode(){return ka},get PolygonMode(){return Va},get ShadeModel(){return Wa},get CullMode(){return ja},get DynamicStateFlagBit(){return qa},get StencilFace(){return Xa},get DescriptorType(){return Ya},get QueueType(){return Ka},get CommandBufferType(){return Za},get ClearFlagBit(){return Qa},Size:ns,DeviceCaps:is,Offset:rs,Rect:os,Extent:as,TextureSubresLayers:ss,TextureSubresRange:cs,TextureCopy:ls,TextureBlit:us,BufferTextureCopy:hs,Viewport:_s,Color:fs,BindingMappingInfo:ds,BufferInfo:ps,BufferViewInfo:ms,DrawInfo:gs,DispatchInfo:vs,IndirectBuffer:ys,TextureInfo:Ss,TextureViewInfo:Es,SamplerInfo:Ts,Uniform:xs,UniformBlock:As,UniformSamplerTexture:Cs,UniformSampler:bs,UniformTexture:ws,UniformStorageImage:Rs,UniformStorageBuffer:Is,UniformInputAttachment:Ps,ShaderStage:Os,Attribute:Ds,ShaderInfo:Ns,InputAssemblerInfo:Ms,ColorAttachment:Ls,DepthStencilAttachment:Bs,SubpassInfo:Fs,RenderPassInfo:zs,GlobalBarrierInfo:Us,TextureBarrierInfo:Hs,FramebufferInfo:Gs,DescriptorSetLayoutBinding:ks,DescriptorSetLayoutInfo:Vs,DescriptorSetInfo:Ws,PipelineLayoutInfo:js,InputState:qs,CommandBufferInfo:Xs,QueueInfo:Ys,FormatInfo:Ks,MemoryStatus:Zs,Obj:Qs,DeviceInfo:Js,get AttributeName(){return ts},FormatInfos:$s,DESCRIPTOR_BUFFER_TYPE:ec,DESCRIPTOR_SAMPLER_TYPE:tc,DESCRIPTOR_DYNAMIC_TYPE:nc,DRAW_INFO_SIZE:28,IsPowerOf2:ic,FormatSize:rc,FormatSurfaceSize:oc,GetTypeSize:sc,getTypedArrayConstructor:cc,Device:_c,Framebuffer:fc,InputAssembler:gc,DescriptorSetLayout:yc,PipelineLayout:Sc,RasterizerState:Ec,DepthStencilState:Tc,BlendTarget:xc,BlendState:Ac,PipelineStateInfo:Cc,PipelineState:bc,Queue:wc,RenderPass:Rc,Sampler:Ic,Shader:Pc,Texture:Oc,GlobalBarrier:Dc,TextureBarrier:Nc})),function(e){e[e.ALL=0]="ALL",e[e.CLOSEST=1]="CLOSEST",e[e.ANY=2]="ANY"}(Lc||(Lc={}));var Uc,Hc,Gc,kc,Vc,Wc,jc,qc,Xc=(Uc=new yn(0,0,0),function(e,t){var n=yn.dot(e.d,t.n);if(Math.abs(n)<Number.EPSILON)return 0;yn.multiplyScalar(Uc,t.n,t.d);var i=yn.dot(yn.subtract(Uc,Uc,e.o),t.n)/n;return i<0?0:i}),Yc=(Hc=new yn(0,0,0),Gc=new yn(0,0,0),kc=new yn(0,0,0),Vc=new yn(0,0,0),Wc=new yn(0,0,0),function(e,t,n){yn.subtract(Hc,t.b,t.a),yn.subtract(Gc,t.c,t.a),yn.cross(kc,e.d,Gc);var i=yn.dot(Hc,kc);if(i<Number.EPSILON&&(!n||i>-Number.EPSILON))return 0;var r=1/i;yn.subtract(Vc,e.o,t.a);var o=yn.dot(Vc,kc)*r;if(o<0||o>1)return 0;yn.cross(Wc,Vc,Hc);var a=yn.dot(e.d,Wc)*r;if(a<0||o+a>1)return 0;var s=yn.dot(Gc,Wc)*r;return s<0?0:s}),Kc=function(){var e=new yn(0,0,0);return function(t,n){var i=n.radius,r=n.center,o=t.o,a=t.d,s=i*i;yn.subtract(e,r,o);var c=e.lengthSqr(),l=yn.dot(e,a),u=s-(c-l*l);if(u<0)return 0;var h=Math.sqrt(u),_=c<s?l+h:l-h;return _<0?0:_}}(),Zc=(jc=new yn,qc=new yn,function(e,t){return yn.subtract(jc,t.center,t.halfExtents),yn.add(qc,t.center,t.halfExtents),Qc(e,jc,qc)});function Qc(e,t,n){var i=e.o,r=e.d,o=1/r.x,a=1/r.y,s=1/r.z,c=(t.x-i.x)*o,l=(n.x-i.x)*o,u=(t.y-i.y)*a,h=(n.y-i.y)*a,_=(t.z-i.z)*s,f=(n.z-i.z)*s,d=Math.max(Math.max(Math.min(c,l),Math.min(u,h)),Math.min(_,f)),p=Math.min(Math.min(Math.max(c,l),Math.max(u,h)),Math.max(_,f));return p<0||d>p?0:d>0?d:p}var Jc,$c,el,tl,nl=function(){var e=new yn,t=new yn,n=new yn,i=new yn,r=new yn,o=new yn,a=new yn,s=new Array(3),c=new Array(3),l=new Array(3),u=new Array(6);return function(h,_){s[0]=_.halfExtents.x,s[1]=_.halfExtents.y,s[2]=_.halfExtents.z,e=_.center,t=h.o,n=h.d,yn.set(i,_.orientation.m00,_.orientation.m01,_.orientation.m02),yn.set(r,_.orientation.m03,_.orientation.m04,_.orientation.m05),yn.set(o,_.orientation.m06,_.orientation.m07,_.orientation.m08),yn.subtract(a,e,t),c[0]=yn.dot(i,n),c[1]=yn.dot(r,n),c[2]=yn.dot(o,n),l[0]=yn.dot(i,a),l[1]=yn.dot(r,a),l[2]=yn.dot(o,a);for(var f=0;f<3;++f){if(0===c[f]){if(-l[f]-s[f]>0||-l[f]+s[f]<0)return 0;c[f]=1e-7}u[2*f+0]=(l[f]+s[f])/c[f],u[2*f+1]=(l[f]-s[f])/c[f]}var d=Math.max(Math.max(Math.min(u[0],u[1]),Math.min(u[2],u[3])),Math.min(u[4],u[5])),p=Math.min(Math.min(Math.max(u[0],u[1]),Math.max(u[2],u[3])),Math.max(u[4],u[5]));return p<0||d>p?0:d>0?d:p}}(),il=function(){var e=new yn,t=new yn,n=new yn,i=new yn,r=new yn,o=new yn,a=new yn,s=new Ja;return function(c,l){var u=l.radius*l.radius,h=yn.normalize(e,c.d),_=l.ellipseCenter0,f=l.ellipseCenter1,d=yn.subtract(t,f,_);if(d.equals(yn.ZERO))return s.radius=l.radius,s.center.set(l.ellipseCenter0),Gl.raySphere(c,s);var p=c.o,m=yn.subtract(n,p,_),g=yn.cross(i,h,d),v=g.lengthSqr();if(0===v){s.radius=l.radius;var y=yn.subtract(r,f,p);return m.lengthSqr()<y.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),Gl.raySphere(c,s)}var S=yn.cross(r,m,d),E=d.lengthSqr(),T=2*yn.dot(g,S),x=T*T-4*v*(S.lengthSqr()-u*E);if(x<0)return 0;var A=(-T-Math.sqrt(x))/(2*v);if(A<0){s.radius=l.radius;var C=yn.subtract(o,f,p);return m.lengthSqr()<C.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),Gl.raySphere(c,s)}var b=yn.scaleAndAdd(o,c.o,h,A),w=yn.subtract(a,b,_),R=yn.dot(w,d)/E;return R>=0&&R<=1?A:R<0?(s.radius=l.radius,s.center.set(l.ellipseCenter0),Gl.raySphere(c,s)):R>1?(s.radius=l.radius,s.center.set(l.ellipseCenter1),Gl.raySphere(c,s)):0}}(),rl=(Jc=$a.create(),$c={distance:1/0,doubleSided:!1,mode:Lc.ANY},el=0,tl=function(e,t,n,i,r,o){e===Lc.CLOSEST?(el>t||0===el)&&(el=t,o&&(0===o.length?o.push({distance:t,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}):(o[0].distance=t,o[0].vertexIndex0=n/3,o[0].vertexIndex1=i/3,o[0].vertexIndex2=r/3))):(el=t,o&&o.push({distance:t,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}))},function(e,t,n){if(el=0,0===t.geometricInfo.positions.length)return el;var i=void 0===n?$c:n;if(Qc(e,t.geometricInfo.boundingBox.min,t.geometricInfo.boundingBox.max)){var r=t.primitiveMode,o=t.geometricInfo;!function(e,t,n,i,r){if(n===ka.TRIANGLE_LIST)for(var o=t.length,a=0;a<o;a+=3){var s=3*t[a],c=3*t[a+1],l=3*t[a+2];yn.set(Jc.a,e[s],e[s+1],e[s+2]),yn.set(Jc.b,e[c],e[c+1],e[c+2]),yn.set(Jc.c,e[l],e[l+1],e[l+2]);var u=Gl.rayTriangle(i,Jc,r.doubleSided);if(!(0===u||u>r.distance)&&(tl(r.mode,u,s,c,l,r.result),r.mode===Lc.ANY))return u}else if(n===ka.TRIANGLE_STRIP)for(var h=t.length-2,_=0,f=0;f<h;f+=1){var d=3*t[f-_],p=3*t[f+_+1],m=3*t[f+2];yn.set(Jc.a,e[d],e[d+1],e[d+2]),yn.set(Jc.b,e[p],e[p+1],e[p+2]),yn.set(Jc.c,e[m],e[m+1],e[m+2]),_=~_;var g=Gl.rayTriangle(i,Jc,r.doubleSided);if(!(0===g||g>r.distance)&&(tl(r.mode,g,d,p,m,r.result),r.mode===Lc.ANY))return g}else if(n===ka.TRIANGLE_FAN){var v=t.length-1,y=3*t[0];yn.set(Jc.a,e[y],e[y+1],e[y+2]);for(var S=1;S<v;S+=1){var E=3*t[S],T=3*t[S+1];yn.set(Jc.b,e[E],e[E+1],e[E+2]),yn.set(Jc.c,e[T],e[T+1],e[T+2]);var x=Gl.rayTriangle(i,Jc,r.doubleSided);if(!(0===x||x>r.distance)&&(tl(r.mode,x,y,E,T,r.result),r.mode===Lc.ANY))return x}}}(o.positions,o.indices,r,e,i)}return el}),ol=function(){var e=0,t={distance:1/0,doubleSided:!1,mode:Lc.ANY};return function(n,i,r){e=0;var o=void 0===r?t:r,a=i.renderingSubMeshes.length,s=i.struct.minPosition,c=i.struct.maxPosition;if(s&&c&&!Qc(n,s,c))return e;for(var l=0;l<a;l++){var u=i.renderingSubMeshes[l],h=rl(n,u,o);if(h)if(o.mode===Lc.CLOSEST)(0===e||e>h)&&(e=h,o.subIndices&&(o.subIndices[0]=l));else if(e=h,o.subIndices&&o.subIndices.push(l),o.mode===Lc.ANY)return h}return e&&o.mode===Lc.CLOSEST&&(o.result&&(o.result[0].distance=e,o.result.length=1),o.subIndices&&(o.subIndices.length=1)),e}}(),al=function(){var e=0,t={distance:1/0,doubleSided:!1,mode:Lc.ANY},n=new ca,i=new Mn;return function(r,o,a){e=0;var s=void 0===a?t:a,c=o.worldBounds;if(c&&!Zc(r,c))return e;ca.copy(n,r),o.node&&(Mn.invert(i,o.node.getWorldMatrix(i)),yn.transformMat4(n.o,r.o,i),yn.transformMat4Normal(n.d,r.d,i));for(var l=o.subModels,u=0;u<l.length;u++){var h=l[u].subMesh,_=rl(n,h,s);if(_)if(s.mode===Lc.CLOSEST)(0===e||e>_)&&(e=_,s.subIndices&&(s.subIndices[0]=u));else if(e=_,s.subIndices&&s.subIndices.push(u),s.mode===Lc.ANY)return _}return e&&s.mode===Lc.CLOSEST&&(s.result&&(s.result[0].distance=e,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),e}}(),sl=function(){var e=new yn(0,0,0);return function(t,n){yn.subtract(e,t.e,t.s);var i=(n.d-yn.dot(t.s,n.n))/yn.dot(e,n.n);return i<0||i>1?0:i}}(),cl=function(){var e=new yn(0,0,0),t=new yn(0,0,0),n=new yn(0,0,0),i=new yn(0,0,0),r=new yn(0,0,0),o=new yn(0,0,0);return function(a,s,c){yn.subtract(e,s.b,s.a),yn.subtract(t,s.c,s.a),yn.subtract(n,a.s,a.e),yn.cross(r,e,t);var l=yn.dot(n,r);if(l<=0)return 0;yn.subtract(i,a.s,s.a);var u=yn.dot(i,r);if(u<0||u>l)return 0;yn.cross(o,n,i);var h=yn.dot(t,o);if(h<0||h>l)return 0;var _=-yn.dot(e,o);if(_<0||h+_>l)return 0;if(c){var f=1/l,d=1-(h*=f)-(_*=f);yn.set(c,s.a.x*d+s.b.x*h+s.c.x*_,s.a.y*d+s.b.y*h+s.c.y*_,s.a.z*d+s.b.z*h+s.c.z*_)}return 1}}(),ll=new ca;function ul(e,t){ll.o.set(e.s),yn.subtract(ll.d,e.e,e.s),ll.d.normalize();var n=Zc(ll,t);return n<=e.length()?n:0}function hl(e,t){ll.o.set(e.s),yn.subtract(ll.d,e.e,e.s),ll.d.normalize();var n=nl(ll,t);return n<=e.length()?n:0}function _l(e,t){ll.o.set(e.s),yn.subtract(ll.d,e.e,e.s),ll.d.normalize();var n=Kc(ll,t);return n<=e.length()?n:0}var fl,dl,pl,ml,gl=(fl=new yn,dl=new yn,pl=new yn,ml=new yn,function(e,t){return yn.subtract(fl,e.center,e.halfExtents),yn.add(dl,e.center,e.halfExtents),yn.subtract(pl,t.center,t.halfExtents),yn.add(ml,t.center,t.halfExtents),fl.x<=ml.x&&dl.x>=pl.x&&fl.y<=ml.y&&dl.y>=pl.y&&fl.z<=ml.z&&dl.z>=pl.z});function vl(e,t,n,i,r,o){yn.set(o[0],e.x+n.x*t.x+i.x*t.y+r.x*t.z,e.y+n.y*t.x+i.y*t.y+r.y*t.z,e.z+n.z*t.x+i.z*t.y+r.z*t.z),yn.set(o[1],e.x-n.x*t.x+i.x*t.y+r.x*t.z,e.y-n.y*t.x+i.y*t.y+r.y*t.z,e.z-n.z*t.x+i.z*t.y+r.z*t.z),yn.set(o[2],e.x+n.x*t.x-i.x*t.y+r.x*t.z,e.y+n.y*t.x-i.y*t.y+r.y*t.z,e.z+n.z*t.x-i.z*t.y+r.z*t.z),yn.set(o[3],e.x+n.x*t.x+i.x*t.y-r.x*t.z,e.y+n.y*t.x+i.y*t.y-r.y*t.z,e.z+n.z*t.x+i.z*t.y-r.z*t.z),yn.set(o[4],e.x-n.x*t.x-i.x*t.y-r.x*t.z,e.y-n.y*t.x-i.y*t.y-r.y*t.z,e.z-n.z*t.x-i.z*t.y-r.z*t.z),yn.set(o[5],e.x+n.x*t.x-i.x*t.y-r.x*t.z,e.y+n.y*t.x-i.y*t.y-r.y*t.z,e.z+n.z*t.x-i.z*t.y-r.z*t.z),yn.set(o[6],e.x-n.x*t.x+i.x*t.y-r.x*t.z,e.y-n.y*t.x+i.y*t.y-r.y*t.z,e.z-n.z*t.x+i.z*t.y-r.z*t.z),yn.set(o[7],e.x-n.x*t.x-i.x*t.y+r.x*t.z,e.y-n.y*t.x-i.y*t.y+r.y*t.z,e.z-n.z*t.x-i.z*t.y+r.z*t.z)}function yl(e,t){for(var n=yn.dot(t,e[0]),i=n,r=1;r<8;++r){var o=yn.dot(t,e[r]);n=o<n?o:n,i=o>i?o:i}return[n,i]}var Sl,El,Tl,xl=function(){for(var e=new Array(15),t=0;t<15;t++)e[t]=new yn(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new yn(0,0,0),i[r]=new yn(0,0,0);var o=new yn,a=new yn;return function(t,r){yn.set(e[0],1,0,0),yn.set(e[1],0,1,0),yn.set(e[2],0,0,1),yn.set(e[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),yn.set(e[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),yn.set(e[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var s=0;s<3;++s)yn.cross(e[6+3*s],e[s],e[0]),yn.cross(e[7+3*s],e[s],e[1]),yn.cross(e[7+3*s],e[s],e[2]);yn.subtract(o,t.center,t.halfExtents),yn.add(a,t.center,t.halfExtents),function(e,t,n){yn.set(n[0],e.x,t.y,t.z),yn.set(n[1],e.x,t.y,e.z),yn.set(n[2],e.x,e.y,t.z),yn.set(n[3],e.x,e.y,e.z),yn.set(n[4],t.x,t.y,t.z),yn.set(n[5],t.x,t.y,e.z),yn.set(n[6],t.x,e.y,t.z),yn.set(n[7],t.x,e.y,e.z)}(o,a,n),vl(r.center,r.halfExtents,e[3],e[4],e[5],i);for(var c=0;c<15;++c){var l=yl(n,e[c]),u=yl(i,e[c]);if(u[0]>l[1]||l[0]>u[1])return 0}return 1}}(),Al=function(e,t){var n=e.halfExtents.x*Math.abs(t.n.x)+e.halfExtents.y*Math.abs(t.n.y)+e.halfExtents.z*Math.abs(t.n.z),i=yn.dot(t.n,e.center);return i+n<t.d?-1:i-n>t.d?0:1},Cl=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Al(e,t.planes[n]))return 0;return 1},bl=function(){for(var e=new Array(8),t=0,n=0,i=0;i<e.length;i++)e[i]=new yn(0,0,0);return function(i,r){for(var o=0,a=!1,s=0;s<r.planes.length;s++){if(-1===(o=Al(i,r.planes[s])))return 0;1===o&&(a=!0)}if(!a)return 1;for(var c=0;c<r.vertices.length;c++)yn.subtract(e[c],r.vertices[c],i.center);t=0,n=0;for(var l=0;l<r.vertices.length;l++)e[l].x>i.halfExtents.x?t++:e[l].x<-i.halfExtents.x&&n++;if(t===r.vertices.length||n===r.vertices.length)return 0;t=0,n=0;for(var u=0;u<r.vertices.length;u++)e[u].y>i.halfExtents.y?t++:e[u].y<-i.halfExtents.y&&n++;if(t===r.vertices.length||n===r.vertices.length)return 0;t=0,n=0;for(var h=0;h<r.vertices.length;h++)e[h].z>i.halfExtents.z?t++:e[h].z<-i.halfExtents.z&&n++;return t===r.vertices.length||n===r.vertices.length?0:1}}(),wl=(Sl=new yn(0,0,0),El=new xn,function(e,t){return yn.subtract(Sl,t,e.center),yn.transformMat3(Sl,Sl,xn.transpose(El,e.orientation)),n=Sl,i=e.halfExtents,Math.abs(n.x)<i.x&&Math.abs(n.y)<i.y&&Math.abs(n.z)<i.z;var n,i}),Rl=(Tl=function(e,t,n,i){return Math.abs(e.x*t+e.y*n+e.z*i)},function(e,t){var n=e.halfExtents.x*Tl(t.n,e.orientation.m00,e.orientation.m01,e.orientation.m02)+e.halfExtents.y*Tl(t.n,e.orientation.m03,e.orientation.m04,e.orientation.m05)+e.halfExtents.z*Tl(t.n,e.orientation.m06,e.orientation.m07,e.orientation.m08),i=yn.dot(t.n,e.center);return i+n<t.d?-1:i-n>t.d?0:1}),Il=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Rl(e,t.planes[n]))return 0;return 1},Pl=function(){for(var e=new Array(8),t=0,n=0,i=0,r=0;r<e.length;r++)e[r]=new yn(0,0,0);var o=function(e,t,n,i){return e.x*t+e.y*n+e.z*i};return function(r,a){for(var s=0,c=!1,l=0;l<a.planes.length;l++){if(-1===(s=Rl(r,a.planes[l])))return 0;1===s&&(c=!0)}if(!c)return 1;for(var u=0;u<a.vertices.length;u++)yn.subtract(e[u],a.vertices[u],r.center);n=0,i=0;for(var h=0;h<a.vertices.length;h++)(t=o(e[h],r.orientation.m00,r.orientation.m01,r.orientation.m02))>r.halfExtents.x?n++:t<-r.halfExtents.x&&i++;if(n===a.vertices.length||i===a.vertices.length)return 0;n=0,i=0;for(var _=0;_<a.vertices.length;_++)(t=o(e[_],r.orientation.m03,r.orientation.m04,r.orientation.m05))>r.halfExtents.y?n++:t<-r.halfExtents.y&&i++;if(n===a.vertices.length||i===a.vertices.length)return 0;n=0,i=0;for(var f=0;f<a.vertices.length;f++)(t=o(e[f],r.orientation.m06,r.orientation.m07,r.orientation.m08))>r.halfExtents.z?n++:t<-r.halfExtents.z&&i++;return n===a.vertices.length||i===a.vertices.length?0:1}}(),Ol=function(){for(var e=new Array(15),t=0;t<15;t++)e[t]=new yn(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new yn(0,0,0),i[r]=new yn(0,0,0);return function(t,r){yn.set(e[0],t.orientation.m00,t.orientation.m01,t.orientation.m02),yn.set(e[1],t.orientation.m03,t.orientation.m04,t.orientation.m05),yn.set(e[2],t.orientation.m06,t.orientation.m07,t.orientation.m08),yn.set(e[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),yn.set(e[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),yn.set(e[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var o=0;o<3;++o)yn.cross(e[6+3*o],e[o],e[0]),yn.cross(e[7+3*o],e[o],e[1]),yn.cross(e[7+3*o],e[o],e[2]);vl(t.center,t.halfExtents,e[0],e[1],e[2],n),vl(r.center,r.halfExtents,e[3],e[4],e[5],i);for(var a=0;a<15;++a){var s=yl(n,e[a]),c=yl(i,e[a]);if(c[0]>s[1]||s[0]>c[1])return 0}return 1}}(),Dl=function(){for(var e=new Ja,t=new yn,n=new yn,i=new yn,r=new Array(8),o=0;o<8;o++)r[o]=new yn;for(var a=new Array(8),s=0;s<8;s++)a[s]=new yn;return function(o,s){if(0===yn.squaredDistance(s.ellipseCenter0,s.ellipseCenter1))return e.radius=s.radius,e.center.set(s.ellipseCenter0),Gl.sphereOBB(e,o);t.x=o.orientation.m00,t.y=o.orientation.m01,t.z=o.orientation.m02,n.x=o.orientation.m03,n.y=o.orientation.m04,n.z=o.orientation.m05,i.x=o.orientation.m06,i.y=o.orientation.m07,i.z=o.orientation.m08,vl(o.center,o.halfExtents,t,n,i,r);var c=a,l=yn.copy(c[0],t),u=yn.copy(c[1],n),h=yn.copy(c[2],i);yn.subtract(c[3],s.center,o.center).normalize();var _=yn.subtract(c[4],s.ellipseCenter0,s.ellipseCenter1);_.normalize(),yn.cross(c[5],l,_),yn.cross(c[6],u,_),yn.cross(c[7],h,_);for(var f=0;f<8;++f){var d=yl(r,c[f]),p=yn.dot(c[f],s.ellipseCenter0),m=yn.dot(c[f],s.ellipseCenter1),g=Math.max(p,m),v=Math.min(p,m)-s.radius,y=g+s.radius;if(v>d[1]||d[0]>y)return 0}return 1}}(),Nl=function(e,t){var n=yn.dot(t.n,e.center),i=e.radius*t.n.length();return n+i<t.d?-1:n-i>t.d?0:1},Ml=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Nl(e,t.planes[n]))return 0;return 1},Ll=function(){var e=new yn(0,0,0),t=[1,-1,1,-1,1,-1];return function(n,i){for(var r=0;r<6;r++){var o=i.planes[r],a=n.radius,s=n.center,c=o.n,l=o.d,u=yn.dot(c,s);if(u+a<l)return 0;if(!(u-a>l)){yn.add(e,s,yn.multiplyScalar(e,c,a));for(var h=0;h<6;h++)if(h!==r&&h!==r+t[r]){var _=i.planes[h];if(yn.dot(_.n,e)<_.d)return 0}}}return 1}}(),Bl=function(e,t){var n=e.radius+t.radius;return yn.squaredDistance(e.center,t.center)<n*n},Fl=function(){var e=new yn;return function(t,n){return ia(e,t.center,n),yn.squaredDistance(t.center,e)<t.radius*t.radius}}(),zl=function(){var e=new yn;return function(t,n){return ra(e,t.center,n),yn.squaredDistance(t.center,e)<t.radius*t.radius}}(),Ul=function(){var e=new yn,t=new yn;return function(n,i){var r=n.radius+i.radius,o=r*r,a=yn.squaredDistance(i.ellipseCenter0,i.ellipseCenter1);if(0===a)return yn.squaredDistance(n.center,i.center)<o;yn.subtract(e,n.center,i.ellipseCenter0),yn.subtract(t,i.ellipseCenter1,i.ellipseCenter0);var s=yn.dot(e,t)/a;return s<0?yn.squaredDistance(n.center,i.ellipseCenter0)<o:s>1?yn.squaredDistance(n.center,i.ellipseCenter1)<o:(yn.scaleAndAdd(e,i.ellipseCenter0,t,s),yn.squaredDistance(n.center,e)<o)}}(),Hl=function(){var e=new yn,t=new yn,n=new yn,i=new yn,r=new yn,o=new yn;return function(a,s){var c,l,u,h,_=yn.subtract(e,a.ellipseCenter1,a.ellipseCenter0),f=yn.subtract(t,s.ellipseCenter1,s.ellipseCenter0),d=yn.subtract(n,a.ellipseCenter0,s.ellipseCenter0),p=yn.dot(_,_),m=yn.dot(_,f),g=yn.dot(f,f),v=yn.dot(_,d),y=yn.dot(f,d),S=p*g-m*m,E=S,T=S;S<Kt?(l=0,E=1,h=y,T=g):(h=p*y-m*v,(l=m*y-g*v)<0?(l=0,h=y,T=g):l>E&&(l=E,h=y+m,T=g)),h<0?(h=0,-v<0?l=0:-v>p?l=E:(l=-v,E=p)):h>T&&(h=T,-v+m<0?l=0:-v+m>p?l=E:(l=-v+m,E=p)),c=Math.abs(l)<Kt?0:l/E,u=Math.abs(h)<Kt?0:h/T;var x=i;x.set(d),x.add(yn.multiplyScalar(r,_,c)),x.subtract(yn.multiplyScalar(o,f,u));var A=a.radius+s.radius;return x.lengthSqr()<A*A}}(),Gl={raySphere:Kc,rayAABB:Zc,rayOBB:nl,rayPlane:Xc,rayTriangle:Yc,rayCapsule:il,raySubMesh:rl,rayMesh:ol,rayModel:al,lineSphere:_l,lineAABB:ul,lineOBB:hl,linePlane:sl,lineTriangle:cl,sphereWithSphere:Bl,sphereAABB:Fl,sphereOBB:zl,spherePlane:Nl,sphereFrustum:Ml,sphereFrustumAccurate:Ll,sphereCapsule:Ul,aabbWithAABB:gl,aabbWithOBB:xl,aabbPlane:Al,aabbFrustum:Cl,aabbFrustumAccurate:bl,obbWithOBB:Ol,obbPlane:Rl,obbFrustum:Il,obbFrustumAccurate:Pl,obbPoint:wl,obbCapsule:Dl,capsuleWithCapsule:Hl,resolve:function(e,t,n){void 0===n&&(n=null);var i=e._type,r=t._type,o=this[i|r];return i<r?o(e,t,n):o(t,e,n)}};Gl[aa.SHAPE_RAY|aa.SHAPE_SPHERE]=Kc,Gl[aa.SHAPE_RAY|aa.SHAPE_AABB]=Zc,Gl[aa.SHAPE_RAY|aa.SHAPE_OBB]=nl,Gl[aa.SHAPE_RAY|aa.SHAPE_PLANE]=Xc,Gl[aa.SHAPE_RAY|aa.SHAPE_TRIANGLE]=Yc,Gl[aa.SHAPE_RAY|aa.SHAPE_CAPSULE]=il,Gl[aa.SHAPE_LINE|aa.SHAPE_SPHERE]=_l,Gl[aa.SHAPE_LINE|aa.SHAPE_AABB]=ul,Gl[aa.SHAPE_LINE|aa.SHAPE_OBB]=hl,Gl[aa.SHAPE_LINE|aa.SHAPE_PLANE]=sl,Gl[aa.SHAPE_LINE|aa.SHAPE_TRIANGLE]=cl,Gl[aa.SHAPE_SPHERE]=Bl,Gl[aa.SHAPE_SPHERE|aa.SHAPE_AABB]=Fl,Gl[aa.SHAPE_SPHERE|aa.SHAPE_OBB]=zl,Gl[aa.SHAPE_SPHERE|aa.SHAPE_PLANE]=Nl,Gl[aa.SHAPE_SPHERE|aa.SHAPE_FRUSTUM]=Ml,Gl[aa.SHAPE_SPHERE|aa.SHAPE_FRUSTUM_ACCURATE]=Ll,Gl[aa.SHAPE_SPHERE|aa.SHAPE_CAPSULE]=Ul,Gl[aa.SHAPE_AABB]=gl,Gl[aa.SHAPE_AABB|aa.SHAPE_OBB]=xl,Gl[aa.SHAPE_AABB|aa.SHAPE_PLANE]=Al,Gl[aa.SHAPE_AABB|aa.SHAPE_FRUSTUM]=Cl,Gl[aa.SHAPE_AABB|aa.SHAPE_FRUSTUM_ACCURATE]=bl,Gl[aa.SHAPE_OBB]=Ol,Gl[aa.SHAPE_OBB|aa.SHAPE_PLANE]=Rl,Gl[aa.SHAPE_OBB|aa.SHAPE_FRUSTUM]=Il,Gl[aa.SHAPE_OBB|aa.SHAPE_FRUSTUM_ACCURATE]=Pl,Gl[aa.SHAPE_OBB|aa.SHAPE_CAPSULE]=Dl,Gl[aa.SHAPE_CAPSULE]=Hl,F(sa.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),z(Gl,"intersect",[{name:"line_quad"}]);var kl=new yn(0,0,0),Vl=new yn(0,0,0),Wl=i.mat4(),jl=i.v4(),ql=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=aa.SHAPE_PLANE,this.n=new yn(e,t,n),this.d=i}return e.create=function(t,n,i,r){return new e(t,n,i,r)},e.clone=function(t){return new e(t.n.x,t.n.y,t.n.z,t.d)},e.copy=function(e,t){return yn.copy(e.n,t.n),e.d=t.d,e},e.fromPoints=function(e,t,n,i){return yn.subtract(kl,n,t),yn.subtract(Vl,i,t),yn.normalize(e.n,yn.cross(e.n,kl,Vl)),e.d=yn.dot(e.n,t),e},e.set=function(e,t,n,i,r){return e.n.x=t,e.n.y=n,e.n.z=i,e.d=r,e},e.fromNormalAndPoint=function(e,t,n){return yn.copy(e.n,t),e.d=yn.dot(t,n),e},e.normalize=function(e,t){var n=t.n.length();return yn.normalize(e.n,t.n),n>0&&(e.d=t.d/n),e},e.prototype.transform=function(e){Mn.invert(Wl,e),Mn.transpose(Wl,Wl),kn.set(jl,this.n.x,this.n.y,this.n.z,this.d),kn.transformMat4(jl,jl,Wl),yn.set(this.n,jl.x,jl.y,jl.z),this.d=jl.w},X(e,[{key:"type",get:function(){return this._type}},{key:"x",get:function(){return this.n.x},set:function(e){this.n.x=e}},{key:"y",get:function(){return this.n.y},set:function(e){this.n.y=e}},{key:"z",get:function(){return this.n.z},set:function(e){this.n.z=e}},{key:"w",get:function(){return this.d},set:function(e){this.d=e}}]),e}(),Xl=new yn,Yl=new yn,Kl=new yn,Zl=new yn,Ql=new xn,Jl=function(e,t,n){Ql.m00=Math.abs(n.m00),Ql.m01=Math.abs(n.m01),Ql.m02=Math.abs(n.m02),Ql.m03=Math.abs(n.m04),Ql.m04=Math.abs(n.m05),Ql.m05=Math.abs(n.m06),Ql.m06=Math.abs(n.m08),Ql.m07=Math.abs(n.m09),Ql.m08=Math.abs(n.m10),yn.transformMat3(e,t,Ql)},$l=function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=aa.SHAPE_AABB,this.center=new yn(e,t,n),this.halfExtents=new yn(i,r,o)}e.create=function(t,n,i,r,o,a){return new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z)},e.copy=function(e,t){return yn.copy(e.center,t.center),yn.copy(e.halfExtents,t.halfExtents),e},e.fromPoints=function(e,t,n){return yn.add(Xl,n,t),yn.subtract(Yl,n,t),yn.multiplyScalar(e.center,Xl,.5),yn.multiplyScalar(e.halfExtents,Yl,.5),e},e.set=function(e,t,n,i,r,o,a){return yn.set(e.center,t,n,i),yn.set(e.halfExtents,r,o,a),e},e.merge=function(t,n,i){return yn.subtract(Xl,n.center,n.halfExtents),yn.subtract(Yl,i.center,i.halfExtents),yn.add(Kl,n.center,n.halfExtents),yn.add(Zl,i.center,i.halfExtents),yn.max(Zl,Kl,Zl),yn.min(Kl,Xl,Yl),e.fromPoints(t,Kl,Zl)},e.toBoundingSphere=function(e,t){t.getBoundary(Xl,Yl),e.center.set(Xl),e.radius=0,yn.subtract(Kl,Yl,e.center);var n=Kl.length(),i=.5*n;return e.radius+=i,yn.multiplyScalar(Kl,Kl,i/n),yn.add(e.center,e.center,Kl),e},e.transform=function(e,t,n){return yn.transformMat4(e.center,t.center,n),Jl(e.halfExtents,t.halfExtents,n),e};var t=e.prototype;return t.getBoundary=function(e,t){yn.subtract(e,this.center,this.halfExtents),yn.add(t,this.center,this.halfExtents)},t.transform=function(e,t,n,i,r){yn.transformMat4(r.center,this.center,e),Jl(r.halfExtents,this.halfExtents,e)},t.clone=function(){return e.clone(this)},t.copy=function(t){return e.copy(this,t)},X(e,[{key:"type",get:function(){return this._type}}]),e}(),eu=new yn,tu=new yn,nu=new xn,iu=function(){function e(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),void 0===a&&(a=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=aa.SHAPE_OBB,this.center=new yn(e,t,n),this.halfExtents=new yn(i,r,o),this.orientation=new xn(a,s,c,l,u,h,_,f,d)}e.create=function(t,n,i,r,o,a,s,c,l,u,h,_,f,d,p){return new e(t,n,i,r,o,a,s,c,l,u,h,_,f,d,p)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z,t.orientation.m00,t.orientation.m01,t.orientation.m02,t.orientation.m03,t.orientation.m04,t.orientation.m05,t.orientation.m06,t.orientation.m07,t.orientation.m08)},e.copy=function(e,t){return yn.copy(e.center,t.center),yn.copy(e.halfExtents,t.halfExtents),xn.copy(e.orientation,t.orientation),e},e.fromPoints=function(e,t,n){return yn.multiplyScalar(e.center,yn.add(eu,t,n),.5),yn.multiplyScalar(e.halfExtents,yn.subtract(tu,n,t),.5),xn.identity(e.orientation),e},e.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,p){return yn.set(e.center,t,n,i),yn.set(e.halfExtents,r,o,a),xn.set(e.orientation,s,c,l,u,h,_,f,d,p),e};var t=e.prototype;return t.getBoundary=function(e,t){!function(e,t,n){nu.m00=Math.abs(n.m00),nu.m01=Math.abs(n.m01),nu.m02=Math.abs(n.m02),nu.m03=Math.abs(n.m03),nu.m04=Math.abs(n.m04),nu.m05=Math.abs(n.m05),nu.m06=Math.abs(n.m06),nu.m07=Math.abs(n.m07),nu.m08=Math.abs(n.m08),yn.transformMat3(e,t,nu)}(eu,this.halfExtents,this.orientation),yn.subtract(e,this.center,eu),yn.add(t,this.center,eu)},t.transform=function(e,t,n,i,r){yn.transformMat4(r.center,this.center,e),xn.fromQuat(r.orientation,n),yn.multiply(r.halfExtents,this.halfExtents,i)},t.translateAndRotate=function(e,t,n){yn.transformMat4(n.center,this.center,e),xn.fromQuat(n.orientation,t)},t.setScale=function(e,t){yn.multiply(t.halfExtents,this.halfExtents,e)},X(e,[{key:"type",get:function(){return this._type}}]),e}(),ru=function(){function e(e,t,n){void 0===e&&(e=.5),void 0===t&&(t=.5),void 0===n&&(n=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=aa.SHAPE_CAPSULE,this.radius=e,this.halfHeight=t,this.axis=n,this.center=new yn,this.rotation=new bn,this.ellipseCenter0=new yn(0,t,0),this.ellipseCenter1=new yn(0,-t,0),this.updateCache()}var t=e.prototype;return t.transform=function(e,t,n,i,r){var o=i,a=dn(o);r.radius=this.radius*Math.abs(a);var s=(this.halfHeight+this.radius)*Math.abs(o.y)-r.radius;s<0&&(s=0),r.halfHeight=s,yn.transformMat4(r.center,this.center,e),bn.multiply(r.rotation,this.rotation,n),r.updateCache()},t.updateCache=function(){this.updateLocalCenter(),yn.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),yn.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},t.updateLocalCenter=function(){var e=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(e,0,0),this.ellipseCenter1.set(-e,0,0);break;case 1:this.ellipseCenter0.set(0,e,0),this.ellipseCenter1.set(0,-e,0);break;case 2:this.ellipseCenter0.set(0,0,e),this.ellipseCenter1.set(0,0,-e)}},X(e,[{key:"type",get:function(){return this._type}}]),e}(),ou=new Array(8);ou[0]=new yn(1,1,1),ou[1]=new yn(-1,1,1),ou[2]=new yn(-1,-1,1),ou[3]=new yn(1,-1,1),ou[4]=new yn(1,1,-1),ou[5]=new yn(-1,1,-1),ou[6]=new yn(-1,-1,-1),ou[7]=new yn(1,-1,-1);var au,su,cu,lu=function(){function e(){this._type=void 0,this.planes=void 0,this.vertices=void 0,this._type=aa.SHAPE_FRUSTUM,this.planes=new Array(6);for(var e=0;e<6;++e)this.planes[e]=ql.create(0,0,0,0);this.vertices=new Array(8);for(var t=0;t<8;++t)this.vertices[t]=new yn}e.create=function(){return new e},e.clone=function(t){return e.copy(new e,t)},e.copy=function(e,t){e._type=t._type;for(var n=0;n<6;++n)ql.copy(e.planes[n],t.planes[n]);for(var i=0;i<8;++i)yn.copy(e.vertices[i],t.vertices[i]);return e};var t=e.prototype;return t.update=function(e,t){if(yn.set(this.planes[0].n,e.m03+e.m00,e.m07+e.m04,e.m11+e.m08),this.planes[0].d=-(e.m15+e.m12),yn.set(this.planes[1].n,e.m03-e.m00,e.m07-e.m04,e.m11-e.m08),this.planes[1].d=-(e.m15-e.m12),yn.set(this.planes[2].n,e.m03+e.m01,e.m07+e.m05,e.m11+e.m09),this.planes[2].d=-(e.m15+e.m13),yn.set(this.planes[3].n,e.m03-e.m01,e.m07-e.m05,e.m11-e.m09),this.planes[3].d=-(e.m15-e.m13),yn.set(this.planes[4].n,e.m03+e.m02,e.m07+e.m06,e.m11+e.m10),this.planes[4].d=-(e.m15+e.m14),yn.set(this.planes[5].n,e.m03-e.m02,e.m07-e.m06,e.m11-e.m10),this.planes[5].d=-(e.m15-e.m14),this._type===aa.SHAPE_FRUSTUM_ACCURATE){for(var n=0;n<6;n++){var i=this.planes[n],r=1/i.n.length();yn.multiplyScalar(i.n,i.n,r),i.d*=r}for(var o=0;o<8;o++)yn.transformMat4(this.vertices[o],ou[o],t)}},t.transform=function(e){if(this._type===aa.SHAPE_FRUSTUM_ACCURATE){for(var t=0;t<8;t++)yn.transformMat4(this.vertices[t],this.vertices[t],e);ql.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),ql.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),ql.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),ql.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),ql.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),ql.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},X(e,[{key:"accurate",set:function(e){this._type=e?aa.SHAPE_FRUSTUM_ACCURATE:aa.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]),e}();function uu(e,t){if(t&&0!==e){for(var n=t.vertices,i=io.VERTICES,r=0;r<8;++r)co.setVec3(e,i,n[r]),i+=3;for(var o=t.planes,a=io.PLANES,s=0;s<6;s++,a+=4)co.setVec4(e,a,o[s])}}lu.createOrtho=(au=new yn,function(e,t,n,i,r,o){var a=t/2,s=n/2;yn.set(au,a,s,i),yn.transformMat4(e.vertices[0],au,o),yn.set(au,-a,s,i),yn.transformMat4(e.vertices[1],au,o),yn.set(au,-a,-s,i),yn.transformMat4(e.vertices[2],au,o),yn.set(au,a,-s,i),yn.transformMat4(e.vertices[3],au,o),yn.set(au,a,s,r),yn.transformMat4(e.vertices[4],au,o),yn.set(au,-a,s,r),yn.transformMat4(e.vertices[5],au,o),yn.set(au,-a,-s,r),yn.transformMat4(e.vertices[6],au,o),yn.set(au,a,-s,r),yn.transformMat4(e.vertices[7],au,o),ql.fromPoints(e.planes[0],e.vertices[1],e.vertices[6],e.vertices[5]),ql.fromPoints(e.planes[1],e.vertices[3],e.vertices[4],e.vertices[7]),ql.fromPoints(e.planes[2],e.vertices[6],e.vertices[3],e.vertices[7]),ql.fromPoints(e.planes[3],e.vertices[0],e.vertices[5],e.vertices[4]),ql.fromPoints(e.planes[4],e.vertices[2],e.vertices[0],e.vertices[3]),ql.fromPoints(e.planes[0],e.vertices[7],e.vertices[5],e.vertices[6])}),function(e){e[e.Default=0]="Default",e[e.Normal=1]="Normal",e[e.Loop=2]="Loop",e[e.ShouldWrap=4]="ShouldWrap",e[e.Clamp=8]="Clamp",e[e.PingPong=22]="PingPong",e[e.Reverse=36]="Reverse"}(su||(su={})),function(e){e[e.Default=su.Default]="Default",e[e.Normal=su.Normal]="Normal",e[e.Reverse=su.Reverse]="Reverse",e[e.Loop=su.Loop]="Loop",e[e.LoopReverse=su.Loop|su.Reverse]="LoopReverse",e[e.PingPong=su.PingPong]="PingPong",e[e.PingPongReverse=su.PingPong|su.Reverse]="PingPongReverse"}(cu||(cu={})),et(cu);var hu=function(){function e(e){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,e&&this.set(e)}return e.prototype.set=function(e){this.ratio=e.ratio,this.time=e.time,this.direction=e.direction,this.stopped=e.stopped,this.iterations=e.iterations,this.frameIndex=e.frameIndex},e}(),_u=Qe({Default:su.Default,Normal:su.Normal,Clamp:su.Clamp,Loop:su.Loop,PingPong:su.PingPong}),fu=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};Wt.fastDefine("cc.Keyframe",fu,{time:0,value:0,inTangent:0,outTangent:0});var du=function(){function e(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return e.prototype.evaluate=function(e){return t=e-this.time,n=this.coefficient,t*(t*(t*n[0]+n[1])+n[2])+n[3];var t,n},e}(),pu=function(){function e(t){void 0===t&&(t=null),this.keyFrames=void 0,this.preWrapMode=_u.Loop,this.postWrapMode=_u.Clamp,this.cachedKey=void 0,this.keyFrames=t||[].concat(e.defaultKF),this.cachedKey=new du}var t=e.prototype;return t.addKey=function(e){null==this.keyFrames&&(this.keyFrames=[]),this.keyFrames.push(e)},t.evaluate_slow=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,i=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(n){case _u.Loop:t=hn(e-i,r-i)+i;break;case _u.PingPong:t=_n(e-i,r-i)+i;break;case _u.Default:case _u.Normal:case _u.Clamp:default:t=Jt(e,i,r)}var o=0;if(t>this.keyFrames[0].time)if(t>=this.keyFrames[this.keyFrames.length-1].time)o=this.keyFrames.length-2;else for(var a=0;a<this.keyFrames.length-1;a++)if(t>=this.keyFrames[0].time&&t<=this.keyFrames[a+1].time){o=a;break}var s=this.keyFrames[o],c=this.keyFrames[o+1],l=fn(s.time,c.time,t),u=c.time-s.time,h=s.outTangent*u,_=c.inTangent*u,f=l*l,d=f*l,p=d-2*f+l,m=d-f,g=-2*d+3*f;return(2*d-3*f+1)*s.value+p*h+m*_+g*c.value},t.evaluate=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,i=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(n){case _u.Loop:t=hn(e-i,r-i)+i;break;case _u.PingPong:t=_n(e-i,r-i)+i;break;case _u.Default:case _u.Normal:case _u.Clamp:default:t=Jt(e,i,r)}if(t>=this.cachedKey.time&&t<this.cachedKey.endTime)return this.cachedKey.evaluate(t);var o=this.findIndex(this.cachedKey,t),a=Math.min(o+1,this.keyFrames.length-1);return this.calcOptimizedKey(this.cachedKey,o,a),this.cachedKey.evaluate(t)},t.calcOptimizedKey=function(e,t,n){var i=this.keyFrames[t],r=this.keyFrames[n];e.index=t,e.time=i.time,e.endTime=r.time;var o=r.time-i.time,a=r.value-i.value,s=1/(o*o),c=i.outTangent*o,l=r.inTangent*o;e.coefficient[0]=(c+l-a-a)*s/o,e.coefficient[1]=(a+a+a-c-c-l)*s,e.coefficient[2]=i.outTangent,e.coefficient[3]=i.value},t.findIndex=function(e,t){var n=e.index;if(-1!==n)if(t>this.keyFrames[n].time)for(var i=0;i<3;i++){var r=n+i;if(r+1<this.keyFrames.length&&this.keyFrames[r+1].time>t)return r}else for(var o=0;o<3;o++){var a=n-o;if(a>=0&&this.keyFrames[a-1].time<=t)return a-1}for(var s,c=0,l=this.keyFrames.length;l-c>1;)s=Math.floor((c+l)/2),this.keyFrames[s].time>=t?l=s:c=s;return c},e}();function mu(e,t){console.warn(e+" is deprecated, please use "+t+" instead.")}pu.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],Wt.fastDefine("cc.AnimationCurve",pu,{preWrapMode:_u.Default,postWrapMode:_u.Default,keyFrames:[]}),F(Gl,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var gu=function(e){function t(){var t;return t=e.call(this)||this,mu("line","Line"),t}return K(t,e),t}(sa),vu=function(e){function t(){var t;return t=e.call(this)||this,mu("plane","Plane"),t}return K(t,e),t}(ql),yu=function(e){function t(){var t;return t=e.call(this)||this,mu("ray","Ray"),t}return K(t,e),t}(ca),Su=function(e){function t(){var t;return t=e.call(this)||this,mu("triangle","Triangle"),t}return K(t,e),t}($a),Eu=function(e){function t(){var t;return t=e.call(this)||this,mu("sphere","Sphere"),t}return K(t,e),t}(Ja),Tu=function(e){function t(){var t;return t=e.call(this)||this,mu("aabb","AABB"),t}return K(t,e),t}($l),xu=function(e){function t(){var t;return t=e.call(this)||this,mu("obb","OBB"),t}return K(t,e),t}(iu),Au=function(e){function t(){var t;return t=e.call(this)||this,mu("capsule","Capsule"),t}return K(t,e),t}(ru),Cu=function(e){function t(){var t;return t=e.call(this)||this,mu("frustum","Frustum"),t}return K(t,e),t}(lu),bu=Object.freeze({__proto__:null,distance:oa,enums:aa,intersect:Gl,Line:sa,Plane:ql,Ray:ca,Triangle:$a,Sphere:Ja,AABB:$l,OBB:iu,Capsule:ru,Frustum:lu,Keyframe:fu,AnimationCurve:pu,get ERaycastMode(){return Lc},line:gu,plane:vu,ray:yu,triangle:Su,sphere:Eu,aabb:Tu,obb:xu,capsule:Au,frustum:Cu});e("geometry",bu);var wu={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},Ru=e("Layers",function(){function e(){}return e.makeMaskInclude=function(e){for(var t,n=0,i=$(e);!(t=i()).done;)n|=t.value;return n},e.makeMaskExclude=function(t){return~e.makeMaskInclude(t)},e.addLayer=function(t,n){void 0!==n?n>19||n<0?console.warn("maximum layers reached."):(e.Enum[t]=1<<n,e.Enum[n]=t,e.BitMask[t]=1<<n,e.BitMask[n]=t):console.warn("bitNum can't be undefined")},e.deleteLayer=function(t){t>19||t<0?console.warn("do not change buildin layers."):(delete e.Enum[e.Enum[t]],delete e.Enum[t],delete e.BitMask[e.BitMask[t]],delete e.BitMask[t])},e}());Ru.Enum=Qe(wu),Ru.BitMask=Ze(Y({},wu)),i.Layers=Ru;var Iu,Pu,Ou="GbufferFlow",Du="LightingFlow",Nu="ForwardFlow",Mu="ShadowFlow";!function(e){e[e.DEFAULT=100]="DEFAULT",e[e.UI=200]="UI"}(Iu||(Iu={})),i.RenderPassStage=Iu,function(e){e[e.MIN=0]="MIN",e[e.MAX=255]="MAX",e[e.DEFAULT=128]="DEFAULT"}(Pu||(Pu={}));var Lu,Bu={bindings:[],layouts:{}},Fu={bindings:[],layouts:{}};!function(e){e[e.UBO_GLOBAL=0]="UBO_GLOBAL",e[e.UBO_CAMERA=1]="UBO_CAMERA",e[e.UBO_SHADOW=2]="UBO_SHADOW",e[e.SAMPLER_SHADOWMAP=3]="SAMPLER_SHADOWMAP",e[e.SAMPLER_ENVIRONMENT=4]="SAMPLER_ENVIRONMENT",e[e.SAMPLER_SPOT_LIGHTING_MAP=5]="SAMPLER_SPOT_LIGHTING_MAP",e[e.SAMPLER_GBUFFER_ALBEDOMAP=6]="SAMPLER_GBUFFER_ALBEDOMAP",e[e.SAMPLER_GBUFFER_POSITIONMAP=7]="SAMPLER_GBUFFER_POSITIONMAP",e[e.SAMPLER_GBUFFER_NORMALMAP=8]="SAMPLER_GBUFFER_NORMALMAP",e[e.SAMPLER_GBUFFER_EMISSIVEMAP=9]="SAMPLER_GBUFFER_EMISSIVEMAP",e[e.SAMPLER_LIGHTING_RESULTMAP=10]="SAMPLER_LIGHTING_RESULTMAP",e[e.COUNT=11]="COUNT"}(Lu||(Lu={}));var zu,Uu=Lu.SAMPLER_SHADOWMAP,Hu=Lu.COUNT-Uu;!function(e){e[e.UBO_LOCAL=0]="UBO_LOCAL",e[e.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",e[e.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",e[e.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",e[e.UBO_MORPH=4]="UBO_MORPH",e[e.SAMPLER_JOINTS=5]="SAMPLER_JOINTS",e[e.SAMPLER_MORPH_POSITION=6]="SAMPLER_MORPH_POSITION",e[e.SAMPLER_MORPH_NORMAL=7]="SAMPLER_MORPH_NORMAL",e[e.SAMPLER_MORPH_TANGENT=8]="SAMPLER_MORPH_TANGENT",e[e.SAMPLER_LIGHTMAP=9]="SAMPLER_LIGHTMAP",e[e.SAMPLER_SPRITE=10]="SAMPLER_SPRITE",e[e.COUNT=11]="COUNT"}(zu||(zu={}));var Gu,ku=zu.SAMPLER_JOINTS,Vu=zu.COUNT-ku;!function(e){e[e.GLOBAL=0]="GLOBAL",e[e.MATERIAL=1]="MATERIAL",e[e.LOCAL=2]="LOCAL"}(Gu||(Gu={}));var Wu=new ds;Wu.bufferOffsets=[0,Uu+ku,Uu],Wu.samplerOffsets=[-Uu,Hu+Vu,Hu-ku],Wu.flexibleSet=1;var ju=function(){};ju.SIZE=4*(ju.COUNT=4+(ju.SCREEN_SIZE_OFFSET=4+(ju.NATIVE_SIZE_OFFSET=4+(ju.TIME_OFFSET=0)))),ju.NAME="CCGlobal",ju.BINDING=Lu.UBO_GLOBAL,ju.DESCRIPTOR=new ks(ju.BINDING,Ya.UNIFORM_BUFFER,1,Fa.ALL),ju.LAYOUT=new As(Gu.GLOBAL,ju.BINDING,ju.NAME,[new xs("cc_time",Ea.FLOAT4,1),new xs("cc_screenSize",Ea.FLOAT4,1),new xs("cc_nativeSize",Ea.FLOAT4,1)],1),Bu.layouts[ju.NAME]=ju.LAYOUT,Bu.bindings[ju.BINDING]=ju.DESCRIPTOR;var qu=function(){};qu.SIZE=4*(qu.COUNT=4+(qu.GLOBAL_FOG_ADD_OFFSET=4+(qu.GLOBAL_FOG_BASE_OFFSET=4+(qu.GLOBAL_FOG_COLOR_OFFSET=4+(qu.AMBIENT_GROUND_OFFSET=4+(qu.AMBIENT_SKY_OFFSET=4+(qu.MAIN_LIT_COLOR_OFFSET=4+(qu.MAIN_LIT_DIR_OFFSET=4+(qu.EXPOSURE_OFFSET=4+(qu.SCREEN_SCALE_OFFSET=4+(qu.CAMERA_POS_OFFSET=16+(qu.MAT_VIEW_PROJ_INV_OFFSET=16+(qu.MAT_VIEW_PROJ_OFFSET=16+(qu.MAT_PROJ_INV_OFFSET=16+(qu.MAT_PROJ_OFFSET=16+(qu.MAT_VIEW_INV_OFFSET=16+(qu.MAT_VIEW_OFFSET=0))))))))))))))))),qu.NAME="CCCamera",qu.BINDING=Lu.UBO_CAMERA,qu.DESCRIPTOR=new ks(qu.BINDING,Ya.UNIFORM_BUFFER,1,Fa.ALL),qu.LAYOUT=new As(Gu.GLOBAL,qu.BINDING,qu.NAME,[new xs("cc_matView",Ea.MAT4,1),new xs("cc_matViewInv",Ea.MAT4,1),new xs("cc_matProj",Ea.MAT4,1),new xs("cc_matProjInv",Ea.MAT4,1),new xs("cc_matViewProj",Ea.MAT4,1),new xs("cc_matViewProjInv",Ea.MAT4,1),new xs("cc_cameraPos",Ea.FLOAT4,1),new xs("cc_screenScale",Ea.FLOAT4,1),new xs("cc_exposure",Ea.FLOAT4,1),new xs("cc_mainLitDir",Ea.FLOAT4,1),new xs("cc_mainLitColor",Ea.FLOAT4,1),new xs("cc_ambientSky",Ea.FLOAT4,1),new xs("cc_ambientGround",Ea.FLOAT4,1),new xs("cc_fogColor",Ea.FLOAT4,1),new xs("cc_fogBase",Ea.FLOAT4,1),new xs("cc_fogAdd",Ea.FLOAT4,1)],1),Bu.layouts[qu.NAME]=qu.LAYOUT,Bu.bindings[qu.BINDING]=qu.DESCRIPTOR;var Xu=function(){};Xu.SIZE=4*(Xu.COUNT=4+(Xu.SHADOW_COLOR_OFFSET=4+(Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET=4+(Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET=4+(Xu.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET=16+(Xu.MAT_LIGHT_VIEW_PROJ_OFFSET=16+(Xu.MAT_LIGHT_VIEW_OFFSET=16+(Xu.MAT_LIGHT_PLANE_PROJ_OFFSET=0)))))))),Xu.NAME="CCShadow",Xu.BINDING=Lu.UBO_SHADOW,Xu.DESCRIPTOR=new ks(Xu.BINDING,Ya.UNIFORM_BUFFER,1,Fa.ALL),Xu.LAYOUT=new As(Gu.GLOBAL,Xu.BINDING,Xu.NAME,[new xs("cc_matLightPlaneProj",Ea.MAT4,1),new xs("cc_matLightView",Ea.MAT4,1),new xs("cc_matLightViewProj",Ea.MAT4,1),new xs("cc_shadowNFLSInfo",Ea.FLOAT4,1),new xs("cc_shadowWHPBInfo",Ea.FLOAT4,1),new xs("cc_shadowLPNNInfo",Ea.FLOAT4,1),new xs("cc_shadowColor",Ea.FLOAT4,1)],1),Bu.layouts[Xu.NAME]=Xu.LAYOUT,Bu.bindings[Xu.BINDING]=Xu.DESCRIPTOR;var Yu=Lu.SAMPLER_SHADOWMAP,Ku=new ks(Yu,Ya.SAMPLER_TEXTURE,1,Fa.FRAGMENT),Zu=new Cs(Gu.GLOBAL,Yu,"cc_shadowMap",Ea.SAMPLER2D,1);Bu.layouts.cc_shadowMap=Zu,Bu.bindings[Yu]=Ku;var Qu=Lu.SAMPLER_GBUFFER_ALBEDOMAP,Ju=new ks(Qu,Ya.SAMPLER_TEXTURE,1,Fa.FRAGMENT),$u=new Cs(Gu.GLOBAL,Qu,"cc_gbuffer_albedoMap",Ea.SAMPLER2D,1);Bu.layouts.cc_gbuffer_albedoMap=$u,Bu.bindings[Qu]=Ju;var eh=Lu.SAMPLER_GBUFFER_POSITIONMAP,th=new ks(eh,Ya.SAMPLER_TEXTURE,1,Fa.FRAGMENT),nh=new Cs(Gu.GLOBAL,eh,"cc_gbuffer_positionMap",Ea.SAMPLER2D,1);Bu.layouts.cc_gbuffer_positionMap=nh,Bu.bindings[eh]=th;var ih=Lu.SAMPLER_GBUFFER_NORMALMAP,rh=new ks(ih,Ya.SAMPLER_TEXTURE,1,Fa.FRAGMENT),oh=new Cs(Gu.GLOBAL,ih,"cc_gbuffer_normalMap",Ea.SAMPLER2D,1);Bu.layouts.cc_gbuffer_normalMap=oh,Bu.bindings[ih]=rh;var ah=Lu.SAMPLER_LIGHTING_RESULTMAP,sh=new ks(ah,Ya.SAMPLER_TEXTURE,1,Fa.FRAGMENT),ch=new Cs(Gu.GLOBAL,ah,"cc_lighting_resultMap",Ea.SAMPLER2D,1);Bu.layouts.cc_lighting_resultMap=ch,Bu.bindings[ah]=sh;var lh=Lu.SAMPLER_GBUFFER_EMISSIVEMAP,uh=new ks(lh,Ya.SAMPLER_TEXTURE,1,Fa.FRAGMENT),hh=new Cs(Gu.GLOBAL,lh,"cc_gbuffer_emissiveMap",Ea.SAMPLER2D,1);Bu.layouts.cc_gbuffer_emissiveMap=hh,Bu.bindings[lh]=uh;var _h=Lu.SAMPLER_ENVIRONMENT,fh=new ks(_h,Ya.SAMPLER_TEXTURE,1,Fa.FRAGMENT),dh=new Cs(Gu.GLOBAL,_h,"cc_environment",Ea.SAMPLER_CUBE,1);Bu.layouts.cc_environment=dh,Bu.bindings[_h]=fh;var ph=Lu.SAMPLER_SPOT_LIGHTING_MAP,mh=new ks(ph,Ya.SAMPLER_TEXTURE,1,Fa.FRAGMENT),gh=new Cs(Gu.GLOBAL,ph,"cc_spotLightingMap",Ea.SAMPLER2D,1);Bu.layouts.cc_spotLightingMap=gh,Bu.bindings[ph]=mh;var vh=function(){};vh.SIZE=4*(vh.COUNT=4+(vh.LIGHTINGMAP_UVPARAM=16+(vh.MAT_WORLD_IT_OFFSET=16+(vh.MAT_WORLD_OFFSET=0)))),vh.NAME="CCLocal",vh.BINDING=zu.UBO_LOCAL,vh.DESCRIPTOR=new ks(vh.BINDING,Ya.UNIFORM_BUFFER,1,Fa.VERTEX),vh.LAYOUT=new As(Gu.LOCAL,vh.BINDING,vh.NAME,[new xs("cc_matWorld",Ea.MAT4,1),new xs("cc_matWorldIT",Ea.MAT4,1),new xs("cc_lightingMapUVParam",Ea.FLOAT4,1)],1),Fu.layouts[vh.NAME]=vh.LAYOUT,Fu.bindings[vh.BINDING]=vh.DESCRIPTOR;var yh="a_matWorld0",Sh=function(){};Sh.BATCHING_COUNT=10,Sh.MAT_WORLDS_OFFSET=0,Sh.SIZE=4*(Sh.COUNT=16*Sh.BATCHING_COUNT),Sh.NAME="CCLocalBatched",Sh.BINDING=zu.UBO_LOCAL,Sh.DESCRIPTOR=new ks(Sh.BINDING,Ya.UNIFORM_BUFFER,1,Fa.VERTEX),Sh.LAYOUT=new As(Gu.LOCAL,Sh.BINDING,Sh.NAME,[new xs("cc_matWorlds",Ea.MAT4,Sh.BATCHING_COUNT)],1),Fu.layouts[Sh.NAME]=Sh.LAYOUT,Fu.bindings[Sh.BINDING]=Sh.DESCRIPTOR;var Eh=function(){};Eh.LIGHTS_PER_PASS=1,Eh.SIZE=4*(Eh.COUNT=(Eh.LIGHT_DIR_OFFSET=(Eh.LIGHT_SIZE_RANGE_ANGLE_OFFSET=(Eh.LIGHT_COLOR_OFFSET=(Eh.LIGHT_POS_OFFSET=0)+4*Eh.LIGHTS_PER_PASS)+4*Eh.LIGHTS_PER_PASS)+4*Eh.LIGHTS_PER_PASS)+4*Eh.LIGHTS_PER_PASS),Eh.NAME="CCForwardLight",Eh.BINDING=zu.UBO_FORWARD_LIGHTS,Eh.DESCRIPTOR=new ks(Eh.BINDING,Ya.DYNAMIC_UNIFORM_BUFFER,1,Fa.FRAGMENT),Eh.LAYOUT=new As(Gu.LOCAL,Eh.BINDING,Eh.NAME,[new xs("cc_lightPos",Ea.FLOAT4,Eh.LIGHTS_PER_PASS),new xs("cc_lightColor",Ea.FLOAT4,Eh.LIGHTS_PER_PASS),new xs("cc_lightSizeRangeAngle",Ea.FLOAT4,Eh.LIGHTS_PER_PASS),new xs("cc_lightDir",Ea.FLOAT4,Eh.LIGHTS_PER_PASS)],1),Fu.layouts[Eh.NAME]=Eh.LAYOUT,Fu.bindings[Eh.BINDING]=Eh.DESCRIPTOR;var Th=function(){};Th.LIGHTS_PER_PASS=10;var xh=function(){};xh.SIZE=4*(xh.COUNT=4+(xh.JOINTS_TEXTURE_INFO_OFFSET=0)),xh.NAME="CCSkinningTexture",xh.BINDING=zu.UBO_SKINNING_TEXTURE,xh.DESCRIPTOR=new ks(xh.BINDING,Ya.UNIFORM_BUFFER,1,Fa.VERTEX),xh.LAYOUT=new As(Gu.LOCAL,xh.BINDING,xh.NAME,[new xs("cc_jointTextureInfo",Ea.FLOAT4,1)],1),Fu.layouts[xh.NAME]=xh.LAYOUT,Fu.bindings[xh.BINDING]=xh.DESCRIPTOR;var Ah=function(){};Ah.SIZE=4*(Ah.COUNT=4+(Ah.JOINTS_ANIM_INFO_OFFSET=0)),Ah.NAME="CCSkinningAnimation",Ah.BINDING=zu.UBO_SKINNING_ANIMATION,Ah.DESCRIPTOR=new ks(Ah.BINDING,Ya.UNIFORM_BUFFER,1,Fa.VERTEX),Ah.LAYOUT=new As(Gu.LOCAL,Ah.BINDING,Ah.NAME,[new xs("cc_jointAnimInfo",Ea.FLOAT4,1)],1),Fu.layouts[Ah.NAME]=Ah.LAYOUT,Fu.bindings[Ah.BINDING]=Ah.DESCRIPTOR;var Ch=function(){};Ch.SIZE=4*(Ch.COUNT=360+(Ch.JOINTS_OFFSET=0)),Ch.NAME="CCSkinning",Ch.BINDING=zu.UBO_SKINNING_TEXTURE,Ch.DESCRIPTOR=new ks(Ch.BINDING,Ya.UNIFORM_BUFFER,1,Fa.VERTEX),Ch.LAYOUT=new As(Gu.LOCAL,Ch.BINDING,Ch.NAME,[new xs("cc_joints",Ea.FLOAT4,90)],1),Fu.layouts[Ch.NAME]=Ch.LAYOUT,Fu.bindings[Ch.BINDING]=Ch.DESCRIPTOR;var bh=function(){};bh.MAX_MORPH_TARGET_COUNT=60,bh.OFFSET_OF_WEIGHTS=0,bh.OFFSET_OF_VERTICES_COUNT=4+(bh.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=4+(bh.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*bh.MAX_MORPH_TARGET_COUNT)),bh.COUNT_BASE_4_BYTES=4*Math.ceil(bh.MAX_MORPH_TARGET_COUNT/4)+4,bh.SIZE=4*bh.COUNT_BASE_4_BYTES,bh.NAME="CCMorph",bh.BINDING=zu.UBO_MORPH,bh.DESCRIPTOR=new ks(bh.BINDING,Ya.UNIFORM_BUFFER,1,Fa.VERTEX),bh.LAYOUT=new As(Gu.LOCAL,bh.BINDING,bh.NAME,[new xs("cc_displacementWeights",Ea.FLOAT4,bh.MAX_MORPH_TARGET_COUNT/4),new xs("cc_displacementTextureInfo",Ea.FLOAT4,1)],1),Fu.layouts[bh.NAME]=bh.LAYOUT,Fu.bindings[bh.BINDING]=bh.DESCRIPTOR;var wh=zu.SAMPLER_JOINTS,Rh=new ks(wh,Ya.SAMPLER_TEXTURE,1,Fa.VERTEX),Ih=new Cs(Gu.LOCAL,wh,"cc_jointTexture",Ea.SAMPLER2D,1);Fu.layouts.cc_jointTexture=Ih,Fu.bindings[wh]=Rh;var Ph=zu.SAMPLER_MORPH_POSITION,Oh=new ks(Ph,Ya.SAMPLER_TEXTURE,1,Fa.VERTEX),Dh=new Cs(Gu.LOCAL,Ph,"cc_PositionDisplacements",Ea.SAMPLER2D,1);Fu.layouts.cc_PositionDisplacements=Dh,Fu.bindings[Ph]=Oh;var Nh=zu.SAMPLER_MORPH_NORMAL,Mh=new ks(Nh,Ya.SAMPLER_TEXTURE,1,Fa.VERTEX),Lh=new Cs(Gu.LOCAL,Nh,"cc_NormalDisplacements",Ea.SAMPLER2D,1);Fu.layouts.cc_NormalDisplacements=Lh,Fu.bindings[Nh]=Mh;var Bh=zu.SAMPLER_MORPH_TANGENT,Fh=new ks(Bh,Ya.SAMPLER_TEXTURE,1,Fa.VERTEX),zh=new Cs(Gu.LOCAL,Bh,"cc_TangentDisplacements",Ea.SAMPLER2D,1);Fu.layouts.cc_TangentDisplacements=zh,Fu.bindings[Bh]=Fh;var Uh=zu.SAMPLER_LIGHTMAP,Hh=new ks(Uh,Ya.SAMPLER_TEXTURE,1,Fa.FRAGMENT),Gh=new Cs(Gu.LOCAL,Uh,"cc_lightingMap",Ea.SAMPLER2D,1);Fu.layouts.cc_lightingMap=Gh,Fu.bindings[Uh]=Hh;var kh=zu.SAMPLER_SPRITE,Vh=new ks(kh,Ya.SAMPLER_TEXTURE,1,Fa.FRAGMENT),Wh=new Cs(Gu.LOCAL,kh,"cc_spriteTexture",Ea.SAMPLER2D,1);Fu.layouts.cc_spriteTexture=Wh,Fu.bindings[kh]=Vh;var jh,qh,Xh,Yh,Kh,Zh=Ru.makeMaskExclude([Ru.BitMask.UI_2D,Ru.BitMask.GIZMOS,Ru.BitMask.EDITOR,Ru.BitMask.SCENE_GIZMO,Ru.BitMask.PROFILER]),Qh=Ru.makeMaskExclude([Ru.BitMask.UI_2D,Ru.BitMask.PROFILER]),Jh=Ru.Enum.ALL;function $h(e){return e.hasFeature(va.COLOR_HALF_FLOAT)&&e.hasFeature(va.TEXTURE_HALF_FLOAT)}e("pipeline",Object.freeze({__proto__:null,PIPELINE_FLOW_GBUFFER:Ou,PIPELINE_FLOW_LIGHTING:Du,PIPELINE_FLOW_FORWARD:Nu,PIPELINE_FLOW_SHADOW:Mu,PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",get RenderPassStage(){return Iu},get RenderPriority(){return Pu},globalDescriptorSetLayout:Bu,localDescriptorSetLayout:Fu,get PipelineGlobalBindings(){return Lu},get ModelLocalBindings(){return zu},get SetIndex(){return Gu},bindingMappingInfo:Wu,UBOGlobal:ju,UBOCamera:qu,UBOShadow:Xu,UNIFORM_SHADOWMAP_BINDING:Yu,UNIFORM_GBUFFER_ALBEDOMAP_BINDING:Qu,UNIFORM_GBUFFER_POSITIONMAP_BINDING:eh,UNIFORM_GBUFFER_NORMALMAP_BINDING:ih,UNIFORM_LIGHTING_RESULTMAP_BINDING:ah,UNIFORM_GBUFFER_EMISSIVEMAP_BINDING:lh,UNIFORM_ENVIRONMENT_BINDING:_h,UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING:ph,UBOLocal:vh,INST_MAT_WORLD:yh,UBOLocalBatched:Sh,UBOForwardLight:Eh,UBODeferredLight:Th,JOINT_UNIFORM_CAPACITY:30,UBOSkinningTexture:xh,UBOSkinningAnimation:Ah,INST_JOINT_ANIM_INFO:"a_jointAnimInfo",UBOSkinning:Ch,UBOMorph:bh,UNIFORM_JOINT_TEXTURE_BINDING:wh,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:Ph,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:Nh,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:Bh,UNIFORM_LIGHTMAP_TEXTURE_BINDING:Uh,UNIFORM_SPRITE_TEXTURE_BINDING:kh,CAMERA_DEFAULT_MASK:Zh,CAMERA_EDITOR_MASK:Qh,MODEL_ALWAYS_MASK:Jh,supportsHalfFloatTexture:$h})),function(e){e[e.VERTICAL=0]="VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL"}(jh||(jh={})),function(e){e[e.ORTHO=0]="ORTHO",e[e.PERSPECTIVE=1]="PERSPECTIVE"}(qh||(qh={})),function(e){e[e.F1_8=0]="F1_8",e[e.F2_0=1]="F2_0",e[e.F2_2=2]="F2_2",e[e.F2_5=3]="F2_5",e[e.F2_8=4]="F2_8",e[e.F3_2=5]="F3_2",e[e.F3_5=6]="F3_5",e[e.F4_0=7]="F4_0",e[e.F4_5=8]="F4_5",e[e.F5_0=9]="F5_0",e[e.F5_6=10]="F5_6",e[e.F6_3=11]="F6_3",e[e.F7_1=12]="F7_1",e[e.F8_0=13]="F8_0",e[e.F9_0=14]="F9_0",e[e.F10_0=15]="F10_0",e[e.F11_0=16]="F11_0",e[e.F13_0=17]="F13_0",e[e.F14_0=18]="F14_0",e[e.F16_0=19]="F16_0",e[e.F18_0=20]="F18_0",e[e.F20_0=21]="F20_0",e[e.F22_0=22]="F22_0"}(Xh||(Xh={})),function(e){e[e.ISO100=0]="ISO100",e[e.ISO200=1]="ISO200",e[e.ISO400=2]="ISO400",e[e.ISO800=3]="ISO800"}(Yh||(Yh={})),function(e){e[e.D1=0]="D1",e[e.D2=1]="D2",e[e.D4=2]="D4",e[e.D8=3]="D8",e[e.D15=4]="D15",e[e.D30=5]="D30",e[e.D60=6]="D60",e[e.D125=7]="D125",e[e.D250=8]="D250",e[e.D500=9]="D500",e[e.D1000=10]="D1000",e[e.D2000=11]="D2000",e[e.D4000=12]="D4000"}(Kh||(Kh={}));var e_,t_,n_=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],i_=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],r_=[100,200,400,800],o_=new yn,a_=new yn,s_=new Mn,c_=Qa.STENCIL<<1,l_=[],u_=function(){function e(e){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=jh.VERTICAL,this._fov=tn(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new fs(.2,.2,.2,1),this._viewport=new Xn(0,0,1,1),this._curTransform=ga.IDENTITY,this._isProjDirty=!0,this._matView=new Mn,this._matViewInv=null,this._matProj=new Mn,this._matProjInv=new Mn,this._matViewProj=new Mn,this._matViewProjInv=new Mn,this._frustum=new lu,this._forward=new yn,this._position=new yn,this._priority=0,this._aperture=Xh.F16_0,this._apertureValue=void 0,this._shutter=Kh.D125,this._shutterValue=0,this._iso=Yh.ISO100,this._isoValue=0,this._ec=0,this._poolHandle=0,this._frustumHandle=0,this._window=null,this._device=e,this._apertureValue=n_[this._aperture],this._shutterValue=i_[this._shutter],this._isoValue=r_[this._iso],this._aspect=this.screenScale=1,!l_.length){var t=e.capabilities.clipSpaceSignY;l_[ga.IDENTITY]=new Mn(1,0,0,0,0,t),l_[ga.ROTATE_90]=new Mn(0,1,0,0,-t,0),l_[ga.ROTATE_180]=new Mn(-1,0,0,0,0,-t),l_[ga.ROTATE_270]=new Mn(0,-1,0,0,t,0)}}var t=e.prototype;return t.initialize=function(e){this._name=e.name,this._node=e.node,this._proj=e.projection,this._priority=e.priority||0,this._aspect=this.screenScale=1;var t=this._poolHandle=Zr.alloc();Zr.set(t,jr.WIDTH,1),Zr.set(t,jr.HEIGHT,1),Zr.set(t,jr.CLEAR_FLAGS,Qa.NONE),Zr.set(t,jr.CLEAR_DEPTH,1),Zr.set(t,jr.NODE,this._node.handle),Zr.set(t,jr.VISIBILITY,Zh),this._scene&&Zr.set(t,jr.SCENE,this._scene.handle),this.updateExposure(),this.changeTargetWindow(e.window),console.log("Created Camera: "+this._name+" "+Zr.get(t,jr.WIDTH)+"x"+Zr.get(t,jr.HEIGHT))},t.destroy=function(){this._window&&this._window.detachCamera(this),this._name=null,this._poolHandle&&(Zr.free(this._poolHandle),this._poolHandle=0,this._frustumHandle&&(co.free(this._frustumHandle),this._frustumHandle=0))},t.attachToScene=function(e){this._scene=e,this._enabled=!0,Zr.set(this._poolHandle,jr.SCENE,e.handle)},t.detachFromScene=function(){this._scene=null,this._enabled=!1,Zr.set(this._poolHandle,jr.SCENE,0)},t.resize=function(e,t){var n=this._poolHandle;Zr.set(n,jr.WIDTH,e),Zr.set(n,jr.HEIGHT,t),this._aspect=e*this._viewport.width/(t*this._viewport.height),this._isProjDirty=!0},t.setFixedSize=function(e,t){var n=this._poolHandle;Zr.set(n,jr.WIDTH,e),Zr.set(n,jr.HEIGHT,t),this._aspect=e*this._viewport.width/(t*this._viewport.height),this.isWindowSize=!1},t.update=function(e){if(void 0===e&&(e=!1),this._node){var t=!1;(this._node.hasChangedFlags||e)&&(Mn.invert(this._matView,this._node.worldMatrix),Zr.setMat4(this._poolHandle,jr.MAT_VIEW,this._matView),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,this._node.getWorldPosition(this._position),Zr.setVec3(this._poolHandle,jr.POSITION,this._position),Zr.setVec3(this._poolHandle,jr.FORWARD,this._forward),t=!0);var n=this._device.surfaceTransform;if(this._isProjDirty||this._curTransform!==n){var i;this._curTransform=n;var r=this._device.capabilities.clipSpaceSignY;if((null===(i=this.window)||void 0===i?void 0:i.hasOffScreenAttachments)&&(n=ga.IDENTITY),this._proj===qh.PERSPECTIVE)Mn.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===jh.VERTICAL,this._device.capabilities.clipSpaceMinZ,r,n);else{var o=this._orthoHeight*this._aspect,a=this._orthoHeight;Mn.ortho(this._matProj,-o,o,-a,a,this._nearClip,this._farClip,this._device.capabilities.clipSpaceMinZ,r,n)}Mn.invert(this._matProjInv,this._matProj),Zr.setMat4(this._poolHandle,jr.MAT_PROJ,this._matProj),Zr.setMat4(this._poolHandle,jr.MAT_PROJ_INV,this._matProjInv),t=!0,this._isProjDirty=!1}t&&(Mn.multiply(this._matViewProj,this._matProj,this._matView),Mn.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv),Zr.setMat4(this._poolHandle,jr.MAT_VIEW_PROJ,this._matViewProj),Zr.setMat4(this._poolHandle,jr.MAT_VIEW_PROJ_INV,this._matViewProjInv),uu(this._frustumHandle,this._frustum))}},t.changeTargetWindow=function(e){void 0===e&&(e=null),this._window&&this._window.detachCamera(this);var t=e||i.director.root.mainWindow;t&&(t.attachCamera(this),this.resize(t.width,t.height),this._window=t,Zr.set(this._poolHandle,jr.WINDOW,t.handle))},t.detachCamera=function(){this._window&&this._window.detachCamera(this)},t.screenPointToRay=function(e,t,n){if(!this._node)return null;var i=this._poolHandle,r=Zr.get(i,jr.WIDTH),o=Zr.get(i,jr.HEIGHT),a=this._viewport.x*r,s=this._viewport.y*o,c=this._viewport.width*r,l=this._viewport.height*o,u=this._proj===qh.PERSPECTIVE,h=this._device.capabilities.clipSpaceSignY,_=Nn[this._curTransform];yn.set(o_,(t-a)/c*2-1,(n-s)/l*2-1,u?1:-1);var f=o_.x,d=o_.y;return o_.x=f*_[0]+d*_[2]*h,o_.y=f*_[1]+d*_[3]*h,yn.transformMat4(u?o_:e.o,o_,this._matViewProjInv),u?(this._node.getWorldPosition(a_),ca.fromPoints(e,a_,o_)):yn.transformQuat(e.d,yn.FORWARD,this._node.worldRotation),e},t.screenToWorld=function(e,t){var n=this._poolHandle,i=Zr.get(n,jr.WIDTH),r=Zr.get(n,jr.HEIGHT),o=this._viewport.x*i,a=this._viewport.y*r,s=this._viewport.width*i,c=this._viewport.height*r,l=this._device.capabilities.clipSpaceSignY,u=Nn[this._curTransform];if(this._proj===qh.PERSPECTIVE){yn.set(e,(t.x-o)/s*2-1,(t.y-a)/c*2-1,1);var h=e.x,_=e.y;e.x=h*u[0]+_*u[2]*l,e.y=h*u[1]+_*u[3]*l,yn.transformMat4(e,e,this._matViewProjInv),this._node&&this._node.getWorldPosition(o_),yn.lerp(e,o_,e,en(this._nearClip/this._farClip,1,t.z))}else{yn.set(e,(t.x-o)/s*2-1,(t.y-a)/c*2-1,2*t.z-1);var f=e.x,d=e.y;e.x=f*u[0]+d*u[2]*l,e.y=f*u[1]+d*u[3]*l,yn.transformMat4(e,e,this._matViewProjInv)}return e},t.worldToScreen=function(e,t){var n=this._poolHandle,i=Zr.get(n,jr.WIDTH),r=Zr.get(n,jr.HEIGHT),o=this._viewport.x*i,a=this._viewport.y*r,s=this._viewport.width*i,c=this._viewport.height*r,l=this._device.capabilities.clipSpaceSignY,u=Nn[this._curTransform];yn.transformMat4(e,t,this._matViewProj);var h=e.x,_=e.y;return e.x=h*u[0]+_*u[2]*l,e.y=h*u[1]+_*u[3]*l,e.x=o+.5*(e.x+1)*s,e.y=a+.5*(e.y+1)*c,e.z=.5*e.z+.5,e},t.worldMatrixToScreen=function(e,t,n,i){Mn.multiply(e,this._matViewProj,t),Mn.multiply(e,l_[this._curTransform],e);var r=n/2,o=i/2;return Mn.identity(s_),Mn.transform(s_,s_,yn.set(o_,r,o,0)),Mn.scale(s_,s_,yn.set(o_,r,o,1)),Mn.multiply(e,s_,e),e},t.updateExposure=function(){var e=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);Zr.set(this._poolHandle,jr.EXPOSURE,.833333/Math.pow(2,e))},X(e,[{key:"node",get:function(){return this._node},set:function(e){this._node=e}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(e){this._orthoHeight=e,this._isProjDirty=!0}},{key:"projectionType",get:function(){return this._proj},set:function(e){this._proj=e,this._isProjDirty=!0}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(e){this._fovAxis=e,this._isProjDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._isProjDirty=!0}},{key:"nearClip",get:function(){return this._nearClip},set:function(e){this._nearClip=e,this._isProjDirty=!0}},{key:"farClip",get:function(){return this._farClip},set:function(e){this._farClip=e,this._isProjDirty=!0}},{key:"clearColor",get:function(){return this._clearColor},set:function(e){this._clearColor.x=e.x,this._clearColor.y=e.y,this._clearColor.z=e.z,this._clearColor.w=e.w,Zr.setVec4(this._poolHandle,jr.CLEAR_COLOR,e)}},{key:"viewport",get:function(){return this._viewport},set:function(e){var t=e.x,n=e.width,i=e.height,r=this._device.capabilities.clipSpaceSignY<0?1-e.y-i:e.y;switch(this._device.surfaceTransform){case ga.ROTATE_90:this._viewport.x=1-r-i,this._viewport.y=t,this._viewport.width=i,this._viewport.height=n;break;case ga.ROTATE_180:this._viewport.x=1-t-n,this._viewport.y=1-r-i,this._viewport.width=n,this._viewport.height=i;break;case ga.ROTATE_270:this._viewport.x=r,this._viewport.y=1-t-n,this._viewport.width=i,this._viewport.height=n;break;case ga.IDENTITY:this._viewport.x=t,this._viewport.y=r,this._viewport.width=n,this._viewport.height=i}Zr.setVec4(this._poolHandle,jr.VIEW_PORT,this._viewport),this.resize(this.width,this.height)}},{key:"scene",get:function(){return this._scene}},{key:"name",get:function(){return this._name}},{key:"width",get:function(){return Zr.get(this._poolHandle,jr.WIDTH)}},{key:"height",get:function(){return Zr.get(this._poolHandle,jr.HEIGHT)}},{key:"aspect",get:function(){return this._aspect}},{key:"matView",get:function(){return this._matView},set:function(e){this._matView=e,Zr.setMat4(this._poolHandle,jr.MAT_VIEW,this._matView)}},{key:"matViewInv",get:function(){return this._matViewInv||this._node.worldMatrix},set:function(e){this._matViewInv=e}},{key:"matProj",get:function(){return this._matProj},set:function(e){this._matProj=e,Zr.setMat4(this._poolHandle,jr.MAT_PROJ,this._matProj)}},{key:"matProjInv",get:function(){return this._matProjInv},set:function(e){this._matProjInv=e,Zr.setMat4(this._poolHandle,jr.MAT_PROJ_INV,this._matProjInv)}},{key:"matViewProj",get:function(){return this._matViewProj},set:function(e){this._matViewProj=e,Zr.setMat4(this._poolHandle,jr.MAT_VIEW_PROJ,this._matViewProj)}},{key:"matViewProjInv",get:function(){return this._matViewProjInv},set:function(e){this._matViewProjInv=e,Zr.setMat4(this._poolHandle,jr.MAT_VIEW_PROJ_INV,this._matViewProjInv)}},{key:"frustum",get:function(){return this._frustum},set:function(e){this._frustum=e,uu(this._frustumHandle,e)}},{key:"window",get:function(){return this._window},set:function(e){this._window=e,e&&Zr.set(this._poolHandle,jr.WINDOW,e.handle)}},{key:"forward",get:function(){return this._forward},set:function(e){this._forward=e,Zr.setVec3(this._poolHandle,jr.FORWARD,this._forward)}},{key:"position",get:function(){return this._position},set:function(e){this._position=e,Zr.setVec3(this._poolHandle,jr.POSITION,this._position)}},{key:"visibility",get:function(){return Zr.get(this._poolHandle,jr.VISIBILITY)},set:function(e){Zr.set(this._poolHandle,jr.VISIBILITY,e)}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}},{key:"aperture",get:function(){return this._aperture},set:function(e){this._aperture=e,this._apertureValue=n_[this._aperture],this.updateExposure()}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",get:function(){return this._shutter},set:function(e){this._shutter=e,this._shutterValue=i_[this._shutter],this.updateExposure()}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",get:function(){return this._iso},set:function(e){this._iso=e,this._isoValue=r_[this._iso],this.updateExposure()}},{key:"isoValue",get:function(){return this._isoValue}},{key:"ec",get:function(){return this._ec},set:function(e){this._ec=e}},{key:"exposure",get:function(){return Zr.get(this._poolHandle,jr.EXPOSURE)}},{key:"clearFlag",get:function(){return Zr.get(this._poolHandle,jr.CLEAR_FLAGS)},set:function(e){Zr.set(this._poolHandle,jr.CLEAR_FLAGS,e)}},{key:"clearDepth",get:function(){return Zr.get(this._poolHandle,jr.CLEAR_DEPTH)},set:function(e){Zr.set(this._poolHandle,jr.CLEAR_DEPTH,e)}},{key:"clearStencil",get:function(){return Zr.get(this._poolHandle,jr.CLEAR_STENCIL)},set:function(e){Zr.set(this._poolHandle,jr.CLEAR_STENCIL,e)}},{key:"handle",get:function(){return this._poolHandle}}]),e}();!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD"}(e_||(e_={})),function(e){e[e.NONE=0]="NONE",e[e.POSITION=1]="POSITION",e[e.ROTATION=2]="ROTATION",e[e.SCALE=4]="SCALE",e[e.RS=e.ROTATION|e.SCALE]="RS",e[e.TRS=e.POSITION|e.ROTATION|e.SCALE]="TRS",e[e.TRS_MASK=~e.TRS]="TRS_MASK"}(t_||(t_={})),i.internal.TransformBit=t_;var h_=function(){function e(e){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._batches=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._mainLight=null,this._modelId=0,this._scenePoolHandle=0,this._modelArrayHandle=0,this._batchArrayHandle=0,this._sphereLightsHandle=0,this._spotLightsHandle=0,this._root=e,this._createHandles()}e.registerCreateFunc=function(t){t._createSceneFun=function(t){return new e(t)}};var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._createHandles(),!0},t.update=function(e){var t=this._mainLight;t&&t.update();for(var n=this._sphereLights,i=0;i<n.length;i++)n[i].update();for(var r=this._spotLights,o=0;o<r.length;o++)r[o].update();for(var a=this._models,s=0;s<a.length;s++){var c=a[s];c.enabled&&(c.updateTransform(e),c.updateUBOs(e))}},t.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeModels(),this._modelArrayHandle&&(Tr.free(this._modelArrayHandle),this._modelArrayHandle=0),this._scenePoolHandle&&(Xr.free(this._scenePoolHandle),this._scenePoolHandle=0),this._sphereLightsHandle&&(Cr.free(this._sphereLightsHandle),this._sphereLightsHandle=0),this._spotLightsHandle&&(Cr.free(this._spotLightsHandle),this._spotLightsHandle=0),this._batchArrayHandle&&(wr.free(this._batchArrayHandle),this._batchArrayHandle=0)},t.addCamera=function(e){e.attachToScene(this),this._cameras.push(e)},t.removeCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return this._cameras.splice(t,1),void e.detachFromScene()},t.removeCameras=function(){for(var e,t=$(this._cameras);!(e=t()).done;)e.value.detachFromScene();this._cameras.splice(0)},t.setMainLight=function(e){this._mainLight=e,Xr.set(this._scenePoolHandle,kr.MAIN_LIGHT,e.handle)},t.unsetMainLight=function(e){if(this._mainLight===e){var t=this._directionalLights;t.length?(this._mainLight=t[t.length-1],this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=t_.ROTATION)):this._mainLight=null}},t.addDirectionalLight=function(e){e.attachToScene(this),this._directionalLights.push(e)},t.removeDirectionalLight=function(e){for(var t=0;t<this._directionalLights.length;++t)if(this._directionalLights[t]===e)return e.detachFromScene(),void this._directionalLights.splice(t,1)},t.addSphereLight=function(e){e.attachToScene(this),this._sphereLights.push(e),Cr.push(this._sphereLightsHandle,e.handle)},t.removeSphereLight=function(e){for(var t=0;t<this._sphereLights.length;++t)if(this._sphereLights[t]===e)return e.detachFromScene(),this._sphereLights.splice(t,1),void Cr.erase(this._sphereLightsHandle,t)},t.addSpotLight=function(e){e.attachToScene(this),this._spotLights.push(e),Cr.push(this._spotLightsHandle,e.handle)},t.removeSpotLight=function(e){for(var t=0;t<this._spotLights.length;++t)if(this._spotLights[t]===e)return e.detachFromScene(),this._spotLights.splice(t,1),void Cr.erase(this._spotLightsHandle,t)},t.removeSphereLights=function(){for(var e=0;e<this._sphereLights.length;++e)this._sphereLights[e].detachFromScene();this._sphereLights.length=0,Cr.clear(this._sphereLightsHandle)},t.removeSpotLights=function(){for(var e=0;e<this._spotLights.length;++e)this._spotLights[e].detachFromScene();this._spotLights=[],Cr.clear(this._spotLightsHandle)},t.addModel=function(e){e.attachToScene(this),this._models.push(e),Tr.push(this._modelArrayHandle,e.handle)},t.removeModel=function(e){for(var t=0;t<this._models.length;++t)if(this._models[t]===e)return e.detachFromScene(),this._models.splice(t,1),void Tr.erase(this._modelArrayHandle,t)},t.removeModels=function(){for(var e,t=$(this._models);!(e=t()).done;){var n=e.value;n.detachFromScene(),n.destroy()}this._models.length=0,Tr.clear(this._modelArrayHandle)},t.addBatch=function(e){this._batches.push(e),wr.push(this._batchArrayHandle,e.handle)},t.removeBatch=function(e){for(var t=0;t<this._batches.length;++t)if(this._batches[t]===e)return this._batches.splice(t,1),void wr.erase(this._batchArrayHandle,t)},t.removeBatches=function(){this._batches.length=0,wr.clear(this._batchArrayHandle)},t.onGlobalPipelineStateChanged=function(){for(var e,t=$(this._models);!(e=t()).done;)e.value.onGlobalPipelineStateChanged()},t.generateModelId=function(){return this._modelId++},t._createHandles=function(){this._modelArrayHandle||(this._modelArrayHandle=Tr.alloc(),this._scenePoolHandle=Xr.alloc(),Xr.set(this._scenePoolHandle,kr.MODEL_ARRAY,this._modelArrayHandle),this._spotLightsHandle=Cr.alloc(),Xr.set(this._scenePoolHandle,kr.SPOT_LIGHT_ARRAY,this._spotLightsHandle),this._sphereLightsHandle=Cr.alloc(),Xr.set(this._scenePoolHandle,kr.SPHERE_LIGHT_ARRAY,this._sphereLightsHandle)),this._batchArrayHandle||(this._batchArrayHandle=wr.alloc(),Xr.set(this._scenePoolHandle,kr.BATCH_ARRAY_2D,this._batchArrayHandle))},X(e,[{key:"root",get:function(){return this._root}},{key:"name",get:function(){return this._name}},{key:"cameras",get:function(){return this._cameras}},{key:"mainLight",get:function(){return this._mainLight}},{key:"sphereLights",get:function(){return this._sphereLights}},{key:"spotLights",get:function(){return this._spotLights}},{key:"models",get:function(){return this._models}},{key:"handle",get:function(){return this._scenePoolHandle}},{key:"batches",get:function(){return this._batches}}]),e}(),__=function(){},f_=function(){return __},d_=p_((function(){}));function p_(e){return function(t){return"function"==typeof t?e(t):function(n){return e(n,t)}}}function m_(e){return function(t){return function(n){!function(e,t,n){var i=v_(e);if(i){var r=y_(i,"proto");y_(r,"editor")[t]=n}}(n,e,t)}}}var g_="__ccclassCache__";function v_(e){return y_(e,g_)}function y_(e,t){return e[t]||(e[t]={})}var S_=p_((function(e,t){var n=Ke.getSuper(e);n===Object&&(n=null);var i={name:t,extends:n,ctor:e},r=e[g_];if(r){var o=r.proto;o&&Ke.mixin(i,o),e[g_]=void 0}return Wt(i)})),E_=m_("requireComponent"),T_=m_("executionOrder"),x_=d_;function A_(e,t,n){var i=null;function r(e,t,n){var r=v_(e.constructor);if(r){var o=y_(r,"proto"),a=y_(o,"properties");!function(e,t,n,i,r,o){var a,s=r&&(r.get||r.set);i&&(a=Mt(i,s));var c=t[n],l=Ke.mixin(c||{},a||i||{});if(s)r.get&&(l.get=r.get),r.set&&(l.set=r.set);else if(r)r.initializer&&(l.default=function(e){var t;try{t=e()}catch(t){return e}return"object"!=typeof t||null===t?t:e}(r.initializer));else{var u=o.default||(o.default=function(e){var t;try{t=new e}catch(e){return{}}return t}(e));u.hasOwnProperty(n)&&(l.default=u[n])}t[n]=l}(e.constructor,a,t,i,n,r)}}return void 0===e?A_({type:void 0}):void 0===t?(i=e,r):void r(e,t,n)}var C_=function(e,t,n){return A_(((i={}).__noImplicit=!0,"serializable"in i||(i.serializable=!0),i))(e,t,n);var i},b_=function(e,t,n){return A_({editorOnly:!0})(e,t,n)},w_=d_,R_=f_,I_=d_,P_=f_,O_=f_,D_=f_,N_=__,M_=f_,L_=f_,B_=f_,F_=f_,z_=f_,U_=f_,H_=f_,G_=__,k_=f_,V_=__,W_=__,j_=K_(At),q_=K_(Ct),X_=K_(bt),Y_=K_(wt);function K_(e){return A_({type:e})}var Z_=function(e,t,n){return A_({__noImplicit:!0,override:!0})(e,t,n)},Q_=function(){function e(e){this._map=null,this._count=0,e?(this._map=e,this._count=Object.keys(e).length):(this._map=Ke.createMap(!0),this._count=0)}var t=e.prototype;return t.add=function(e,t){return e in this._map||this._count++,this._map[e]=t},t.get=function(e){return this._map[e]},t.has=function(e){return e in this._map},t.remove=function(e){var t=this._map[e];return e in this._map&&(delete this._map[e],this._count--),t},t.clear=function(){0!==this._count&&(this._map=Ke.createMap(!0),this._count=0)},t.forEach=function(e){for(var t in this._map)e(this._map[t],t)},t.find=function(e){for(var t in this._map)if(e(this._map[t],t))return this._map[t];return null},t.destroy=function(){this._map=null},X(e,[{key:"count",get:function(){return this._count}}]),e}(),J_=function(){function e(t,n){this.id=e._pipelineId++,this.name="",this.pipes=[],this.name=t;for(var i=0,r=n.length;i<r;i++)this.pipes.push(n[i])}var t=e.prototype;return t.insert=function(e,t){return t>this.pipes.length?(A(4921),this):(this.pipes.splice(t,0,e),this)},t.append=function(e){return this.pipes.push(e),this},t.remove=function(e){return this.pipes.splice(e,1),this},t.sync=function(e){var t=this.pipes;if(0===t.length)return null;e.isFinish=!1;for(var n=0,i=t.length;n<i;){var r=(0,t[n])(e);if(r)return e.isFinish=!0,r;++n!==i&&(e.input=e.output,e.output=null)}return e.isFinish=!0,e.output},t.async=function(e){0!==this.pipes.length&&(e.isFinish=!1,this._flow(0,e))},t._flow=function(e,t){var n=this;(0,this.pipes[e])(t,(function(i){i?(t.isFinish=!0,t.dispatch("complete",i)):++e<n.pipes.length?(t.input=t.output,t.output=null,n._flow(e,t)):(t.isFinish=!0,t.dispatch("complete",i,t.output))}))},e}();J_._pipelineId=0;var $_,ef=new Q_,tf=new Q_,nf=new Q_,rf=new Q_,of=new J_("normal load",[]),af=new J_("fetch",[]),sf=new J_("transform url",[]);!function(e){e.UUID="uuid",e.PATH="path",e.DIR="dir",e.URL="url",e.SCENE="scene"}($_||($_={}));var cf,lf={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(e){e.RESOURCES="resources",e.MAIN="main",e.START_SCENE="start-scene"}(cf||(cf={}));var uf=function(){function e(t){this.id=e._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(t)}e.create=function(t){var n;return 0!==e._deadPool.length?(n=e._deadPool.pop()).set(t):n=new e(t),n};var t=e.prototype;return t.set=function(e){void 0===e&&(e=Object.create(null)),this.onComplete=e.onComplete||null,this.onProgress=e.onProgress||null,this.onError=e.onError||null,this.source=this.input=e.input,this.output=null,this.progress=e.progress,this.options=e.options||Object.create(null)},t.dispatch=function(e,t,n,i,r){switch(e){case"complete":this.onComplete&&this.onComplete(t,n);break;case"progress":this.onProgress&&this.onProgress(t,n,i,r);break;case"error":this.onError&&this.onError(t,n,i,r);break;default:var o="on"+e[0].toUpperCase()+e.substr(1);"function"==typeof this[o]&&this[o](t,n,i,r)}},t.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,e._deadPool.push(this))},e}();uf.MAX_DEAD_NUM=500,uf._taskId=0,uf._deadPool=[];var hf="0123456789abcdef".split(""),_f=["","","",""],ff=_f.concat(_f,"-",_f,"-",_f,"-",_f,"-",_f,_f,_f),df=ff.map((function(e,t){return"-"===e?NaN:t})).filter(isFinite);function pf(e){var t=e.split("@")[0];if(22!==t.length)return e;ff[0]=e[0],ff[1]=e[1];for(var n=2,i=2;n<22;n+=2){var r=st[e.charCodeAt(n)],o=st[e.charCodeAt(n+1)];ff[df[i++]]=hf[r>>2],ff[df[i++]]=hf[(3&r)<<2|o>>4],ff[df[i++]]=hf[15&o]}return e.replace(t,ff.join(""))}var mf=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function gf(e){var t=mf.exec(e);return t?t[1]:""}function vf(e,t){(t=t||Object.create(null)).__isNative__=t.isNative,t.ext=t.nativeExt;var n=rf.find((function(t){return!!t.getAssetInfo(e)}));return n&&(t.bundle=n.name),Ef(e,t)}function yf(e){return e&&(e instanceof i.SceneAsset||e instanceof i.Scene)}function Sf(e){return e&&(46===e.charCodeAt(0)&&47===e.charCodeAt(1)?e=e.slice(2):47===e.charCodeAt(0)&&(e=e.slice(1))),e}function Ef(e,t){var n=uf.create({input:e,options:t}),i=[];try{for(var r,o=$(sf.sync(n));!(r=o()).done;){var a=r.value,s=a.url;a.recycle(),i.push(s)}}catch(e){for(var c,l=$(n.output);!(c=l()).done;)c.value.recycle();p(e.message,e.stack)}return n.recycle(),i.length>1?i:i[0]}var Tf,xf,Af,Cf,bf=Object.freeze({__proto__:null,getUuidFromURL:gf,getUrlWithUuid:vf,isScene:yf,normalize:Sf,transform:Ef,decodeUuid:pf}),wf=e("Event",function(){function e(e,t){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=e,this.bubbles=!!t}var t=e.prototype;return t.unuse=function(){this.type=e.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=e.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},t.reuse=function(e,t){this.type=e,this.bubbles=t||!1},t.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},t.getCurrentTarget=function(){return this.currentTarget},t.getType=function(){return this.type},e}());wf.NO_TYPE="no_type",wf.TOUCH="touch",wf.MOUSE="mouse",wf.KEYBOARD="keyboard",wf.ACCELERATION="acceleration",wf.NONE=0,wf.CAPTURING_PHASE=1,wf.AT_TARGET=2,wf.BUBBLING_PHASE=3,i.Event=wf;var Rf=e("Asset",S_("cc.Asset")((Cf=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).loaded=!0,ee(t,"_native",Af,Q(t)),t._nativeUrl="",t.__onLoadedInvoked__=!1,t.__nativeDepend__=null,t.__depends__=null,t._file=null,t._ref=0,Object.defineProperty(Q(t),"_uuid",{value:"",writable:!0}),t}K(t,e),t.deserialize=function(e){return i.deserialize(e)};var n=t.prototype;return n.toString=function(){return this.nativeUrl},n.serialize=function(){},n._setRawAsset=function(e,t){void 0===t&&(t=!0),this._native=!1!==t?e||"":"/"+e},n.addRef=function(){return this._ref++,this},n.decRef=function(e){return void 0===e&&(e=!0),this._ref>0&&this._ref--,e&&i.assetManager._releaseManager.tryRelease(this),this},n.onLoaded=function(){},n.initDefault=function(e){e&&(this._uuid=e),this.isDefault=!0},n.validate=function(){return!0},X(t,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var e=this._native;if(47===e.charCodeAt(0))return e.slice(1);46===e.charCodeAt(0)?this._nativeUrl=vf(this._uuid,{nativeExt:e,isNative:!0}):this._nativeUrl=vf(this._uuid,{__nativeName__:e,nativeExt:Ai(e),isNative:!0})}return this._nativeUrl}},{key:"_nativeAsset",get:function(){return this._file},set:function(e){this._file=e}},{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),t}(ui(ei)),Af=te((xf=Cf).prototype,"_native",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),te(xf.prototype,"_nativeAsset",[A_],Object.getOwnPropertyDescriptor(xf.prototype,"_nativeAsset"),xf.prototype),Tf=xf))||Tf);Rf.prototype.createNode=null,i.Asset=Rf;var If,Pf,Of,Df,Nf,Mf,Lf,Bf=1024;function Ff(e){return i.sys.capabilities.imageBitmap&&e instanceof ImageBitmap}!function(e){e[e.RGB565=ya.R5G6B5]="RGB565",e[e.RGB5A1=ya.RGB5A1]="RGB5A1",e[e.RGBA4444=ya.RGBA4]="RGBA4444",e[e.RGB888=ya.RGB8]="RGB888",e[e.RGB32F=ya.RGB32F]="RGB32F",e[e.RGBA8888=ya.RGBA8]="RGBA8888",e[e.RGBA32F=ya.RGBA32F]="RGBA32F",e[e.A8=ya.A8]="A8",e[e.I8=ya.L8]="I8",e[e.AI8=ya.LA8]="AI8",e[e.RGB_PVRTC_2BPPV1=ya.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",e[e.RGBA_PVRTC_2BPPV1=ya.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",e[e.RGB_A_PVRTC_2BPPV1=Bf++]="RGB_A_PVRTC_2BPPV1",e[e.RGB_PVRTC_4BPPV1=ya.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",e[e.RGBA_PVRTC_4BPPV1=ya.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",e[e.RGB_A_PVRTC_4BPPV1=Bf++]="RGB_A_PVRTC_4BPPV1",e[e.RGB_ETC1=ya.ETC_RGB8]="RGB_ETC1",e[e.RGBA_ETC1=Bf++]="RGBA_ETC1",e[e.RGB_ETC2=ya.ETC2_RGB8]="RGB_ETC2",e[e.RGBA_ETC2=ya.ETC2_RGBA8]="RGBA_ETC2",e[e.RGBA_ASTC_4x4=ya.ASTC_RGBA_4x4]="RGBA_ASTC_4x4",e[e.RGBA_ASTC_5x4=ya.ASTC_RGBA_5x4]="RGBA_ASTC_5x4",e[e.RGBA_ASTC_5x5=ya.ASTC_RGBA_5x5]="RGBA_ASTC_5x5",e[e.RGBA_ASTC_6x5=ya.ASTC_RGBA_6x5]="RGBA_ASTC_6x5",e[e.RGBA_ASTC_6x6=ya.ASTC_RGBA_6x6]="RGBA_ASTC_6x6",e[e.RGBA_ASTC_8x5=ya.ASTC_RGBA_8x5]="RGBA_ASTC_8x5",e[e.RGBA_ASTC_8x6=ya.ASTC_RGBA_8x6]="RGBA_ASTC_8x6",e[e.RGBA_ASTC_8x8=ya.ASTC_RGBA_8x8]="RGBA_ASTC_8x8",e[e.RGBA_ASTC_10x5=ya.ASTC_RGBA_10x5]="RGBA_ASTC_10x5",e[e.RGBA_ASTC_10x6=ya.ASTC_RGBA_10x6]="RGBA_ASTC_10x6",e[e.RGBA_ASTC_10x8=ya.ASTC_RGBA_10x8]="RGBA_ASTC_10x8",e[e.RGBA_ASTC_10x10=ya.ASTC_RGBA_10x10]="RGBA_ASTC_10x10",e[e.RGBA_ASTC_12x10=ya.ASTC_RGBA_12x10]="RGBA_ASTC_12x10",e[e.RGBA_ASTC_12x12=ya.ASTC_RGBA_12x12]="RGBA_ASTC_12x12"}(If||(If={})),function(e){e[e.REPEAT=Oa.WRAP]="REPEAT",e[e.CLAMP_TO_EDGE=Oa.CLAMP]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=Oa.MIRROR]="MIRRORED_REPEAT",e[e.CLAMP_TO_BORDER=Oa.BORDER]="CLAMP_TO_BORDER"}(Pf||(Pf={})),function(e){e[e.NONE=Pa.NONE]="NONE",e[e.LINEAR=Pa.LINEAR]="LINEAR",e[e.NEAREST=Pa.POINT]="NEAREST"}(Of||(Of={}));var zf,Uf=e("ImageAsset",S_("cc.ImageAsset")((Lf=Mf=function(e){function t(t){var n;return(n=e.call(this)||this)._nativeData=void 0,n._tex=void 0,n._exportedExts=void 0,n._format=If.RGBA8888,n._width=0,n._height=0,n.loaded=!1,n._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==t&&n.reset(t),n}K(t,e);var n=t.prototype;return n.reset=function(e){var t=this;Ff(e)?(this._nativeData=e,this._onDataComplete()):e instanceof HTMLElement?(this._nativeData=e,e.complete||e instanceof HTMLCanvasElement?this._onDataComplete():(this.loaded=!1,e.addEventListener("load",(function(){t._onDataComplete()})),e.addEventListener("error",(function(e){A(3119,e.message)})))):(this._nativeData=e,this._format=e.format,this._onDataComplete())},n.destroy=function(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset("")):Ff(this.data)&&this.data.close&&this.data.close(),e.prototype.destroy.call(this)},n._serialize=function(){},n._deserialize=function(e){var n="";"string"==typeof e?n=e:(this._width=e.w,this._height=e.h,n=e.fmt);for(var r,o=i.director.root?i.director.root.device:null,a=n.split("_"),s="",c=Number.MAX_VALUE,l=this._format,u="",h=i.macro.SUPPORT_TEXTURE_FORMATS,_=$(a);!(r=_()).done;){var f=r.value.split("@"),d=parseInt(f[0],void 0),p=t.extnames[d]||f[0],m=h.indexOf(p);if(-1!==m&&m<c){var g=f[1]?parseInt(f[1]):this._format;if(!(".astc"!==p||o&&o.hasFeature(va.FORMAT_ASTC)))continue;if(!(".pvr"!==p||o&&o.hasFeature(va.FORMAT_PVRTC)))continue;if(!(g!==If.RGB_ETC1&&g!==If.RGBA_ETC1||o&&o.hasFeature(va.FORMAT_ETC1)))continue;if(!(g!==If.RGB_ETC2&&g!==If.RGBA_ETC2||o&&o.hasFeature(va.FORMAT_ETC2)))continue;if(".webp"===p&&!i.sys.capabilities.webp)continue;c=m,u=p,l=g}else s||(s=p)}u?(this._setRawAsset(u),this._format=l):s?(this._setRawAsset(s),A(3120,s,s)):A(3121)},n._onDataComplete=function(){this.loaded=!0,this.emit("load")},n.initDefault=function(n){if(e.prototype.initDefault.call(this,n),t._sharedPlaceHolderCanvas)this.reset(t._sharedPlaceHolderCanvas);else{var i=document.createElement("canvas"),r=i.getContext("2d"),o=i.width=i.height=2;r.fillStyle="#ff00ff",r.fillRect(0,0,o,o),this.reset(i),t._sharedPlaceHolderCanvas=i}},n.validate=function(){return!!this.data},X(t,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(e){e instanceof HTMLElement||Ff(e)||(e.format=e.format||this._format),this.reset(e)}},{key:"data",get:function(){return this._nativeData&&((e=this._nativeData)instanceof HTMLImageElement||e instanceof HTMLCanvasElement||Ff(e))?this._nativeData:this._nativeData&&this._nativeData._data;var e}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=If.RGB_ETC1&&this._format<=If.RGBA_ASTC_12x12||this._format>=If.RGB_A_PVRTC_2BPPV1&&this._format<=If.RGBA_ETC1}},{key:"url",get:function(){return this.nativeUrl}},{key:"_texture",get:function(){if(!this._tex){var e=new i.Texture2D;e.name=this.nativeUrl,e.image=this,this._tex=e}return this._tex},set:function(e){this._tex=e}}]),t}(Rf),Mf.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],Mf._sharedPlaceHolderCanvas=null,te((Nf=Lf).prototype,"_nativeAsset",[Z_],Object.getOwnPropertyDescriptor(Nf.prototype,"_nativeAsset"),Nf.prototype),Df=Nf))||Df);i.ImageAsset=Uf,function(e){e[e.minFilter=0]="minFilter",e[e.magFilter=1]="magFilter",e[e.mipFilter=2]="mipFilter",e[e.addressU=3]="addressU",e[e.addressV=4]="addressV",e[e.addressW=5]="addressW",e[e.maxAnisotropy=6]="maxAnisotropy",e[e.cmpFunc=7]="cmpFunc",e[e.mipLODBias=8]="mipLODBias",e[e.total=9]="total"}(zf||(zf={}));var Hf=[Pa.LINEAR,Pa.LINEAR,Pa.NONE,Oa.WRAP,Oa.WRAP,Oa.WRAP,0,Da.NEVER,0],Gf=Wf(Hf),kf=new fs,Vf=new Ts;function Wf(e){for(var t=0,n=0,i=0;i<Hf.length;i++)switch(t=e[i]||Hf[i],i){case zf.minFilter:n|=t;break;case zf.magFilter:n|=t<<2;break;case zf.mipFilter:n|=t<<4;break;case zf.addressU:n|=t<<6;break;case zf.addressV:n|=t<<8;break;case zf.addressW:n|=t<<10;break;case zf.maxAnisotropy:n|=t<<12;break;case zf.cmpFunc:n|=t<<16;break;case zf.mipLODBias:n|=t<<28}return n}var jf,qf,Xf,Yf,Kf,Zf,Qf,Jf,$f,ed,td,nd,id=new(function(){function e(){this._cache={}}return e.prototype.getSampler=function(e,t){return t||(t=Gf),this._cache[t]||(Vf.minFilter=3&t,Vf.magFilter=t>>2&3,Vf.mipFilter=t>>4&3,Vf.addressU=t>>6&3,Vf.addressV=t>>8&3,Vf.addressW=t>>10&3,Vf.maxAnisotropy=t>>12&15,Vf.cmpFunc=t>>16&15,Vf.mipLODBias=t>>28&15,Vf.borderColor=kf,this._cache[t]=e.createSampler(Vf))},e}());i.samplerLib=id;var rd=new ce("Tex"),od=S_("cc.TextureBase")((nd=td=function(e){function t(){var t;return ee(t=e.call(this)||this,"_format",Xf,Q(t)),ee(t,"_minFilter",Yf,Q(t)),ee(t,"_magFilter",Kf,Q(t)),ee(t,"_mipFilter",Zf,Q(t)),ee(t,"_wrapS",Qf,Q(t)),ee(t,"_wrapT",Jf,Q(t)),ee(t,"_wrapR",$f,Q(t)),ee(t,"_anisotropy",ed,Q(t)),t._width=1,t._height=1,t._id=void 0,t._samplerInfo=[],t._samplerHash=0,t._gfxSampler=null,t._gfxDevice=null,t._textureHash=0,t._id=rd.getNewId(),t.loaded=!1,t._gfxDevice=t._getGFXDevice(),t._textureHash=mc(t._id,666),t}K(t,e);var n=t.prototype;return n.getId=function(){return this._id},n.getPixelFormat=function(){return this._format},n.getAnisotropy=function(){return this._anisotropy},n.setWrapMode=function(e,t,n){this._wrapS=e,this._samplerInfo[zf.addressU]=e,this._wrapT=t,this._samplerInfo[zf.addressV]=t,void 0!==n&&(this._wrapR=n,this._samplerInfo[zf.addressW]=n),this._samplerHash=Wf(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=id.getSampler(this._gfxDevice,this._samplerHash))},n.setFilters=function(e,t){this._minFilter=e,this._samplerInfo[zf.minFilter]=e,this._magFilter=t,this._samplerInfo[zf.magFilter]=t,this._samplerHash=Wf(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=id.getSampler(this._gfxDevice,this._samplerHash))},n.setMipFilter=function(e){this._mipFilter=e,this._samplerInfo[zf.mipFilter]=e,this._samplerHash=Wf(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=id.getSampler(this._gfxDevice,this._samplerHash))},n.setAnisotropy=function(e){this._anisotropy=e,this._samplerInfo[zf.maxAnisotropy]=e,this._samplerHash=Wf(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=id.getSampler(this._gfxDevice,this._samplerHash))},n.destroy=function(){var t=e.prototype.destroy.call(this);return t&&i.director.root&&i.director.root.batcher2D&&i.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),t},n.getHash=function(){return this._textureHash},n.getGFXTexture=function(){return null},n.getSamplerHash=function(){return this._samplerHash},n.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=id.getSampler(this._gfxDevice,this._samplerHash):b(9302)),this._gfxSampler},n._serialize=function(){return""},n._deserialize=function(e){var t=e.split(",");t.unshift(""),t.length>=5&&(this.setFilters(parseInt(t[1]),parseInt(t[2])),this.setWrapMode(parseInt(t[3]),parseInt(t[4]))),t.length>=7&&(this.setMipFilter(parseInt(t[5])),this.setAnisotropy(parseInt(t[6])))},n._getGFXDevice=function(){return i.director.root?i.director.root.device:null},n._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},n._setGFXFormat=function(e){this._format=void 0===e?If.RGBA8888:e},n._getGFXPixelFormat=function(e){return e===If.RGBA_ETC1?e=If.RGB_ETC1:e===If.RGB_A_PVRTC_4BPPV1?e=If.RGB_PVRTC_4BPPV1:e===If.RGB_A_PVRTC_2BPPV1&&(e=If.RGB_PVRTC_2BPPV1),e},X(t,[{key:"isCompressed",get:function(){return this._format>=If.RGB_ETC1&&this._format<=If.RGBA_ASTC_12x12||this._format>=If.RGB_A_PVRTC_2BPPV1&&this._format<=If.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),t}(Rf),td.PixelFormat=If,td.WrapMode=Pf,td.Filter=Of,Xf=te((qf=nd).prototype,"_format",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return If.RGBA8888}}),Yf=te(qf.prototype,"_minFilter",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Of.LINEAR}}),Kf=te(qf.prototype,"_magFilter",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Of.LINEAR}}),Zf=te(qf.prototype,"_mipFilter",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Of.NONE}}),Qf=te(qf.prototype,"_wrapS",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pf.REPEAT}}),Jf=te(qf.prototype,"_wrapT",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pf.REPEAT}}),$f=te(qf.prototype,"_wrapR",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pf.REPEAT}}),ed=te(qf.prototype,"_anisotropy",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jf=qf))||jf;i.TextureBase=od;var ad=[zn,yn,kn,bn,gn,jn,Xn,Mn];function sd(e,t){e.x=t[1],e.y=t[2],e.z=t[3],e.w=t[4]}var cd=[function(e,t){e.x=t[1],e.y=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.z=t[3]},sd,sd,function(e,t){e._val=t[1]},function(e,t){e.width=t[1],e.height=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.width=t[3],e.height=t[4]},function(e,t){Mn.fromArray(e,t,1)}],ld=e("Details",function(){function e(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}var t=e.prototype;return t.init=function(e){this.uuidObjList=e[8],this.uuidPropList=e[9],this.uuidList=e[10]},t.reset=function(){this.uuidList=null,this.uuidObjList=null,this.uuidPropList=null},t.push=function(e,t,n,i){this.uuidObjList.push(e),this.uuidPropList.push(t),this.uuidList.push(n),this.uuidTypeList.push(i||"")},e}());function ud(e,t){for(var n=e[4][t[0]],i=n[0],r=new(0,i[0]),o=i[1],a=i[2],s=n[n.length-1],c=1;c<s;++c)r[o[n[c]]]=t[c];for(;c<t.length;++c){var l=o[n[c]],u=i[n[c]+a];(0,md[u])(e,r,l,t[c])}return r}function hd(e,t,n){var i=new t;return i._deserialize?i._deserialize(n,e[0]):b(5303,Ee(t)),i}function _d(e,t,n,i){i>=0?t[n]=e[5][i]:e[7][3*~i]=t}function fd(e){return function(t,n,i,r){n[i]=r;for(var o=0;o<r.length;++o)e(t,r,o,r[o])}}function dd(e,t,n,i){t[n]=null,e[8][i]=t}function pd(e,t,n,i){t[n]=ud(e,i)}ld.pool=new Xe((function(e){e.reset()}),5),ld.pool.get=function(){return this._get()||new ld};var md=new Array(13);function gd(e,t){return e||Ed.reportMissingClass(t),Object}function vd(e,t,n,i,r,o){var a=e(t);if(!a){if(r)return void(n[i]=function(t,n,i){return function(){var r=e(i)||gd(o,i);return t[n]=r,new r}}(n,i,t));a=gd(o,t)}n[i]=a}function yd(e,t,n){for(var i=n||We,r=e[3],o=0;o<r.length;++o){var a=r[o];"string"!=typeof a?vd(i,a[0],a,0,t,n):vd(i,a,r,o,t,n)}}function Sd(e){var t=e[4];if(t)for(var n=e[3],i=0;i<t.length;++i){var r=t[i];r[0]=n[r[0]]}}function Ed(e,t,n){"string"==typeof e&&(e=JSON.parse(e));var r,o=!t;(t=t||ld.pool.get()).init(e),n=n||{};var a=e[0],s=!1;if("object"==typeof a&&(s=a.preprocessed,a=a.version),a<1)throw new Error(P(5304,a));n._version=a,n.result=t,e[0]=n,s||(yd(e,!1,n.classFinder),Sd(e)),i.game._isCloning=!0;var c=e[5],l=function(e){var t=e[5],n=e[6],i=0===n?0:n.length,r=t[t.length-1],o=t.length-i;"number"!=typeof r?r=0:(r<0&&(r=~r),--o);for(var a=0;a<o;++a)t[a]=ud(e,t[a]);for(var s=e[3],c=0;c<i;++c,++a){var l=n[c],u=t[a];if(l>=0){var h=s[l];t[a]=hd(e,h,u)}else(0,md[l=~l])(e,t,a,u)}return r}(e);return i.game._isCloning=!1,e[7]&&function(e,t,n){for(var i=e.length-1,r=0,o=3*e[i];r<o;r+=3){var a=e[r],s=t[e[r+2]],c=e[r+1];c>=0?a[n[c]]=s:a[~c]=s}for(;r<i;r+=3){var l=t[e[r]],u=t[e[r+2]],h=e[r+1];h>=0?l[n[h]]=u:l[~h]=u}}(e[7],c,e[2]),function(e){for(var t=e[5],n=e[2],i=e[1],r=e[8],o=e[9],a=e[10],s=0;s<r.length;++s){var c=r[s];"number"==typeof c&&(r[s]=t[c]);var l=o[s];"number"==typeof l&&(l=l>=0?n[l]:~l,o[s]=l);var u=a[s];"number"==typeof u&&(a[s]=i[u])}}(e),r=c[l],o&&ld.pool.put(t),r}md[0]=function(e,t,n,i){t[n]=i},md[1]=_d,md[2]=fd(_d),md[3]=fd(dd),md[4]=pd,md[5]=function(e,t,n,i){cd[i[0]](t[n],i)},md[6]=dd,md[7]=function(e,t,n,i){t[n].set(i)},md[8]=function(e,t,n,i){var r=new ad[i[0]];cd[i[0]](r,i),t[n]=r},md[9]=fd(pd),md[10]=function(e,t,n,i){var r=e[3][i[0]];t[n]=hd(e,r,i[1])},md[11]=function(e,t,n,i){var r=i[0];t[n]=r;for(var o=1;o<i.length;o+=3){var a=i[o],s=i[o+1],c=i[o+2];(0,md[s])(e,r,a,c)}},md[12]=function(e,t,n,i){var r=i[0];t[n]=r;for(var o=0;o<r.length;++o){var a=r[o],s=i[o+1];0!==s&&(0,md[s])(e,r,o,a)}},Ed.Details=ld,Ed.reportMissingClass=function(e){A(5302,e)};var Td,xd,Ad,Cd=function(e){this.preprocessed=!0,this.version=e};function bd(e,t,n){return[1,0,0,[e],0,n?[t,-1]:[t],[0],0,[],[],[]]}i.deserialize=Ed;var wd=e("Script",S_("cc.Script")(Td=function(e){function t(){return e.apply(this,arguments)||this}return K(t,e),t}(Rf))||Td);i._Script=wd;var Rd=e("JavaScript",S_("cc.JavaScript")(xd=function(e){function t(){return e.apply(this,arguments)||this}return K(t,e),t}(wd))||xd);i._JavaScript=Rd;var Id,Pd,Od,Dd,Nd,Md,Ld,Bd,Fd,zd,Ud,Hd=e("TypeScript",S_("cc.TypeScript")(Ad=function(e){function t(){return e.apply(this,arguments)||this}return K(t,e),t}(wd))||Ad);i._TypeScript=Hd;var Gd,kd,Vd,Wd,jd=new ce("Comp"),qd=ei.Flags.IsOnLoadCalled,Xd=e("Component",(Id=S_("cc.Component"),Pd=L_(),Od=K_(wd),Dd=B_(),Id((Ud=zd=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"node",Ld,Q(t)),ee(t,"_enabled",Bd,Q(t)),ee(t,"__prefab",Fd,Q(t)),t._sceneGetter=null,t._id=jd.getNewId(),t}K(t,e);var n=t.prototype;return n._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene._renderScene},n.addComponent=function(e){return this.node.addComponent(e)},n.getComponent=function(e){return this.node.getComponent(e)},n.getComponents=function(e){return this.node.getComponents(e)},n.getComponentInChildren=function(e){return this.node.getComponentInChildren(e)},n.getComponentsInChildren=function(e){return this.node.getComponentsInChildren(e)},n.destroy=function(){return!!e.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&i.director._compScheduler.disableComp(this),!0)},n._onPreDestroy=function(){this.unscheduleAllCallbacks(),i.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},n._instantiate=function(e){return e||(e=i.instantiate._clone(this,this)),e&&(e.node=null),e},n.schedule=function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=i.macro.REPEAT_FOREVER),void 0===r&&(r=0),I(e,1619),I((t=t||0)>=0,1620),n=Number.isNaN(n)?i.macro.REPEAT_FOREVER:n,r=r||0;var o=i.director.getScheduler(),a=o.isTargetPaused(this);o.schedule(e,this,t,n,r,a)},n.scheduleOnce=function(e,t){void 0===t&&(t=0),this.schedule(e,0,0,t)},n.unschedule=function(e){e&&i.director.getScheduler().unschedule(e,this)},n.unscheduleAllCallbacks=function(){i.director.getScheduler().unscheduleAllForTarget(this)},X(t,[{key:"name",get:function(){if(this._name)return this._name;var e=Ee(this),t=e.lastIndexOf(".");return t>=0&&(e=e.slice(t+1)),this.node.name+"<"+e+">"},set:function(e){this._name=e}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(this._enabled=e,this.node.activeInHierarchy)){var t=i.director._compScheduler;e?t.enableComp(this):t.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&qd}}]),t}(ei),zd.system=null,te((Md=Ud).prototype,"__scriptAsset",[Pd,Od,Dd,W_],Object.getOwnPropertyDescriptor(Md.prototype,"__scriptAsset"),Md.prototype),Ld=te(Md.prototype,"node",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bd=te(Md.prototype,"_enabled",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Fd=te(Md.prototype,"__prefab",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nd=Md))||Nd)),Yd=Xd.prototype;Yd.update=null,Yd.lateUpdate=null,Yd.__preload=null,Yd.onLoad=null,Yd.start=null,Yd.onEnable=null,Yd.onDisable=null,Yd.onDestroy=null,Yd.onFocusInEditor=null,Yd.onLostFocusInEditor=null,Yd.resetInEditor=null,Yd._getLocalBounds=null,Yd.onRestore=null,Xd._requireComponent=null,Xd._executionOrder=0,me(Xd,"_registerEditorProps",(function(e,t){var n=t.requireComponent;n&&(e._requireComponent=n);var i=t.executionOrder;i&&"number"==typeof i&&(e._executionOrder=i)})),i.Component=Xd;var Kd=e("MissingScript",S_("cc.MissingScript")(Gd=P_()((Wd=function(e){function t(){var t;return ee(t=e.call(this)||this,"_$erialized",Vd,Q(t)),t}return K(t,e),t.safeFindClass=function(e){var t=We(e);if(t)return t;i.deserialize.reportMissingClass(e)},t.prototype.onLoad=function(){A(4600,this.node.name)},t}(Xd),Vd=te((kd=Wd).prototype,"_$erialized",[C_,b_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gd=kd))||Gd)||Gd);function Zd(e,t){var n;n=Kd.safeFindClass;var i,r=ld.pool.get();try{i=Ed(e,r,{classFinder:n,customEnv:t})}catch(e){throw p(e),ld.pool.put(r),e}i._uuid=t.__uuid__||"";for(var o=r.uuidList,a=r.uuidObjList,s=r.uuidPropList,c=r.uuidTypeList||[],l=[],u=0;u<o.length;u++){var h=o[u];l[u]={uuid:pf(h),owner:a[u],prop:s[u],type:Ke._getClassById(c[u])}}return i.__depends__=l,i._native&&(i.__nativeDepend__=!0),ld.pool.put(r),i}i._MissingScript=Kd;var Qd,Jd=new(function(){function e(){this._depends=new Q_}var t=e.prototype;return t.init=function(){this._depends.clear()},t.getNativeDep=function(e){var t=this._depends.get(e);return t&&t.nativeDep?Y({},t.nativeDep):null},t.getDeps=function(e){return this._depends.has(e)?this._depends.get(e).deps:[]},t.getDepsRecursively=function(e){var t=Object.create(null),n=[];return this._descend(e,t,n),n},t.remove=function(e){this._depends.remove(e)},t.parse=function(e,t){var n,i,r=null;if(Array.isArray(t)||t.__type__){if(this._depends.has(e))return this._depends.get(e);if(!Array.isArray(t)||"number"==typeof(i=(n=t[5])[n.length-1])&&i<0)try{var o=Zd(t,{__uuid__:e});(r=this._parseDepsFromAsset(o)).nativeDep&&(r.nativeDep.uuid=e),nf.add(e+"@import",o)}catch(t){tf.remove(e+"@import"),r={deps:[]}}else r={deps:this._parseDepsFromJson(t)}}else{if(this._depends.has(e)&&(r=this._depends.get(e)).parsedFromExistAsset)return r;r=this._parseDepsFromAsset(t)}return this._depends.add(e,r),r},t._parseDepsFromAsset=function(e){for(var t={deps:[],parsedFromExistAsset:!0},n=e.__depends__,i=0,r=n.length;i<r;i++)t.deps.push(n[i].uuid);return e.__nativeDepend__&&(t.nativeDep=e._nativeDep),t},t._parseDepsFromJson=function(e){var t=null;return(t=function(e){var t=e[1];return e[10].map((function(e){return t[e]}))}(e)).forEach((function(e,n){return t[n]=pf(e)})),t},t._descend=function(e,t,n){for(var i=this.getDeps(e),r=0;r<i.length;r++){var o=i[r];t[o]||(t[o]=!0,n.push(o),this._descend(o,t,n))}},e}()),$d=[new hs];function ep(e){return e&&0==(e&e-1)}var tp,np,ip,rp,op,ap,sp=S_("cc.SimpleTexture")(Qd=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gfxTexture=null,t._mipmapLevel=1,t._textureWidth=0,t._textureHeight=0,t}K(t,e);var n=t.prototype;return n.getGFXTexture=function(){return this._gfxTexture},n.destroy=function(){return this._tryDestroyTexture(),e.prototype.destroy.call(this)},n.updateImage=function(){this.updateMipmaps(0)},n.updateMipmaps=function(){},n.uploadData=function(e,t,n){if(void 0===t&&(t=0),void 0===n&&(n=0),this._gfxTexture&&!(this._mipmapLevel<=t)){var i=this._getGFXDevice();if(i){var r=$d[0];r.texExtent.width=this._textureWidth>>t,r.texExtent.height=this._textureHeight>>t,r.texSubres.mipLevel=t,r.texSubres.baseArrayLayer=n,ArrayBuffer.isView(e)?i.copyBuffersToTexture([e],this._gfxTexture,$d):i.copyTexImagesToTexture([e],this._gfxTexture,$d)}}},n._assignImage=function(e,t,n){var r=this,o=function(){var i=e.data;if(i&&(r.uploadData(i,t,n),r._checkTextureLoaded(),nt.CLEANUP_IMAGE_CACHE)){var o=Jd.getDeps(r._uuid),a=o.indexOf(e._uuid);-1!==a&&(re(o,a),e.decRef())}};if(e.loaded)o();else{if(e.once("load",(function(){o()})),!this.isCompressed){var a=i.builtinResMgr.get("black-texture").image;this.uploadData(a.data,t,n)}i.assetManager.postLoadNative(e)}},n._checkTextureLoaded=function(){this._textureReady()},n._textureReady=function(){this.loaded=!0,this.emit("load")},n._setMipmapLevel=function(e){this._mipmapLevel=e<1?1:e},n._getGfxTextureCreateInfo=function(){return null},n._tryReset=function(){if(this._tryDestroyTexture(),0!==this._mipmapLevel){var e=this._getGFXDevice();e&&this._createTexture(e)}},n._createTexture=function(e){if(0!==this._width&&0!==this._height){var t=Ra.NONE;this._mipFilter!==Of.NONE&&function(e,t,n){return!(e.gfxAPI===ma.WEBGL)||ep(t)&&ep(n)}(e,this._width,this._height)&&(this._mipmapLevel=function(e,t){for(var n=Math.max(e,t),i=0;n;)n>>=1,i++;return i}(this._width,this._height),t=Ra.GEN_MIPMAP);var n=this._getGfxTextureCreateInfo({usage:wa.SAMPLED|wa.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:t|Ra.IMMUTABLE});if(n){var i=e.createTexture(n);this._textureWidth=n.width,this._textureHeight=n.height,this._gfxTexture=i}}},n._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},X(t,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),t}(od))||Qd;i.SimpleTexture=sp;var cp,lp,up,hp,_p,fp,dp=e("Texture2D",(tp=S_("cc.Texture2D"),np=K_([Uf]),tp((ap=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_mipmaps",op,Q(t)),t}K(t,e);var n=t.prototype;return n.initialize=function(){this.mipmaps=this._mipmaps},n.onLoaded=function(){this.initialize()},n.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()},n.create=function(e,t,n,i){void 0===n&&(n=If.RGBA8888),void 0===i&&(i=1),this.reset({width:e,height:t,format:n,mipmapLevel:i})},n.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},n.updateMipmaps=function(e,t){if(void 0===e&&(e=0),!(e>=this._mipmaps.length))for(var n=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e),i=0;i<n;++i){var r=e+i;this._assignImage(this._mipmaps[r],r)}},n.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},n.destroy=function(){return this._mipmaps=[],e.prototype.destroy.call(this)},n.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},n.releaseTexture=function(){this.destroy()},n._serialize=function(){return null},n._deserialize=function(t,n){var i=t;e.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r)if(this._mipmaps[r]=new Uf,i.mipmaps[r]){var o=i.mipmaps[r];n.result.push(this._mipmaps,""+r,o,Ke._getClassId(Uf)),this._mipmaps[r]._texture=this}},n._getGfxTextureCreateInfo=function(e){var t=new Ss(ba.TEX2D);return t.width=this._width,t.height=this._height,Object.assign(t,e)},n._checkTextureLoaded=function(){for(var t=!0,n=0;n<this._mipmaps.length;++n)if(!this._mipmaps[n].loaded){t=!1;break}t&&e.prototype._textureReady.call(this)},n.initDefault=function(t){e.prototype.initDefault.call(this,t);var n=new Uf;n.initDefault(),this.image=n},n.validate=function(){return this.mipmaps&&0!==this.mipmaps.length},X(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){var t=this;if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0];this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(e,n){t._assignImage(e,n)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(sp),op=te((rp=ap).prototype,"_mipmaps",[np],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ip=rp))||ip));i.Texture2D=dp,function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom",e[e.front=4]="front",e[e.back=5]="back"}(fp||(fp={}));var pp=e("TextureCube",S_("cc.TextureCube")((_p=hp=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_mipmaps",up,Q(t)),t}K(t,e),t.fromTexture2DArray=function(e,n){for(var i=[],r=e.length/6,o=0;o<r;o++){var a=6*o;i.push({front:e[a+fp.front].image,back:e[a+fp.back].image,left:e[a+fp.left].image,right:e[a+fp.right].image,top:e[a+fp.top].image,bottom:e[a+fp.bottom].image})}return(n=n||new t).mipmaps=i,n};var n=t.prototype;return n.onLoaded=function(){this.mipmaps=this._mipmaps,this.loaded=!0,this.emit("load")},n.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()},n.updateMipmaps=function(e,t){var n=this;if(void 0===e&&(e=0),!(e>=this._mipmaps.length))for(var i=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e),r=function(t){var i=e+t;mp(n._mipmaps[i],(function(e,t){n._assignImage(e,i,t)}))},o=0;o<i;++o)r(o)},n.destroy=function(){return this._mipmaps=[],e.prototype.destroy.call(this)},n.releaseTexture=function(){this.mipmaps=[]},n._serialize=function(){return null},n._deserialize=function(t,n){var i=t;e.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r){this._mipmaps[r]={front:new Uf,back:new Uf,left:new Uf,right:new Uf,top:new Uf,bottom:new Uf};var o=i.mipmaps[r],a=Ke._getClassId(Uf);n.result.push(this._mipmaps[r],"front",o.front,a),n.result.push(this._mipmaps[r],"back",o.back,a),n.result.push(this._mipmaps[r],"left",o.left,a),n.result.push(this._mipmaps[r],"right",o.right,a),n.result.push(this._mipmaps[r],"top",o.top,a),n.result.push(this._mipmaps[r],"bottom",o.bottom,a)}},n._getGfxTextureCreateInfo=function(e){var t=new Ss(ba.CUBE);return t.width=this._width,t.height=this._height,t.layerCount=6,Object.assign(t,e),t},n.initDefault=function(t){e.prototype.initDefault.call(this,t);var n=new Uf;n.initDefault(),this.mipmaps=[{front:n,back:n,top:n,bottom:n,left:n,right:n}]},n.validate=function(){return 0!==this._mipmaps.length&&!this._mipmaps.find((function(e){return!(e.top&&e.bottom&&e.front&&e.back&&e.left&&e.right)}))},X(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){var t=this;if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0].front;this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(e,n){mp(e,(function(e,i){t._assignImage(e,n,i)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(sp),hp.FaceIndex=fp,up=te((lp=_p).prototype,"_mipmaps",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cp=lp))||cp);function mp(e,t){t(e.front,fp.front),t(e.back,fp.back),t(e.left,fp.left),t(e.right,fp.right),t(e.top,fp.top),t(e.bottom,fp.bottom)}i.TextureCube=pp;var gp,vp,yp,Sp=e("effects",[{name:"billboard",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"billboard|vert:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"billboard|vert:vs_main|tinted-fs:add",hash:456146524,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:50,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:38},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"builtin",defines:[],binding:1,stageFlags:1,members:[{name:"cc_size_rotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:2,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:3}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"clear-stencil",techniques:[{passes:[{blendState:{targets:[{blend:!0}]},rasterizerState:{cullMode:0},program:"clear-stencil|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"clear-stencil|sprite-vs:vert|sprite-fs:frag",hash:1062464958,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:0,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[],samplerTextures:[]},locals:{blocks:[],samplerTextures:[]}},defines:[],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0}]}]},{name:"graphics",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:1,blendDst:4,blendSrcAlpha:1,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"graphics|vs:vert|fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"graphics|vs:vert|fs:frag",hash:3946667351,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:46,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_dist",type:13,count:1,defines:[],stageFlags:1,format:11,location:2}]}]},{name:"particle-gpu",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",hash:932177378,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:60,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:38},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"COLOR_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"SIZE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"FORCE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"VELOCITY_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"TEXTURE_ANIMATION_MODULE_ENABLE",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"SampleConstants",defines:[],binding:1,stageFlags:1,members:[{name:"u_sampleInfo",type:16,count:1}]},{name:"TickConstants",defines:[],binding:2,stageFlags:1,members:[{name:"u_worldRot",type:16,count:1},{name:"u_timeDelta",type:16,count:1}]},{name:"ColorConstant",defines:["COLOR_OVER_TIME_MODULE_ENABLE"],binding:3,stageFlags:1,members:[{name:"u_color_mode",type:5,count:1}]},{name:"RotationConstant",defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],binding:4,stageFlags:1,members:[{name:"u_rotation_mode",type:5,count:1}]},{name:"SizeConstant",defines:["SIZE_OVER_TIME_MODULE_ENABLE"],binding:5,stageFlags:1,members:[{name:"u_size_mode",type:5,count:1}]},{name:"ForceConstant",defines:["FORCE_OVER_TIME_MODULE_ENABLE"],binding:6,stageFlags:1,members:[{name:"u_force_mode",type:5,count:1},{name:"u_force_space",type:5,count:1}]},{name:"VelocityConstant",defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],binding:7,stageFlags:1,members:[{name:"u_velocity_mode",type:5,count:1},{name:"u_velocity_space",type:5,count:1}]},{name:"AnimationConstant",defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],binding:8,stageFlags:1,members:[{name:"u_anim_info",type:16,count:1}]},{name:"FragConstants",defines:[],binding:9,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"color_over_time_tex0",type:28,count:1,defines:["COLOR_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:10},{name:"rotation_over_time_tex0",type:28,count:1,defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:11},{name:"size_over_time_tex0",type:28,count:1,defines:["SIZE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:12},{name:"force_over_time_tex0",type:28,count:1,defines:["FORCE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:13},{name:"velocity_over_time_tex0",type:28,count:1,defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:14},{name:"texture_animation_tex0",type:28,count:1,defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],stageFlags:1,binding:15},{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:16}],attributes:[{name:"a_position_starttime",type:16,count:1,defines:[],stageFlags:1,format:44,location:0},{name:"a_size_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_rotation_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_dir_life",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_rndSeed",type:13,count:1,defines:[],stageFlags:1,format:11,location:5},{name:"a_texCoord",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_color1",type:16,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:44,location:9}]}]},{name:"particle-trail",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-trail|particle-trail:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},frameTile_velLenScale:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-trail|particle-trail:vs_main|tinted-fs:add",hash:293909391,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:49,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:38},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_DRAW_WIRE_FRAME",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4}]}]},{name:"particle",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",hash:3802928649,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:49,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:38},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_color1",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7}]}]},{name:"spine",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"spine|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"spine|sprite-vs:vert|sprite-fs:frag",hash:2041444135,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:46,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:[]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"TWO_COLORED",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color2",type:16,count:1,defines:["TWO_COLORED"],stageFlags:1,format:44,location:3}]}]},{name:"sprite",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"sprite|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"sprite|sprite-vs:vert|sprite-fs:frag",hash:1142786345,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:46,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"standard",techniques:[{name:"opaque",passes:[{program:"standard|standard-vs|standard-fs",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"deferred",propertyIndex:0,blendState:{targets:[{blend:!1},{blend:!1},{blend:!1},{blend:!1}]},program:"standard|standard-vs|standard-fs",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"standard|standard-vs|standard-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"shadow-caster",propertyIndex:0,rasterizerState:{cullMode:1},program:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}}]}],shaders:[{name:"standard|standard-vs|standard-fs",hash:632993342,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:216,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:59},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]}]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_NORMAL_MAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"NORMAL_UV",type:"string",options:["v_uv","v_uv1"]},{name:"PBR_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_PBR_MAP",type:"boolean"},{name:"USE_METALLIC_ROUGHNESS_MAP",type:"boolean"},{name:"USE_OCCLUSION_MAP",type:"boolean"},{name:"USE_EMISSIVE_MAP",type:"boolean"},{name:"EMISSIVE_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1},{name:"normalMap",type:28,count:1,defines:["USE_NORMAL_MAP"],stageFlags:16,binding:2},{name:"pbrMap",type:28,count:1,defines:["USE_PBR_MAP"],stageFlags:16,binding:3},{name:"metallicRoughnessMap",type:28,count:1,defines:["USE_METALLIC_ROUGHNESS_MAP"],stageFlags:16,binding:4},{name:"occlusionMap",type:28,count:1,defines:["USE_OCCLUSION_MAP"],stageFlags:16,binding:5},{name:"emissiveMap",type:28,count:1,defines:["USE_EMISSIVE_MAP"],stageFlags:16,binding:6}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:"u32vec4",count:1,defines:["CC_USE_SKINNING"],stageFlags:1,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:14}]},{name:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:1518991842,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:179,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:22},globals:{blocks:[{name:"CCShadow",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:"u32vec4",count:1,defines:["CC_USE_SKINNING"],stageFlags:1,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:13}]}]},{name:"terrain",techniques:[{name:"opaque",passes:[{program:"terrain|terrain-vs|terrain-fs",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"deferred",propertyIndex:0,blendState:{targets:[{blend:!1},{blend:!1},{blend:!1},{blend:!1}]},program:"terrain|terrain-vs|terrain-fs",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"terrain|terrain-vs|terrain-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"shadow-add",propertyIndex:0,rasterizerState:{cullMode:2},program:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"terrain|terrain-vs|terrain-fs",hash:2532494361,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:64,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:55},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]}]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplerTextures:[{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}]}},defines:[{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_NORMALMAP",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"LAYERS",type:"number",range:[0,4]},{name:"USE_PBR",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]}],blocks:[{name:"TexCoords",defines:[],binding:0,stageFlags:1,members:[{name:"UVScale",type:16,count:1},{name:"lightMapUVParam",type:16,count:1}]},{name:"PbrParams",defines:[],binding:1,stageFlags:16,members:[{name:"metallic",type:16,count:1},{name:"roughness",type:16,count:1}]}],samplerTextures:[{name:"weightMap",type:28,count:1,defines:[],stageFlags:16,binding:2},{name:"detailMap0",type:28,count:1,defines:[],stageFlags:16,binding:3},{name:"detailMap1",type:28,count:1,defines:[],stageFlags:16,binding:4},{name:"detailMap2",type:28,count:1,defines:[],stageFlags:16,binding:5},{name:"detailMap3",type:28,count:1,defines:[],stageFlags:16,binding:6},{name:"normalMap0",type:28,count:1,defines:[],stageFlags:16,binding:7},{name:"normalMap1",type:28,count:1,defines:[],stageFlags:16,binding:8},{name:"normalMap2",type:28,count:1,defines:[],stageFlags:16,binding:9},{name:"normalMap3",type:28,count:1,defines:[],stageFlags:16,binding:10},{name:"lightMap",type:28,count:1,defines:[],stageFlags:16,binding:11}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]},{name:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3874167763,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:62,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[]}},defines:[],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]}]},{name:"unlit",techniques:[{name:"opaque",passes:[{program:"unlit|unlit-vs:vert|unlit-fs:frag",properties:{mainTexture:{value:"grey",type:28},tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16},colorScale:{value:[1,1,1],type:15,handleInfo:["colorScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["colorScaleAndCutoff",3,13]},color:{type:16,handleInfo:["mainColor",0,16]},colorScaleAndCutoff:{type:16,value:[1,1,1,.5]}}}]}],shaders:[{name:"unlit|unlit-vs:vert|unlit-fs:frag",hash:3579616855,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:195,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r","g","b"]}],blocks:[{name:"TexCoords",defines:["USE_TEXTURE"],binding:0,stageFlags:1,members:[{name:"tilingOffset",type:16,count:1}]},{name:"Constant",defines:[],binding:1,stageFlags:16,members:[{name:"mainColor",type:16,count:1},{name:"colorScaleAndCutoff",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:["USE_TEXTURE"],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:"u32vec4",count:1,defines:["CC_USE_SKINNING"],stageFlags:1,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13}]}]},{name:"deferred-lighting",techniques:[{passes:[{phase:"deferred-lighting",program:"deferred-lighting|lighting-vs|lighting-fs",depthStencilState:{depthFunc:4,depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"deferred-lighting|lighting-vs|lighting-fs",hash:4181944545,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:37,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:53},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_gbuffer_albedoMap",defines:[]},{name:"cc_gbuffer_positionMap",defines:[]},{name:"cc_gbuffer_normalMap",defines:[]},{name:"cc_gbuffer_emissiveMap",defines:[]}]},locals:{blocks:[{name:"CCForwardLight",defines:[]}],samplerTextures:[]}},defines:[{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"USE_LIGHTMAP",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_USE_FOG",type:"number",range:[0,4]}],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3}]}]},{name:"planar-shadow",techniques:[{passes:[{phase:"planarShadow",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1,stencilTestFront:!0,stencilFuncFront:5,stencilPassOpFront:2,stencilRefBack:128,stencilRefFront:128,stencilReadMaskBack:128,stencilReadMaskFront:128,stencilWriteMaskBack:128,stencilWriteMaskFront:128}}]}],shaders:[{name:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",hash:3940098901,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:210,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:53},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:"u32vec4",count:1,defines:["CC_USE_SKINNING"],stageFlags:1,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12}]}]},{name:"post-process",techniques:[{passes:[{phase:"post-process",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendSrcAlpha:2,blendDstAlpha:4}]},program:"post-process|post-process-vs|post-process-fs",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"post-process|post-process-vs|post-process-fs",hash:2054814724,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:145,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:37},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_lighting_resultMap",defines:[]}]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"}],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:"u32vec4",count:1,defines:["CC_USE_SKINNING"],stageFlags:1,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7}]}]},{name:"skybox",techniques:[{passes:[{rasterizerState:{cullMode:0},program:"skybox|sky-vs:vert|sky-fs:frag",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"skybox|sky-vs:vert|sky-fs:frag",hash:553035852,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:37,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:37},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_environment",defines:[]}]},locals:{blocks:[],samplerTextures:[]}},defines:[{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_RGBE_CUBEMAP",type:"boolean"}],blocks:[],samplerTextures:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3}]}]},{name:"profiler",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"profiler|profiler-vs:vert|profiler-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"profiler|profiler-vs:vert|profiler-fs:frag",hash:3108604430,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:58,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:37},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[]},locals:{blocks:[],samplerTextures:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"offset",type:16,count:1}]},{name:"PerFrameInfo",defines:[],binding:1,stageFlags:1,members:[{name:"digits",type:16,count:20}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1}]}]},{name:"splash-screen",techniques:[{name:"default",passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},resolution:{value:[640,960],type:14,handleInfo:["u_buffer0",0,14]},precent:{value:[.5],type:13,handleInfo:["u_buffer0",2,13]},scale:{value:[200,500],type:14,handleInfo:["u_buffer1",0,14]},translate:{value:[320,480],type:14,handleInfo:["u_buffer1",2,14]},u_buffer0:{type:16,value:[640,960,.5,0]},u_buffer1:{type:16,value:[200,500,320,480]}}}]}],shaders:[{name:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",hash:624029864,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:6,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[],samplerTextures:[]},locals:{blocks:[],samplerTextures:[]}},defines:[],blocks:[{name:"Constant",defines:[],binding:0,stageFlags:1,members:[{name:"u_buffer0",type:16,count:1},{name:"u_buffer1",type:16,count:1},{name:"u_projection",type:25,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:14,count:1,defines:[],stageFlags:1,format:21,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1}]}]}]),Ep=4026531840,Tp=264241152,xp=3145728,Ap=1032192;!function(e){e[e.BUFFER=0]="BUFFER",e[e.TEXTURE=1]="TEXTURE"}(yp||(yp={}));var Cp=function(e,t,n,i,r){return void 0===r&&(r=0),e<<28&Ep|i<<22&Tp|t<<20&xp|n<<14&Ap|16383&r},bp=function(e){return(e&Ep)>>>28},wp=function(e){return(e&Tp)>>>22},Rp=function(e){return(e&Ap)>>>14},Ip=function(e){return 16383&e},Pp=function(e,t){return e&~Tp|t<<22&Tp},Op=((gp={})[Ea.UNKNOWN]=function(){return console.warn("illegal uniform handle")},gp[Ea.INT]=function(e,t,n){return void 0===n&&(n=0),e[n]},gp[Ea.INT2]=function(e,t,n){return void 0===n&&(n=0),zn.fromArray(t,e,n)},gp[Ea.INT3]=function(e,t,n){return void 0===n&&(n=0),yn.fromArray(t,e,n)},gp[Ea.INT4]=function(e,t,n){return void 0===n&&(n=0),kn.fromArray(t,e,n)},gp[Ea.FLOAT]=function(e,t,n){return void 0===n&&(n=0),e[n]},gp[Ea.FLOAT2]=function(e,t,n){return void 0===n&&(n=0),zn.fromArray(t,e,n)},gp[Ea.FLOAT3]=function(e,t,n){return void 0===n&&(n=0),yn.fromArray(t,e,n)},gp[Ea.FLOAT4]=function(e,t,n){return void 0===n&&(n=0),kn.fromArray(t,e,n)},gp[Ea.MAT3]=function(e,t,n){return void 0===n&&(n=0),xn.fromArray(t,e,n)},gp[Ea.MAT4]=function(e,t,n){return void 0===n&&(n=0),Mn.fromArray(t,e,n)},gp),Dp=((vp={})[Ea.UNKNOWN]=function(){return console.warn("illegal uniform handle")},vp[Ea.INT]=function(e,t,n){return void 0===n&&(n=0),e[n]=t},vp[Ea.INT2]=function(e,t,n){return void 0===n&&(n=0),zn.toArray(e,t,n)},vp[Ea.INT3]=function(e,t,n){return void 0===n&&(n=0),yn.toArray(e,t,n)},vp[Ea.INT4]=function(e,t,n){return void 0===n&&(n=0),kn.toArray(e,t,n)},vp[Ea.FLOAT]=function(e,t,n){return void 0===n&&(n=0),e[n]=t},vp[Ea.FLOAT2]=function(e,t,n){return void 0===n&&(n=0),zn.toArray(e,t,n)},vp[Ea.FLOAT3]=function(e,t,n){return void 0===n&&(n=0),yn.toArray(e,t,n)},vp[Ea.FLOAT4]=function(e,t,n){return void 0===n&&(n=0),kn.toArray(e,t,n)},vp[Ea.MAT3]=function(e,t,n){return void 0===n&&(n=0),xn.toArray(e,t,n)},vp[Ea.MAT4]=function(e,t,n){return void 0===n&&(n=0),Mn.toArray(e,t,n)},vp),Np=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function Mp(e){switch(e){case Ea.BOOL:case Ea.INT:case Ea.UINT:case Ea.FLOAT:return Np[0];case Ea.BOOL2:case Ea.INT2:case Ea.UINT2:case Ea.FLOAT2:return Np[1];case Ea.BOOL4:case Ea.INT4:case Ea.UINT4:case Ea.FLOAT4:return Np[2];case Ea.MAT4:return Np[3];case Ea.SAMPLER2D:return"default-texture";case Ea.SAMPLER_CUBE:return"default-cube-texture"}return Np[0]}function Lp(e,t){for(var n=Object.entries(t),i=!1,r=0;r<n.length;r++)e[n[r][0]]!==n[r][1]&&(e[n[r][0]]=n[r][1],i=!0);return i}var Bp=new Vs;function Fp(e){return Math.ceil(Math.log2(Math.max(e,2)))}function zp(e,t){switch(e.type){case"boolean":return"number"==typeof t?t.toString():t?"1":"0";case"string":return void 0!==t?t:e.options[0];case"number":return void 0!==t?t.toString():e.range[0].toString();default:return console.warn("unknown define type '"+e.type+"'"),"-1"}}function Up(e,t,n,i,r){for(var o=e.builtins[i],a=[],s=function(e){var t=o.blocks[e],i=n.layouts[t.name],s=i&&n.bindings.find((function(e){return e.binding===i.binding}));if(!(i&&s&&s.descriptorType&ec))return console.warn("builtin UBO '"+t.name+"' not available!"),"continue";a.push(i),r&&!r.includes(s)&&r.push(s)},c=0;c<o.blocks.length;c++)s(c);Array.prototype.unshift.apply(t.gfxBlocks,a);for(var l=[],u=function(e){var t=o.samplerTextures[e],i=n.layouts[t.name],a=i&&n.bindings.find((function(e){return e.binding===i.binding}));if(!(i&&a&&a.descriptorType&tc))return console.warn("builtin samplerTexture '"+t.name+"' not available!"),"continue";l.push(i),r&&!r.includes(a)&&r.push(a)},h=0;h<o.samplerTextures.length;h++)u(h);Array.prototype.unshift.apply(t.gfxSamplerTextures,l),r&&r.sort((function(e,t){return e.binding-t.binding}))}function Hp(e){return e.members.reduce((function(e,t){return e+sc(t.type)*t.count}),0)}function Gp(e,t){for(var n=0;n<e.length;n++){var i=e[n];if("!"===i[0]){if(t[i.slice(1)])return!1}else if(!t[i])return!1}return!0}function kp(e){switch(e.gfxAPI){case ma.GLES2:case ma.WEBGL:return"glsl1";case ma.GLES3:case ma.WEBGL2:return"glsl3";default:return"glsl4"}}var Vp=new(function(){function e(){this._templates={},this._cache={},this._templateInfos={}}var t=e.prototype;return t.register=function(e){for(var t=0;t<e.shaders.length;t++)this.define(e.shaders[t]).effectName=e.name},t.define=function(e){var t=this._templates[e.name];if(t&&t.hash===e.hash)return t;for(var n=Y({},e),i=0,r=function(e){var t=n.defines[e],r=1;if("number"===t.type){var o=t.range;r=Fp(o[1]-o[0]+1),t._map=function(e){return e-o[0]}}else"string"===t.type?(r=Fp(t.options.length),t._map=function(e){return Math.max(0,t.options.findIndex((function(t){return t===e})))}):"boolean"===t.type&&(t._map=function(e){return e?1:0});t._offset=i,i+=r},o=0;o<n.defines.length;o++)r(o);for(var a in i>31&&(n.uber=!0),n.constantMacros="",n.builtins.statistics)n.constantMacros+="#define "+a+" "+n.builtins.statistics[a]+"\n";if(this._templates[e.name]=n,!this._templateInfos[n.hash]){var s={};s.samplerStartBinding=n.blocks.length,s.gfxBlocks=[],s.gfxSamplerTextures=[],s.bindings=[],s.blockSizes=[];for(var c=0;c<n.blocks.length;c++){var l=n.blocks[c];s.blockSizes.push(Hp(l)),s.bindings.push(new ks(l.binding,l.descriptorType||Ya.UNIFORM_BUFFER,1,l.stageFlags)),s.gfxBlocks.push(new As(Gu.MATERIAL,l.binding,l.name,l.members.map((function(e){return new xs(e.name,e.type,e.count)})),1))}for(var u=0;u<n.samplerTextures.length;u++){var h=n.samplerTextures[u];s.bindings.push(new ks(h.binding,h.descriptorType||Ya.SAMPLER_TEXTURE,h.count,h.stageFlags)),s.gfxSamplerTextures.push(new Cs(Gu.MATERIAL,h.binding,h.name,h.type,h.count))}s.gfxAttributes=[];for(var _=0;_<n.attributes.length;_++){var f=n.attributes[_];s.gfxAttributes.push(new Ds(f.name,f.format,f.isNormalized,0,f.isInstanced,f.location))}Up(n,s,Fu,"locals"),s.gfxStages=[],s.gfxStages.push(new Os(Fa.VERTEX,"")),s.gfxStages.push(new Os(Fa.FRAGMENT,"")),s.handleMap=function(e){for(var t={},n=0;n<e.blocks.length;n++)for(var i=e.blocks[n],r=i.members,o=0,a=0;a<r.length;a++){var s=r[a];t[s.name]=Cp(yp.BUFFER,Gu.MATERIAL,i.binding,s.type,o),o+=(sc(s.type)>>2)*s.count}for(var c=0;c<e.samplerTextures.length;c++){var l=e.samplerTextures[c];t[l.name]=Cp(yp.TEXTURE,Gu.MATERIAL,l.binding,l.type)}return t}(n),s.hPipelineLayout=0,s.setLayouts=[],this._templateInfos[n.hash]=s}return n},t.getTemplate=function(e){return this._templates[e]},t.getTemplateInfo=function(e){var t=this._templates[e].hash;return this._templateInfos[t]},t.getDescriptorSetLayout=function(e,t,n){void 0===n&&(n=!1);var i=this._templates[t],r=this._templateInfos[i.hash];return r.setLayouts.length||(Bp.bindings=r.bindings,r.setLayouts[Gu.MATERIAL]=e.createDescriptorSetLayout(Bp),Bp.bindings=Fu.bindings,r.setLayouts[Gu.LOCAL]=e.createDescriptorSetLayout(Bp)),r.setLayouts[n?Gu.LOCAL:Gu.MATERIAL]},t.hasProgram=function(e){return void 0!==this._templates[e]},t.getKey=function(e,t){var n=this._templates[e],i=n.defines;if(n.uber){for(var r="",o=0;o<i.length;o++){var a=i[o],s=t[a.name];if(s&&a._map){var c=a._map(s);r+=""+a._offset+c+"|"}}return""+r+n.hash}for(var l=0,u=0;u<i.length;u++){var h=i[u],_=t[h.name];_&&h._map&&(l|=h._map(_)<<h._offset)}return l.toString(16)+"|"+n.hash},t.destroyShaderByDefines=function(e){var t=this,n=Object.keys(e);if(n.length)for(var i=n.map((function(t){var n=e[t];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(""+t+n)})),r=Object.keys(this._cache).filter((function(e){return i.every((function(n){return n.test(mr.get(t._cache[e]).name)}))})),o=0;o<r.length;o++){var a=r[o],s=mr.get(this._cache[a]);console.log("destroyed shader "+s.name),s.destroy(),delete this._cache[a]}},t.getGFXShader=function(e,t,n,i,r){Object.assign(n,i.macros),r||(r=this.getKey(t,n));var o=this._cache[r];if(o)return o;var a=this._templates[t],s=this._templateInfos[a.hash];s.hPipelineLayout||(this.getDescriptorSetLayout(e,t),Up(a,s,Bu,"globals"),s.setLayouts[Gu.GLOBAL]=i.descriptorSetLayout,s.hPipelineLayout=yr.alloc(e,new js(s.setLayouts)));var c=function(e,t){for(var n=[],i=0;i<t.length;i++){var r=t[i],o=r.name,a=e[o],s=zp(r,a),c=!a||"0"===a;n.push({name:o,value:s,isDefault:c})}return n}(n,a.defines),l=i.constantMacros+a.constantMacros+c.reduce((function(e,t){return e+"#define "+t.name+" "+t.value+"\n"}),""),u=a.glsl3,h=kp(e);h?u=a[h]:console.error("Invalid GFX API!"),s.gfxStages[0].source=l+u.vert,s.gfxStages[1].source=l+u.frag;var _=function(e,t,n){for(var i=[],r=e.attributes,o=t.gfxAttributes,a=0;a<r.length;a++)Gp(r[a].defines,n)&&i.push(o[a]);return i}(a,s,n),f=function(e,t){return e+t.reduce((function(e,t){return t.isDefault?e:e+"|"+t.name+t.value}),"")}(t,c),d=new Ns(f,s.gfxStages,_,s.gfxBlocks);return d.samplerTextures=s.gfxSamplerTextures,this._cache[r]=mr.alloc(e,d)},e}());i.programLib=Vp;var Wp,jp,qp,Xp={glsl1:[[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nuniform vec4 cc_size_rotation;\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nattribute vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nattribute float a_dist;\nvarying float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\nprecision highp float;\nvarying vec4 v_color;\nvarying float v_dist;\nvec4 frag () {\nvec4 o = v_color;\n#ifdef GL_OES_standard_derivatives\nfloat aa = fwidth(v_dist);\n#else\nfloat aa = 0.05;\n#endif\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\nrotateCorner(viewSpaceVert, q.z);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nuniform vec4 u_sampleInfo;\nuniform vec4 u_worldRot;\nuniform vec4 u_timeDelta;\nattribute vec4 a_position_starttime;\nattribute vec4 a_size_uv;\nattribute vec4 a_rotation_uv;\nattribute vec4 a_color;\nattribute vec4 a_dir_life;\nattribute float a_rndSeed;\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\nseed = mod(seed, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nuniform int u_color_mode;\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nuniform int u_rotation_mode;\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nuniform int u_size_mode;\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nuniform int u_force_mode;\nuniform int u_force_space;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nuniform int u_velocity_mode;\nuniform int u_velocity_space;\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nuniform vec4 u_anim_info;\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 rotation = a_rotation_uv.xyz;\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nrotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nrotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture2D(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture2D(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture2D(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = rotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., rotation.z);\n#endif\ncomputeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\nmat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nuniform vec4 mainTiling_Offset;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nattribute vec3 a_position;\nattribute vec4 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\nrotateCorner(viewSpaceVert, q.z);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nattribute vec3 a_position;\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_RENDER_MODE == 1\nattribute vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\ncomputeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_texCoord.x\n#endif\n);\ncolor = a_color;\n#else\nmat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\nmat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_light;\nvarying vec2 uv0;\n#if TWO_COLORED\nattribute vec4 a_color2;\nvarying vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 v_light;\n#if TWO_COLORED\nvarying vec4 v_dark;\n#endif\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture2D(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture2D(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\n#if SAMPLE_FROM_RT\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 color;\nvarying vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture2D(tex, uv).rgb, texture2D(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture2D(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 color;\n#if USE_TEXTURE\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\nuniform highp vec4 cc_lightingMapUVParam;\n#endif\nuniform vec4 tilingOffset;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvarying float v_fog_factor;\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\n#endif\n#if USE_VERTEX_COLOR\nattribute vec4 a_color;\nvarying vec4 v_color;\n#endif\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\n#if USE_NORMAL_MAP\nvarying vec3 v_tangent;\nvarying vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\nv_luv.z = cc_lightingMapUVParam.z;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\nv_luv.z = a_lightingMapUVParam.z;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if USE_NORMAL_MAP\nv_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(pos);\n#else\nv_fog_factor = 1.0;\n#endif\nv_shadowPos = cc_matLightViewProj * pos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nuniform vec4 pbrParams;\nuniform vec4 emissive;\nuniform vec4 emissiveScaleParam;\nvarying float v_fog_factor;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform lowp vec4 cc_shadowNFLSInfo;\nuniform lowp vec4 cc_shadowWHPBInfo;\nuniform lowp vec4 cc_shadowLPNNInfo;\nuniform lowp vec4 cc_shadowColor;\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorX1 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorX5 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetShadowFactorX9 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetShadowFactorX25 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\nfloat CCGetDirLightShadowFactorX1 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetDirLightShadowFactorX5 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetDirLightShadowFactorX9 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetDirLightShadowFactorX25 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat depth = 0.0;\nfloat shadow = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nfinalColor *= (diffuseContrib + specularContrib);\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25(pos);\nelse if (pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5(pos);\nelse shadowAttenuation = CCGetShadowFactorX1(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation + finalColor.rgb * (1.0 - shadowAttenuation);\n} else {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nvarying highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nvarying vec3 v_position;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec3 v_normal;\n#if USE_VERTEX_COLOR\nvarying vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nvarying vec3 v_tangent;\nvarying vec3 v_bitangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor *= v_color;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture2D(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(cc_lightingMap, v_luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if USE_NORMAL_MAP\nvec3 nmmp = texture2D(normalMap, NORMAL_UV).xyz - vec3(0.5);\ns.normal =\n(nmmp.x * pbrParams.w) * normalize(v_tangent) +\n(nmmp.y * pbrParams.w) * normalize(v_bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\ns.position = v_position;\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture2D(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture2D(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture2D(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = clamp(pbr.x, 0.0, 0.96);\ns.roughness = clamp(pbr.y, 0.04, 1.0);\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture2D(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25(pos, s.position);\nelse if (pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5(pos, s.position);\nelse shadowAttenuation = CCGetDirLightShadowFactorX1(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 0\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(s.position, s.roughness);\ngl_FragData[2] = vec4(s.normal, s.metallic);\ngl_FragData[3] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\n#endif\nuniform vec4 tilingOffset;\nuniform highp mat4 cc_matLightViewProj;\n#if HAS_SECOND_UV || USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\nret = fract(ret);\nret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn ret;\n}\nuniform highp mat4 cc_matLightView;\nuniform lowp vec4 cc_shadowNFLSInfo;\nuniform lowp vec4 cc_shadowLPNNInfo;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture2D(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nvec4 viewStartPos = cc_matLightView * v_worldPos;\nfloat dist = length(viewStartPos.xyz);\nfloat linearDepth = cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\nreturn vec4(linearDepth, 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform highp mat4 cc_matWorld;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvarying float v_fog_factor;\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\n#endif\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\nvarying mediump vec3 v_tangent;\nvarying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 luv;\nvarying mediump vec3 diffuse;\nuniform vec4 UVScale;\nuniform vec4 lightMapUVParam;\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\nluv.z = lightMapUVParam.z;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(vec4(worldPos, 1.0));\n#else\nv_fog_factor = 1.0;\n#endif\n#if USE_NORMALMAP\nv_tangent = vec3(1.0, 0.0, 0.0);\nv_binormal = vec3(0.0, 0.0, 1.0);\nv_binormal = cross(v_tangent, a_normal);\nv_tangent = cross(a_normal, v_binormal);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform lowp vec4 cc_shadowNFLSInfo;\nuniform lowp vec4 cc_shadowWHPBInfo;\nuniform lowp vec4 cc_shadowLPNNInfo;\nuniform lowp vec4 cc_shadowColor;\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorX1 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorX5 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetShadowFactorX9 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetShadowFactorX25 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\nfloat CCGetDirLightShadowFactorX1 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetDirLightShadowFactorX5 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetDirLightShadowFactorX9 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetDirLightShadowFactorX25 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat depth = 0.0;\nfloat shadow = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nfinalColor *= (diffuseContrib + specularContrib);\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25(pos);\nelse if (pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5(pos);\nelse shadowAttenuation = CCGetShadowFactorX1(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation + finalColor.rgb * (1.0 - shadowAttenuation);\n} else {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nvarying float v_fog_factor;\nvarying highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\nvarying mediump vec3 v_tangent;\nvarying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 diffuse;\nvarying mediump vec3 luv;\nuniform vec4 metallic;\nuniform vec4 roughness;\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture2D(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture2D(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\nbaseColor += texture2D(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture2D(detailMap0, uv0);\n#endif\ns.position = v_position;\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture2D(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\nbaseNormal += texture2D(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture2D(normalMap0, uv0);\n#endif\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(v_tangent) +\nnmmp.y * normalize(v_binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.metallic = 0.0;\n#if LAYERS == 1\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(lightMap, luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25(pos, s.position);\nelse if (pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5(pos, s.position);\nelse shadowAttenuation = CCGetDirLightShadowFactorX1(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 0\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(s.position, s.roughness);\ngl_FragData[2] = vec4(s.normal, s.metallic);\ngl_FragData[3] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\nret = fract(ret);\nret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn ret;\n}\nvarying vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvarying float v_fog_factor;\n#if USE_VERTEX_COLOR\nattribute lowp vec4 a_color;\nvarying lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform vec4 tilingOffset;\n#endif\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(matWorld * position);\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(matWorld * position);\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(matWorld * position);\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(matWorld * position);\n#else\nv_fog_factor = 1.0;\n#endif\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_fogColor;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying float v_fog_factor;\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nuniform vec4 mainColor;\nuniform vec4 colorScaleAndCutoff;\n#if USE_VERTEX_COLOR\nvarying lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no *= v_color;\n#endif\n#if USE_TEXTURE\no *= texture2D(mainTexture, v_uv);\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\no = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, v_fog_factor), o.a);\nreturn CCFragOutput(o);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp mat4 cc_matLightViewProj;\nuniform lowp vec4 cc_shadowNFLSInfo;\nuniform lowp vec4 cc_shadowWHPBInfo;\nuniform lowp vec4 cc_shadowLPNNInfo;\nuniform lowp vec4 cc_shadowColor;\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorX1 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorX5 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetShadowFactorX9 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetShadowFactorX25 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\nfloat CCGetDirLightShadowFactorX1 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetDirLightShadowFactorX5 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetDirLightShadowFactorX9 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetDirLightShadowFactorX25 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat depth = 0.0;\nfloat shadow = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nfinalColor *= (diffuseContrib + specularContrib);\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25(pos);\nelse if (pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5(pos);\nelse shadowAttenuation = CCGetShadowFactorX1(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation + finalColor.rgb * (1.0 - shadowAttenuation);\n} else {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25(pos, s.position);\nelse if (pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5(pos, s.position);\nelse shadowAttenuation = CCGetDirLightShadowFactorX1(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvarying vec2 v_uv;\nuniform sampler2D cc_gbuffer_albedoMap;\nuniform sampler2D cc_gbuffer_positionMap;\nuniform sampler2D cc_gbuffer_normalMap;\nuniform sampler2D cc_gbuffer_emissiveMap;\nvoid main () {\nStandardSurface s;\nvec4 albedoMap = texture2D(cc_gbuffer_albedoMap,v_uv);\nvec4 positionMap = texture2D(cc_gbuffer_positionMap,v_uv);\nvec4 normalMap = texture2D(cc_gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture2D(cc_gbuffer_emissiveMap,v_uv);\ns.albedo = albedoMap;\ns.position = positionMap.xyz;\ns.roughness = positionMap.w;\ns.normal = normalMap.xyz;\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\n#if CC_USE_FOG == 0\nfogFactor = LinearFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 1\nfogFactor = ExpFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 2\nfogFactor = ExpSquaredFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 3\nfogFactor = LayeredFog(vec4(s.position, 1));\n#else\nfogFactor = 1.0;\n#endif\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(s.position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\nCCStandardShadingAdditive(s, shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, fogFactor), color.a);\ngl_FragColor = CCFragOutput(color);\n}"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nuniform highp mat4 cc_matLightPlaneProj;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\nposition = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\nposition.z -= 0.0001;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform lowp vec4 cc_shadowColor;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvec4 frag () {\nreturn CCFragOutput(cc_shadowColor);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nuniform mediump vec4 cc_screenSize;\nvarying vec2 v_uv;\nuniform sampler2D cc_lighting_resultMap;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\nvec4 texColor = texture2D(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\ngl_FragColor = fxaa(cc_lighting_resultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nvarying mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nmat4 matProj = cc_matProj;\nif (matProj[3].w > 0.0) {\nvec2 scale = vec2(48.0, 24.0);\nmatProj[0].xy *= scale;\nmatProj[1].xy *= scale;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\n}\nvec4 pos = matProj * matViewRotOnly * viewDir;\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_ambientSky;\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nvarying mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(textureCube(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(textureCube(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec2 v_uv;\nuniform vec4 offset;\nuniform vec4 digits[20];\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nvec4 position = cc_matViewProj * vec4(a_position, 1.0);\nposition.xy += offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture2D(mainTexture, v_uv));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_uv;\nvarying float v_percent;\nuniform vec4 u_buffer0;\nuniform vec4 u_buffer1;\nuniform mat4 u_projection;\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nv_percent = u_buffer0.z;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvarying vec2 v_uv;\nvarying float v_percent;\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture2D(mainTexture, v_uv);\nfloat precent = clamp(v_percent, 0.0, 1.0);\ncolor.xyz *= precent;\nreturn color;\n}\nvoid main() { gl_FragColor = frag(); }"}]],glsl3:[[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nlayout(std140) uniform builtin {\nvec4 cc_size_rotation;\n};\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nin vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nin float a_dist;\nout float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nin vec4 v_color;\nin float v_dist;\nvec4 frag () {\nvec4 o = v_color;\nfloat aa = fwidth(v_dist);\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\nrotateCorner(viewSpaceVert, q.z);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(std140) uniform SampleConstants {\nvec4 u_sampleInfo;\n};\nlayout(std140) uniform TickConstants {\nvec4 u_worldRot;\nvec4 u_timeDelta;\n};\nin vec4 a_position_starttime;\nin vec4 a_size_uv;\nin vec4 a_rotation_uv;\nin vec4 a_color;\nin vec4 a_dir_life;\nin float a_rndSeed;\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord;\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\nseed = mod(seed, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nlayout(std140) uniform ColorConstant {\nint u_color_mode;\n};\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nlayout(std140) uniform RotationConstant {\nint u_rotation_mode;\n};\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nlayout(std140) uniform SizeConstant {\nint u_size_mode;\n};\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nlayout(std140) uniform ForceConstant {\nint u_force_mode;\nint u_force_space;\n};\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nlayout(std140) uniform VelocityConstant {\nint u_velocity_mode;\nint u_velocity_space;\n};\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nlayout(std140) uniform AnimationConstant {\nvec4 u_anim_info;\n};\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 rotation = a_rotation_uv.xyz;\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nrotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nrotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = rotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., rotation.z);\n#endif\ncomputeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\nmat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nout vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\n#if CC_DRAW_WIRE_FRAME\nin vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\nfloat xOS = cos(angle) * corner.x - sin(angle) * corner.y;\nfloat yOS = sin(angle) * corner.x + cos(angle) * corner.y;\ncorner.x = xOS;\ncorner.y = yOS;\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\nrotateCorner(viewSpaceVert, q.z);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nin vec3 a_position;\nin vec3 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_RENDER_MODE == 1\nin vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\ncomputeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_texCoord.x\n#endif\n);\ncolor = a_color;\n#else\nmat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\nmat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 v_light;\nout vec2 uv0;\n#if TWO_COLORED\nin vec4 a_color2;\nout vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 v_light;\n#if TWO_COLORED\nin vec4 v_dark;\n#endif\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\n#if SAMPLE_FROM_RT\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 color;\nout vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture(tex, uv).rgb, texture(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 color;\n#if USE_TEXTURE\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nout float v_fog_factor;\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\n#endif\n#if USE_VERTEX_COLOR\nin vec4 a_color;\nout vec4 v_color;\n#endif\nout vec3 v_position;\nout vec3 v_normal;\nout vec2 v_uv;\nout vec2 v_uv1;\n#if USE_NORMAL_MAP\nout vec3 v_tangent;\nout vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nout vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\nv_luv.z = cc_lightingMapUVParam.z;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\nv_luv.z = a_lightingMapUVParam.z;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if USE_NORMAL_MAP\nv_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(pos);\n#else\nv_fog_factor = 1.0;\n#endif\nv_shadowPos = cc_matLightViewProj * pos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nin float v_fog_factor;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorX1 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorX5 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetShadowFactorX9 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetShadowFactorX25 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\nfloat CCGetDirLightShadowFactorX1 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetDirLightShadowFactorX5 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetDirLightShadowFactorX9 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetDirLightShadowFactorX25 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat depth = 0.0;\nfloat shadow = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nfinalColor *= (diffuseContrib + specularContrib);\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25(pos);\nelse if (pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5(pos);\nelse shadowAttenuation = CCGetShadowFactorX1(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation + finalColor.rgb * (1.0 - shadowAttenuation);\n} else {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nin highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nin vec3 v_position;\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec3 v_normal;\n#if USE_VERTEX_COLOR\nin vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nin vec3 v_tangent;\nin vec3 v_bitangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor *= v_color;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(cc_lightingMap, v_luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if USE_NORMAL_MAP\nvec3 nmmp = texture(normalMap, NORMAL_UV).xyz - vec3(0.5);\ns.normal =\n(nmmp.x * pbrParams.w) * normalize(v_tangent) +\n(nmmp.y * pbrParams.w) * normalize(v_bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\ns.position = v_position;\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = clamp(pbr.x, 0.0, 0.96);\ns.roughness = clamp(pbr.y, 0.04, 1.0);\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25(pos, s.position);\nelse if (pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5(pos, s.position);\nelse shadowAttenuation = CCGetDirLightShadowFactorX1(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 0\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nlayout(location = 3) out vec4 fragColor3;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(s.position, s.roughness);\nfragColor2 = vec4(s.normal, s.metallic);\nfragColor3 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if HAS_SECOND_UV || USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\nout vec2 v_uv;\nout vec2 v_uv1;\nout vec4 v_worldPos;\nout float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\nret = fract(ret);\nret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn ret;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec4 v_worldPos;\nin float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nvec4 viewStartPos = cc_matLightView * v_worldPos;\nfloat dist = length(viewStartPos.xyz);\nfloat linearDepth = cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\nreturn vec4(linearDepth, 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nout float v_fog_factor;\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\n#endif\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout highp vec3 v_position;\nout mediump vec3 v_normal;\n#if USE_NORMALMAP\nout mediump vec3 v_tangent;\nout mediump vec3 v_binormal;\n#endif\nout mediump vec2 uvw;\nout mediump vec2 uv0;\nout mediump vec2 uv1;\nout mediump vec2 uv2;\nout mediump vec2 uv3;\nout mediump vec3 luv;\nout mediump vec3 diffuse;\nlayout(std140) uniform TexCoords {\nvec4 UVScale;\nvec4 lightMapUVParam;\n};\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\nluv.z = lightMapUVParam.z;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(vec4(worldPos, 1.0));\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(vec4(worldPos, 1.0));\n#else\nv_fog_factor = 1.0;\n#endif\n#if USE_NORMALMAP\nv_tangent = vec3(1.0, 0.0, 0.0);\nv_binormal = vec3(0.0, 0.0, 1.0);\nv_binormal = cross(v_tangent, a_normal);\nv_tangent = cross(a_normal, v_binormal);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorX1 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorX5 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetShadowFactorX9 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetShadowFactorX25 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\nfloat CCGetDirLightShadowFactorX1 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetDirLightShadowFactorX5 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetDirLightShadowFactorX9 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetDirLightShadowFactorX25 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat depth = 0.0;\nfloat shadow = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nfinalColor *= (diffuseContrib + specularContrib);\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25(pos);\nelse if (pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5(pos);\nelse shadowAttenuation = CCGetShadowFactorX1(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation + finalColor.rgb * (1.0 - shadowAttenuation);\n} else {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nin float v_fog_factor;\nin highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nin highp vec3 v_position;\nin mediump vec3 v_normal;\n#if USE_NORMALMAP\nin mediump vec3 v_tangent;\nin mediump vec3 v_binormal;\n#endif\nin mediump vec2 uvw;\nin mediump vec2 uv0;\nin mediump vec2 uv1;\nin mediump vec2 uv2;\nin mediump vec2 uv3;\nin mediump vec3 diffuse;\nin mediump vec3 luv;\nlayout(std140) uniform PbrParams {\nvec4 metallic;\nvec4 roughness;\n};\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\nbaseColor += texture(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture(detailMap0, uv0);\n#endif\ns.position = v_position;\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\nbaseNormal += texture(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture(normalMap0, uv0);\n#endif\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(v_tangent) +\nnmmp.y * normalize(v_binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.metallic = 0.0;\n#if LAYERS == 1\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(lightMap, luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25(pos, s.position);\nelse if (pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5(pos, s.position);\nelse shadowAttenuation = CCGetDirLightShadowFactorX1(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 0\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nlayout(location = 3) out vec4 fragColor3;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(s.position, s.roughness);\nfragColor2 = vec4(s.normal, s.metallic);\nfragColor3 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\nret = fract(ret);\nret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn ret;\n}\nin vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nout float v_fog_factor;\n#if USE_VERTEX_COLOR\nin lowp vec4 a_color;\nout lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nout vec2 v_uv;\nlayout(std140) uniform TexCoords {\nvec4 tilingOffset;\n};\n#endif\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\n#if CC_USE_FOG == 0\nv_fog_factor = LinearFog(matWorld * position);\n#elif CC_USE_FOG == 1\nv_fog_factor = ExpFog(matWorld * position);\n#elif CC_USE_FOG == 2\nv_fog_factor = ExpSquaredFog(matWorld * position);\n#elif CC_USE_FOG == 3\nv_fog_factor = LayeredFog(matWorld * position);\n#else\nv_fog_factor = 1.0;\n#endif\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin float v_fog_factor;\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nin vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nlayout(std140) uniform Constant {\nvec4 mainColor;\nvec4 colorScaleAndCutoff;\n};\n#if USE_VERTEX_COLOR\nin lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no *= v_color;\n#endif\n#if USE_TEXTURE\no *= texture(mainTexture, v_uv);\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\no = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, v_fog_factor), o.a);\nreturn CCFragOutput(o);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nout vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\n#if CC_RECEIVE_SHADOW\nuniform sampler2D cc_shadowMap;\nuniform sampler2D cc_spotLightingMap;\nfloat CCGetLinearDepth (vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nfloat dist = length(viewStartPos.xyz);\nreturn cc_shadowNFLSInfo.x + (-dist / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x));\n}\nfloat CCGetShadowFactorX1 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, clipPos.z- cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetShadowFactorX5 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetShadowFactorX9 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetShadowFactorX25 (vec4 shadowPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\nfloat CCGetDirLightShadowFactorX1 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = 0.0;\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(closestDepth, depth - cc_shadowWHPBInfo.w);\nreturn shadow;\n}\nfloat CCGetDirLightShadowFactorX5 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n} else {\nfloat closestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\nclosestDepth = texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\nreturn shadow / 5.0;\n}\nfloat CCGetDirLightShadowFactorX9 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat shadow = 0.0;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -1; i <= 1; i++) {\nfor (int j = -1; j <= 1; j++) {\nfloat closestDepth = texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, depth - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 9.0;\n}\nfloat CCGetDirLightShadowFactorX25 (vec4 shadowPos, vec3 worldPos) {\nvec3 clipPos = shadowPos.xyz / shadowPos.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\nfloat offsetx = 1.0 / cc_shadowWHPBInfo.x;\nfloat offsety = 1.0 / cc_shadowWHPBInfo.y;\nfloat depth = 0.0;\nfloat shadow = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n} else {\nfor (int i = -2; i <= 2; i++) {\nfor (int j = -2; j <= 2; j++) {\nfloat closestDepth = texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)).x;\nshadow += step(closestDepth, clipPos.z - cc_shadowWHPBInfo.w);\n}\n}\n}\nreturn shadow / 25.0;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\nstruct StandardSurface {\nvec4 albedo;\nvec3 position;\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.001);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nfinalColor *= (diffuseContrib + specularContrib);\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\nfinalColor += (ambDiff.rgb * diffuse);\n#if CC_USE_IBL\nvec3 R = normalize(reflect(-V, N));\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\nfinalColor += env * cc_ambientSky.w * specular;\n#endif\nfinalColor = finalColor * s.occlusion;\n#if CC_USE_HDR\ns.emissive *= cc_exposure.w;\n#endif\nfinalColor += s.emissive;\n#if CC_RECEIVE_SHADOW\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, L.xyz), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25(pos);\nelse if (pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9(pos);\nelse if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5(pos);\nelse shadowAttenuation = CCGetShadowFactorX1(pos);\nvec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\nif (cc_shadowNFLSInfo.w > 0.000001) {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation + finalColor.rgb * (1.0 - shadowAttenuation);\n} else {\nfinalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n}\n}\n#endif\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - s.position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - s.position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z + 0.001;\nfloat shadowAttenuation = 0.0;\nfloat cosAngle = clamp(1.0 - dot(N, normalize(cc_lightPos[i].xyz - s.position.xyz)), 0.0, 1.0);\nvec3 projWorldPos = shadowPos.xyz + cosAngle * cc_shadowLPNNInfo.z * N;\nvec4 pos = vec4(projWorldPos.xyz, shadowPos.w);\nif (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25(pos, s.position);\nelse if (pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9(pos, s.position);\nelse if (pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5(pos, s.position);\nelse shadowAttenuation = CCGetDirLightShadowFactorX1(pos, s.position);\nlightColor *= 1.0 - shadowAttenuation;\n}\n}\n#endif\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nfinalColor = finalColor * s.occlusion;\nreturn vec4(finalColor, 0.0);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nin vec2 v_uv;\nuniform sampler2D cc_gbuffer_albedoMap;\nuniform sampler2D cc_gbuffer_positionMap;\nuniform sampler2D cc_gbuffer_normalMap;\nuniform sampler2D cc_gbuffer_emissiveMap;\nlayout(location = 0) out vec4 fragColor;\nvoid main () {\nStandardSurface s;\nvec4 albedoMap = texture(cc_gbuffer_albedoMap,v_uv);\nvec4 positionMap = texture(cc_gbuffer_positionMap,v_uv);\nvec4 normalMap = texture(cc_gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture(cc_gbuffer_emissiveMap,v_uv);\ns.albedo = albedoMap;\ns.position = positionMap.xyz;\ns.roughness = positionMap.w;\ns.normal = normalMap.xyz;\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\n#if CC_USE_FOG == 0\nfogFactor = LinearFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 1\nfogFactor = ExpFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 2\nfogFactor = ExpSquaredFog(vec4(s.position, 1));\n#elif CC_USE_FOG == 3\nfogFactor = LayeredFog(vec4(s.position, 1));\n#else\nfogFactor = 1.0;\n#endif\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(s.position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\nCCStandardShadingAdditive(s, shadowPos);\ncolor = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, fogFactor), color.a);\nfragColor = CCFragOutput(color);\n}"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\nposition = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\nposition.z -= 0.0001;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nlowp  vec4 cc_shadowNFLSInfo;\nlowp  vec4 cc_shadowWHPBInfo;\nlowp  vec4 cc_shadowLPNNInfo;\nlowp  vec4 cc_shadowColor;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nvec4 frag () {\nreturn CCFragOutput(cc_shadowColor);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nin vec2 v_uv;\nuniform sampler2D cc_lighting_resultMap;\nlayout(location = 0) out vec4 fragColor;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture(tex, v_rgbSE).xyz;\nvec4 texColor = texture(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\nfragColor = fxaa(cc_lighting_resultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nout mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nmat4 matProj = cc_matProj;\nif (matProj[3].w > 0.0) {\nvec2 scale = vec2(48.0, 24.0);\nmatProj[0].xy *= scale;\nmatProj[1].xy *= scale;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\n}\nvec4 pos = matProj * matViewRotOnly * viewDir;\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if !CC_USE_HDR\ncolor.rgb = sqrt(ACESToneMap(color.rgb));\n#endif\nreturn color;\n}\nin mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(texture(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(texture(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec2 v_uv;\nlayout(std140) uniform Constants {\nvec4 offset;\n};\nlayout(std140) uniform PerFrameInfo {\nvec4 digits[8 * 10 / 4];\n};\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nvec4 position = cc_matViewProj * vec4(a_position, 1.0);\nposition.xy += offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n#endif\nreturn color;\n}\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture(mainTexture, v_uv));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_uv;\nout float v_percent;\nlayout(std140) uniform Constant {\nvec4 u_buffer0;\nvec4 u_buffer1;\nmat4 u_projection;\n};\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nv_percent = u_buffer0.z;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nin vec2 v_uv;\nin float v_percent;\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture(mainTexture, v_uv);\nfloat precent = clamp(v_percent, 0.0, 1.0);\ncolor.xyz *= precent;\nreturn color;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}]]},Yp=function(){function e(){this._device=null,this._resources={}}var t=e.prototype;return t.initBuiltinRes=function(e){var t=this;this._device=e;var n=this._resources,r=document.createElement("canvas"),o=r.getContext("2d"),a=new Uf(r),s=r.width=r.height=2;o.fillStyle="#000",o.fillRect(0,0,s,s);var c=new dp;c._uuid="black-texture",c.image=a,n[c._uuid]=c,o.fillStyle="rgba(0,0,0,0)",o.fillRect(0,0,s,s);var l=new dp;l._uuid="empty-texture",l.image=a,n[l._uuid]=l;var u=new pp;u._uuid="black-cube-texture",u.setMipFilter(pp.Filter.NEAREST),u.image={front:new Uf(r),back:new Uf(r),left:new Uf(r),right:new Uf(r),top:new Uf(r),bottom:new Uf(r)},n[u._uuid]=u,o.fillStyle="#777",o.fillRect(0,0,s,s);var h=new dp;h._uuid="grey-texture",h.image=a,n[h._uuid]=h,o.fillStyle="#fff",o.fillRect(0,0,s,s);var _=new dp;_._uuid="white-texture",_.image=a,n[_._uuid]=_;var f=new pp;f._uuid="white-cube-texture",f.setMipFilter(pp.Filter.NEAREST),f.image={front:new Uf(r),back:new Uf(r),left:new Uf(r),right:new Uf(r),top:new Uf(r),bottom:new Uf(r)},n[f._uuid]=f,o.fillStyle="#7f7fff",o.fillRect(0,0,s,s);var d=new dp;d._uuid="normal-texture",d.image=a,n[d._uuid]=d,r.width=r.height=16,o.fillStyle="#ddd",o.fillRect(0,0,16,16),o.fillStyle="#555",o.fillRect(0,0,8,8),o.fillStyle="#555",o.fillRect(8,8,8,8);var p=new dp;p._uuid="default-texture",p.image=a,n[p._uuid]=p;var m=new pp;if(m.setMipFilter(pp.Filter.NEAREST),m._uuid="default-cube-texture",m.image={front:new Uf(r),back:new Uf(r),left:new Uf(r),right:new Uf(r),top:new Uf(r),bottom:new Uf(r)},n[m._uuid]=m,i.SpriteFrame){var g=new i.SpriteFrame,v=a._texture;g.texture=v,g._uuid="default-spriteframe",n[g._uuid]=g}var y=kp(e);if(!y)return Promise.reject(Error("Failed to initialize builtin shaders: unknown device."));var S=Xp[y];return S?Promise.resolve().then((function(){Sp.forEach((function(e,t){var n=Object.assign(new i.EffectAsset,e);n.shaders.forEach((function(e,n){var i=S[t][n];i&&(e[y]=i)})),n.hideInEditor=!0,n.onLoaded()})),t._initMaterials()})):Promise.reject(Error("Current device is requiring builtin shaders of version "+y+" but shaders of that version are not assembled in this build."))},t.get=function(e){return this._resources[e]},t._initMaterials=function(){var e=this._resources,t=[],n=new i.Material;n._uuid="standard-material",n.initialize({effectName:"standard"}),e[n._uuid]=n,t.push(n);var r=new i.Material;r._uuid="missing-effect-material",r.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),r.setProperty("mainColor",i.color("#ffff00")),e[r._uuid]=r,t.push(r);var o=new i.Material;o._uuid="missing-material",o.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),o.setProperty("mainColor",i.color("#ff00ff")),e[o._uuid]=o,t.push(o);var a=new i.Material;a._uuid="default-clear-stencil",a.initialize({defines:{USE_TEXTURE:!1},effectName:"clear-stencil"}),e[a._uuid]=a,t.push(a);var s=new i.Material;s._uuid="ui-base-material",s.initialize({defines:{USE_TEXTURE:!1},effectName:"sprite"}),e[s._uuid]=s,t.push(s);var c=new i.Material;c._uuid="ui-sprite-material",c.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[c._uuid]=c,t.push(c);var l=new i.Material;l._uuid="ui-alpha-test-material",l.initialize({defines:{USE_TEXTURE:!0,USE_ALPHA_TEST:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[l._uuid]=l,t.push(l);var u=new i.Material;u._uuid="ui-sprite-gray-material",u.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!0},effectName:"sprite"}),e[u._uuid]=u,t.push(u);var h=new i.Material;h._uuid="ui-sprite-alpha-sep-material",h.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"sprite"}),e[h._uuid]=h,t.push(h);var _=new i.Material;_._uuid="ui-sprite-gray-alpha-sep-material",_.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!0},effectName:"sprite"}),e[_._uuid]=_,t.push(_);var f=new i.Material;f._uuid="ui-graphics-material",f.initialize({effectName:"graphics"}),e[f._uuid]=f,t.push(f);var d=new i.Material;d._uuid="default-particle-material",d.initialize({effectName:"particle"}),e[d._uuid]=d,t.push(d);var p=new i.Material;p._uuid="default-particle-gpu-material",p.initialize({effectName:"particle-gpu"}),e[p._uuid]=p,t.push(p);var m=new i.Material;m._uuid="default-trail-material",m.initialize({effectName:"particle-trail"}),e[m._uuid]=m,t.push(m);var g=new i.Material;g._uuid="default-billboard-material",g.initialize({effectName:"billboard"}),e[g._uuid]=g,t.push(g);var v=new i.Material;v._uuid="default-spine-material",v.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"spine"}),e[v._uuid]=v,t.push(v);var y=new i.Material;y._uuid="builtin-deferred-material",y.initialize({effectName:"deferred-lighting"}),e[y._uuid]=y,t.push(y);var S=new i.Material;S._uuid="builtin-post-process-material",S.initialize({effectName:"post-process"}),e[S._uuid]=S,t.push(S),i.game.on(i.Game.EVENT_RENDERER_INITED,(function(){for(var e=0;e<t.length;++e)for(var n=t[e],i=0;i<n.passes.length;++i)n.passes[i].tryCompile()}))},e}(),Kp=e("builtinResMgr",i.builtinResMgr=new Yp),Zp=e("getPhaseID",(Wp=new Map,jp=0,function(e){return"number"==typeof e?e:(Wp.has(e)||(Wp.set(e,1<<jp),jp++),Wp.get(e))})),Qp=new ps(Ta.UNIFORM|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE),Jp=new ms(null),$p=new Ws(null);!function(e){e[e.INSTANCING=1]="INSTANCING",e[e.VB_MERGING=2]="VB_MERGING"}(qp||(qp={}));var em=function(){function e(e){this._rootBuffer=null,this._rootBufferDirty=!1,this._buffers=[],this._descriptorSet=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._root=void 0,this._device=void 0,this._hShaderDefault=0,this._handle=0,this._bs=new Ac,this._dss=new Tc,this._rs=new Ec,this._root=e,this._device=e.device}e.fillPipelineInfo=function(e,t){var n=e.handle;void 0!==t.priority&&Dr.set(n,pr.PRIORITY,t.priority),void 0!==t.primitive&&Dr.set(n,pr.PRIMITIVE,t.primitive),void 0!==t.stage&&Dr.set(n,pr.STAGE,t.stage),void 0!==t.dynamicStates&&Dr.set(n,pr.DYNAMIC_STATES,t.dynamicStates),void 0!==t.phase&&Dr.set(n,pr.PHASE,Zp(t.phase));var i=e._bs;if(t.blendState){var r=t.blendState,o=r.targets;o&&o.forEach((function(e,t){i.setTarget(t,e)})),void 0!==r.isA2C&&(i.isA2C=r.isA2C),void 0!==r.isIndepend&&(i.isIndepend=r.isIndepend),void 0!==r.blendColor&&(i.blendColor=r.blendColor)}e._rs.assign(t.rasterizerState),e._dss.assign(t.depthStencilState)},e.getPassHash=function(e,t){var n,i=e.handle,r=t+","+Dr.get(i,pr.PRIMITIVE)+","+Dr.get(i,pr.DYNAMIC_STATES);return r+=function(e){for(var t,n=",bs,"+e.isA2C,i=$(e.targets);!(t=i()).done;){var r=t.value;n+=",bt,"+r.blend+","+r.blendEq+","+r.blendAlphaEq+","+r.blendColorMask,n+=","+r.blendSrc+","+r.blendDst+","+r.blendSrcAlpha+","+r.blendDstAlpha}return n}(e._bs),r+=function(e){var t=",dss,"+e.depthTest+","+e.depthWrite+","+e.depthFunc;return t+=","+e.stencilTestFront+","+e.stencilFuncFront+","+e.stencilRefFront+","+e.stencilReadMaskFront,t+=","+e.stencilFailOpFront+","+e.stencilZFailOpFront+","+e.stencilPassOpFront+","+e.stencilWriteMaskFront,(t+=","+e.stencilTestBack+","+e.stencilFuncBack+","+e.stencilRefBack+","+e.stencilReadMaskBack)+","+e.stencilFailOpBack+","+e.stencilZFailOpBack+","+e.stencilPassOpBack+","+e.stencilWriteMaskBack}(e._dss),mc(r+=",rs,"+(n=e._rs).cullMode+","+n.depthBias+","+n.isFrontFaceCCW,666)};var t=e.prototype;return t.initialize=function(e){this._doInit(e),this.resetUBOs(),this.resetTextures(),this.tryCompile()},t.getHandle=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=Ea.UNKNOWN);var i=this._propertyHandleMap[e];return i?(n?i=Pp(i,n):t&&(i=Pp(i,wp(i)-t)),i+t):0},t.getBinding=function(t){var n=this.getHandle(t);return n?e.getBindingFromHandle(n):-1},t.setUniform=function(t,n){var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=e.getOffsetFromHandle(t),a=this._blocks[i];Dp[r](a,n,o),this._rootBufferDirty=!0},t.getUniform=function(t,n){var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=e.getOffsetFromHandle(t),a=this._blocks[i];return Op[r](a,n,o)},t.setUniformArray=function(t,n){for(var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=sc(r)>>2,a=this._blocks[i],s=e.getOffsetFromHandle(t),c=0;c<n.length;c++,s+=o)null!==n[c]&&Dp[r](a,n[c],s);this._rootBufferDirty=!0},t.bindTexture=function(e,t,n){this._descriptorSet.bindTexture(e,t,n||0)},t.bindSampler=function(e,t,n){this._descriptorSet.bindSampler(e,t,n||0)},t.setDynamicState=function(e,t){var n=this._dynamics[e];n&&n.value===t||(n.value=t,n.dirty=!0)},t.overridePipelineStates=function(){console.warn("base pass cannot override states, please use pass instance instead.")},t.update=function(){this._rootBufferDirty&&this._rootBuffer&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()},t.destroy=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++){var t=this._shaderInfo.blocks[e];this._buffers[t.binding].destroy()}this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBlock=null),this._descriptorSet=null,this._rs.destroy(),this._dss.destroy(),this._bs.destroy(),this._handle&&(gr.free(Dr.get(this._handle,pr.DESCRIPTOR_SET)),Dr.free(this._handle),this._handle=0)},t.resetUniform=function(t){var n=this.getHandle(t);if(n){var i=e.getTypeFromHandle(n),r=e.getBindingFromHandle(n),o=e.getOffsetFromHandle(n),a=this._blocks[r],s=this._properties[t],c=s&&s.value||Mp(i);Dp[i](a,c,o),this._rootBufferDirty=!0}},t.resetTexture=function(t,n){var i=this.getHandle(t);if(i){var r=e.getTypeFromHandle(i),o=e.getBindingFromHandle(i),a=this._properties[t],s=a&&a.value,c=s?s+"-texture":Mp(r),l=Kp.get(c),u=l&&l.getGFXTexture(),h=a&&void 0!==a.samplerHash?a.samplerHash:l&&l.getSamplerHash(),_=id.getSampler(this._device,h);this._descriptorSet.bindSampler(o,_,n),this._descriptorSet.bindTexture(o,u,n)}},t.resetUBOs=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++)for(var t=this._shaderInfo.blocks[e],n=this._blocks[t.binding],i=0,r=0;r<t.members.length;r++){for(var o=t.members[r],a=this._properties[o.name],s=a&&a.value||Mp(o.type),c=(sc(o.type)>>2)*o.count,l=0;l+s.length<=c;l+=s.length)n.set(s,i+l);i+=c}this._rootBufferDirty=!0},t.resetTextures=function(){for(var e=0;e<this._shaderInfo.samplerTextures.length;e++)for(var t=this._shaderInfo.samplerTextures[e],n=0;n<t.count;n++)this.resetTexture(t.name,n)},t.tryCompile=function(){var t=this._root.pipeline;return!!t&&(this._syncBatchingScheme(),this._hShaderDefault=Vp.getGFXShader(this._device,this._programName,this._defines,t),this._hShaderDefault?(Dr.set(this._handle,pr.PIPELINE_LAYOUT,Vp.getTemplateInfo(this._programName).hPipelineLayout),Dr.set(this._handle,pr.HASH,e.getPassHash(this,this._hShaderDefault)),!0):(console.warn("create shader "+this._programName+" failed"),!1))},t.getShaderVariant=function(e){if(void 0===e&&(e=null),!this._hShaderDefault&&!this.tryCompile())return console.warn("pass resources incomplete"),0;if(!e)return this._hShaderDefault;for(var t=this._root.pipeline,n=0;n<e.length;n++){var i=e[n];this._defines[i.name]=i.value}for(var r=Vp.getGFXShader(this._device,this._programName,this._defines,t),o=0;o<e.length;o++){var a=e[o];delete this._defines[a.name]}return r},t.beginChangeStatesSilently=function(){},t.endChangeStatesSilently=function(){},t._doInit=function(t,n){void 0===n&&(n=!1);var i=this._handle=Dr.alloc();Dr.set(i,pr.PRIORITY,Pu.DEFAULT),Dr.set(i,pr.STAGE,Iu.DEFAULT),Dr.set(i,pr.PHASE,Zp("default")),Dr.set(i,pr.PRIMITIVE,ka.TRIANGLE_LIST),Dr.set(i,pr.RASTERIZER_STATE,this._rs.handle),Dr.set(i,pr.DEPTH_STENCIL_STATE,this._dss.handle),Dr.set(i,pr.BLEND_STATE,this._bs.handle),this._passIndex=t.passIndex,this._propertyIndex=void 0!==t.propertyIndex?t.propertyIndex:t.passIndex,this._programName=t.program,this._defines=n?Y({},t.defines):t.defines,this._shaderInfo=Vp.getTemplate(t.program),this._properties=t.properties||this._properties;var r=this._device;e.fillPipelineInfo(this,t),t.stateOverrides&&e.fillPipelineInfo(this,t.stateOverrides),$p.layout=Vp.getDescriptorSetLayout(this._device,t.program);var o=gr.alloc(this._device,$p);Dr.set(this._handle,pr.DESCRIPTOR_SET,o),this._descriptorSet=gr.get(o);for(var a=this._shaderInfo.blocks,s=Vp.getTemplateInfo(t.program),c=s.blockSizes,l=s.handleMap,u=r.capabilities.uboOffsetAlignment,h=[],_=0,f=0,d=0;d<a.length;d++){var p=c[d];h.push(f),f+=Math.ceil(p/u)*u,_=p}var m=h[h.length-1]+_;m&&(Qp.size=16*Math.ceil(m/16),this._rootBuffer=r.createBuffer(Qp),this._rootBlock=new ArrayBuffer(m));for(var g=0,v=0;g<a.length;g++){var y=a[g].binding,S=c[g];Jp.buffer=this._rootBuffer,Jp.offset=h[v++],Jp.range=16*Math.ceil(S/16);var E=this._buffers[y]=r.createBuffer(Jp);this._blocks[y]=new Float32Array(this._rootBlock,Jp.offset,S/Float32Array.BYTES_PER_ELEMENT),this._descriptorSet.bindBuffer(y,E)}var T=this._propertyHandleMap=l,x={};for(var A in this._properties){var C=this._properties[A];C.handleInfo&&(x[A]=this.getHandle.apply(this,C.handleInfo))}Object.assign(T,x)},t._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(va.INSTANCED_ARRAYS)?Dr.set(this._handle,pr.BATCHING_SCHEME,qp.INSTANCING):(this._defines.USE_INSTANCING=!1,Dr.set(this._handle,pr.BATCHING_SCHEME,0)):this._defines.USE_BATCHING?Dr.set(this._handle,pr.BATCHING_SCHEME,qp.VB_MERGING):Dr.set(this._handle,pr.BATCHING_SCHEME,0)},t._destroyHandle=function(){this._handle&&(Dr.free(this._handle),this._handle=0)},t._initPassFromTarget=function(e,t,n,i){Dr.set(this.handle,pr.PRIORITY,e.priority),Dr.set(this.handle,pr.STAGE,e.stage),Dr.set(this.handle,pr.PHASE,e.phase),Dr.set(this.handle,pr.BATCHING_SCHEME,e.batchingScheme),Dr.set(this.handle,pr.PRIMITIVE,e.primitive),Dr.set(this.handle,pr.DYNAMIC_STATES,e.dynamicStates),this._descriptorSet=e.descriptorSet,Dr.set(this.handle,pr.DESCRIPTOR_SET,Dr.get(e.handle,pr.DESCRIPTOR_SET)),this._bs=n,Dr.set(this.handle,pr.BLEND_STATE,n.handle),this._rs=e.rasterizerState,Dr.set(this.handle,pr.RASTERIZER_STATE,Dr.get(e.handle,pr.RASTERIZER_STATE)),this._dss=t,Dr.set(this.handle,pr.DEPTH_STENCIL_STATE,t.handle),this._passIndex=e.passIndex,this._propertyIndex=e.propertyIndex,this._programName=e.program,this._defines=e.defines,this._shaderInfo=e._shaderInfo,this._properties=e._properties,this._blocks=e._blocks,this._dynamics=e._dynamics,this._hShaderDefault=e._hShaderDefault,Dr.set(this._handle,pr.PIPELINE_LAYOUT,Vp.getTemplateInfo(this._programName).hPipelineLayout);var r=Dr.get(e.handle,pr.HASH);Dr.set(this._handle,pr.HASH,r^i)},X(e,[{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return Vp.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"handle",get:function(){return this._handle}},{key:"priority",get:function(){return Dr.get(this._handle,pr.PRIORITY)}},{key:"primitive",get:function(){return Dr.get(this._handle,pr.PRIMITIVE)}},{key:"stage",get:function(){return Dr.get(this._handle,pr.STAGE)}},{key:"phase",get:function(){return Dr.get(this._handle,pr.PHASE)}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return Dr.get(this._handle,pr.DYNAMIC_STATES)}},{key:"batchingScheme",get:function(){return Dr.get(this._handle,pr.BATCHING_SCHEME)}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return Dr.get(this._handle,pr.HASH)}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}}]),e}();em.PropertyType=yp,em.getPropertyTypeFromHandle=bp,em.getTypeFromHandle=wp,em.getBindingFromHandle=Rp,em.getOffsetFromHandle=Ip,z(h_.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),z(h_.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]);var tm={};z(tm,"CameraVisFlags",[{name:"GENERAL"}]),F(tm,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:Ru.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Ru.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Ru.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Ru.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Ru.BitMask,targetName:"UI_2D"}]),i.CameraVisFlags=tm;var nm,im={};function rm(e,t){t<1e3?t=1e3:t>15e3&&(t=15e3);var n=t*t,i=(.860117757+.000154118254*t+1.28641212e-7*n)/(1+.000842420235*t+7.08145163e-7*n),r=(.317398726+422806245e-13*t+4.20481691e-8*n)/(1-289741816e-13*t+1.61456053e-7*n),o=2*i-8*r+4,a=3*i/o,s=2*r/o,c=1/s*a,l=1/s*(1-a-s);e.x=3.2404542*c-1.5371385+-.4985314*l,e.y=-.969266*c+1.8760108+.041556*l,e.z=.0556434*c-.2040259+1.0572252*l}z(im,"VisibilityFlags",[{name:"GENERAL"}]),F(im,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:Ru.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:Ru.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Ru.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Ru.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Ru.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Ru.Enum,targetName:"UI_2D"}]),i.VisibilityFlags=im,F(em.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),z(u_.prototype,"Camera.prototype",[{name:"getSplitFrustum"}]),function(e){e[e.DIRECTIONAL=0]="DIRECTIONAL",e[e.SPHERE=1]="SPHERE",e[e.SPOT=2]="SPOT",e[e.UNKNOWN=3]="UNKNOWN"}(nm||(nm={}));var om=function(e){return 4*Math.PI*Math.PI*e*e},am=function(){function e(){this._baked=!1,this._color=new yn(1,1,1),this._colorTemp=6550,this._colorTempRGB=new yn(1,1,1),this._scene=null,this._node=null,this._name=null,this._handle=0}var t=e.prototype;return t.initialize=function(){this._handle=wo.alloc(),wo.setVec3(this._handle,To.COLOR,this._color),wo.setVec3(this._handle,To.COLOR_TEMPERATURE_RGB,this._colorTempRGB),wo.set(this._handle,To.TYPE,nm.UNKNOWN)},t.attachToScene=function(e){this._scene=e},t.detachFromScene=function(){this._scene=null},t.destroy=function(){this._name=null,this._node=null,this._handle&&(wo.free(this._handle),this._handle=0)},t.update=function(){},X(e,[{key:"baked",get:function(){return this._baked},set:function(e){this._baked=e}},{key:"color",get:function(){return this._color},set:function(e){this._color.set(e),wo.setVec3(this._handle,To.COLOR,e)}},{key:"useColorTemperature",get:function(){return 1===wo.get(this._handle,To.USE_COLOR_TEMPERATURE)},set:function(e){wo.set(this._handle,To.USE_COLOR_TEMPERATURE,e?1:0)}},{key:"colorTemperature",get:function(){return this._colorTemp},set:function(e){this._colorTemp=e,rm(this._colorTempRGB,this._colorTemp),wo.setVec3(this._handle,To.COLOR_TEMPERATURE_RGB,this._colorTempRGB)}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"node",get:function(){return this._node},set:function(e){this._node=e,this._node&&(this._node.hasChangedFlags|=t_.ROTATION,wo.set(this._handle,To.NODE,this._node.handle))}},{key:"type",get:function(){return wo.get(this._handle,To.TYPE)}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"scene",get:function(){return this._scene}},{key:"handle",get:function(){return this._handle}}]),e}(),sm=new yn(0,0,-1),cm=new yn,lm=function(e){function t(){var t;return(t=e.call(this)||this)._dir=new yn(1,-1,-1),t}K(t,e);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),wo.set(this._handle,To.ILLUMINANCE,Xo.SUN_ILLUM),wo.setVec3(this._handle,To.DIRECTION,this._dir),wo.set(this._handle,To.TYPE,nm.DIRECTIONAL)},n.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=yn.transformQuat(cm,sm,this._node.worldRotation))},X(t,[{key:"direction",get:function(){return this._dir},set:function(e){yn.normalize(this._dir,e),wo.setVec3(this._handle,To.DIRECTION,this._dir)}},{key:"illuminance",get:function(){return wo.get(this._handle,To.ILLUMINANCE)},set:function(e){wo.set(this._handle,To.ILLUMINANCE,e)}}]),t}(am);function um(e,t){for(var n,i=$(t);!(n=i()).done;){var r=n.value;Array.isArray(r)?um(e,r):e.push(r)}}function hm(e){var t=[];return um(t,e),t.join("")}var _m=ei.Flags.Destroyed,fm=ei.Flags.PersistentMask,dm=Wt.IDENTIFIER_RE,pm="var ",mm="o",gm={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},vm=Wt.escapeForJS,ym=function(){function e(e,t){this.varName=void 0,this.expression=void 0,this.varName=e,this.expression=t}return e.prototype.toString=function(){return pm+this.varName+"="+this.expression+";"},e}();function Sm(e,t){return t instanceof ym?new ym(t.varName,e+t.expression):e+t}function Em(e,t,n){Array.isArray(n)?(n[0]=Sm(t,n[0]),e.push(n)):e.push(Sm(t,n)+";")}var Tm=function(){function e(e){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=e}var t=e.prototype;return t.append=function(e,t){this._exps.push([e,t])},t.writeCode=function(e){var t;if(this._exps.length>1)e.push("t="+this._targetExp+";"),t="t";else{if(1!==this._exps.length)return;t=this._targetExp}for(var n=0;n<this._exps.length;n++){var i=this._exps[n];Em(e,t+xm(i[0])+"=",i[1])}},e}();function xm(e){return dm.test(e)?"."+e:"["+vm(e)+"]"}Tm.pool=void 0,Tm.pool=new Xe((function(e){e._exps.length=0,e._targetExp=null}),1),Tm.pool.get=function(e){var t=this._get()||new Tm;return t._targetExp=e,t};var Am=function(){function e(e,t){var n;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=t,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=Se(),Oe(this.funcModuleCache,gm),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(e.constructor,!0)+"();","}"),e._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(e),this.enumerateObject(this.codeArray,e),this.globalVariables.length>0&&(n=pm+this.globalVariables.join(",")+";");var i=hm(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",i)(this.objs,this.funcs);for(var r=0,o=this.objsToClear_iN$t.length;r<o;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}var t=e.prototype;return t.getFuncModule=function(e,t){var n=Ee(e);if(n){var i=this.funcModuleCache[n];if(i)return i;if(void 0===i){var r=-1!==n.indexOf(".");if(r)try{if(r=e===Function("return "+n)())return this.funcModuleCache[n]=n,n}catch(e){}}}var o=this.funcs.indexOf(e);o<0&&(o=this.funcs.length,this.funcs.push(e));var a="F["+o+"]";return t&&(a="("+a+")"),this.funcModuleCache[n]=a,a},t.getObjRef=function(e){var t=this.objs.indexOf(e);return t<0&&(t=this.objs.length,this.objs.push(e)),"O["+t+"]"},t.setValueType=function(e,t,n,i){var r=Tm.pool.get(i),o=t.constructor.__props__;o||(o=Object.keys(t));for(var a=0;a<o.length;a++){var s=o[a],c=n[s];if(t[s]!==c){var l=this.enumerateField(n,s,c);r.append(s,l)}}r.writeCode(e),Tm.pool.put(r)},t.enumerateCCClass=function(e,t,n){for(var r=n.__values__,o=Et(n),a=0;a<r.length;a++){var s=r[a],c=t[s],l=o[s+"$_$default"];if(!Cm(l,c))if("object"==typeof c&&c instanceof i.ValueType&&(l=Wt.getDefault(l))&&l.constructor===c.constructor){var u=mm+xm(s);this.setValueType(e,l,c,u)}else this.setObjProp(e,t,s,c)}},t.instantiateArray=function(e){if(0===e.length)return"[]";var t="a"+ ++this.localVariableId,n=[new ym(t,"new Array("+e.length+")")];e._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(e);for(var i=0;i<e.length;++i)Em(n,t+"["+i+"]=",this.enumerateField(e,i,e[i]));return n},t.instantiateTypedArray=function(e){var t=e.constructor.name;if(0===e.length)return"new "+t;var n="a"+ ++this.localVariableId,i=[new ym(n,"new "+t+"("+e.length+")")];e._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(e);for(var r=0;r<e.length;++r)0!==e[r]&&Em(i,n+"["+r+"]=",e[r]);return i},t.enumerateField=function(e,t,n){if("object"==typeof n&&n){var i=n._iN$t;if(i){var r=i.globalVar;if(!r){r=i.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var o=i.source[0];i.source[0]=Sm(r+"=",o)}return r}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?vm(n):("_objFlags"===t&&e instanceof ei&&(n&=fm),n)},t.setObjProp=function(e,t,n,i){Em(e,mm+xm(n)+"=",this.enumerateField(t,n,i))},t.enumerateObject=function(e,t){var n=t.constructor;if(i.Class._isCCClass(n))this.enumerateCCClass(e,t,n);else for(var r in t)if(t.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var o=t[r];"object"==typeof o&&o&&o===t._iN$t||this.setObjProp(e,t,r,o)}},t.instantiateObj=function(e){if(e instanceof i.ValueType)return Wt.getNewValueTypeCode(e);if(e instanceof i.Asset)return this.getObjRef(e);if(e._objFlags&_m)return null;var t,n=e.constructor;if(i.Class._isCCClass(n)){if(this.parent)if(this.parent instanceof i.Component){if(e instanceof i._BaseNode||e instanceof i.Component)return this.getObjRef(e)}else if(this.parent instanceof i._BaseNode)if(e instanceof i._BaseNode){if(!e.isChildOf(this.parent))return this.getObjRef(e)}else if(e instanceof i.Component&&!e.node.isChildOf(this.parent))return this.getObjRef(e);t=new ym(mm,"new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)t=new ym(mm,"{}");else{if(n)return this.getObjRef(e);t=new ym(mm,"Object.create(null)")}var r=[t];return e._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(e),this.enumerateObject(r,e),["(function(){",r,"return o;})();"]},e}();function Cm(e,t){if("function"==typeof e)try{e=e()}catch(e){return!1}if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t&&e.constructor===t.constructor)if(e instanceof i.ValueType){if(e.equals(t))return!0}else{if(Array.isArray(e))return 0===e.length&&0===t.length;if(e.constructor===Object)return de(e)&&de(t)}return!1}var bm,wm=function(){function e(e){this._uiComp=null,this.opacity=1,this.localOpacity=1,this._uiTransformComp=null,this._node=void 0,this._node=e}return X(e,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(e){this._uiTransformComp=e}},{key:"uiComp",get:function(){return this._uiComp},set:function(e){this._uiComp&&e?A(12002):this._uiComp=e}}]),e}();!function(e){e.TOUCH_START="touch-start",e.TOUCH_MOVE="touch-move",e.TOUCH_END="touch-end",e.TOUCH_CANCEL="touch-cancel",e.MOUSE_DOWN="mouse-down",e.MOUSE_MOVE="mouse-move",e.MOUSE_UP="mouse-up",e.MOUSE_WHEEL="mouse-wheel",e.MOUSE_ENTER="mouse-enter",e.MOUSE_LEAVE="mouse-leave",e.KEY_DOWN="keydown",e.KEY_UP="keyup",e.DEVICEMOTION="devicemotion",e.TRANSFORM_CHANGED="transform-changed",e.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",e.SIZE_CHANGED="size-changed",e.ANCHOR_CHANGED="anchor-changed",e.COLOR_CHANGED="color-changed",e.CHILD_ADDED="child-added",e.CHILD_REMOVED="child-removed",e.PARENT_CHANGED="parent-changed",e.NODE_DESTROYED="node-destroyed",e.LAYER_CHANGED="layer-changed",e.SIBLING_ORDER_CHANGED="sibling-order-changed"}(bm||(bm=e("SystemEventType",{}))),et(bm),i.SystemEventType=bm;var Rm=function(){function e(e,t,n){this._cameraPriority=0,this.owner=null,this.mask=null,this._previousIn=!1,this._target=null,this._onEvent=void 0,this._type=void 0,this._listenerID=void 0,this._registered=!1,this._fixedPriority=0,this._node=null,this._paused=!0,this._isEnabled=!0,this._onEvent=n,this._type=e||0,this._listenerID=t||""}e.create=function(e){I(e&&e.event,1900);var t=e.event;delete e.event;var n=null;if(t===i.EventListener.TOUCH_ONE_BY_ONE?n=new Om:t===i.EventListener.TOUCH_ALL_AT_ONCE?n=new Dm:t===i.EventListener.MOUSE?n=new Pm:t===i.EventListener.KEYBOARD?n=new Mm:t===i.EventListener.ACCELERATION&&(n=new Nm(e.callback),delete e.callback),n)for(var r=0,o=Object.keys(e);r<o.length;r++){var a=o[r];n[a]=e[a]}return n};var t=e.prototype;return t._setPaused=function(e){this._paused=e},t._isPaused=function(){return this._paused},t._setRegistered=function(e){this._registered=e},t._isRegistered=function(){return this._registered},t._getType=function(){return this._type},t._getListenerID=function(){return this._listenerID},t._setFixedPriority=function(e){this._fixedPriority=e},t._getFixedPriority=function(){return this._fixedPriority},t._setSceneGraphPriority=function(e){this._target=e,this._node=e},t._getSceneGraphPriority=function(){return this._node},t.checkAvailable=function(){return null!==this._onEvent},t.clone=function(){return null},t.setEnabled=function(e){this._isEnabled=e},t.isEnabled=function(){return this._isEnabled},X(e,[{key:"onEvent",get:function(){return this._onEvent}}]),e}();Rm.UNKNOWN=0,Rm.TOUCH_ONE_BY_ONE=1,Rm.TOUCH_ALL_AT_ONCE=2,Rm.KEYBOARD=3,Rm.MOUSE=4,Rm.ACCELERATION=6,Rm.CUSTOM=8,Rm.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"};var Im=Rm.ListenerID,Pm=function(e){function t(){var t;return(t=e.call(this,Rm.MOUSE,Im.MOUSE,null)||this).onMouseDown=null,t.onMouseUp=null,t.onMouseMove=null,t.onMouseScroll=null,t._onEvent=function(e){return t._callback(e)},t}K(t,e);var n=t.prototype;return n._callback=function(e){switch(e.eventType){case bm.MOUSE_DOWN:this.onMouseDown&&this.onMouseDown(e);break;case bm.MOUSE_UP:this.onMouseUp&&this.onMouseUp(e);break;case bm.MOUSE_MOVE:this.onMouseMove&&this.onMouseMove(e);break;case bm.MOUSE_WHEEL:this.onMouseScroll&&this.onMouseScroll(e)}},n.clone=function(){var e=new t;return e.onMouseDown=this.onMouseDown,e.onMouseUp=this.onMouseUp,e.onMouseMove=this.onMouseMove,e.onMouseScroll=this.onMouseScroll,e},n.checkAvailable=function(){return!0},t}(Rm),Om=function(e){function t(){var t;return(t=e.call(this,Rm.TOUCH_ONE_BY_ONE,Im.TOUCH_ONE_BY_ONE,null)||this).swallowTouches=!1,t.onTouchBegan=null,t.onTouchMoved=null,t.onTouchEnded=null,t.onTouchCancelled=null,t._claimedTouches=[],t}K(t,e);var n=t.prototype;return n.setSwallowTouches=function(e){this.swallowTouches=e},n.isSwallowTouches=function(){return this.swallowTouches},n.clone=function(){var e=new t;return e.onTouchBegan=this.onTouchBegan,e.onTouchMoved=this.onTouchMoved,e.onTouchEnded=this.onTouchEnded,e.onTouchCancelled=this.onTouchCancelled,e.swallowTouches=this.swallowTouches,e},n.checkAvailable=function(){return!!this.onTouchBegan||(T(1801),!1)},t}(Rm),Dm=function(e){function t(){var t;return(t=e.call(this,Rm.TOUCH_ALL_AT_ONCE,Im.TOUCH_ALL_AT_ONCE,null)||this).onTouchesBegan=null,t.onTouchesMoved=null,t.onTouchesEnded=null,t.onTouchesCancelled=null,t}K(t,e);var n=t.prototype;return n.clone=function(){var e=new t;return e.onTouchesBegan=this.onTouchesBegan,e.onTouchesMoved=this.onTouchesMoved,e.onTouchesEnded=this.onTouchesEnded,e.onTouchesCancelled=this.onTouchesCancelled,e},n.checkAvailable=function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(T(1802),!1)},t}(Rm),Nm=function(e){function t(t){var n;return(n=e.call(this,Rm.ACCELERATION,Im.ACCELERATION,null)||this)._onAccelerationEvent=null,n._onEvent=function(e){return n._callback(e)},n._onAccelerationEvent=t,n}K(t,e);var n=t.prototype;return n._callback=function(e){this._onAccelerationEvent&&this._onAccelerationEvent(e.acc,e)},n.checkAvailable=function(){return I(this._onAccelerationEvent,1803),!0},n.clone=function(){return new t(this._onAccelerationEvent)},t}(Rm),Mm=function(e){function t(){var t;return(t=e.call(this,Rm.KEYBOARD,Im.KEYBOARD,null)||this).onKeyPressed=null,t.onKeyReleased=null,t._onEvent=function(e){return t._callback(e)},t}K(t,e);var n=t.prototype;return n._callback=function(e){e.isPressed?this.onKeyPressed&&this.onKeyPressed(e.keyCode,e):this.onKeyReleased&&this.onKeyReleased(e.keyCode,e)},n.clone=function(){var e=new t;return e.onKeyPressed=this.onKeyPressed,e.onKeyReleased=this.onKeyReleased,e},n.checkAvailable=function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(T(1800),!1)},t}(Rm);i.EventListener=Rm;var Lm=Rm.ListenerID,Bm=function(){function e(){this.gt0Index=0,this._fixedListeners=[],this._sceneGraphListeners=[]}var t=e.prototype;return t.size=function(){return this._fixedListeners.length+this._sceneGraphListeners.length},t.empty=function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},t.push=function(e){0===e._getFixedPriority()?this._sceneGraphListeners.push(e):this._fixedListeners.push(e)},t.clearSceneGraphListeners=function(){this._sceneGraphListeners.length=0},t.clearFixedListeners=function(){this._fixedListeners.length=0},t.clear=function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},t.getFixedPriorityListeners=function(){return this._fixedListeners},t.getSceneGraphPriorityListeners=function(){return this._sceneGraphListeners},e}(),Fm=function(){function e(){this._listenersMap={},this._priorityDirtyFlagMap={},this._nodeListenersMap={},this._toAddedListeners=[],this._toRemovedListeners=[],this._dirtyListeners={},this._inDispatch=0,this._isEnabled=!1,this._internalCustomListenerIDs=[],this._currentTouch=null,this._currentTouchListener=null}var t=e.prototype;return t.pauseTarget=function(e,t){if(void 0===t&&(t=!1),e instanceof i._BaseNode){var n=this._nodeListenersMap[e.uuid];if(n)for(var r=0;r<n.length;++r)n[r]._setPaused(!0);if(!0===t){var o=e.children;if(o)for(var a=0;a<o.length;++a){var s=o[a];this.pauseTarget(s,!0)}}}else A(3506)},t.resumeTarget=function(e,t){if(void 0===t&&(t=!1),e instanceof i._BaseNode){var n=this._nodeListenersMap[e.uuid];if(n)for(var r=0;r<n.length;++r)n[r]._setPaused(!1);if(this._setDirtyForNode(e),!0===t&&e.children.length>0){var o=e.children;if(o)for(var a=0;a<o.length;++a){var s=o[a];this.resumeTarget(s,!0)}}}else A(3506)},t.frameUpdateListeners=function(){var e=this._listenersMap,t=this._priorityDirtyFlagMap;for(var n in e)e[n].empty()&&(delete t[n],delete e[n]);var i=this._toAddedListeners;if(0!==i.length){for(var r=0,o=i.length;r<o;r++)this._forceAddEventListener(i[r]);i.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},t.hasEventListener=function(e){return!!this._getListeners(e)},t.addListener=function(e,t){if(I(e&&t,3503),!(i.js.isNumber(t)||t instanceof i._BaseNode))return A(3506),null;if(e instanceof i.EventListener){if(e._isRegistered())return T(3505),null}else I(!i.js.isNumber(t),3504),e=i.EventListener.create(e);if(!e.checkAvailable())return null;if(i.js.isNumber(t)){if(0===t)return T(3500),null;e._setSceneGraphPriority(null),e._setFixedPriority(t),e._setRegistered(!0),e._setPaused(!1),this._addListener(e)}else{if(!(n=t)||!n.getComponent("cc.UITransform"))return T(3512),null;e._setSceneGraphPriority(t),e._setFixedPriority(0),e._setRegistered(!0),this._addListener(e)}var n;return e},t.addCustomListener=function(e,t){var n=Rm.create({event:i.EventListener.CUSTOM,eventName:e,callback:t});return this.addListener(n,1),n},t.removeListener=function(e){if(null!=e){var t=!1,n=this._listenersMap;for(var r in e===this._currentTouchListener&&(this._currentTouchListener=this._currentTouch=null),n){var o=n[r],a=o.getFixedPriorityListeners(),s=o.getSceneGraphPriorityListeners();if((t=this._removeListenerInVector(s,e))?this._setDirty(e._getListenerID(),2):(t=this._removeListenerInVector(a,e))&&this._setDirty(e._getListenerID(),1),o.empty()&&(delete this._priorityDirtyFlagMap[e._getListenerID()],delete n[r]),t)break}if(!t)for(var c=this._toAddedListeners,l=c.length-1;l>=0;l--){var u=c[l];if(u===e){i.js.array.removeAt(c,l),u._setRegistered(!1);break}}}},t.removeListeners=function(e,t){if(void 0===t&&(t=!1),i.js.isNumber(e)||e instanceof i._BaseNode)if(void 0!==e._id){var n=this._nodeListenersMap[e._id];if(n){for(var r=i.js.array.copy(n),o=0;o<r.length;++o){var a=r[o];this.removeListener(a)}delete this._nodeListenersMap[e._id]}for(var s=this._toAddedListeners,c=0;c<s.length;){var l=s[c];l._getSceneGraphPriority()===e?(l._setSceneGraphPriority(null),l._setRegistered(!1),s.splice(c,1)):++c}if(!0===t)for(var u=e.getChildren(),h=0;h<u.length;++h){var _=u[h];this.removeListeners(_,!0)}}else e===i.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(Lm.TOUCH_ONE_BY_ONE):e===i.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(Lm.TOUCH_ALL_AT_ONCE):e===i.EventListener.MOUSE?this._removeListenersForListenerID(Lm.MOUSE):e===i.EventListener.ACCELERATION?this._removeListenersForListenerID(Lm.ACCELERATION):e===i.EventListener.KEYBOARD?this._removeListenersForListenerID(Lm.KEYBOARD):T(3501);else A(3506)},t.removeCustomListeners=function(e){this._removeListenersForListenerID(e)},t.removeAllListeners=function(){var e=this._listenersMap,t=this._internalCustomListenerIDs;for(var n in e)-1===t.indexOf(n)&&this._removeListenersForListenerID(n)},t.setPriority=function(e,t){if(null!=e){var n=this._listenersMap;for(var i in n){var r=n[i].getFixedPriorityListeners();if(r&&-1!==r.indexOf(e))return null!=e._getSceneGraphPriority()&&T(3502),void(e._getFixedPriority()!==t&&(e._setFixedPriority(t),this._setDirty(e._getListenerID(),1)))}}},t.setEnabled=function(e){this._isEnabled=e},t.isEnabled=function(){return this._isEnabled},t.dispatchEvent=function(e){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,e&&e.getType){if(e.getType().startsWith(i.Event.TOUCH))return this._dispatchTouchEvent(e),void this._inDispatch--;var t=function(e){var t=wf,n=e.type;return n===t.ACCELERATION?Lm.ACCELERATION:n===t.KEYBOARD?Lm.KEYBOARD:n.startsWith(t.MOUSE)?Lm.MOUSE:(n.startsWith(t.TOUCH)&&T(2e3),"")}(e);this._sortEventListeners(t);var n=this._listenersMap[t];null!=n&&(this._dispatchEventToListeners(n,this._onListenerCallback,e),this._onUpdateListeners(n)),this._inDispatch--}else b(3511)},t._onListenerCallback=function(e,t){t.currentTarget=e._target;var n=e.onEvent;return n&&n(t),t.isStopped()},t.dispatchCustomEvent=function(e,t){var n=new i.Event.EventCustom(e);n.setUserData(t),this.dispatchEvent(n)},t._setDirtyForNode=function(e){var t=this._nodeListenersMap[e._id];if(void 0!==t)for(var n=0,i=t.length;n<i;n++){var r=t[n]._getListenerID();this._dirtyListeners[r]||(this._dirtyListeners[r]=!0)}if(e.children.length>0)for(var o=e.children,a=0,s=o?o.length:0;a<s;a++)this._setDirtyForNode(o[a])},t._addListener=function(e){0===this._inDispatch?this._forceAddEventListener(e):this._toAddedListeners.push(e)},t._forceAddEventListener=function(e){var t=e._getListenerID(),n=this._listenersMap[t];if(n||(n=new Bm,this._listenersMap[t]=n),n.push(e),0===e._getFixedPriority()){this._setDirty(t,2);var i=e._getSceneGraphPriority();null===i&&T(3507),this._associateNodeAndEventListener(i,e),i.activeInHierarchy&&this.resumeTarget(i)}else this._setDirty(t,1)},t._getListeners=function(e){return this._listenersMap[e]},t._updateDirtyFlagForSceneGraph=function(){var e=this._dirtyListeners;for(var t in e)this._setDirty(t,2),e[t]=!1},t._removeAllListenersInVector=function(e){if(e)for(var t,n=e.length-1;n>=0;n--)(t=e[n])._setRegistered(!1),null!=t._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(t._getSceneGraphPriority(),t),t._setSceneGraphPriority(null)),0===this._inDispatch&&i.js.array.removeAt(e,n)},t._removeListenersForListenerID=function(e){var t=this._listenersMap[e];if(t){var n=t.getFixedPriorityListeners(),r=t.getSceneGraphPriorityListeners();this._removeAllListenersInVector(r),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[e],this._inDispatch||(t.clear(),delete this._listenersMap[e])}for(var o=this._toAddedListeners,a=o.length-1;a>=0;a--){var s=o[a];s&&s._getListenerID()===e&&i.js.array.removeAt(o,a)}},t._sortEventListeners=function(e){var t=0,n=this._priorityDirtyFlagMap;n[e]&&(t=n[e]),0!==t&&(n[e]=0,1&t&&this._sortListenersOfFixedPriority(e),2&t&&i.director.getScene()&&this._sortListenersOfSceneGraphPriority(e))},t._sortListenersOfSceneGraphPriority=function(e){var t=this._getListeners(e);if(t){var n=t.getSceneGraphPriorityListeners();if(n&&0!==n.length){var i=t.getSceneGraphPriorityListeners();i.forEach((function(e){var t=e._getSceneGraphPriority()._uiProps.uiTransformComp;e._cameraPriority=t.cameraPriority})),i.sort(this._sortEventListenersOfSceneGraphPriorityDes)}}},t._sortEventListenersOfSceneGraphPriorityDes=function(e,t){var n=e._getSceneGraphPriority(),i=t._getSceneGraphPriority();if(!(t&&i&&i._activeInHierarchy&&i._uiProps.uiTransformComp))return-1;if(!(e&&n&&n._activeInHierarchy&&n._uiProps.uiTransformComp))return 1;var r=n,o=i,a=!1;if(e._cameraPriority!==t._cameraPriority)return t._cameraPriority-e._cameraPriority;for(;r.parent._id!==o.parent._id;)r=null===r.parent.parent?(a=!0)&&i:r.parent,o=null===o.parent.parent?(a=!0)&&n:o.parent;if(r._id===o._id){if(r._id===i._id)return-1;if(r._id===n._id)return 1}var s=r.getSiblingIndex(),c=o.getSiblingIndex();return a?s-c:c-s},t._sortListenersOfFixedPriority=function(e){var t=this._listenersMap[e];if(t){var n=t.getFixedPriorityListeners();if(n&&0!==n.length){n.sort(this._sortListenersOfFixedPriorityAsc);for(var i=0,r=n.length;i<r&&!(n[i]._getFixedPriority()>=0);)++i;t.gt0Index=i}}},t._sortListenersOfFixedPriorityAsc=function(e,t){return e._getFixedPriority()-t._getFixedPriority()},t._onUpdateListeners=function(e){var t=e.getFixedPriorityListeners(),n=e.getSceneGraphPriorityListeners(),r=this._toRemovedListeners;if(n)for(var o=n.length-1;o>=0;o--){var a=n[o];if(!a._isRegistered()){i.js.array.removeAt(n,o);var s=r.indexOf(a);-1!==s&&r.splice(s,1)}}if(t)for(var c=t.length-1;c>=0;c--){var l=t[c];if(!l._isRegistered()){i.js.array.removeAt(t,c);var u=r.indexOf(l);-1!==u&&r.splice(u,1)}}n&&0===n.length&&e.clearSceneGraphListeners(),t&&0===t.length&&e.clearFixedListeners()},t._updateTouchListeners=function(){var e=this._inDispatch;if(I(e>0,3508),!(e>1)){var t;(t=this._listenersMap[Lm.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(t),(t=this._listenersMap[Lm.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(t),I(1===e,3509);var n=this._toAddedListeners;if(0!==n.length){for(var i=0,r=n.length;i<r;i++)this._forceAddEventListener(n[i]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},t._cleanToRemovedListeners=function(){for(var e=this._toRemovedListeners,t=0;t<e.length;++t){var n=e[t],i=this._listenersMap[n._getListenerID()];if(i){var r=i.getFixedPriorityListeners(),o=i.getSceneGraphPriorityListeners();if(o){var a=o.indexOf(n);-1!==a&&o.splice(a,1)}if(r){var s=r.indexOf(n);-1!==s&&r.splice(s,1)}}}e.length=0},t._onTouchEventCallback=function(e,t){if(!e._isRegistered())return!1;var n=t.event,i=n.touch;n.currentTarget=e._getSceneGraphPriority();var r=!1,o=-1,a=n.getEventCode();if(a===bm.TOUCH_START){if(!nt.ENABLE_MULTI_TOUCH&&zm._currentTouch){var s=zm._currentTouchListener._node;if(!s||s.activeInHierarchy)return!1}e.onTouchBegan&&(r=e.onTouchBegan(i,n))&&e._isRegistered()&&!e._isPaused()&&(e._claimedTouches.push(i),!nt.ENABLE_MULTI_TOUCH&&zm._currentTouch||(zm._currentTouch=i),zm._currentTouchListener=e)}else if(e._claimedTouches.length>0&&-1!==(o=e._claimedTouches.indexOf(i))){if(r=!0,!nt.ENABLE_MULTI_TOUCH&&zm._currentTouch&&zm._currentTouch!==i)return!1;a===bm.TOUCH_MOVE&&e.onTouchMoved?e.onTouchMoved(i,n):a===bm.TOUCH_END?(e.onTouchEnded&&e.onTouchEnded(i,n),e._isRegistered()&&e._claimedTouches.splice(o,1),(nt.ENABLE_MULTI_TOUCH||zm._currentTouch===i)&&(zm._currentTouch=null),zm._currentTouchListener=null):a===bm.TOUCH_CANCEL&&(e.onTouchCancelled&&e.onTouchCancelled(i,n),e._isRegistered()&&e._claimedTouches.splice(o,1),(nt.ENABLE_MULTI_TOUCH||zm._currentTouch===i)&&(zm._currentTouch=null),zm._currentTouchListener=null)}return n.isStopped()?(zm._updateTouchListeners(n),!0):!!(r&&e._isRegistered()&&e.swallowTouches)&&(t.needsMutableSet&&t.touches.splice(i,1),!0)},t._dispatchTouchEvent=function(e){this._sortEventListeners(Lm.TOUCH_ONE_BY_ONE),this._sortEventListeners(Lm.TOUCH_ALL_AT_ONCE);var t=this._getListeners(Lm.TOUCH_ONE_BY_ONE),n=this._getListeners(Lm.TOUCH_ALL_AT_ONCE);if(null!==t||null!==n){var r=e.getTouches(),o=i.js.array.copy(r),a={event:e,needsMutableSet:t&&n,touches:o,selTouch:null};if(t)for(var s=0;s<r.length;++s){var c=r[s];e.touch=c,e.propagationStopped=e.propagationImmediateStopped=!1,this._dispatchEventToListeners(t,this._onTouchEventCallback,a)}n&&o.length>0&&(this._dispatchEventToListeners(n,this._onTouchesEventCallback,{event:e,touches:o}),e.isStopped())||this._updateTouchListeners(e)}},t._onTouchesEventCallback=function(e,t){if(!e._isRegistered())return!1;var n=t.event,i=t.touches,r=n.getEventCode();return n.currentTarget=e._getSceneGraphPriority(),r===bm.TOUCH_START&&e.onTouchesBegan?e.onTouchesBegan(i,n):r===bm.TOUCH_MOVE&&e.onTouchesMoved?e.onTouchesMoved(i,n):r===bm.TOUCH_END&&e.onTouchesEnded?e.onTouchesEnded(i,n):r===bm.TOUCH_CANCEL&&e.onTouchesCancelled&&e.onTouchesCancelled(i,n),!!n.isStopped()&&(zm._updateTouchListeners(n),!0)},t._associateNodeAndEventListener=function(e,t){var n=this._nodeListenersMap[e.uuid];n||(n=[],this._nodeListenersMap[e.uuid]=n),n.push(t)},t._dissociateNodeAndEventListener=function(e,t){var n=this._nodeListenersMap[e.uuid];n&&(i.js.array.remove(n,t),0===n.length&&delete this._nodeListenersMap[e.uuid])},t._dispatchEventToListeners=function(e,t,n){var i=!1,r=e.getFixedPriorityListeners(),o=e.getSceneGraphPriorityListeners(),a=0;if(r&&0!==r.length)for(;a<e.gt0Index;++a){var s=r[a];if(s.isEnabled()&&!s._isPaused()&&s._isRegistered()&&t(s,n)){i=!0;break}}if(o&&!i)for(var c=0;c<o.length;++c){var l=o[c];if(l.isEnabled()&&!l._isPaused()&&l._isRegistered()&&t(l,n)){i=!0;break}}if(r&&!i)for(;a<r.length;++a){var u=r[a];if(u.isEnabled()&&!u._isPaused()&&u._isRegistered()&&t(u,n)){i=!0;break}}},t._setDirty=function(e,t){var n=this._priorityDirtyFlagMap;null==n[e]?n[e]=t:n[e]|=t},t._sortNumberAsc=function(e,t){return e-t},t._removeListenerInCallback=function(e,t){if(null==e)return!1;for(var n=e.length-1;n>=0;n--){var r=e[n];if(r._onCustomEvent===t||r.onEvent===t)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?i.js.array.removeAt(e,n):this._toRemovedListeners.push(r),!0}return!1},t._removeListenerInVector=function(e,t){if(null==e)return!1;for(var n=e.length-1;n>=0;n--){var r=e[n];if(r===t)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?i.js.array.removeAt(e,n):this._toRemovedListeners.push(r),!0}return!1},e}(),zm=e("eventManager",new Fm);i.eventManager=zm,ei.Flags.Destroying;var Um,Hm,Gm,km,Vm,Wm,jm,qm,Xm,Ym=ei.Flags.Destroying,Km=ei.Flags.DontDestroy,Zm=ei.Flags.Deactivating,Qm=new ce("Node");function Jm(e){return e?"string"==typeof e?je(e):e:(b(3804),null)}var $m,eg,tg,ng,ig,rg,og,ag,sg,cg,lg,ug=e("BaseNode",S_("cc.BaseNode")((Xm=qm=function(e){K(n,e),n._setScene=function(e){e._updateScene()},n._findComponent=function(e,t){var n=t,i=e._components;if(n._sealed)for(var r=0;r<i.length;++r){var o=i[r];if(o.constructor===t)return o}else for(var a=0;a<i.length;++a){var s=i[a];if(s instanceof t)return s}return null},n._findComponents=function(e,t,n){var i=t,r=e._components;if(i._sealed)for(var o=0;o<r.length;++o){var a=r[o];a.constructor===t&&n.push(a)}else for(var s=0;s<r.length;++s){var c=r[s];c instanceof t&&n.push(c)}},n._findChildComponent=function(e,t){for(var i=0;i<e.length;++i){var r=e[i],o=n._findComponent(r,t);if(o)return o;if(r._children.length>0&&(o=n._findChildComponent(r._children,t)))return o}return null},n._findChildComponents=function(e,t,i){for(var r=0;r<e.length;++r){var o=e[r];n._findComponents(o,t,i),o._children.length>0&&n._findChildComponents(o._children,t,i)}};var t=n.prototype;function n(t){var n;return ee(n=e.call(this,t)||this,"_parent",Gm,Q(n)),ee(n,"_children",km,Q(n)),ee(n,"_active",Vm,Q(n)),ee(n,"_components",Wm,Q(n)),ee(n,"_prefab",jm,Q(n)),n._scene=null,n._activeInHierarchy=!1,n._id=Qm.getNewId(),n._name=void 0,n._eventProcessor=new i.NodeEventProcessor(Q(n)),n._eventMask=0,n._siblingIndex=0,n._originalSceneId="",n._registerIfAttached=void 0,n._name=void 0!==t?t:"New Node",n}return t._updateScene=function(){null==this._parent?p("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},t.attr=function(e){Oe(this,e)},t.getParent=function(){return this._parent},t.setParent=function(e,t){if(void 0===t&&(t=!1),this._parent!==e){var n=this._parent,i=e;if(this._parent=i,this._siblingIndex=0,this._onSetParent(n,t),this.emit&&this.emit(bm.PARENT_CHANGED,n),n&&!(n._objFlags&Ym)){var r=n._children.indexOf(this);n._children.splice(r,1),n._updateSiblingIndex(),n.emit&&n.emit(bm.CHILD_REMOVED,this)}i&&(i._children.push(this),this._siblingIndex=i._children.length-1,i.emit&&i.emit(bm.CHILD_ADDED,this)),this._onHierarchyChanged(n)}},t.getChildByUuid=function(e){if(!e)return f("Invalid uuid"),null;for(var t=this._children,n=0,i=t.length;n<i;n++)if(t[n]._id===e)return t[n];return null},t.getChildByName=function(e){if(!e)return f("Invalid name"),null;for(var t=this._children,n=0,i=t.length;n<i;n++)if(t[n]._name===e)return t[n];return null},t.getChildByPath=function(e){for(var t=e.split("/"),n=this,i=function(e){var i=t[e];if(0===i.length)return"continue";var r=n.children.find((function(e){return e.name===i}));if(!r)return{v:null};n=r},r=0;r<t.length;++r){var o=i(r);if("continue"!==o&&"object"==typeof o)return o.v}return n},t.addChild=function(e){e.setParent(this)},t.insertChild=function(e,t){e.parent=this,e.setSiblingIndex(t)},t.getSiblingIndex=function(){return this._siblingIndex},t.setSiblingIndex=function(e){if(this._parent)if(this._parent._objFlags&Zm)b(3821);else{var t=this._parent._children;e=-1!==e?e:t.length-1;var n=t.indexOf(this);e!==n&&(t.splice(n,1),e<t.length?t.splice(e,0,this):t.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(e))}},t.walk=function(e,t){var i=1,r=null,o=null,a=0,s=n._stacks[n._stackId];s||(s=[],n._stacks.push(s)),n._stackId++,s.length=0,s[0]=this;for(var c=null,l=!1;i;)if(o=s[--i])if(!l&&e?e(o):l&&t&&t(o),s[i]=null,l){if(c===this._parent)break;if(l=!1,r)if(r[++a])s[i]=r[a],i++;else if(c&&(s[i]=c,i++,l=!0,c._parent?(a=(r=c._parent._children).indexOf(c),c=c._parent):(c=null,r=null),a<0))break}else o._children.length>0?(c=o,r=o._children,a=0,s[i]=r[a],i++):(s[i]=o,i++,l=!0);s.length=0,n._stackId--},t.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},t.removeChild=function(e){this._children.indexOf(e)>-1&&(e.parent=null)},t.removeAllChildren=function(){for(var e=this._children,t=e.length-1;t>=0;t--){var n=e[t];n&&(n.parent=null)}this._children.length=0},t.isChildOf=function(e){var t=this;do{if(t===e)return!0;t=t._parent}while(t);return!1},t.getComponent=function(e){var t=Jm(e);return t?n._findComponent(this,t):null},t.getComponents=function(e){var t=Jm(e),i=[];return t&&n._findComponents(this,t,i),i},t.getComponentInChildren=function(e){var t=Jm(e);return t?n._findChildComponent(this._children,t):null},t.getComponentsInChildren=function(e){var t=Jm(e),i=[];return t&&(n._findComponents(this,t,i),n._findChildComponents(this._children,t,i)),i},t.addComponent=function(e){var t;if("string"==typeof e){if(!(t=je(e)))throw i._RF.peek()&&b(3808,e),TypeError(P(3807,e))}else{if(!e)throw TypeError(P(3804));t=e}if("function"!=typeof t)throw TypeError(P(3809));if(!Me(t,i.Component))throw TypeError(P(3810));var n=t._requireComponent;n&&!this.getComponent(n)&&this.addComponent(n);var r=new t;return r.node=this,this._components.push(r),this._activeInHierarchy&&i.director._nodeActivator.activateComp(r),r},t.removeComponent=function(e){if(e){var t=null;(t=e instanceof Xd?e:this.getComponent(e))&&t.destroy()}else b(3813)},t.on=function(e,t,n,i){switch(void 0===i&&(i=!1),e){case bm.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(e,t,n,i)},t.off=function(e,t,n,i){if(void 0===i&&(i=!1),this._eventProcessor.off(e,t,n,i),!this._eventProcessor.hasEventListener(e))switch(e){case bm.TRANSFORM_CHANGED:this._eventMask&=-2}},t.once=function(e,t,n,i){this._eventProcessor.once(e,t,n,i)},t.emit=function(e,t,n,i,r,o){this._eventProcessor.emit(e,t,n,i,r,o)},t.dispatchEvent=function(e){this._eventProcessor.dispatchEvent(e)},t.hasEventListener=function(e,t,n){return this._eventProcessor.hasEventListener(e,t,n)},t.targetOff=function(e){this._eventProcessor.targetOff(e),1&this._eventMask&&!this._eventProcessor.hasEventListener(bm.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},t.destroy=function(){return!!e.prototype.destroy.call(this)&&(this.active=!1,!0)},t.destroyAllChildren=function(){for(var e=this._children,t=0;t<e.length;++t)e[t].destroy()},t._removeComponent=function(e){if(e){if(!(this._objFlags&Ym)){var t=this._components.indexOf(e);-1!==t?this._components.splice(t,1):e.node!==this&&b(3815)}}else b(3814)},t._updateSiblingIndex=function(){for(var e=0;e<this._children.length;++e)this._children[e]._siblingIndex=e;this.emit(bm.SIBLING_ORDER_CHANGED)},t._onSetParent=function(e){this._parent&&(null!=e&&e._scene===this._parent._scene||null==this._parent._scene||this.walk(n._setScene))},t._onPostActivated=function(){},t._onBatchCreated=function(){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this))},t._onPreDestroy=function(){this._onPreDestroyBase()},t._onHierarchyChanged=function(e){return this._onHierarchyChangedBase(e)},t._instantiate=function(e,t){return e||(e=i.instantiate._clone(this,this)),e._prefab,e._parent=null,e._onBatchCreated(t),e},t._onHierarchyChangedBase=function(){var e=this._parent;!this._persistNode||e instanceof i.Scene||i.game.removePersistRootNode(this);var t=this._active&&!(!e||!e._activeInHierarchy);this._activeInHierarchy!==t&&i.director._nodeActivator.activateNode(this,t)},t._onPreDestroyBase=function(){this._objFlags|=Ym;var e=this._parent,t=!!e&&0!=(e._objFlags&Ym);if(this._persistNode&&i.game.removePersistRootNode(this),!t&&e){this.emit(bm.PARENT_CHANGED,this);var n=e._children.indexOf(this);e._children.splice(n,1),this._siblingIndex=0,e._updateSiblingIndex(),e.emit&&e.emit(bm.CHILD_REMOVED,this)}this.emit(bm.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var r=this._children,o=0;o<r.length;++o)r[o]._destroyImmediate();for(var a=this._components,s=0;s<a.length;++s)a[s]._destroyImmediate();return t},X(n,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&Km)>0},set:function(e){e?this._objFlags|=Km:this._objFlags&=~Km}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(e){if(this._active!==e){this._active=e;var t=this._parent;t&&t._activeInHierarchy&&i.director._nodeActivator.activateNode(this,e)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){this.setParent(e)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}}]),n}(ei),qm.idGenerator=Qm,qm._stacks=[[]],qm._stackId=0,te((Hm=Xm).prototype,"_persistNode",[A_],Object.getOwnPropertyDescriptor(Hm.prototype,"_persistNode"),Hm.prototype),te(Hm.prototype,"name",[N_],Object.getOwnPropertyDescriptor(Hm.prototype,"name"),Hm.prototype),te(Hm.prototype,"children",[N_],Object.getOwnPropertyDescriptor(Hm.prototype,"children"),Hm.prototype),te(Hm.prototype,"active",[N_],Object.getOwnPropertyDescriptor(Hm.prototype,"active"),Hm.prototype),te(Hm.prototype,"activeInHierarchy",[N_],Object.getOwnPropertyDescriptor(Hm.prototype,"activeInHierarchy"),Hm.prototype),te(Hm.prototype,"parent",[N_],Object.getOwnPropertyDescriptor(Hm.prototype,"parent"),Hm.prototype),Gm=te(Hm.prototype,"_parent",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),km=te(Hm.prototype,"_children",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vm=te(Hm.prototype,"_active",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Wm=te(Hm.prototype,"_components",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jm=te(Hm.prototype,"_prefab",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Um=Hm))||Um);function hg(e){var t=e._prefab;if(t&&t.instance){if(!t.asset)return b(3701,e.name),void(t.instance=void 0);var n=e._objFlags,r=e._parent,o=e._id,a=e._prefab;i.game._isCloning=!0,t.asset._doInstantiate(e),i.game._isCloning=!1,e._objFlags=n,e._parent=r,e._id=o,e._prefab&&(e._prefab.instance=null==a?void 0:a.instance)}}function _g(e,t,n){var i;if(t){var r=t,o=null===(i=e._prefab)||void 0===i?void 0:i.instance;!n&&o&&(t[o.fileId]={},r=t[o.fileId]);var a=e._prefab;a&&(r[a.fileId]=e);for(var s=e.components,c=0;c<s.length;c++){var l=s[c];l.__prefab&&(r[l.__prefab.fileId]=l)}for(var u=0;u<e.children.length;u++)_g(e.children[u],r,!1)}}function fg(e,t){if(!e)return null;for(var n=t,i=0;i<e.length;i++){if(!n)return null;n=n[e[i]]}return n}function dg(e,t,n){if(t)for(var i=0;i<t.length;i++){var r=t[i];if(r&&r.targetInfo){var o=fg(r.targetInfo.localID,n);if(!o)continue;var a=n,s=r.targetInfo.localID;if(s.length>0)for(var c=0;c<s.length-1;c++)a=a[s[c]];if(r.nodes)for(var l=0;l<r.nodes.length;l++){var u=r.nodes[l];u&&(o._children.push(u),u._parent=o,_g(u,a,!1),u._siblingIndex=o._children.length-1,u._onBatchCreated(!1))}}}}function pg(e,t,n){if(t)for(var i=0;i<t.length;i++){var r=t[i];if(r&&r.targetInfo){var o=fg(r.targetInfo.localID,n);if(!o)continue;if(r.components)for(var a=0;a<r.components.length;a++){var s=r.components[a];s&&(s.node=o,o._components.push(s))}}}}function mg(e,t,n){if(t)for(var i=0;i<t.length;i++){var r=t[i];if(r){var o=fg(r.localID,n);if(!o||!o.node)continue;var a=o.node.components.indexOf(o);a>=0&&o.node._components.splice(a,1)}}}function gg(e,t,n){if(!(t.length<=0))for(var i=null,r=0;r<t.length;r++){var o=t[r];if(o&&o.targetInfo){if(!(i=fg(o.targetInfo.localID,n)))continue;var a=i,s=o.propertyPath.slice();if(s.length>0){var c=s.pop();if(!c)continue;for(var l=0;l<s.length&&(a=a[s[l]]);l++);if(!a)continue;if(Array.isArray(a))if("length"===c)a[c]=o.value;else{var u=Number.parseInt(c);Number.isInteger(u)&&u<a.length&&(a[c]=o.value)}else a[c]=o.value}}}}function vg(e){var t,n=null===(t=e._prefab)||void 0===t?void 0:t.targetOverrides;if(n)for(var i=0;i<n.length;i++){var r,o,a=n[i],s=a.source,c=a.sourceInfo;if(c){var l,u,h=null===(l=a.source)||void 0===l||null===(u=l._prefab)||void 0===u?void 0:u.instance;h&&h.targetMap&&(s=fg(c.localID,h.targetMap))}if(s){var _,f=a.targetInfo;if(f){var d=null===(r=a.target)||void 0===r||null===(o=r._prefab)||void 0===o?void 0:o.instance;if(d&&d.targetMap&&(_=fg(f.localID,d.targetMap))){var p=a.propertyPath.slice(),m=s;if(p.length>0){var g=p.pop();if(!g)return;for(var v=0;v<p.length&&(m=m[p[v]]);v++);if(!m)continue;m[g]=_}}}}}}i._BaseNode=ug;var yg,Sg,Eg,Tg,xg,Ag,Cg,bg,wg,Rg,Ig,Pg,Og,Dg,Ng,Mg,Lg,Bg,Fg,zg,Ug,Hg,Gg,kg,Vg,Wg,jg,qg,Xg,Yg,Kg,Zg,Qg,Jg,$g,ev,tv,nv,iv,rv,ov,av,sv,cv,lv,uv,hv,_v,fv,dv,pv,mv,gv,vv,yv,Sv,Ev,Tv,xv,Av,Cv,bv,wv,Rv,Iv,Pv,Ov,Dv,Nv,Mv=new yn,Lv=new bn,Bv=new bn,Fv=new Array(10),zv=new bn,Uv=new xn,Hv=new xn,Gv=new Mn,kv=new Map,Vv=e("Node",($m=S_("cc.Node"),eg=K_(yn),$m((lg=cg=function(e){function t(t){var n;return(n=e.call(this,t)||this)._uiProps=new wm(Q(n)),n._static=!1,n._pos=new yn,n._rot=new bn,n._scale=new yn(1,1,1),n._mat=new Mn,ee(n,"_lpos",ig,Q(n)),ee(n,"_lrot",rg,Q(n)),ee(n,"_lscale",og,Q(n)),ee(n,"_layer",ag,Q(n)),ee(n,"_euler",sg,Q(n)),n._dirtyFlags=t_.NONE,n._eulerDirty=!1,n._poolHandle=0,n._poolHandle=$r.alloc(),$r.set(n._poolHandle,Yr.LAYER,n._layer),n}K(t,e),t.isNode=function(e){return e instanceof t&&(e.constructor===t||!(e instanceof i.Scene))};var n=t.prototype;return n.destroy=function(){return this._poolHandle&&($r.free(this._poolHandle),this._poolHandle=0),e.prototype.destroy.call(this)},n.setParent=function(t,n){void 0===n&&(n=!1),n&&this.updateWorldTransform(),e.prototype.setParent.call(this,t,n)},n._onSetParent=function(t,n){if(e.prototype._onSetParent.call(this,t,n),n){var i=this._parent;i?(i.updateWorldTransform(),Mn.multiply(Gv,Mn.invert(Gv,i._mat),this._mat),Mn.toRTS(Gv,this._lrot,this._lpos,this._lscale)):(yn.copy(this._lpos,this._pos),bn.copy(this._lrot,this._rot),yn.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(t_.TRS)},n._onHierarchyChanged=function(t){this.eventProcessor.reattach(),e.prototype._onHierarchyChangedBase.call(this,t)},n._onBatchCreated=function(e){var t;$r.set(this._poolHandle,Yr.LAYER,this._layer),$r.setVec3(this._poolHandle,Yr.WORLD_SCALE,this._scale);var n=null===(t=this._prefab)||void 0===t?void 0:t.instance;!e&&n&&hg(this),this.hasChangedFlags=t_.TRS,this._dirtyFlags=t_.TRS;for(var i=this._children.length,r=0;r<i;++r)this._children[r]._siblingIndex=r,this._children[r]._onBatchCreated(e);if(!e&&n){var o={};n.targetMap=o,_g(this,o,!0),dg(0,n.mountedChildren,o),mg(0,n.removedComponents,o),pg(0,n.mountedComponents,o),gg(0,n.propertyOverrides,o)}vg(this)},n._onBeforeSerialize=function(){this.eulerAngles},n._onPostActivated=function(e){e?(zm.resumeTarget(this),this.invalidateChildren(t_.TRS)):zm.pauseTarget(this)},n.translate=function(e,t){var n=t||e_.LOCAL;if(n===e_.LOCAL)yn.transformQuat(Mv,e,this._lrot),this._lpos.x+=Mv.x,this._lpos.y+=Mv.y,this._lpos.z+=Mv.z;else if(n===e_.WORLD)if(this._parent){bn.invert(Lv,this._parent.worldRotation),yn.transformQuat(Mv,e,Lv);var i=this.worldScale;this._lpos.x+=Mv.x/i.x,this._lpos.y+=Mv.y/i.y,this._lpos.z+=Mv.z/i.z}else this._lpos.x+=e.x,this._lpos.y+=e.y,this._lpos.z+=e.z;this.invalidateChildren(t_.POSITION),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.POSITION),$r.setVec3(this._poolHandle,Yr.WORLD_POSITION,this.worldPosition)},n.rotate=function(e,t){var n=t||e_.LOCAL;if(bn.normalize(Lv,e),n===e_.LOCAL)bn.multiply(this._lrot,this._lrot,Lv);else if(n===e_.WORLD){var i=this.worldRotation;bn.multiply(Bv,Lv,i),bn.invert(Lv,i),bn.multiply(Bv,Lv,Bv),bn.multiply(this._lrot,this._lrot,Bv)}this._eulerDirty=!0,this.invalidateChildren(t_.ROTATION),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.ROTATION),$r.setVec4(this._poolHandle,Yr.WORLD_ROTATION,this.worldRotation)},n.lookAt=function(e,t){this.getWorldPosition(Mv),yn.subtract(Mv,Mv,e),yn.normalize(Mv,Mv),bn.fromViewUp(Lv,Mv,t),this.setWorldRotation(Lv)},n.invalidateChildren=function(e){var t=this.hasChangedFlags;if((this._dirtyFlags&t&e)!==e){this._dirtyFlags|=e,this.hasChangedFlags=t|e;for(var n=e|t_.POSITION,i=this._children.length,r=0;r<i;++r){var o=this._children[r];o.isValid&&o.invalidateChildren(n)}}},n.updateWorldTransform=function(){if(this._dirtyFlags){for(var e,t=this,n=0;t&&t._dirtyFlags;)Fv[n++]=t,t=t._parent;for(var i=0;n;)i|=(e=Fv[--n])._dirtyFlags,t?(i&t_.POSITION&&(yn.transformMat4(e._pos,e._lpos,t._mat),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z,$r.setVec3(e._poolHandle,Yr.WORLD_POSITION,e._pos)),i&t_.RS&&(Mn.fromRTS(e._mat,e._lrot,e._lpos,e._lscale),Mn.multiply(e._mat,t._mat,e._mat),i&t_.ROTATION&&(bn.multiply(e._rot,t._rot,e._lrot),$r.setVec4(e._poolHandle,Yr.WORLD_ROTATION,e._rot)),xn.fromQuat(Uv,bn.conjugate(zv,e._rot)),xn.multiplyMat4(Uv,Uv,e._mat),e._scale.x=Uv.m00,e._scale.y=Uv.m04,e._scale.z=Uv.m08,$r.setVec3(e._poolHandle,Yr.WORLD_SCALE,e._scale))):(i&t_.POSITION&&(yn.copy(e._pos,e._lpos),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z,$r.setVec3(e._poolHandle,Yr.WORLD_POSITION,e._pos)),i&t_.RS&&(i&t_.ROTATION&&(bn.copy(e._rot,e._lrot),$r.setVec4(e._poolHandle,Yr.WORLD_ROTATION,e._rot)),i&t_.SCALE&&(yn.copy(e._scale,e._lscale),$r.setVec3(e._poolHandle,Yr.WORLD_SCALE,e._scale),Mn.fromRTS(e._mat,e._rot,e._pos,e._scale)))),i!==t_.NONE&&$r.setMat4(e._poolHandle,Yr.WORLD_MATRIX,e._mat),e._dirtyFlags=t_.NONE,t=e}},n.setPosition=function(e,t,n){void 0===t&&void 0===n?yn.copy(this._lpos,e):void 0===n?yn.set(this._lpos,e,t,this._lpos.z):yn.set(this._lpos,e,t,n),this.invalidateChildren(t_.POSITION),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.POSITION)},n.getPosition=function(e){return e?yn.set(e,this._lpos.x,this._lpos.y,this._lpos.z):yn.copy(new yn,this._lpos)},n.setRotation=function(e,t,n,i){void 0===t||void 0===n||void 0===i?bn.copy(this._lrot,e):bn.set(this._lrot,e,t,n,i),this._eulerDirty=!0,this.invalidateChildren(t_.ROTATION),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.ROTATION)},n.setRotationFromEuler=function(e,t,n){var i=void 0===n?this._euler.z:n;void 0===t?(yn.copy(this._euler,e),bn.fromEuler(this._lrot,e.x,e.y,e.z)):(yn.set(this._euler,e,t,i),bn.fromEuler(this._lrot,e,t,i)),this._eulerDirty=!1,this.invalidateChildren(t_.ROTATION),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.ROTATION)},n.getRotation=function(e){return e?bn.set(e,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):bn.copy(new bn,this._lrot)},n.setScale=function(e,t,n){void 0===t&&void 0===n?yn.copy(this._lscale,e):void 0===n?yn.set(this._lscale,e,t,this._lscale.z):yn.set(this._lscale,e,t,n),this.invalidateChildren(t_.SCALE),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.SCALE)},n.getScale=function(e){return e?yn.set(e,this._lscale.x,this._lscale.y,this._lscale.z):yn.copy(new yn,this._lscale)},n.inverseTransformPoint=function(e,t){yn.copy(e,t);for(var n=this,i=0;n._parent;)Fv[i++]=n,n=n._parent;for(;i>=0;)yn.transformInverseRTS(e,e,n._lrot,n._lpos,n._lscale),n=Fv[--i];return e},n.setWorldPosition=function(e,t,n){void 0===t||void 0===n?yn.copy(this._pos,e):yn.set(this._pos,e,t,n),$r.setVec3(this._poolHandle,Yr.WORLD_POSITION,this._pos);var i=this._parent,r=this._lpos;i?(i.updateWorldTransform(),yn.transformMat4(r,this._pos,Mn.invert(Gv,i._mat))):yn.copy(r,this._pos),this.invalidateChildren(t_.POSITION),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.POSITION)},n.getWorldPosition=function(e){return this.updateWorldTransform(),e?yn.copy(e,this._pos):yn.copy(new yn,this._pos)},n.setWorldRotation=function(e,t,n,i){void 0===t||void 0===n||void 0===i?bn.copy(this._rot,e):bn.set(this._rot,e,t,n,i),$r.setVec4(this._poolHandle,Yr.WORLD_ROTATION,this._rot),this._parent?(this._parent.updateWorldTransform(),bn.multiply(this._lrot,bn.conjugate(this._lrot,this._parent._rot),this._rot)):bn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(t_.ROTATION),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.ROTATION)},n.setWorldRotationFromEuler=function(e,t,n){bn.fromEuler(this._rot,e,t,n),this._parent?(this._parent.updateWorldTransform(),bn.multiply(this._lrot,bn.conjugate(this._lrot,this._parent._rot),this._rot)):bn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(t_.ROTATION),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.ROTATION)},n.getWorldRotation=function(e){return this.updateWorldTransform(),e?bn.copy(e,this._rot):bn.copy(new bn,this._rot)},n.setWorldScale=function(e,t,n){void 0===t||void 0===n?yn.copy(this._scale,e):yn.set(this._scale,e,t,n),$r.setVec3(this._poolHandle,Yr.WORLD_SCALE,this._scale);var i=this._parent;i?(i.updateWorldTransform(),xn.fromQuat(Uv,bn.conjugate(zv,i._rot)),xn.multiplyMat4(Uv,Uv,i._mat),Hv.m00=this._scale.x,Hv.m04=this._scale.y,Hv.m08=this._scale.z,xn.multiply(Uv,Hv,xn.invert(Uv,Uv)),this._lscale.x=yn.set(Mv,Uv.m00,Uv.m01,Uv.m02).length(),this._lscale.y=yn.set(Mv,Uv.m03,Uv.m04,Uv.m05).length(),this._lscale.z=yn.set(Mv,Uv.m06,Uv.m07,Uv.m08).length()):yn.copy(this._lscale,this._scale),this.invalidateChildren(t_.SCALE),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.SCALE)},n.getWorldScale=function(e){return this.updateWorldTransform(),e?yn.copy(e,this._scale):yn.copy(new yn,this._scale)},n.getWorldMatrix=function(e){this.updateWorldTransform();var t=e||new Mn;return Mn.copy(t,this._mat)},n.getWorldRS=function(e){this.updateWorldTransform();var t=e||new Mn;return Mn.copy(t,this._mat),t.m12=0,t.m13=0,t.m14=0,t},n.getWorldRT=function(e){this.updateWorldTransform();var t=e||new Mn;return Mn.fromRT(t,this._rot,this._pos)},n.setRTS=function(e,t,n){var i=0;e&&(i|=t_.ROTATION,void 0!==e.w?(bn.copy(this._lrot,e),this._eulerDirty=!0):(yn.copy(this._euler,e),bn.fromEuler(this._lrot,e.x,e.y,e.z),this._eulerDirty=!1)),t&&(yn.copy(this._lpos,t),i|=t_.POSITION),n&&(yn.copy(this._lscale,n),i|=t_.SCALE),i&&(this.invalidateChildren(i),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,i))},n.pauseSystemEvents=function(e){zm.pauseTarget(this,e)},n.resumeSystemEvents=function(e){zm.resumeTarget(this,e)},t.clearBooks=function(){kv.clear()},n.syncToNativeTransform=function(){var e=this.hasChangedFlags;e&&(e&t_.POSITION&&$r.setVec3(this._poolHandle,Yr.WORLD_POSITION,this.worldPosition),e&t_.ROTATION&&$r.setVec3(this._poolHandle,Yr.WORLD_ROTATION,this.worldRotation),e&t_.SCALE&&$r.setVec3(this._poolHandle,Yr.WORLD_SCALE,this.worldScale))},n.syncFromNativeTransform=function(){var e=$r.get(this._poolHandle,Yr.FLAGS_CHANGED);e&&(e&t_.POSITION&&($r.getVec3(this._poolHandle,Yr.WORLD_POSITION,Mv),this.setWorldPosition(Mv)),e&t_.ROTATION&&($r.getVec4(this._poolHandle,Yr.WORLD_ROTATION,Lv),this.setWorldRotation(Lv)),e&t_.SCALE&&($r.getVec3(this._poolHandle,Yr.WORLD_SCALE,Mv),this.setWorldScale(Mv)))},X(t,[{key:"handle",get:function(){return this._poolHandle}},{key:"position",get:function(){return this._lpos},set:function(e){this.setPosition(e)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(e){this.setWorldPosition(e)}},{key:"rotation",get:function(){return this._lrot},set:function(e){this.setRotation(e)}},{key:"eulerAngles",get:function(){return this._eulerDirty&&(bn.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler},set:function(e){this.setRotationFromEuler(e.x,e.y,e.z)}},{key:"angle",get:function(){return this._euler.z},set:function(e){yn.set(this._euler,0,0,e),bn.fromAngleZ(this._lrot,e),this._eulerDirty=!1,this.invalidateChildren(t_.ROTATION),1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(e){this.setWorldRotation(e)}},{key:"scale",get:function(){return this._lscale},set:function(e){this.setScale(e)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(e){this.setWorldScale(e)}},{key:"matrix",set:function(e){Mn.toRTS(e,this._lrot,this._lpos,this._lscale),this.invalidateChildren(t_.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(bm.TRANSFORM_CHANGED,t_.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return yn.transformQuat(new yn,yn.FORWARD,this.worldRotation)},set:function(e){var t=e.length();yn.multiplyScalar(Mv,e,-1/t),bn.fromViewUp(Lv,Mv),this.setWorldRotation(Lv)}},{key:"layer",get:function(){return this._layer},set:function(e){this._layer=e,$r.set(this._poolHandle,Yr.LAYER,this._layer),this.emit(bm.LAYER_CHANGED,this._layer)}},{key:"hasChangedFlags",get:function(){return kv.get(this)||0},set:function(e){kv.set(this,e),$r.set(this._poolHandle,Yr.FLAGS_CHANGED,e)}}]),t}(ug),cg.bookOfChange=kv,cg.EventType=bm,cg.NodeSpace=e_,cg.TransformDirtyBit=t_,cg.TransformBit=t_,ig=te((ng=lg).prototype,"_lpos",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new yn}}),rg=te(ng.prototype,"_lrot",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new bn}}),og=te(ng.prototype,"_lscale",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new yn(1,1,1)}}),ag=te(ng.prototype,"_layer",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ru.Enum.DEFAULT}}),sg=te(ng.prototype,"_euler",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new yn}}),te(ng.prototype,"eulerAngles",[eg],Object.getOwnPropertyDescriptor(ng.prototype,"eulerAngles"),ng.prototype),te(ng.prototype,"angle",[N_],Object.getOwnPropertyDescriptor(ng.prototype,"angle"),ng.prototype),te(ng.prototype,"layer",[N_],Object.getOwnPropertyDescriptor(ng.prototype,"layer"),ng.prototype),tg=ng))||tg));i.Node=Vv;var Wv=S_("cc.TargetInfo")((Eg=te((Sg=function(){ee(this,"localID",Eg,this)}).prototype,"localID",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yg=Sg))||yg,jv=(Tg=S_("cc.TargetOverrideInfo"),xg=K_(ei),Ag=K_(Wv),Cg=K_(Vv),bg=K_(Wv),Tg((Ig=te((Rg=function(){ee(this,"source",Ig,this),ee(this,"sourceInfo",Pg,this),ee(this,"propertyPath",Og,this),ee(this,"target",Dg,this),ee(this,"targetInfo",Ng,this)}).prototype,"source",[C_,xg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pg=te(Rg.prototype,"sourceInfo",[C_,Ag],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Og=te(Rg.prototype,"propertyPath",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Dg=te(Rg.prototype,"target",[C_,Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ng=te(Rg.prototype,"targetInfo",[C_,bg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wg=Rg))||wg),qv=S_("cc.CompPrefabInfo")((Bg=te((Lg=function(){ee(this,"fileId",Bg,this)}).prototype,"fileId",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Mg=Lg))||Mg,Xv=(Fg=S_("CCPropertyOverrideInfo"),zg=K_(Wv),Fg((Wg=function(){function e(){ee(this,"targetInfo",Gg,this),ee(this,"propertyPath",kg,this),ee(this,"value",Vg,this)}return e.prototype.isTarget=function(){},e}(),Gg=te((Hg=Wg).prototype,"targetInfo",[C_,zg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kg=te(Hg.prototype,"propertyPath",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vg=te(Hg.prototype,"value",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ug=Hg))||Ug),Yv=(jg=S_("cc.MountedChildrenInfo"),qg=K_(Wv),Xg=K_([Vv]),jg((Jg=function(){function e(){ee(this,"targetInfo",Zg,this),ee(this,"nodes",Qg,this)}return e.prototype.isTarget=function(){},e}(),Zg=te((Kg=Jg).prototype,"targetInfo",[C_,qg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qg=te(Kg.prototype,"nodes",[C_,Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yg=Kg))||Yg),Kv=($g=S_("cc.MountedComponentsInfo"),ev=K_(Wv),tv=K_([Xd]),$g((av=function(){function e(){ee(this,"targetInfo",rv,this),ee(this,"components",ov,this)}return e.prototype.isTarget=function(){},e}(),rv=te((iv=av).prototype,"targetInfo",[C_,ev],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ov=te(iv.prototype,"components",[C_,tv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nv=iv))||nv),Zv=(sv=S_("cc.PrefabInstance"),cv=K_(Vv),lv=K_([Yv]),uv=K_([Kv]),hv=K_([Xv]),_v=K_([Wv]),sv((Ev=function(){function e(){ee(this,"fileId",pv,this),ee(this,"prefabRootNode",mv,this),ee(this,"mountedChildren",gv,this),ee(this,"mountedComponents",vv,this),ee(this,"propertyOverrides",yv,this),ee(this,"removedComponents",Sv,this),this.targetMap={}}var t=e.prototype;return t.findPropertyOverride=function(){},t.removePropertyOverride=function(){},e}(),pv=te((dv=Ev).prototype,"fileId",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),mv=te(dv.prototype,"prefabRootNode",[C_,cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gv=te(dv.prototype,"mountedChildren",[C_,lv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vv=te(dv.prototype,"mountedComponents",[C_,uv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yv=te(dv.prototype,"propertyOverrides",[C_,hv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Sv=te(dv.prototype,"removedComponents",[C_,_v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fv=dv))||fv),Qv=(Tv=S_("cc.PrefabInfo"),xv=K_(Vv),Av=K_(i.Prefab),Cv=K_(Zv),bv=K_([jv]),Tv((Iv=te((Rv=function(){ee(this,"root",Iv,this),ee(this,"asset",Pv,this),ee(this,"fileId",Ov,this),ee(this,"instance",Dv,this),ee(this,"targetOverrides",Nv,this)}).prototype,"root",[C_,xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv=te(Rv.prototype,"asset",[C_,Av],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ov=te(Rv.prototype,"fileId",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Dv=te(Rv.prototype,"instance",[C_,Cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv=te(Rv.prototype,"targetOverrides",[C_,bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wv=Rv))||wv);i._PrefabInfo=Qv;var Jv,$v,ey,ty,ny,iy,ry,oy,ay,sy,cy,ly,uy,hy=Object.freeze({__proto__:null,TargetInfo:Wv,TargetOverrideInfo:jv,CompPrefabInfo:qv,PropertyOverrideInfo:Xv,MountedChildrenInfo:Yv,MountedComponentsInfo:Kv,PrefabInstance:Zv,PrefabInfo:Qv,createNodeWithPrefab:hg,generateTargetMap:_g,getTarget:fg,applyMountedChildren:dg,applyMountedComponents:pg,applyRemovedComponents:mg,applyPropertyOverrides:gg,applyTargetOverrides:vg}),_y=Qe({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),fy=e("Prefab",S_("cc.Prefab")((iy=ny=function(e){function t(){var t;return ee(t=e.call(this)||this,"data",ey,Q(t)),ee(t,"optimizationPolicy",ty,Q(t)),t._createFunction=void 0,t._instantiatedTimes=void 0,t._createFunction=null,t._instantiatedTimes=0,t}K(t,e);var n=t.prototype;return n.createNode=function(e){var t=i.instantiate(this);t.name=this.name,e(null,t)},n.compileCreateFunction=function(){var e,t;this._createFunction=(t=(e=this.data)instanceof i._BaseNode&&e,new Am(e,t).result)},n._doInstantiate=function(e){return this.data._prefab||A(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(e)},n._instantiate=function(){var e;return this.optimizationPolicy!==_y.SINGLE_INSTANCE&&(this.optimizationPolicy===_y.MULTI_INSTANCE||this._instantiatedTimes+1>=t.OptimizationPolicyThreshold)?(e=this._doInstantiate(),this.data._instantiate(e)):e=this.data._instantiate(),++this._instantiatedTimes,e},n.initDefault=function(t){e.prototype.initDefault.call(this,t),this.data=new Vv,this.data.name="(Missing Node)";var n=new Qv;n.asset=this,n.root=this.data,this.data._prefab=n},n.validate=function(){return!!this.data},t}(Rf),ny.OptimizationPolicy=_y,ny.OptimizationPolicyThreshold=3,ey=te(($v=iy).prototype,"data",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ty=te($v.prototype,"optimizationPolicy",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _y.AUTO}}),Jv=$v))||Jv);Ke.value(fy,"_utils",hy),i.Prefab=fy,Te(i,"cc._Prefab","Prefab"),e("PrefabLink",(ry=S_("cc.PrefabLink"),oy=K_(fy),ay=M_(),ry((uy=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"prefab",ly,Q(t)),t}return K(t,e),t}(Xd),ly=te((cy=uy).prototype,"prefab",[oy,C_,ay],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sy=cy))||sy));var dy=new yn;function py(e,t,n,i){i||(i=new yn),e.convertToUINode(t,n,i);var r=n.position;return i.add(r),i}function my(e,t,n){return n||(n=new yn),e.worldToScreen(t,n),n.x/=i.view.getScaleX(),n.y/=i.view.getScaleY(),n}var gy=e("convertUtils",{WorldNode3DToLocalNodeUI:py,WorldNode3DToWorldNodeUI:my});i.pipelineUtils=gy,F(i.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0],r=t[3]||dy;return i.convertToUINode(t[1],t[2],r),r.add(t[2].position),t[3]||r.clone()}}]),F(bm,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]);var vy=function(){function e(){this.support=void 0,this._intervalInMileseconds=200,this._accelTimer=0,this._eventTarget=new vi,this._deviceEventName=void 0,this._globalEventClass=void 0,this._didAccelerateFunc=void 0,this.support=void 0!==window.DeviceMotionEvent||void 0!==window.DeviceOrientationEvent,this._globalEventClass=window.DeviceMotionEvent||window.DeviceOrientationEvent,yi.browserType===hi.MOBILE_QQ&&(this._globalEventClass=window.DeviceOrientationEvent),this._deviceEventName=this._globalEventClass===window.DeviceMotionEvent?"devicemotion":"deviceorientation",this._didAccelerateFunc=this._didAccelerate.bind(this)}var t=e.prototype;return t._registerEvent=function(){this._accelTimer=performance.now(),window.addEventListener(this._deviceEventName,this._didAccelerateFunc,!1)},t._unregisterEvent=function(){this._accelTimer=0,window.removeEventListener(this._deviceEventName,this._didAccelerateFunc,!1)},t._didAccelerate=function(e){var t=performance.now();if(!(t-this._accelTimer<this._intervalInMileseconds)){this._accelTimer=t;var n=0,r=0,o=0;if(this._globalEventClass===window.DeviceMotionEvent){var a=e.accelerationIncludingGravity;n=.1*((null==a?void 0:a.x)||0),r=.1*((null==a?void 0:a.y)||0),o=.1*((null==a?void 0:a.z)||0)}else{var s=e;n=(s.gamma||0)/90*.981,r=-(s.beta||0)/90*.981,o=(s.alpha||0)/90*.981}if(i.view._isRotated){var c=n;n=-r,r=c}var l=n;90===window.orientation?(n=-r,r=l):-90===window.orientation?(n=r,r=-l):180===window.orientation&&(n=-n,r=-r),yi.os===pi.ANDROID&&yi.browserType!==hi.MOBILE_QQ&&(n=-n,r=-r);var u={type:bm.DEVICEMOTION,x:n,y:r,z:o,timestamp:performance.now()};this._eventTarget.emit(bm.DEVICEMOTION,u)}},t.start=function(){this._registerEvent()},t.stop=function(){this._unregisterEvent()},t.setInterval=function(e){this._intervalInMileseconds=e},t.onChange=function(e){this._eventTarget.on(bm.DEVICEMOTION,e)},e}(),yy=function(){function e(){this.support=void 0,this.support=!0}var t=e.prototype;return t.show=function(){throw new Error("Method not implemented.")},t.hide=function(){throw new Error("Method not implemented.")},t.onChange=function(){throw new Error("Method not implemented.")},t.onComplete=function(){throw new Error("Method not implemented.")},t.offChange=function(){throw new Error("Method not implemented.")},t.offComplete=function(){throw new Error("Method not implemented.")},e}(),Sy=function(){function e(){this.support=void 0,this._eventTarget=new vi,this.support=void 0!==document.documentElement.onkeyup,this._registerEvent()}var t=e.prototype;return t._registerEvent=function(){var e=document.getElementById("GameCanvas");null==e||e.addEventListener("keydown",this._createCallback(bm.KEY_DOWN)),null==e||e.addEventListener("keyup",this._createCallback(bm.KEY_UP))},t._createCallback=function(e){var t=this;return function(n){var i={type:e,code:n.keyCode,timestamp:performance.now()};n.stopPropagation(),n.preventDefault(),t._eventTarget.emit(e,i)}},t.onDown=function(e){this._eventTarget.on(bm.KEY_DOWN,e)},t.onUp=function(e){this._eventTarget.on(bm.KEY_UP,e)},e}(),Ey=function(){function e(){this.support=void 0,this._canvas=void 0,this._eventTarget=new vi,this._pointLocked=!1,this._isPressed=!1,this._preMousePos=new zn,this.support=void 0!==document.documentElement.onmouseup,this.support&&(this._canvas=document.getElementById("GameCanvas"),this._canvas||console.warn("failed to access canvas"),this._registerEvent())}var t=e.prototype;return t._getCanvasRect=function(){var e=this._canvas,t=null==e?void 0:e.getBoundingClientRect();return t?new Xn(t.x,t.y,t.width,t.height):new Xn(0,0,0,0)},t._getLocation=function(e){return new zn(e.clientX,e.clientY)},t._registerEvent=function(){var e,t,n,i,r=this;window.addEventListener("mousedown",(function(){r._isPressed=!0})),null===(e=this._canvas)||void 0===e||e.addEventListener("mousedown",this._createCallback(bm.MOUSE_DOWN)),null===(t=this._canvas)||void 0===t||t.addEventListener("mousemove",this._createCallback(bm.MOUSE_MOVE)),window.addEventListener("mouseup",this._createCallback(bm.MOUSE_UP)),null===(n=this._canvas)||void 0===n||n.addEventListener("mouseup",this._createCallback(bm.MOUSE_UP)),null===(i=this._canvas)||void 0===i||i.addEventListener("wheel",(function(e){var t=r._getCanvasRect(),n=r._getLocation(e),i={type:bm.MOUSE_WHEEL,x:n.x-t.x,y:t.y+t.height-n.y,button:e.button,deltaX:5*e.deltaX,deltaY:5*-e.deltaY,timestamp:performance.now(),movementX:e.movementX,movementY:e.movementY};e.stopPropagation(),e.preventDefault(),r._eventTarget.emit(bm.MOUSE_WHEEL,i)})),this._registerPointerLockEvent()},t._registerPointerLockEvent=function(){var e=this,t=function(){var t=e._canvas;document.pointerLockElement===t||document.mozPointerLockElement===t?e._pointLocked=!0:e._pointLocked=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",t,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",t,!1)},t._createCallback=function(e){var t=this;return function(n){var i,r=t._getCanvasRect(),o=t._getLocation(n),a=n.button;switch(n.type){case"mousedown":null===(i=t._canvas)||void 0===i||i.focus(),t._isPressed=!0;break;case"mouseup":t._isPressed=!1;break;case"mousemove":t._isPressed||(a=-1)}var s={type:e,x:t._pointLocked?t._preMousePos.x+n.movementX:o.x-r.x,y:t._pointLocked?t._preMousePos.y-n.movementY:r.y+r.height-o.y,button:a,timestamp:performance.now(),movementX:n.movementX,movementY:n.movementY};t._preMousePos.set(s.x,s.y),n.stopPropagation(),n.target===t._canvas&&n.preventDefault(),t._eventTarget.emit(e,s)}},t.onDown=function(e){this._eventTarget.on(bm.MOUSE_DOWN,e)},t.onMove=function(e){this._eventTarget.on(bm.MOUSE_MOVE,e)},t.onUp=function(e){this._eventTarget.on(bm.MOUSE_UP,e)},t.onWheel=function(e){this._eventTarget.on(bm.MOUSE_WHEEL,e)},e}(),Ty=function(){function e(){this.support=void 0,this._canvas=void 0,this._eventTarget=new vi,this.support=void 0!==document.documentElement.ontouchstart||void 0!==document.ontouchstart||navigator.msPointerEnabled,this.support&&(this._canvas=document.getElementById("GameCanvas"),this._canvas||console.warn("failed to access canvas"),this._registerEvent())}var t=e.prototype;return t._registerEvent=function(){var e,t,n,i;null===(e=this._canvas)||void 0===e||e.addEventListener("touchstart",this._createCallback(bm.TOUCH_START)),null===(t=this._canvas)||void 0===t||t.addEventListener("touchmove",this._createCallback(bm.TOUCH_MOVE)),null===(n=this._canvas)||void 0===n||n.addEventListener("touchend",this._createCallback(bm.TOUCH_END)),null===(i=this._canvas)||void 0===i||i.addEventListener("touchcancel",this._createCallback(bm.TOUCH_CANCEL))},t._createCallback=function(e){var t=this;return function(n){for(var r=t._getCanvasRect(),o=[],a=n.changedTouches.length,s=0;s<a;++s){var c=n.changedTouches[s],l=t._getLocation(c),u=l.x-r.x,h=r.y+r.height-l.y;if(i.view._isRotated){var _=u;u=r.height-h,h=_}var f={identifier:c.identifier,x:u,y:h,force:c.force};o.push(f)}var d,p={type:e,changedTouches:o,timestamp:performance.now()};n.stopPropagation(),n.target===t._canvas&&n.preventDefault(),"touchstart"===n.type&&(null===(d=t._canvas)||void 0===d||d.focus()),t._eventTarget.emit(e,p)}},t._getCanvasRect=function(){var e=this._canvas,t=null==e?void 0:e.getBoundingClientRect();return t?new Xn(t.x,t.y,t.width,t.height):new Xn(0,0,0,0)},t._getLocation=function(e){return new zn(e.clientX,e.clientY)},t.onStart=function(e){this._eventTarget.on(bm.TOUCH_START,e)},t.onMove=function(e){this._eventTarget.on(bm.TOUCH_MOVE,e)},t.onEnd=function(e){this._eventTarget.on(bm.TOUCH_END,e)},t.onCancel=function(e){this._eventTarget.on(bm.TOUCH_CANCEL,e)},e}(),xy=new(function(){function e(){this._touch=new Ty,this._mouse=new Ey,this._keyboard=new Sy,this._accelerometer=new vy,this._inputBox=new yy,this._inputEventList=[],this._registerEvent()}var t=e.prototype;return t._registerEvent=function(){},t._pushEvent=function(e){this._inputEventList.push(e)},t.pollEvent=function(){return this._inputEventList.shift()},e}()),Ay=new zn,Cy=e("EventMouse",function(e){function t(n,i,r){var o;return(o=e.call(this,wf.MOUSE,i)||this).movementX=0,o.movementY=0,o.eventType=void 0,o._button=t.BUTTON_MISSING,o._x=0,o._y=0,o._prevX=0,o._prevY=0,o._scrollX=0,o._scrollY=0,o.eventType=n,r&&(o._prevX=r.x,o._prevY=r.y),o}K(t,e);var n=t.prototype;return n.setScrollData=function(e,t){this._scrollX=e,this._scrollY=t},n.getScrollX=function(){return this._scrollX},n.getScrollY=function(){return this._scrollY},n.setLocation=function(e,t){this._x=e,this._y=t},n.getLocation=function(e){return e||(e=new zn),zn.set(e,this._x,this._y),e},n.getLocationInView=function(e){return e||(e=new zn),zn.set(e,this._x,i.view._designResolutionSize.height-this._y),e},n.getUILocation=function(e){return e||(e=new zn),zn.set(e,this._x,this._y),i.view._convertPointWithScale(e),e},n.getPreviousLocation=function(e){return e||(e=new zn),zn.set(e,this._prevX,this._prevY),e},n.getUIPreviousLocation=function(e){return e||(e=new zn),zn.set(e,this._prevX,this._prevY),i.view._convertPointWithScale(e),e},n.getDelta=function(e){return e||(e=new zn),zn.set(e,this._x-this._prevX,this._y-this._prevY),e},n.getDeltaX=function(){return this._x-this._prevX},n.getDeltaY=function(){return this._y-this._prevY},n.getUIDelta=function(e){return e||(e=new zn),zn.set(e,(this._x-this._prevX)/i.view.getScaleX(),(this._y-this._prevY)/i.view.getScaleY()),e},n.getUIDeltaX=function(){return(this._x-this._prevX)/i.view.getScaleX()},n.getUIDeltaY=function(){return(this._y-this._prevY)/i.view.getScaleY()},n.setButton=function(e){this._button=e},n.getButton=function(){return this._button},n.getLocationX=function(){return this._x},n.getLocationY=function(){return this._y},n.getUILocationX=function(){var e=i.view.getViewportRect();return(this._x-e.x)/i.view.getScaleX()},n.getUILocationY=function(){var e=i.view.getViewportRect();return(this._y-e.y)/i.view.getScaleY()},t}(wf));Cy.BUTTON_MISSING=-1,Cy.BUTTON_LEFT=0,Cy.BUTTON_RIGHT=2,Cy.BUTTON_MIDDLE=1,Cy.BUTTON_4=3,Cy.BUTTON_5=4,Cy.BUTTON_6=5,Cy.BUTTON_7=6,Cy.BUTTON_8=7;var by=e("EventTouch",function(e){function t(t,n,i,r){var o;return(o=e.call(this,wf.TOUCH,n)||this).touch=null,o.simulate=!1,o._eventCode=void 0,o._touches=void 0,o._allTouches=void 0,o._eventCode=i||"",o._touches=t||[],o._allTouches=r||[],o}K(t,e);var n=t.prototype;return n.getEventCode=function(){return this._eventCode},n.getTouches=function(){return this._touches},n.getAllTouches=function(){return this._allTouches},n.setLocation=function(e,t){this.touch&&this.touch.setTouchInfo(this.touch.getID(),e,t)},n.getLocation=function(e){return this.touch?this.touch.getLocation(e):new zn},n.getUILocation=function(e){return this.touch?this.touch.getUILocation(e):new zn},n.getLocationInView=function(e){return this.touch?this.touch.getLocationInView(e):new zn},n.getPreviousLocation=function(e){return this.touch?this.touch.getPreviousLocation(e):new zn},n.getStartLocation=function(e){return this.touch?this.touch.getStartLocation(e):new zn},n.getUIStartLocation=function(e){return this.touch?this.touch.getUIStartLocation(e):new zn},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(e){return this.touch?this.touch.getDelta(e):new zn},n.getUIDelta=function(e){return this.touch?this.touch.getUIDelta(e):new zn},n.getDeltaX=function(){return this.touch?this.touch.getDelta(Ay).x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta(Ay).y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},t}(wf));by.MAX_TOUCHES=5;var wy=e("EventAcceleration",function(e){function t(t,n){var i;return(i=e.call(this,wf.ACCELERATION,n)||this).acc=void 0,i.acc=t,i}return K(t,e),t}(wf)),Ry=e("EventKeyboard",function(e){function t(t,n,i){var r;return(r=e.call(this,wf.KEYBOARD,i)||this).keyCode=void 0,r.rawEvent=void 0,r.isPressed=void 0,"number"==typeof t?r.keyCode=t:(r.keyCode=t.keyCode,r.rawEvent=t),r.isPressed=n,r}return K(t,e),t}(wf));wf.EventMouse=Cy,wf.EventTouch=by,wf.EventAcceleration=wy,wf.EventKeyboard=Ry;var Iy=new zn,Py=e("Touch",function(){function e(e,t,n){void 0===n&&(n=0),this._point=new zn,this._prevPoint=new zn,this._lastModified=0,this._id=0,this._startPoint=new zn,this._startPointCaptured=!1,this.setTouchInfo(n,e,t)}var t=e.prototype;return t.getLocation=function(e){return e||(e=new zn),e.set(this._point.x,this._point.y),e},t.getLocationX=function(){return this._point.x},t.getLocationY=function(){return this._point.y},t.getUILocation=function(e){return e||(e=new zn),e.set(this._point.x,this._point.y),i.view._convertPointWithScale(e),e},t.getUILocationX=function(){var e=i.view.getViewportRect();return(this._point.x-e.x)/i.view.getScaleX()},t.getUILocationY=function(){var e=i.view.getViewportRect();return(this._point.y-e.y)/i.view.getScaleY()},t.getPreviousLocation=function(e){return e||(e=new zn),e.set(this._prevPoint.x,this._prevPoint.y),e},t.getUIPreviousLocation=function(e){return e||(e=new zn),e.set(this._prevPoint.x,this._prevPoint.y),i.view._convertPointWithScale(e),e},t.getStartLocation=function(e){return e||(e=new zn),e.set(this._startPoint.x,this._startPoint.y),e},t.getUIStartLocation=function(e){return e||(e=new zn),e.set(this._startPoint.x,this._startPoint.y),i.view._convertPointWithScale(e),e},t.getDelta=function(e){return e||(e=new zn),e.set(this._point),e.subtract(this._prevPoint),e},t.getUIDelta=function(e){return e||(e=new zn),Iy.set(this._point),Iy.subtract(this._prevPoint),e.set(i.view.getScaleX(),i.view.getScaleY()),zn.divide(e,Iy,e),e},t.getLocationInView=function(e){return e||(e=new zn),e.set(this._point.x,i.view._designResolutionSize.height-this._point.y),e},t.getPreviousLocationInView=function(e){return e||(e=new zn),e.set(this._prevPoint.x,i.view._designResolutionSize.height-this._prevPoint.y),e},t.getStartLocationInView=function(e){return e||(e=new zn),e.set(this._startPoint.x,i.view._designResolutionSize.height-this._startPoint.y),e},t.getID=function(){return this._id},t.setTouchInfo=function(e,t,n){void 0===e&&(e=0),this._prevPoint=this._point,this._point=new zn(t||0,n||0),this._id=e,this._startPointCaptured||(this._startPoint=new zn(this._point),this._startPointCaptured=!0)},t.setPoint=function(e,t){"object"==typeof e?(this._point.x=e.x,this._point.y=e.y):(this._point.x=e||0,this._point.y=t||0),this._lastModified=i.director.getCurrentTime()},t.setPrevPoint=function(e,t){this._prevPoint="object"==typeof e?new zn(e.x,e.y):new zn(e||0,t||0),this._lastModified=i.director.getCurrentTime()},X(e,[{key:"lastModified",get:function(){return this._lastModified}}]),e}());i.Touch=Py;var Oy=function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=e,this.y=t,this.z=n,this.timestamp=i},Dy=nt.TOUCH_TIMEOUT,Ny=new zn,My=new zn,Ly=new(function(){function e(){this._isRegisterEvent=!1,this._preTouchPoint=new zn,this._prevMousePoint=new zn,this._preTouchPool=[],this._preTouchPoolPointer=0,this._touches=[],this._touchesIntegerDict={},this._indexBitsUsed=0,this._maxTouches=8,this._glView=null}var t=e.prototype;return t.handleTouchesBegin=function(e){for(var t=[],n=this._touchesIntegerDict,i=0;i<e.length;++i){var r=e[i],o=r.getID();if(null!==o&&void 0===n[o]){var a=this._getUnUsedIndex();if(-1===a){T(2300,a);continue}r.getLocation(Ny);var s=new Py(Ny.x,Ny.y,o);this._touches[a]=s,r.getPreviousLocation(Ny),s.setPrevPoint(Ny),n[o]=a,t.push(s)}}if(t.length>0){var c=new by(t,!1,bm.TOUCH_START,nt.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);zm.dispatchEvent(c)}},t.handleTouchesMove=function(e){for(var t=[],n=this._touches,i=0;i<e.length;++i){var r=e[i],o=r.getID();if(null!==o){var a=this._touchesIntegerDict[o];void 0!==a&&n[a]&&(r.getLocation(Ny),n[a].setPoint(Ny),r.getPreviousLocation(Ny),n[a].setPrevPoint(Ny),t.push(n[a]))}}if(t.length>0){var s=new by(t,!1,bm.TOUCH_MOVE,nt.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);zm.dispatchEvent(s)}},t.handleTouchesEnd=function(e){var t=this.getSetOfTouchesEndOrCancel(e);if(t.length>0){var n=new by(t,!1,bm.TOUCH_END,nt.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);zm.dispatchEvent(n)}this._preTouchPool.length=0},t.handleTouchesCancel=function(e){var t=this.getSetOfTouchesEndOrCancel(e);if(t.length>0){var n=new by(t,!1,bm.TOUCH_CANCEL,nt.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);zm.dispatchEvent(n)}this._preTouchPool.length=0},t.getSetOfTouchesEndOrCancel=function(e){for(var t=[],n=this._touches,i=this._touchesIntegerDict,r=0;r<e.length;++r){var o=e[r],a=o.getID();if(null!==a){var s=i[a];void 0!==s&&n[s]&&(o.getLocation(Ny),n[s].setPoint(Ny),o.getPreviousLocation(Ny),n[s].setPrevPoint(Ny),t.push(n[s]),this._removeUsedIndexBit(s),delete i[a])}}return t},t._getPreTouch=function(e){for(var t=null,n=this._preTouchPool,i=e.getID(),r=n.length-1;r>=0;r--)if(n[r].getID()===i){t=n[r];break}return t||(t=e),t},t._setPreTouch=function(e){for(var t=!1,n=this._preTouchPool,i=e.getID(),r=n.length-1;r>=0;r--)if(n[r].getID()===i){n[r]=e,t=!0;break}t||(n.length<=50?n.push(e):(n[this._preTouchPoolPointer]=e,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},t._getViewPixelRatio=function(){return this._glView?this._glView._devicePixelRatio:1},t._getTouch=function(e){var t=this._preTouchPoint,n=this._getViewPixelRatio(),i=e.x*n,r=e.y*n,o=new Py(i,r,0);return o.setPrevPoint(t.x,t.y),t.x=i,t.y=r,o},t._getMouseEvent=function(e){var t=this._prevMousePoint,n=new Cy(e.type,!1,t),r=this._getViewPixelRatio();return t.x=e.x*r,t.y=e.y*r,i.GAME_VIEW&&(t.x/=i.gameView.canvas.width/i.game.canvas.width,t.y/=i.gameView.canvas.height/i.game.canvas.height),n.setLocation(t.x,t.y),n.setButton(e.button),e.movementX&&(n.movementX=e.movementX),e.movementY&&(n.movementY=e.movementY),n},t._getTouchList=function(e){for(var t=[],n=this._preTouchPoint,i=e.changedTouches.length,r=this._getViewPixelRatio(),o=0;o<i;o++){var a=e.changedTouches[o],s=a.x*r,c=a.y*r,l=new Py(s,c,a.identifier);if(this._getPreTouch(l).getLocation(My),l.setPrevPoint(My.x,My.y),this._setPreTouch(l),n.x=s,n.y=c,t.push(l),!nt.ENABLE_MULTI_TOUCH)break}return t},t._getUnUsedIndex=function(){for(var e=this._indexBitsUsed,t=i.director.getCurrentTime(),n=0;n<this._maxTouches;n++){if(!(1&e))return this._indexBitsUsed|=1<<n,n;var r=this._touches[n];if(t-r.lastModified>Dy){this._removeUsedIndexBit(n);var o=r.getID();return null!==o&&delete this._touchesIntegerDict[o],n}e>>=1}return-1},t._removeUsedIndexBit=function(e){if(!(e<0||e>=this._maxTouches)){var t=1<<e;t=~t,this._indexBitsUsed&=t}},t._getUsefulTouches=function(){var e=[],t=this._touchesIntegerDict;for(var n in t){var i=t[parseInt(n)];if(null!=i){var r=this._touches[i];e.push(r)}}return e},t.setAccelerometerEnabled=function(e){e?xy._accelerometer.start():xy._accelerometer.stop()},t.setAccelerometerInterval=function(e){xy._accelerometer.setInterval(e)},t.registerSystemEvent=function(){this._isRegisterEvent||(this._glView=i.view,xy._mouse.support&&this._registerMouseEvents(),xy._touch.support&&this._registerTouchEvents(),xy._keyboard.support&&this._registerKeyboardEvent(),xy._accelerometer.support&&this._registerAccelerometerEvent(),this._isRegisterEvent=!0)},t._registerMouseEvents=function(){var e=this;xy._mouse.onDown((function(t){var n=e._getMouseEvent(t),i=e._getTouch(t);e.handleTouchesBegin([i]),zm.dispatchEvent(n)})),xy._mouse.onMove((function(t){var n=e._getMouseEvent(t),i=e._getTouch(t);e.handleTouchesMove([i]),zm.dispatchEvent(n)})),xy._mouse.onUp((function(t){var n=e._getMouseEvent(t),i=e._getTouch(t);e.handleTouchesEnd([i]),zm.dispatchEvent(n)})),xy._mouse.onWheel((function(t){var n=e._getMouseEvent(t);n.setScrollData(t.deltaX,t.deltaY),zm.dispatchEvent(n)}))},t._registerTouchEvents=function(){var e=this;xy._touch.onStart((function(t){var n=e._getTouchList(t);e.handleTouchesBegin(n)})),xy._touch.onMove((function(t){var n=e._getTouchList(t);e.handleTouchesMove(n)})),xy._touch.onEnd((function(t){var n=e._getTouchList(t);e.handleTouchesEnd(n)})),xy._touch.onCancel((function(t){var n=e._getTouchList(t);e.handleTouchesCancel(n)}))},t._registerKeyboardEvent=function(){xy._keyboard.onDown((function(e){zm.dispatchEvent(new Ry(e.code,!0))})),xy._keyboard.onUp((function(e){zm.dispatchEvent(new Ry(e.code,!1))}))},t._registerAccelerometerEvent=function(){xy._accelerometer.onChange((function(e){var t=e.x,n=e.y,i=e.z,r=e.timestamp;zm.dispatchEvent(new wy(new Oy(t,n,i,r)))}))},e}());i.internal.inputManager=Ly;var By=null,Fy=null,zy=null,Uy=null,Hy=e("SystemEvent",function(e){function t(){return e.call(this)||this}K(t,e);var n=t.prototype;return n.setAccelerometerEnabled=function(e){e&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(e){T(3520,e),Ly.setAccelerometerEnabled("granted"===e)})).catch((function(e){A(3521,e.message),Ly.setAccelerometerEnabled(!1)})):Ly.setAccelerometerEnabled(e)},n.setAccelerometerInterval=function(e){Ly.setAccelerometerInterval(e)},n.on=function(t,n,r,o){return e.prototype.on.call(this,t,n,r,o),t!==bm.KEY_DOWN&&t!==bm.KEY_UP||By||(By=Rm.create({event:Rm.KEYBOARD,onKeyPressed:function(e,t){t.type=bm.KEY_DOWN,Gy.emit(t.type,t)},onKeyReleased:function(e,t){t.type=bm.KEY_UP,Gy.emit(t.type,t)}}),zm.addListener(By,256)),t===bm.DEVICEMOTION&&(Fy||(Fy=Rm.create({event:Rm.ACCELERATION,callback:function(e,t){t.type=bm.DEVICEMOTION,i.systemEvent.emit(t.type,t)}}),zm.addListener(Fy,256))),t!==bm.TOUCH_START&&t!==bm.TOUCH_MOVE&&t!==bm.TOUCH_END&&t!==bm.TOUCH_CANCEL||zy||(zy=Rm.create({event:Rm.TOUCH_ONE_BY_ONE,onTouchBegan:function(e,t){return t.type=bm.TOUCH_START,i.systemEvent.emit(t.type,e,t),!0},onTouchMoved:function(e,t){t.type=bm.TOUCH_MOVE,i.systemEvent.emit(t.type,e,t)},onTouchEnded:function(e,t){t.type=bm.TOUCH_END,i.systemEvent.emit(t.type,e,t)},onTouchCancelled:function(e,t){t.type=bm.TOUCH_CANCEL,i.systemEvent.emit(t.type,e,t)}}),zm.addListener(zy,256)),t!==bm.MOUSE_DOWN&&t!==bm.MOUSE_MOVE&&t!==bm.MOUSE_UP&&t!==bm.MOUSE_WHEEL||Uy||(Uy=Rm.create({event:Rm.MOUSE,onMouseDown:function(e){e.type=bm.MOUSE_DOWN,i.systemEvent.emit(e.type,e)},onMouseMove:function(e){e.type=bm.MOUSE_MOVE,i.systemEvent.emit(e.type,e)},onMouseUp:function(e){e.type=bm.MOUSE_UP,i.systemEvent.emit(e.type,e)},onMouseScroll:function(e){e.type=bm.MOUSE_WHEEL,i.systemEvent.emit(e.type,e)}}),zm.addListener(Uy,256)),n},n.off=function(t,n,i){if(e.prototype.off.call(this,t,n,i),By&&(t===bm.KEY_DOWN||t===bm.KEY_UP)){var r=this.hasEventListener(bm.KEY_DOWN),o=this.hasEventListener(bm.KEY_UP);r||o||(zm.removeListener(By),By=null)}if(Fy&&t===bm.DEVICEMOTION&&(zm.removeListener(Fy),Fy=null),zy&&(t===bm.TOUCH_START||t===bm.TOUCH_MOVE||t===bm.TOUCH_END||t===bm.TOUCH_CANCEL)){var a=this.hasEventListener(bm.TOUCH_START),s=this.hasEventListener(bm.TOUCH_MOVE),c=this.hasEventListener(bm.TOUCH_END),l=this.hasEventListener(bm.TOUCH_CANCEL);a||s||c||l||(zm.removeListener(zy),zy=null)}if(Uy&&(t===bm.MOUSE_DOWN||t===bm.MOUSE_MOVE||t===bm.MOUSE_UP||t===bm.MOUSE_WHEEL)){var u=this.hasEventListener(bm.MOUSE_DOWN),h=this.hasEventListener(bm.MOUSE_MOVE),_=this.hasEventListener(bm.MOUSE_UP),f=this.hasEventListener(bm.MOUSE_WHEEL);u||h||_||f||(zm.removeListener(Uy),Uy=null)}},t}(vi));Hy.EventType=bm,i.SystemEvent=Hy;var Gy=e("systemEvent",new Hy);i.systemEvent=Gy;var ky,Vy,Wy,jy,qy,Xy,Yy,Ky,Zy,Qy,Jy=yi.getViewSize(),$y=yi.pixelRatio,eS=e("sys",{NetworkType:di,Language:fi,OS:pi,Platform:gi,BrowserType:hi,isNative:yi.isNative,isBrowser:yi.isBrowser,isMobile:yi.isMobile,isLittleEndian:yi.isLittleEndian,platform:yi.platform,language:yi.language,languageCode:yi.nativeLanguage,os:yi.os,osVersion:yi.osVersion,osMainVersion:yi.osMainVersion,browserType:yi.browserType,browserVersion:yi.browserVersion,windowPixelResolution:{width:Jy.width*$y,height:Jy.height*$y},capabilities:{canvas:yi.supportCapability.canvas,opengl:yi.supportCapability.gl,webp:yi.supportCapability.webp,imageBitmap:yi.supportCapability.imageBitmap,touches:!1,mouse:!1,keyboard:!1,accelerometer:!1},localStorage:null,getNetworkType:function(){return yi.networkType},getBatteryLevel:function(){return yi.getBatteryLevel()},garbageCollect:function(){yi.triggerGC()},isObjectValid:function(e){return null!=e},dump:function(){var e="";e+="isMobile : "+this.isMobile+"\r\n",e+="language : "+this.language+"\r\n",e+="browserType : "+this.browserType+"\r\n",e+="browserVersion : "+this.browserVersion+"\r\n",e+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",e+="os : "+this.os+"\r\n",e+="osVersion : "+this.osVersion+"\r\n",e+="platform : "+this.platform+"\r\n",f(e+="Using "+(i.game.renderType===i.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(e){yi.openURL(e)},now:function(){return yi.now()},restartVM:function(){yi.restartJSVM()},getSafeAreaRect:function(){var e=i.view,t=yi.getSafeAreaEdge(),n=yi.getViewSize(),r=new zn(t.left,n.height-t.bottom),o=new zn(n.width-t.right,t.top),a={left:0,top:0,width:n.width,height:n.height};e.convertToLocationInView(r.x,r.y,a,r),e.convertToLocationInView(o.x,o.y,a,o),e._convertPointWithScale(r),e._convertPointWithScale(o);var s=r.x,c=r.y,l=o.x-r.x,u=o.y-r.y;return new Xn(s,c,l,u)},__init:function(){try{var e=eS.localStorage=window.localStorage;e.setItem("storage",""),e.removeItem("storage"),e=null}catch(e){var t=function(){A(5200)};eS.localStorage={getItem:t,setItem:t,removeItem:t,clear:t}}var n=window,i=n.navigator,r=document,o=r.documentElement,a=eS.capabilities;(void 0!==o.ontouchstart||void 0!==r.ontouchstart||i.msPointerEnabled)&&(a.touches=!0),void 0!==o.onmouseup&&(a.mouse=!0),void 0!==o.onkeyup&&(a.keyboard=!0),(n.DeviceMotionEvent||n.DeviceOrientationEvent)&&(a.accelerometer=!0),eS.__isWebIOS14OrIPadOS14Env=(eS.os===pi.IOS||eS.os===pi.OSX)&&yi.isBrowser&&/(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent),yi.onViewResize((function(){var e=yi.getViewSize();eS.windowPixelResolution={width:Math.round(e.width*$y),height:Math.round(e.height*$y)}}))}});eS.__init(),i.sys=eS;var tS,nS,iS,rS,oS,aS,sS,cS,lS,uS,hS,_S,fS,dS=e("RenderStage",(ky=S_("RenderStage"),Vy=k_(),Wy=k_(),jy=k_(),ky((Qy=function(){function e(){ee(this,"_name",Yy,this),ee(this,"_priority",Ky,this),ee(this,"_tag",Zy,this)}var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._priority=e.priority,e.tag&&(this._tag=e.tag),!0},t.activate=function(e,t){this._pipeline=e,this._flow=t},X(e,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}}]),e}(),Yy=te((Xy=Qy).prototype,"_name",[Vy,C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ky=te(Xy.prototype,"_priority",[Wy,C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Zy=te(Xy.prototype,"_tag",[jy,C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qy=Xy))||qy));i.RenderStage=dS;var pS,mS,gS,vS,yS,SS,ES,TS,xS=e("RenderFlow",(tS=S_("RenderFlow"),nS=k_(),iS=k_(),rS=k_(),oS=k_(),aS=K_([dS]),tS((fS=function(){function e(){ee(this,"_name",lS,this),ee(this,"_priority",uS,this),ee(this,"_tag",hS,this),ee(this,"_stages",_S,this)}var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._priority=e.priority,this._stages=e.stages,e.tag&&(this._tag=e.tag),!0},t.activate=function(e){this._pipeline=e,this._stages.sort((function(e,t){return e.priority-t.priority}));for(var t=0,n=this._stages.length;t<n;t++)this._stages[t].activate(e,this)},t.render=function(e){for(var t=0,n=this._stages.length;t<n;t++)this._stages[t].render(e)},t.destroy=function(){for(var e=0,t=this._stages.length;e<t;e++)this._stages[e].destroy();this._stages.length=0},X(e,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}},{key:"pipeline",get:function(){return this._pipeline}}]),e}(),lS=te((cS=fS).prototype,"_name",[nS,C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),uS=te(cS.prototype,"_priority",[iS,C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hS=te(cS.prototype,"_tag",[rS,C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_S=te(cS.prototype,"_stages",[oS,aS,C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sS=cS))||sS));i.RenderFlow=xS;var AS,CS,bS,wS,RS,IS,PS,OS,DS,NS,MS=e("EffectAsset",S_("cc.EffectAsset")((TS=ES=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"techniques",gS,Q(t)),ee(t,"shaders",vS,Q(t)),ee(t,"combinations",yS,Q(t)),ee(t,"hideInEditor",SS,Q(t)),t}K(t,e),t.register=function(e){t._effects[e.name]=e},t.remove=function(e){if(t._effects[e])delete t._effects[e];else for(var n in t._effects)if(t._effects[n]._uuid===e)return void delete t._effects[n]},t.get=function(e){if(t._effects[e])return t._effects[e];for(var n in t._effects)if(t._effects[n]._uuid===e)return t._effects[n];return null},t.getAll=function(){return t._effects};var n=t.prototype;return n.onLoaded=function(){Vp.register(this),t.register(this),i.game.once(i.Game.EVENT_ENGINE_INITED,this._precompile,this)},n._precompile=function(){for(var e=this,t=i.director.root,n=function(n){var i=e.shaders[n],r=e.combinations[n];if(!r)return"continue";Object.keys(r).reduce((function(e,t){return e.reduce((function(e,n){for(var i=r[t],o=0;o<i.length;++o){var a=Y({},n);a[t]=i[o],e.push(a)}return e}),[])}),[{}]).forEach((function(e){return Vp.getGFXShader(t.device,i.name,e,t.pipeline)}))},r=0;r<this.shaders.length;r++)n(r)},n.destroy=function(){return t.remove(this.name),e.prototype.destroy.call(this)},n.initDefault=function(n){e.prototype.initDefault.call(this,n);var i=t.get("unlit");this.name="unlit",this.shaders=i.shaders,this.combinations=i.combinations,this.techniques=i.techniques},n.validate=function(){return this.techniques.length>0&&this.shaders.length>0},t}(Rf),ES._effects={},gS=te((mS=TS).prototype,"techniques",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vS=te(mS.prototype,"shaders",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yS=te(mS.prototype,"combinations",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SS=te(mS.prototype,"hideInEditor",[C_,b_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pS=mS))||pS);i.EffectAsset=MS;var LS=new ce("RenderTex"),BS=new Ls;BS.endAccesses=[Ha.FRAGMENT_SHADER_READ_TEXTURE];var FS,zS,US,HS,GS,kS,VS,WS,jS,qS,XS=new Bs,YS=new zs([BS],XS),KS={width:1,height:1,renderPassInfo:YS},ZS=e("RenderTexture",(AS=S_("cc.RenderTexture"),CS=z_(),bS=U_(),wS=z_(),RS=U_(),AS((NS=function(e){function t(){var t;return ee(t=e.call(this)||this,"_width",OS,Q(t)),ee(t,"_height",DS,Q(t)),t._textureHash=0,t._id=void 0,t._window=null,t._id=LS.getNewId(),t._textureHash=mc(t._id,666),t}K(t,e);var n=t.prototype;return n.getHash=function(){return this._textureHash},n.initialize=function(e){this._name=e.name||"",this._width=e.width,this._height=e.height,this._initWindow(e)},n.reset=function(e){this.initialize(e)},n.destroy=function(){return this._window&&(i.director.root.destroyWindow(this._window),this._window=null),e.prototype.destroy.call(this)},n.resize=function(e,t){this._width=e,this._height=t,this._window&&this._window.resize(e,t),this.emit("resize",this._window)},n.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},n.getGFXSampler=function(){var e=i.director.root;return id.getSampler(e.device,Gf)},n.getSamplerHash=function(){return Gf},n.onLoaded=function(){this._initWindow(),this.loaded=!0,this.emit("load")},n._initWindow=function(e){var t=i.director.root;KS.title=this._name,KS.width=this._width,KS.height=this._height,KS.renderPassInfo=e&&e.passInfo?e.passInfo:YS,this._window?(this._window.destroy(),this._window.initialize(t.device,KS)):this._window=t.createWindow(KS)},n.initDefault=function(t){e.prototype.initDefault.call(this,t),this._width=this._height=1,this._initWindow()},n.validate=function(){return this.width>=1&&this.width<=2048&&this.height>=1&&this.height<=2048},X(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"window",get:function(){return this._window}}]),t}(Rf),OS=te((PS=NS).prototype,"_width",[C_,CS,bS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),DS=te(PS.prototype,"_height",[C_,wS,RS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),IS=PS))||IS));i.RenderTexture=ZS;var QS=e("Material",(FS=S_("cc.Material"),zS=K_(MS),FS((qS=function(e){function t(){var t;return ee(t=e.call(this)||this,"_effectAsset",GS,Q(t)),ee(t,"_techIdx",kS,Q(t)),ee(t,"_defines",VS,Q(t)),ee(t,"_states",WS,Q(t)),ee(t,"_props",jS,Q(t)),t._passes=[],t._hash=0,t.loaded=!1,t}K(t,e),t.getHash=function(e){for(var t,n=0,i=$(e.passes);!(t=i()).done;)n^=t.value.hash;return n};var n=t.prototype;return n.initialize=function(e){this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),void 0!==e.technique&&(this._techIdx=e.technique),e.effectAsset?this._effectAsset=e.effectAsset:e.effectName&&(this._effectAsset=MS.get(e.effectName)),e.defines&&this._prepareInfo(e.defines,this._defines),e.states&&this._prepareInfo(e.states,this._states),this._update()},n.reset=function(e){this.initialize(e)},n.destroy=function(){return this._doDestroy(),e.prototype.destroy.call(this)},n.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.onLoaded=function(){this._update(),this.loaded=!0,this.emit("load")},n.resetUniforms=function(e){void 0===e&&(e=!0),this._props.length=this._passes.length;for(var t=0;t<this._props.length;t++)this._props[t]={};if(e)for(var n,i=$(this._passes);!(n=i()).done;){var r=n.value;r.resetUBOs(),r.resetTextures()}},n.setProperty=function(e,t,n){var i=!1;if(void 0===n)for(var r=this._passes,o=r.length,a=0;a<o;a++){var s=r[a];this._uploadProperty(s,e,t)&&(this._props[s.propertyIndex][e]=t,i=!0)}else{if(n>=this._passes.length)return void console.warn("illegal pass index: "+n+".");var c=this._passes[n];this._uploadProperty(c,e,t)&&(this._props[c.propertyIndex][e]=t,i=!0)}i||console.warn("illegal property name: "+e+".")},n.getProperty=function(e,t){if(void 0===t)for(var n=this._props,i=n.length,r=0;r<i;r++){var o=n[r];if(e in o)return o[e]}else{if(t>=this._props.length)return console.warn("illegal pass index: "+t+"."),null;var a=this._props[this._passes[t].propertyIndex];if(e in a)return a[e]}return null},n.copy=function(e){this._techIdx=e._techIdx,this._props.length=e._props.length;for(var t=0;t<e._props.length;t++)this._props[t]=Y({},e._props[t]);this._defines.length=e._defines.length;for(var n=0;n<e._defines.length;n++)this._defines[n]=Y({},e._defines[n]);this._states.length=e._states.length;for(var i=0;i<e._states.length;i++)this._states[i]=Y({},e._states[i]);this._effectAsset=e._effectAsset,this._update()},n._prepareInfo=function(e,t){var n=e;if(!Array.isArray(n)){var i=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(i).fill(n)}for(var r=0;r<n.length;++r)Object.assign(t[r]||(t[r]={}),n[r])},n._createPasses=function(){var e=this._effectAsset.techniques[this._techIdx||0];if(!e)return[];for(var t=e.passes.length,n=[],r=0;r<t;++r){var o=e.passes[r],a=o.passIndex=r,s=o.defines=this._defines[a]||(this._defines[a]={}),c=o.stateOverrides=this._states[a]||(this._states[a]={});if(void 0!==o.propertyIndex&&(Object.assign(s,this._defines[o.propertyIndex]),Object.assign(c,this._states[o.propertyIndex])),void 0!==o.embeddedMacros&&Object.assign(s,o.embeddedMacros),!o.switch||s[o.switch]){var l=new em(i.director.root);l.initialize(o),n.push(l)}}return n},n._update=function(e){var n=this;if(void 0===e&&(e=!0),this._effectAsset){if(this._passes&&this._passes.length)for(var i,r=$(this._passes);!(i=r()).done;)i.value.destroy();this._passes=this._createPasses();var o=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=o,e)this._passes.forEach((function(e,t){var i=n._props[t];for(var r in i||(i=n._props[t]={}),void 0!==e.propertyIndex&&Object.assign(i,n._props[e.propertyIndex]),i)n._uploadProperty(e,r,i[r])}));else for(var a=0;a<this._props.length;a++)this._props[a]={}}this._hash=t.getHash(this)},n._uploadProperty=function(e,t,n){var i=e.getHandle(t);if(!i)return!1;var r=em.getPropertyTypeFromHandle(i);if(r===yp.BUFFER)Array.isArray(n)?e.setUniformArray(i,n):null!==n?e.setUniform(i,n):e.resetUniform(t);else if(r===yp.TEXTURE)if(Array.isArray(n))for(var o=0;o<n.length;o++)this._bindTexture(e,i,n[o],o);else n?this._bindTexture(e,i,n):e.resetTexture(t);return!0},n._bindTexture=function(e,t,n,i){var r=em.getBindingFromHandle(t);if(n instanceof Oc)e.bindTexture(r,n,i);else if(n instanceof od||n instanceof ZS){var o=n.getGFXTexture();if(!o||!o.width||!o.height)return;e.bindTexture(r,o,i),e.bindSampler(r,n.getGFXSampler(),i)}},n._doDestroy=function(){if(this._passes&&this._passes.length)for(var e,t=$(this._passes);!(e=t()).done;)e.value.destroy();this._effectAsset=null,this._passes.length=0,this._props.length=0,this._defines.length=0,this._states.length=0},n.initDefault=function(t){e.prototype.initDefault.call(this,t),this.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),this.setProperty("mainColor",new gn("#ff00ff"))},n.validate=function(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0},X(t,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),t}(Rf),GS=te((HS=qS).prototype,"_effectAsset",[zS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kS=te(HS.prototype,"_techIdx",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),VS=te(HS.prototype,"_defines",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),WS=te(HS.prototype,"_states",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jS=te(HS.prototype,"_props",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),US=HS))||US));i.Material=QS;var JS=Qe({Planar:0,ShadowMap:1}),$S=Qe({HARD:0,FILTER_X5:1,FILTER_X9:2,FILTER_X25:3}),eE=JS.ShadowMap+1,tE=function(){function e(){this.sphere=new Ja(0,0,0,.01),this.maxReceived=4,this._normal=new yn(0,1,0),this._shadowColor=new gn(0,0,0,76),this._matLight=new Mn,this._material=null,this._instancingMaterial=null,this._size=new zn(512,512),this._handle=0,this._handle=Eo.alloc()}var t=e.prototype;return t.getPlanarShader=function(e){return this._material||(this._material=new QS,this._material.initialize({effectName:"planar-shadow"}),Eo.set(this._handle,go.PLANAR_PASS,this._material.passes[0].handle)),this._material.passes[0].getShaderVariant(e)},t.getPlanarInstanceShader=function(e){return this._instancingMaterial||(this._instancingMaterial=new QS,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),Eo.set(this._handle,go.INSTANCE_PASS,this._instancingMaterial.passes[0].handle)),this._instancingMaterial.passes[0].getShaderVariant(e)},t.initialize=function(e){Eo.set(this._handle,go.TYPE,e.enabled?e.type:eE),Eo.set(this._handle,go.NEAR,e.near),Eo.set(this._handle,go.FAR,e.far),Eo.set(this._handle,go.ASPECT,e.aspect),Eo.set(this._handle,go.ORTHO_SIZE,e.orthoSize),this._size=e.shadowMapSize,Eo.setVec2(this._handle,go.SIZE,this._size),Eo.set(this._handle,go.PCF_TYPE,e.pcf),yn.copy(this._normal,e.normal),Eo.setVec3(this._handle,go.NORMAL,this._normal),Eo.set(this._handle,go.DISTANCE,e.distance),this._shadowColor.set(e.shadowColor),Eo.setVec4(this._handle,go.COLOR,this._shadowColor),Eo.set(this._handle,go.BIAS,e.bias),Eo.set(this._handle,go.PACKING,e.packing?1:0),Eo.set(this._handle,go.LINEAR,e.linear?1:0),Eo.set(this._handle,go.SELF_SHADOW,e.selfShadow?1:0),Eo.set(this._handle,go.NORMAL_BIAS,e.normalBias),Eo.set(this._handle,go.ENABLE,e.enabled?1:0),this.maxReceived=e.maxReceived,Eo.set(this._handle,go.AUTO_ADAPT,e.autoAdapt?1:0)},t.activate=function(){if(this.enabled)this.type===JS.ShadowMap?this._updatePipeline():this._updatePlanarInfo();else{var e=i.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=0,e.onGlobalPipelineStateChanged()}},t._updatePlanarInfo=function(){this._material||(this._material=new QS,this._material.initialize({effectName:"planar-shadow"}),Eo.set(this._handle,go.PLANAR_PASS,this._material.passes[0].handle)),this._instancingMaterial||(this._instancingMaterial=new QS,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),Eo.set(this._handle,go.INSTANCE_PASS,this._instancingMaterial.passes[0].handle));var e=i.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=0,e.onGlobalPipelineStateChanged()},t._updatePipeline=function(){var e=i.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=1,e.onGlobalPipelineStateChanged()},t.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this._handle&&(Eo.free(this._handle),this._handle=0),this.sphere.destroy()},X(e,[{key:"enabled",get:function(){return!!Eo.get(this._handle,go.ENABLE)},set:function(e){Eo.set(this._handle,go.ENABLE,e?1:0),e||Eo.set(this._handle,go.TYPE,eE),this.activate()}},{key:"normal",get:function(){return this._normal},set:function(e){yn.copy(this._normal,e),Eo.setVec3(this._handle,go.NORMAL,this._normal)}},{key:"distance",get:function(){return Eo.get(this._handle,go.DISTANCE)},set:function(e){Eo.set(this._handle,go.DISTANCE,e)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(e){this._shadowColor=e,Eo.setVec4(this._handle,go.COLOR,e)}},{key:"type",get:function(){return Eo.get(this._handle,go.TYPE)},set:function(e){Eo.set(this._handle,go.TYPE,this.enabled?e:eE),this.activate()}},{key:"near",get:function(){return Eo.get(this._handle,go.NEAR)},set:function(e){Eo.set(this._handle,go.NEAR,e)}},{key:"far",get:function(){return Eo.get(this._handle,go.FAR)},set:function(e){Eo.set(this._handle,go.FAR,e)}},{key:"aspect",get:function(){return Eo.get(this._handle,go.ASPECT)},set:function(e){Eo.set(this._handle,go.ASPECT,e)}},{key:"orthoSize",get:function(){return Eo.get(this._handle,go.ORTHO_SIZE)},set:function(e){Eo.set(this._handle,go.ORTHO_SIZE,e)}},{key:"size",get:function(){return this._size},set:function(e){this._size=e,Eo.setVec2(this._handle,go.SIZE,this._size)}},{key:"pcf",get:function(){return Eo.get(this._handle,go.PCF_TYPE)},set:function(e){Eo.set(this._handle,go.PCF_TYPE,e)}},{key:"shadowMapDirty",get:function(){return!!Eo.get(this._handle,go.SHADOW_MAP_DIRTY)},set:function(e){Eo.set(this._handle,go.SHADOW_MAP_DIRTY,e?1:0)}},{key:"bias",get:function(){return Eo.get(this._handle,go.BIAS)},set:function(e){Eo.set(this._handle,go.BIAS,e)}},{key:"packing",get:function(){return!!Eo.get(this._handle,go.PACKING)},set:function(e){Eo.set(this._handle,go.PACKING,e?1:0)}},{key:"linear",get:function(){return!!Eo.get(this._handle,go.LINEAR)},set:function(e){Eo.set(this._handle,go.LINEAR,e?1:0)}},{key:"selfShadow",get:function(){return!!Eo.get(this._handle,go.SELF_SHADOW)},set:function(e){Eo.set(this._handle,go.SELF_SHADOW,e?1:0)}},{key:"normalBias",get:function(){return Eo.get(this._handle,go.NORMAL_BIAS)},set:function(e){Eo.set(this._handle,go.NORMAL_BIAS,e)}},{key:"autoAdapt",get:function(){return!!Eo.get(this._handle,go.AUTO_ADAPT)},set:function(e){Eo.set(this._handle,go.AUTO_ADAPT,e?1:0)}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}},{key:"handle",get:function(){return this._handle}}]),e}();tE.MAX_FAR=2e3,tE.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),i.Shadows=tE;var nE=new yn,iE=new yn,rE=new yn,oE=new Mn,aE=new $l,sE=!1,cE=[],lE=Ja.create(0,0,0,1),uE=new Zn((function(){return{model:null,depth:0}}),128),hE=new Zn((function(){return{model:null,depth:0}}),128);function _E(e,t){var n=0;e.node&&(yn.subtract(nE,e.node.worldPosition,t.position),n=yn.dot(nE,t.forward));var i=uE.alloc();return i.model=e,i.depth=n,i}function fE(e,t){var n=0;e.node&&(yn.subtract(nE,e.node.worldPosition,t.position),n=yn.dot(nE,t.forward));var i=hE.alloc();return i.model=e,i.depth=n,i}function dE(e,t,n,i){var r=e.pipelineSceneData.shadows;yn.negate(iE,n);var o=r.sphere.radius*tE.COEFFICIENT_OF_EXPANSION;return yn.multiplyScalar(rE,iE,o),yn.add(rE,rE,r.sphere.center),i.set(rE),Mn.fromRT(oE,t,rE),oE}function pE(e,t,n){var i=t.direction,r=e.normal,o=e.distance+.001,a=1/yn.dot(r,i),s=i.x*a,c=i.y*a,l=i.z*a,u=r.x,h=r.y,_=r.z,f=e.matLight;f.m00=1-u*s,f.m01=-u*c,f.m02=-u*l,f.m03=0,f.m04=-h*s,f.m05=1-h*c,f.m06=-h*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*o,f.m13=c*o,f.m14=l*o,f.m15=1,Mn.toArray(n,f,Xu.MAT_LIGHT_PLANE_PROJ_OFFSET)}function mE(e,t){var n=t.scene,i=n.mainLight,r=e.pipelineSceneData,o=r.shadows,a=r.skybox,s=r.renderObjects;uE.freeArray(s),s.length=0;var c=null;sE=!1,o.enabled&&(e.pipelineUBO.updateShadowUBORange(Xu.SHADOW_COLOR_OFFSET,o.shadowColor),o.type===JS.ShadowMap&&(c=e.pipelineSceneData.shadowObjects,hE.freeArray(c),c.length=0)),i&&o.type===JS.Planar&&function(e,t){var n=e.pipelineSceneData.shadows,i=t.direction,r=n.normal,o=n.distance+.001,a=1/yn.dot(r,i),s=i.x*a,c=i.y*a,l=i.z*a,u=r.x,h=r.y,_=r.z,f=n.matLight;f.m00=1-u*s,f.m01=-u*c,f.m02=-u*l,f.m03=0,f.m04=-h*s,f.m05=1-h*c,f.m06=-h*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*o,f.m13=c*o,f.m14=l*o,f.m15=1,e.pipelineUBO.updateShadowUBORange(Xu.MAT_LIGHT_PLANE_PROJ_OFFSET,n.matLight)}(e,i),a.enabled&&a.model&&t.clearFlag&c_&&s.push(_E(a.model,t));for(var l=n.models,u=0;u<l.length;u++){var h=l[u];if(h.enabled&&(h.node&&(t.visibility&h.node.layer)===h.node.layer||t.visibility&h.visFlags)){if(null!=c&&h.castShadow&&h.worldBounds&&(sE||(aE.copy(h.worldBounds),sE=!0),$l.merge(aE,aE,h.worldBounds),c.push(fE(h,t))),h.worldBounds&&!Gl.aabbFrustum(h.worldBounds,t.frustum))continue;s.push(_E(h,t))}}aE&&$l.toBoundingSphere(o.sphere,aE)}var gE=new Mn,vE=new Mn,yE=new yn,SE=new kn,EE=function(){function e(){this._globalUBO=new Float32Array(ju.COUNT),this._cameraUBO=new Float32Array(qu.COUNT),this._shadowUBO=new Float32Array(Xu.COUNT)}e.updateGlobalUBOView=function(e,t){var n=e.device,r=i.director.root,o=t,a=Math.floor(n.width),s=Math.floor(n.height);o[ju.TIME_OFFSET]=r.cumulativeTime,o[ju.TIME_OFFSET+1]=r.frameTime,o[ju.TIME_OFFSET+2]=i.director.getTotalFrames(),o[ju.SCREEN_SIZE_OFFSET]=n.width,o[ju.SCREEN_SIZE_OFFSET+1]=n.height,o[ju.SCREEN_SIZE_OFFSET+2]=1/n.width,o[ju.SCREEN_SIZE_OFFSET+3]=1/n.height,o[ju.NATIVE_SIZE_OFFSET]=a,o[ju.NATIVE_SIZE_OFFSET+1]=s,o[ju.NATIVE_SIZE_OFFSET+2]=1/o[ju.NATIVE_SIZE_OFFSET],o[ju.NATIVE_SIZE_OFFSET+3]=1/o[ju.NATIVE_SIZE_OFFSET+1]},e.updateCameraUBOView=function(e,t,n){var r=e.device,o=(n.scene?n.scene:i.director.getScene().renderScene).mainLight,a=e.pipelineSceneData,s=a.ambient,c=a.fog,l=Math.floor(r.width),u=Math.floor(r.height),h=t,_=n.exposure,f=a.isHDR,d=a.shadingScale,p=a.fpScale;if(h[qu.SCREEN_SCALE_OFFSET]=n.width/l*d,h[qu.SCREEN_SCALE_OFFSET+1]=n.height/u*d,h[qu.SCREEN_SCALE_OFFSET+2]=1/h[qu.SCREEN_SCALE_OFFSET],h[qu.SCREEN_SCALE_OFFSET+3]=1/h[qu.SCREEN_SCALE_OFFSET+1],h[qu.EXPOSURE_OFFSET]=_,h[qu.EXPOSURE_OFFSET+1]=1/_,h[qu.EXPOSURE_OFFSET+2]=f?1:0,h[qu.EXPOSURE_OFFSET+3]=p/_,o){if(yn.toArray(h,o.direction,qu.MAIN_LIT_DIR_OFFSET),yn.toArray(h,o.color,qu.MAIN_LIT_COLOR_OFFSET),o.useColorTemperature){var m=o.colorTemperatureRGB;h[qu.MAIN_LIT_COLOR_OFFSET]*=m.x,h[qu.MAIN_LIT_COLOR_OFFSET+1]*=m.y,h[qu.MAIN_LIT_COLOR_OFFSET+2]*=m.z}h[qu.MAIN_LIT_COLOR_OFFSET+3]=f?o.illuminance*p:o.illuminance*_}else yn.toArray(h,yn.UNIT_Z,qu.MAIN_LIT_DIR_OFFSET),kn.toArray(h,kn.ZERO,qu.MAIN_LIT_COLOR_OFFSET);var g=s.colorArray;g[3]=f?s.skyIllum*p:s.skyIllum*_,h.set(g,qu.AMBIENT_SKY_OFFSET),h.set(s.albedoArray,qu.AMBIENT_GROUND_OFFSET),Mn.toArray(h,n.matView,qu.MAT_VIEW_OFFSET),Mn.toArray(h,n.node.worldMatrix,qu.MAT_VIEW_INV_OFFSET),yn.toArray(h,n.position,qu.CAMERA_POS_OFFSET),Mn.toArray(h,n.matProj,qu.MAT_PROJ_OFFSET),Mn.toArray(h,n.matProjInv,qu.MAT_PROJ_INV_OFFSET),Mn.toArray(h,n.matViewProj,qu.MAT_VIEW_PROJ_OFFSET),Mn.toArray(h,n.matViewProjInv,qu.MAT_VIEW_PROJ_INV_OFFSET),h[qu.CAMERA_POS_OFFSET+3]=this.getCombineSignY(),h.set(c.colorArray,qu.GLOBAL_FOG_COLOR_OFFSET),h[qu.GLOBAL_FOG_BASE_OFFSET]=c.fogStart,h[qu.GLOBAL_FOG_BASE_OFFSET+1]=c.fogEnd,h[qu.GLOBAL_FOG_BASE_OFFSET+2]=c.fogDensity,h[qu.GLOBAL_FOG_ADD_OFFSET]=c.fogTop,h[qu.GLOBAL_FOG_ADD_OFFSET+1]=c.fogRange,h[qu.GLOBAL_FOG_ADD_OFFSET+2]=c.fogAtten},e.updateShadowUBOView=function(e,t,n){var i=e.device,r=n.scene.mainLight,o=e.pipelineSceneData.shadows,a=t;if(o.enabled){if(r&&o.type===JS.ShadowMap){var s,c=0,l=0,u=0;if(o.autoAdapt){s=dE(e,r.node.getWorldRotation(),r.direction,yE);var h=o.sphere.radius;c=h*o.aspect,l=h;var _=yn.distance(o.sphere.center,yE);u=Math.min(_*tE.COEFFICIENT_OF_EXPANSION,tE.MAX_FAR)}else s=r.node.getWorldMatrix(),c=o.orthoSize*o.aspect,l=o.orthoSize,u=o.far;Mn.toArray(a,s,Xu.MAT_LIGHT_VIEW_OFFSET),Mn.invert(gE,s),Mn.ortho(vE,-c,c,-l,l,o.near,u,i.capabilities.clipSpaceMinZ,i.capabilities.clipSpaceSignY),Mn.multiply(vE,vE,gE),Mn.toArray(a,vE,Xu.MAT_LIGHT_VIEW_PROJ_OFFSET);var f=$h(i),d=o.linear&&f?1:0;a[Xu.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+0]=o.near,a[Xu.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+1]=u,a[Xu.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+2]=d,a[Xu.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+3]=o.selfShadow?1:0,a[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=o.size.x,a[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=o.size.y,a[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=o.pcf,a[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=o.bias;var p=o.packing?1:f?0:1;a[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=0,a[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=p,a[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=o.normalBias,a[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0}else r&&o.type===JS.Planar&&pE(o,r,a);gn.toArray(a,o.shadowColor,Xu.SHADOW_COLOR_OFFSET)}},e.updateShadowUBOLightView=function(e,t,n){var i,r=e.device,o=e.pipelineSceneData.shadows,a=t,s=$h(r),c=o.linear&&s?1:0,l=o.packing?1:s?0:1,u=0,h=0,_=0;switch(n.type){case nm.DIRECTIONAL:if(n.update(),o.autoAdapt){var f=n.node;f&&(i=dE(e,f.getWorldRotation(),n.direction,yE));var d=o.sphere.radius;u=d*o.aspect,h=d;var p=yn.distance(o.sphere.center,yE);_=Math.min(p*tE.COEFFICIENT_OF_EXPANSION,tE.MAX_FAR)}else i=n.node.getWorldMatrix(),u=o.orthoSize*o.aspect,h=o.orthoSize,_=o.far;Mn.toArray(a,i,Xu.MAT_LIGHT_VIEW_OFFSET),Mn.invert(gE,i),SE.set(o.near,_,c,o.selfShadow?1:0),kn.toArray(a,SE,Xu.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET),SE.set(0,l,o.normalBias,0),kn.toArray(a,SE,Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET),Mn.ortho(vE,-u,u,-h,h,o.near,_,r.capabilities.clipSpaceMinZ,r.capabilities.clipSpaceSignY);break;case nm.SPOT:Mn.toArray(a,n.node.getWorldMatrix(),Xu.MAT_LIGHT_VIEW_OFFSET),Mn.invert(gE,n.node.getWorldMatrix()),SE.set(.01,n.range,c,o.selfShadow?1:0),kn.toArray(a,SE,Xu.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET),SE.set(1,l,o.normalBias,0),kn.toArray(a,SE,Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET),Mn.perspective(vE,n.spotAngle,n.aspect,.001,n.range)}Mn.multiply(vE,vE,gE),Mn.toArray(a,vE,Xu.MAT_LIGHT_VIEW_PROJ_OFFSET),SE.set(o.size.x,o.size.y,o.pcf,o.bias),kn.toArray(a,SE,Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET),gn.toArray(a,o.shadowColor,Xu.SHADOW_COLOR_OFFSET)},e.getCombineSignY=function(){return e._combineSignY};var t=e.prototype;return t._initCombineSignY=function(){var t=this._device;e._combineSignY=.5*t.capabilities.screenSpaceSignY+.5<<1|.5*t.capabilities.clipSpaceSignY+.5},t.activate=function(e,t){this._device=e,this._pipeline=t;var n=this._pipeline.descriptorSet;this._initCombineSignY();var i=e.createBuffer(new ps(Ta.UNIFORM|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,ju.SIZE,ju.SIZE));n.bindBuffer(ju.BINDING,i);var r=e.createBuffer(new ps(Ta.UNIFORM|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,qu.SIZE,qu.SIZE));n.bindBuffer(qu.BINDING,r);var o=e.createBuffer(new ps(Ta.UNIFORM|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,Xu.SIZE,Xu.SIZE));n.bindBuffer(Xu.BINDING,o)},t.updateGlobalUBO=function(){var t=this._pipeline.descriptorSet,n=this._pipeline.commandBuffers;t.update(),e.updateGlobalUBOView(this._pipeline,this._globalUBO),n[0].updateBuffer(t.getBuffer(ju.BINDING),this._globalUBO)},t.updateCameraUBO=function(t){var n=this._pipeline.descriptorSet,i=this._pipeline.commandBuffers;e.updateCameraUBOView(this._pipeline,this._cameraUBO,t),i[0].updateBuffer(n.getBuffer(qu.BINDING),this._cameraUBO)},t.updateShadowUBO=function(t){var n=this._pipeline.pipelineSceneData;if(n.shadows.enabled){var i=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers,o=n.shadowFrameBufferMap,a=t.scene.mainLight;i.update(),a&&o.has(a)&&i.bindTexture(Yu,o.get(a).colorTextures[0]),e.updateShadowUBOView(this._pipeline,this._shadowUBO,t),r[0].updateBuffer(i.getBuffer(Xu.BINDING),this._shadowUBO)}},t.updateShadowUBOLight=function(t){var n=this._pipeline.descriptorSet;e.updateShadowUBOLightView(this._pipeline,this._shadowUBO,t),n.getBuffer(Xu.BINDING).update(this._shadowUBO)},t.updateShadowUBORange=function(e,t){t instanceof Mn?Mn.toArray(this._shadowUBO,t,e):t instanceof gn&&gn.toArray(this._shadowUBO,t,e)},t.destroy=function(){},e}();EE._combineSignY=0;var TE=Qe({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),xE=TE.LAYERED+1,AE=function(){function e(){this._fogColor=new gn("#C8C8C8"),this._colorArray=new Float32Array([.2,.2,.2,1]),this._handle=0,this._handle=vo.alloc()}var t=e.prototype;return t.initialize=function(e){vo.set(this._handle,_o.ENABLE,e.enabled?1:0),vo.set(this._handle,_o.TYPE,e.enabled?e.type:xE),this._fogColor.set(e.fogColor),gn.toArray(this._colorArray,this._fogColor),vo.setVec4(this._handle,_o.COLOR,this._fogColor),vo.set(this._handle,_o.DENSITY,e.fogDensity),vo.set(this._handle,_o.START,e.fogStart),vo.set(this._handle,_o.END,e.fogEnd),vo.set(this._handle,_o.ATTEN,e.fogAtten),vo.set(this._handle,_o.TOP,e.fogTop),vo.set(this._handle,_o.RANGE,e.fogRange)},t.activate=function(){this._updatePipeline()},t._updatePipeline=function(){var e=i.director.root,t=this.enabled?this.type:xE,n=e.pipeline;n.macros.CC_USE_FOG!==t&&(n.macros.CC_USE_FOG=t,e.onGlobalPipelineStateChanged())},t.destroy=function(){this._handle&&(vo.free(this._handle),this._handle=0)},X(e,[{key:"enabled",get:function(){return vo.get(this._handle,_o.ENABLE)},set:function(e){vo.set(this._handle,_o.ENABLE,e?1:0),e||vo.set(this._handle,_o.TYPE,xE),e?this.activate():this._updatePipeline()}},{key:"fogColor",get:function(){return this._fogColor},set:function(e){this._fogColor.set(e),gn.toArray(this._colorArray,this._fogColor),vo.setVec4(this._handle,_o.COLOR,this._fogColor)}},{key:"type",get:function(){return vo.get(this._handle,_o.TYPE)},set:function(e){vo.set(this._handle,_o.TYPE,this.enabled?e:xE),this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return vo.get(this._handle,_o.DENSITY)},set:function(e){vo.set(this._handle,_o.DENSITY,e)}},{key:"fogStart",get:function(){return vo.get(this._handle,_o.START)},set:function(e){vo.set(this._handle,_o.START,e)}},{key:"fogEnd",get:function(){return vo.get(this._handle,_o.END)},set:function(e){vo.set(this._handle,_o.END,e)}},{key:"fogAtten",get:function(){return vo.get(this._handle,_o.ATTEN)},set:function(e){vo.set(this._handle,_o.ATTEN,e)}},{key:"fogTop",get:function(){return vo.get(this._handle,_o.TOP)},set:function(e){vo.set(this._handle,_o.TOP,e)}},{key:"fogRange",get:function(){return vo.get(this._handle,_o.RANGE)},set:function(e){vo.set(this._handle,_o.RANGE,e)}},{key:"colorArray",get:function(){return this._colorArray}},{key:"handle",get:function(){return this._handle}}]),e}();i.Fog=AE;var CE=function(e){function t(t,n){var i;(i=e.call(this,t.root)||this)._parent=void 0,i._owner=void 0,i._dontNotify=!1,i._parent=t,i._owner=n,i._doInit(i._parent,!0);for(var r=0;r<i._shaderInfo.blocks.length;r++){var o=i._shaderInfo.blocks[r],a=i._blocks[o.binding],s=i._parent.blocks[o.binding];a.set(s)}i._rootBufferDirty=!0;for(var c=i._parent,l=0;l<i._shaderInfo.samplerTextures.length;l++)for(var u=i._shaderInfo.samplerTextures[l],h=0;h<u.count;h++){var _=c._descriptorSet.getSampler(u.binding,h),f=c._descriptorSet.getTexture(u.binding,h);i._descriptorSet.bindSampler(u.binding,_,h),i._descriptorSet.bindTexture(u.binding,f,h)}return e.prototype.tryCompile.call(Q(i)),i}K(t,e);var n=t.prototype;return n.overridePipelineStates=function(e,t){this._bs.reset(),this._rs.reset(),this._dss.reset(),em.fillPipelineInfo(this,e),em.fillPipelineInfo(this,t),this._onStateChange()},n.tryCompile=function(t){if(t&&!Lp(this._defines,t))return!1;var n=e.prototype.tryCompile.call(this);return this._onStateChange(),n},n.beginChangeStatesSilently=function(){this._dontNotify=!0},n.endChangeStatesSilently=function(){this._dontNotify=!1},n._syncBatchingScheme=function(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,Dr.set(this._handle,pr.BATCHING_SCHEME,0)},n._onStateChange=function(){Dr.set(this._handle,pr.HASH,em.getPassHash(this,this._hShaderDefault)),this._owner.onPassStateChange(this._dontNotify)},X(t,[{key:"parent",get:function(){return this._parent}}]),t}(em),bE=function(e){function t(t){var n;return(n=e.call(this)||this)._passes=[],n._parent=void 0,n._owner=void 0,n._subModelIdx=0,n._parent=t.parent,n._owner=t.owner||null,n._subModelIdx=t.subModelIdx||0,n.copy(n._parent),n}K(t,e);var n=t.prototype;return n.recompileShaders=function(e,t){if(this._passes&&this.effectAsset)if(void 0===t)for(var n,i=$(this._passes);!(n=i()).done;)n.value.tryCompile(e);else this._passes[t].tryCompile(e)},n.overridePipelineStates=function(e,t){if(this._passes&&this.effectAsset){var n=this.effectAsset.techniques[this.technique].passes;if(void 0===t)for(var i=0;i<this._passes.length;i++){var r=this._passes[i],o=this._states[i]||(this._states[i]={});for(var a in e)o[a]=e[a];r.overridePipelineStates(n[r.passIndex],o)}else{var s=this._states[t]||(this._states[t]={});for(var c in e)s[c]=e[c];this._passes[t].overridePipelineStates(n[t],s)}}},n.destroy=function(){return this._doDestroy(),!0},n.onPassStateChange=function(e){this._hash=QS.getHash(this),!e&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},n._createPasses=function(){var e=[],t=this._parent.passes;if(!t)return e;for(var n=0;n<t.length;++n)e.push(new CE(t[n],this));return e},X(t,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]),t}(QS),wE=null,RE=null,IE=function(){function e(){this._envmap=null,this._globalDescriptorSet=null,this._model=null,this._default=null,this._handle=0,this._handle=po.alloc()}var t=e.prototype;return t.initialize=function(e){po.set(this._handle,uo.ENABLE,e.enabled?1:0),po.set(this._handle,uo.USE_IBL,e.useIBL?1:0),po.set(this._handle,uo.IS_RGBE,e.isRGBE?1:0),this._envmap=e.envmap},t.activate=function(){var e=i.director.root.pipeline,t=e.pipelineSceneData.ambient;if(this._globalDescriptorSet=e.descriptorSet,this._default=Kp.get("default-cube-texture"),this._model||(this._model=i.director.root.createModel(i.renderer.scene.Model),this._model._initLocalDescriptors=function(){}),po.set(this._handle,uo.MODEL,this._model.handle),this._envmap||(this._envmap=this._default),t.albedoArray[3]=this._envmap.mipmapLevel,RE)RE.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE});else{var n=new QS;n.initialize({effectName:"skybox",defines:{USE_RGBE_CUBEMAP:this.isRGBE}}),RE=new bE({parent:n})}this.enabled&&(wE||(wE=i.utils.createMesh(i.primitives.box({width:2,height:2,length:2}))),this._model.initSubModel(0,wE.renderingSubMeshes[0],RE)),this._updateGlobalBinding(),this._updatePipeline()},t._updatePipeline=function(){var e=this.useIBL?this.isRGBE?2:1:0,t=i.director.root,n=t.pipeline;n.macros.CC_USE_IBL!==e&&(n.macros.CC_USE_IBL=e,t.onGlobalPipelineStateChanged())},t._updateGlobalBinding=function(){var e=this.envmap.getGFXTexture(),t=id.getSampler(i.director._device,this.envmap.getSamplerHash());this._globalDescriptorSet.bindSampler(_h,t),this._globalDescriptorSet.bindTexture(_h,e)},t.destroy=function(){this._handle&&(po.free(this._handle),this._handle=0)},X(e,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return po.get(this._handle,uo.ENABLE)},set:function(e){e?this.activate():this._updatePipeline(),po.set(this._handle,uo.ENABLE,e?1:0)}},{key:"useIBL",get:function(){return po.get(this._handle,uo.USE_IBL)},set:function(e){po.set(this._handle,uo.USE_IBL,e?1:0),this._updatePipeline()}},{key:"isRGBE",get:function(){return po.get(this._handle,uo.IS_RGBE)},set:function(e){e&&(RE&&RE.recompileShaders({USE_RGBE_CUBEMAP:e}),this._model&&this._model.setSubModelMaterial(0,RE)),po.set(this._handle,uo.IS_RGBE,e?1:0),this._updatePipeline()}},{key:"envmap",get:function(){return this._envmap},set:function(e){this._envmap=e||this._default,this._envmap&&(i.director.root.pipeline.pipelineSceneData.ambient.albedoArray[3]=this._envmap.mipmapLevel,this._updateGlobalBinding())}},{key:"handle",get:function(){return this._handle}}]),e}();i.Skybox=IE;var PE,OE,DE,NE,ME,LE,BE,FE,zE,UE,HE,GE=function(){function e(){this.fog=new AE,this.ambient=new Xo,this.skybox=new IE,this.shadows=new tE,this.renderObjects=[],this.shadowObjects=[],this.shadowFrameBufferMap=new Map,this._handle=Ao.alloc(),Ao.set(this._handle,So.AMBIENT,this.ambient.handle),Ao.set(this._handle,So.SKYBOX,this.skybox.handle),Ao.set(this._handle,So.FOG,this.fog.handle),Ao.set(this._handle,So.SHADOW,this.shadows.handle),Ao.set(this._handle,So.IS_HDR,0),Ao.set(this._handle,So.SHADING_SCALE,1),Ao.set(this._handle,So.FP_SCALE,1/1024)}var t=e.prototype;return t.initDeferredPassInfo=function(){var e=Kp.get("builtin-deferred-material");if(e){var t=e.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()}var n=Kp.get("builtin-post-process-material");if(n){var i=n.passes[0];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}if(e){var r=e.passes[0];Ao.set(this._handle,So.DEFERRED_LIGHT_PASS,r.handle),Ao.set(this._handle,So.DEFERRED_LIGHT_PASS_SHADER,r.getShaderVariant())}if(n){var o=n.passes[0];Ao.set(this._handle,So.DEFERRED_POST_PASS,o.handle),Ao.set(this._handle,So.DEFERRED_POST_PASS_SHADER,o.getShaderVariant())}},t.activate=function(e,t){return this._device=e,this._pipeline=t,this.initDeferredPassInfo(),!0},t.destroy=function(){this.ambient.destroy(),this.skybox.destroy(),this.fog.destroy(),this.shadows.destroy(),this._handle&&Ao.free(this._handle)},X(e,[{key:"handle",get:function(){return this._handle}},{key:"isHDR",get:function(){return Ao.get(this._handle,So.IS_HDR)},set:function(e){Ao.set(this._handle,So.IS_HDR,e?1:0)}},{key:"shadingScale",get:function(){return Ao.get(this._handle,So.SHADING_SCALE)},set:function(e){Ao.set(this._handle,So.SHADING_SCALE,e)}},{key:"fpScale",get:function(){return Ao.get(this._handle,So.FP_SCALE)},set:function(e){Ao.set(this._handle,So.FP_SCALE,e)}},{key:"deferredLightPassHandle",get:function(){return Ao.get(this._handle,So.DEFERRED_LIGHT_PASS)}},{key:"deferredLightPassShaderHandle",get:function(){return Ao.get(this._handle,So.DEFERRED_LIGHT_PASS_SHADER)}},{key:"deferredPostPassHandle",get:function(){return Ao.get(this._handle,So.DEFERRED_POST_PASS)}},{key:"deferredPostPassShaderHandle",get:function(){return Ao.get(this._handle,So.DEFERRED_POST_PASS_SHADER)}}]),e}(),kE=e("RenderPipeline",(PE=S_("cc.RenderPipeline"),OE=k_(),DE=k_(),NE=K_([xS]),PE((zE=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_tag",BE,Q(t)),ee(t,"_flows",FE,Q(t)),t._commandBuffers=[],t._pipelineUBO=new EE,t._pipelineSceneData=new GE,t._macros={},t._constantMacros="",t}K(t,e);var n=t.prototype;return n.initialize=function(e){return this._flows=e.flows,e.tag&&(this._tag=e.tag),!0},n.generateRenderArea=function(e){var t=new os,n=e.viewport,i=this.pipelineSceneData,r=e.window.hasOnScreenAttachments&&this.device.surfaceTransform%2?e.height:e.width,o=e.window.hasOnScreenAttachments&&this.device.surfaceTransform%2?e.width:e.height;return t.x=n.x*r,t.y=n.y*o,t.width=n.width*r*i.shadingScale,t.height=n.height*o*i.shadingScale,t},n.activate=function(){this._device=i.director.root.device;var e=new Vs(Bu.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(e),this._descriptorSet=this._device.createDescriptorSet(new Ws(this._descriptorSetLayout)),this._pipelineUBO.activate(this._device,this),this._pipelineSceneData.activate(this._device,this);for(var t=0;t<this._flows.length;t++)this._flows[t].activate(this);return this._macros.CC_USE_HDR=this._pipelineSceneData.isHDR,this._generateConstantMacros(),!0},n.render=function(e){for(var t=0;t<this.flows.length;t++)for(var n=0;n<e.length;n++){var i=e[n];this.flows[t].render(i)}},n.destroy=function(){for(var t=0;t<this._flows.length;t++)this._flows[t].destroy();this._flows.length=0,this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null);for(var n=0;n<this._commandBuffers.length;n++)this._commandBuffers[n].destroy();return this._commandBuffers.length=0,this._pipelineUBO.destroy(),this._pipelineSceneData.destroy(),e.prototype.destroy.call(this)},n.resize=function(){},n._generateConstantMacros=function(){var e="";e+="#define CC_DEVICE_SUPPORT_FLOAT_TEXTURE "+(this.device.hasFeature(va.TEXTURE_FLOAT)?1:0)+"\n",e+="#define CC_DEVICE_MAX_VERTEX_UNIFORM_VECTORS "+this.device.capabilities.maxVertexUniformVectors+"\n",e+="#define CC_DEVICE_MAX_FRAGMENT_UNIFORM_VECTORS "+this.device.capabilities.maxFragmentUniformVectors+"\n",this._constantMacros=e},X(t,[{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"constantMacros",get:function(){return this._constantMacros}},{key:"macros",get:function(){return this._macros}},{key:"device",get:function(){return this._device}},{key:"descriptorSetLayout",get:function(){return this._descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}},{key:"pipelineUBO",get:function(){return this._pipelineUBO}},{key:"pipelineSceneData",get:function(){return this._pipelineSceneData}}]),t}(Rf),BE=te((LE=zE).prototype,"_tag",[OE,C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FE=te(LE.prototype,"_flows",[DE,NE,C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ME=LE))||ME));i.RenderPipeline=kE,function(e){e[e.FORWARD=10]="FORWARD",e[e.UI=20]="UI"}(UE||(UE={})),function(e){e[e.SHADOW=0]="SHADOW",e[e.FORWARD=1]="FORWARD",e[e.UI=10]="UI"}(HE||(HE={}));var VE,WE,jE,qE,XE,YE,KE,ZE,QE,JE,$E,eT,tT,nT,iT,rT,oT,aT,sT,cT,lT,uT,hT,_T,fT,dT,pT,mT,gT,vT,yT,ST,ET,TT,xT,AT,CT,bT,wT,RT,IT,PT,OT,DT,NT,MT,LT,BT,FT,zT,UT,HT,GT,kT,VT,WT,jT,qT,XT,YT,KT,ZT,QT,JT,$T,ex,tx,nx,ix,rx,ox,ax,sx,cx,lx,ux,hx,_x,fx,dx,px=e("PipelineStateManager",function(){function e(){}return e.getOrCreatePipelineState=function(e,t,n,i,r){var o=t.handle,a=Dr.get(o,pr.HASH)^i.hash^r.attributesHash^n.id,s=this._PSOHashMap.get(a);if(!s){var c=yr.get(Dr.get(o,pr.PIPELINE_LAYOUT)),l=new qs(r.attributes),u=new Cc(n,c,i,l,t.rasterizerState,t.depthStencilState,t.blendState,Dr.get(o,pr.PRIMITIVE),Dr.get(o,pr.DYNAMIC_STATES));s=e.createPipelineState(u),this._PSOHashMap.set(a,s)}return s},e}());px._PSOHashMap=new Map,et(ba),et(wa),et(Ua),et(za),et(Ha),function(e){e[e.SCENE=0]="SCENE",e[e.POSTPROCESS=1]="POSTPROCESS",e[e.UI=2]="UI"}(dx||(dx={})),et(dx),VE=S_("RenderTextureDesc"),WE=K_(ba),jE=K_(wa),qE=K_(ya),VE((YE=te((XE=function(){ee(this,"name",YE,this),ee(this,"type",KE,this),ee(this,"usage",ZE,this),ee(this,"format",QE,this),ee(this,"width",JE,this),ee(this,"height",$E,this)}).prototype,"name",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),KE=te(XE.prototype,"type",[WE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ba.TEX2D}}),ZE=te(XE.prototype,"usage",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wa.COLOR_ATTACHMENT}}),QE=te(XE.prototype,"format",[qE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ya.UNKNOWN}}),JE=te(XE.prototype,"width",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),$E=te(XE.prototype,"height",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),XE));var mx,gx=(eT=S_("RenderTextureConfig"),tT=K_(ZS),eT((rT=te((iT=function(){ee(this,"name",rT,this),ee(this,"texture",oT,this)}).prototype,"name",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),oT=te(iT.prototype,"texture",[tT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nT=iT))||nT),vx=(aT=S_("MaterialConfig"),sT=K_(QS),aT((uT=te((lT=function(){ee(this,"name",uT,this),ee(this,"material",hT,this)}).prototype,"name",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),hT=te(lT.prototype,"material",[sT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cT=lT))||cT),yx=(_T=S_("FrameBufferDesc"),fT=K_([wt]),dT=K_(ZS),_T((mT=te((pT=function(){ee(this,"name",mT,this),ee(this,"renderPass",gT,this),ee(this,"colorTextures",vT,this),ee(this,"depthStencilTexture",yT,this),ee(this,"texture",ST,this)}).prototype,"name",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),gT=te(pT.prototype,"renderPass",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vT=te(pT.prototype,"colorTextures",[fT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yT=te(pT.prototype,"depthStencilTexture",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ST=te(pT.prototype,"texture",[dT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pT)),ET=S_("ColorDesc"),TT=K_(ya),xT=K_(za),AT=K_(Ua),CT=K_([Ha]),bT=K_([Ha]),ET((IT=te((RT=function(){ee(this,"format",IT,this),ee(this,"loadOp",PT,this),ee(this,"storeOp",OT,this),ee(this,"sampleCount",DT,this),ee(this,"beginAccesses",NT,this),ee(this,"endAccesses",MT,this)}).prototype,"format",[TT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ya.UNKNOWN}}),PT=te(RT.prototype,"loadOp",[xT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return za.CLEAR}}),OT=te(RT.prototype,"storeOp",[AT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ua.STORE}}),DT=te(RT.prototype,"sampleCount",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),NT=te(RT.prototype,"beginAccesses",[CT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),MT=te(RT.prototype,"endAccesses",[bT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[Ha.PRESENT]}}),wT=RT))||wT),Sx=(LT=S_("DepthStencilDesc"),BT=K_(ya),FT=K_(za),zT=K_(Ua),UT=K_(za),HT=K_(Ua),GT=K_([Ha]),kT=K_([Ha]),LT((jT=te((WT=function(){ee(this,"format",jT,this),ee(this,"depthLoadOp",qT,this),ee(this,"depthStoreOp",XT,this),ee(this,"stencilLoadOp",YT,this),ee(this,"stencilStoreOp",KT,this),ee(this,"sampleCount",ZT,this),ee(this,"beginAccesses",QT,this),ee(this,"endAccesses",JT,this)}).prototype,"format",[BT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ya.UNKNOWN}}),qT=te(WT.prototype,"depthLoadOp",[FT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return za.CLEAR}}),XT=te(WT.prototype,"depthStoreOp",[zT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ua.STORE}}),YT=te(WT.prototype,"stencilLoadOp",[UT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return za.CLEAR}}),KT=te(WT.prototype,"stencilStoreOp",[HT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ua.STORE}}),ZT=te(WT.prototype,"sampleCount",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),QT=te(WT.prototype,"beginAccesses",[GT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JT=te(WT.prototype,"endAccesses",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[Ha.DEPTH_STENCIL_ATTACHMENT_WRITE]}}),VT=WT))||VT);$T=S_("RenderPassDesc"),ex=K_([yx]),tx=K_(Sx),$T((ix=te((nx=function(){ee(this,"index",ix,this),ee(this,"colorAttachments",rx,this),ee(this,"depthStencilAttachment",ox,this)}).prototype,"index",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),rx=te(nx.prototype,"colorAttachments",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ox=te(nx.prototype,"depthStencilAttachment",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Sx}}),nx)),function(e){e[e.FRONT_TO_BACK=0]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(mx||(mx={})),et(mx);var Ex=(ax=S_("RenderQueueDesc"),sx=K_(mx),cx=K_([wt]),ax((hx=te((ux=function(){ee(this,"isTransparent",hx,this),ee(this,"sortMode",_x,this),ee(this,"stages",fx,this)}).prototype,"isTransparent",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_x=te(ux.prototype,"sortMode",[sx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mx.FRONT_TO_BACK}}),fx=te(ux.prototype,"stages",[cx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lx=ux))||lx);function Tx(e,t){return e.hash-t.hash||e.depth-t.depth||e.shaderId-t.shaderId}function xx(e,t){return e.hash-t.hash||t.depth-e.depth||e.shaderId-t.shaderId}var Ax=function(){function e(e){this.queue=void 0,this._passDesc=void 0,this._passPool=void 0,this._passDesc=e,this._passPool=new Qn((function(){return{hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64),this.queue=new Jn(64,this._passDesc.sortFunc)}var t=e.prototype;return t.clear=function(){this.queue.clear(),this._passPool.reset()},t.insertRenderPass=function(e,t,n){var i=e.model.subModels[t],r=Lr.get(i.handle,Pr.PASS_0+n);if(i.passes[n].blendState.targets[0].blend!==this._passDesc.isTransparent||!(Dr.get(r,pr.PHASE)&this._passDesc.phases))return!1;var o=0|Dr.get(r,pr.PRIORITY)<<16|i.priority<<8|n,a=this._passPool.add();return a.hash=o,a.depth=e.depth||0,a.shaderId=Lr.get(i.handle,Pr.SHADER_0+n),a.subModel=i,a.passIdx=n,this.queue.push(a),!0},t.sort=function(){this.queue.sort()},t.recordCommandBuffer=function(e,t,n){for(var i=0;i<this.queue.length;++i){var r=this.queue.array[i],o=r.subModel,a=r.passIdx,s=o.inputAssembler,c=o.handle,l=o.passes[a],u=mr.get(Lr.get(c,Pr.SHADER_0+a)),h=px.getOrCreatePipelineState(e,l,u,t,s);n.bindPipelineState(h),n.bindDescriptorSet(Gu.MATERIAL,l.descriptorSet),n.bindDescriptorSet(Gu.LOCAL,o.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},e}();function Cx(e){for(var t=0,n=0;n<e.stages.length;n++)t|=Zp(e.stages[n]);var i=Tx;switch(e.sortMode){case mx.BACK_TO_FRONT:i=xx;break;case mx.FRONT_TO_BACK:i=Tx}return new Ax({isTransparent:e.isTransparent,phases:t,sortFunc:i})}function bx(e){e.clear()}function wx(e){e.sort()}function Rx(e,t){e.x=t.x*t.x,e.y=t.y*t.y,e.z=t.z*t.z}var Ix=function(){function e(){this.queue=new Set}var t=e.prototype;return t.clear=function(){for(var e=this.queue.values(),t=e.next();!t.done;)t.value.clear(),t=e.next();this.queue.clear()},t.uploadBuffers=function(e){for(var t=this.queue.values(),n=t.next();!n.done;){for(var i=0;i<n.value.batches.length;++i){var r=n.value.batches[i];if(r.mergeCount){for(var o=0;o<r.vbs.length;++o)r.vbs[o].update(r.vbDatas[o]);e.updateBuffer(r.vbIdx,r.vbIdxData.buffer),e.updateBuffer(r.ubo,r.uboData)}}n=t.next()}},t.recordCommandBuffer=function(e,t,n){for(var i=this.queue.values(),r=i.next();!r.done;){for(var o=!1,a=0;a<r.value.batches.length;++a){var s=r.value.batches[a];if(s.mergeCount){if(!o){var c=mr.get(s.hShader),l=px.getOrCreatePipelineState(e,s.pass,c,t,s.ia);n.bindPipelineState(l),n.bindDescriptorSet(Gu.MATERIAL,s.pass.descriptorSet),o=!0}n.bindDescriptorSet(Gu.LOCAL,s.descriptorSet,r.value.dynamicOffsets),n.bindInputAssembler(s.ia),n.draw(s.ia)}}r=i.next()}},e}(),Px=function(){function e(){this.queue=new Set}var t=e.prototype;return t.clear=function(){for(var e=this.queue.values(),t=e.next();!t.done;)t.value.clear(),t=e.next();this.queue.clear()},t.uploadBuffers=function(e){for(var t=this.queue.values(),n=t.next();!n.done;)n.value.hasPendingModels&&n.value.uploadBuffers(e),n=t.next()},t.recordCommandBuffer=function(e,t,n){for(var i=this.queue.values(),r=i.next();!r.done;){var o=r.value,a=o.instances,s=o.pass;if(o.hasPendingModels){n.bindDescriptorSet(Gu.MATERIAL,s.descriptorSet);for(var c=null,l=0;l<a.length;++l){var u=a[l];if(u.count){var h=mr.get(u.hShader),_=px.getOrCreatePipelineState(e,s,h,t,u.ia);c!==_&&(n.bindPipelineState(_),c=_),n.bindDescriptorSet(Gu.LOCAL,gr.get(u.hDescriptorSet),r.value.dynamicOffsets),n.bindInputAssembler(u.ia),n.draw(u.ia)}}}r=i.next()}},e}(),Ox=function(){function e(e){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=e.device}e.get=function(t,n){void 0===n&&(n=0);var i=e._buffers;i.has(t)||i.set(t,{});var r=i.get(t);return r[n]||(r[n]=new e(t))};var t=e.prototype;return t.destroy=function(){for(var e=0;e<this.batches.length;++e){for(var t=this.batches[e],n=0;n<t.vbs.length;++n)t.vbs[n].destroy();t.vbIdx.destroy(),t.ia.destroy(),t.ubo.destroy()}this.batches.length=0},t.merge=function(e,t,n){var i=e.subMesh.flatBuffers;if(0!==i.length){for(var r=0,o=0,a=i[0].count,s=e.passes[t],c=Lr.get(e.handle,Pr.SHADER_0+t),l=e.descriptorSet,u=!1,h=0;h<this.batches.length;++h){var _=this.batches[h];if(_.vbs.length===i.length&&_.mergeCount<Sh.BATCHING_COUNT){u=!0;for(var f=0;f<_.vbs.length;++f)if(_.vbs[f].stride!==i[f].stride){u=!1;break}if(u){for(var d=0;d<_.vbs.length;++d){var p=i[d],m=_.vbs[d],g=_.vbDatas[d];(r=(a+_.vbCount)*p.stride)>m.size&&(m.resize(r),_.vbDatas[d]=new Uint8Array(r),_.vbDatas[d].set(g)),_.vbDatas[d].set(p.buffer,_.vbCount*p.stride)}var v=_.vbIdxData;(o=4*(a+_.vbCount))>_.vbIdx.size&&(_.vbIdx.resize(o),_.vbIdxData=new Float32Array(o/Float32Array.BYTES_PER_ELEMENT),_.vbIdxData.set(v),v=_.vbIdxData);var y=_.vbCount,S=y+a,E=_.mergeCount;if(v[y]!==E||v[S-1]!==E)for(var T=y;T<S;T++)v[T]=E+.1;return Mn.toArray(_.uboData,n.transform.worldMatrix,Sh.MAT_WORLDS_OFFSET+16*_.mergeCount),_.mergeCount||(l.bindBuffer(Sh.BINDING,_.ubo),l.update(),_.pass=s,_.hShader=c,_.descriptorSet=l),++_.mergeCount,_.vbCount+=a,void(_.ia.vertexCount+=a)}}}for(var x=[],A=[],C=[],b=0;b<i.length;++b){var w=i[b],R=this._device.createBuffer(new ps(Ta.VERTEX|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,w.count*w.stride,w.stride));R.update(w.buffer.buffer),x.push(R),A.push(new Uint8Array(R.size)),C.push(R)}var I=this._device.createBuffer(new ps(Ta.VERTEX|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,4*a,4)),P=new Float32Array(a);P.fill(0),I.update(P),C.push(I);for(var O=e.inputAssembler.attributes,D=new Array(O.length+1),N=0;N<O.length;++N)D[N]=O[N];D[O.length]=new Ds("a_dyn_batch_id",ya.R32F,!1,i.length);var M=new Ms(D,C),L=this._device.createInputAssembler(M),B=this._device.createBuffer(new ps(Ta.UNIFORM|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,Sh.SIZE,Sh.SIZE));l.bindBuffer(Sh.BINDING,B),l.update();var F=new Float32Array(Sh.COUNT);Mn.toArray(F,n.transform.worldMatrix,Sh.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:x,vbDatas:A,vbIdx:I,vbIdxData:P,vbCount:a,ia:L,ubo:B,uboData:F,pass:s,hShader:c,descriptorSet:l})}},t.clear=function(){for(var e=0;e<this.batches.length;++e){var t=this.batches[e];t.vbCount=0,t.mergeCount=0,t.ia.vertexCount=0}},e}();Ox._buffers=new Map;var Dx=e("InstancedBuffer",function(){function e(e){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=e.device,this.pass=e}e.get=function(t,n){void 0===n&&(n=0);var i=e._buffers;i.has(t)||i.set(t,{});var r=i.get(t);return r[n]||(r[n]=new e(t))};var t=e.prototype;return t.destroy=function(){for(var e=0;e<this.instances.length;++e){var t=this.instances[e];t.vb.destroy(),t.ia.destroy()}this.instances.length=0},t.merge=function(e,t,n,i){void 0===i&&(i=null);var r=t.buffer.length;if(r){var o=e.inputAssembler,a=e.descriptorSet.getTexture(Uh),s=i;s||(s=Lr.get(e.handle,Pr.SHADER_0+n));for(var c=Lr.get(e.handle,Pr.DESCRIPTOR_SET),l=0;l<this.instances.length;++l){var u=this.instances[l];if(!(u.ia.indexBuffer!==o.indexBuffer||u.count>=1024)&&u.lightingMap===a){if(u.stride!==r)return;if(u.count>=u.capacity){u.capacity<<=1;var h=u.stride*u.capacity,_=u.data;u.data=new Uint8Array(h),u.data.set(_),u.vb.resize(h)}return u.hShader!==s&&(u.hShader=s),u.hDescriptorSet!==c&&(u.hDescriptorSet=c),u.data.set(t.buffer,u.stride*u.count++),void(this.hasPendingModels=!0)}}for(var f=this._device.createBuffer(new ps(Ta.VERTEX|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,32*r,r)),d=new Uint8Array(32*r),p=o.vertexBuffers.slice(),m=o.attributes.slice(),g=o.indexBuffer,v=0;v<t.attributes.length;v++){var y=t.attributes[v],S=new Ds(y.name,y.format,y.isNormalized,p.length,!0);m.push(S)}d.set(t.buffer),p.push(f);var E=new Ms(m,p,g),T=this._device.createInputAssembler(E);this.instances.push({count:1,capacity:32,vb:f,data:d,ia:T,stride:r,hShader:s,hDescriptorSet:c,lightingMap:a}),this.hasPendingModels=!0}},t.uploadBuffers=function(e){for(var t=0;t<this.instances.length;++t){var n=this.instances[t];n.count&&(n.ia.instanceCount=n.count,e.updateBuffer(n.vb,n.data))}},t.clear=function(){for(var e=0;e<this.instances.length;++e)this.instances[e].count=0;this.hasPendingModels=!1},e}());Dx._buffers=new Map;var Nx=[Pa.LINEAR,Pa.LINEAR,Pa.NONE,Oa.CLAMP,Oa.CLAMP,Oa.CLAMP],Mx=new Zn((function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}}),16),Lx=new Float32Array(4),Bx=Ja.create(0,0,0,1),Fx=[],zx=[],Ux=new Mn,Hx=new Mn;function Gx(e,t){return!(!t.worldBounds||Gl.aabbWithAABB(t.worldBounds,e.aabb))}function kx(e,t){return!(!t.worldBounds||Gl.aabbWithAABB(t.worldBounds,e.aabb)&&Gl.aabbFrustum(t.worldBounds,e.frustum))}var Vx=Zp("forward-add"),Wx=[];function jx(e,t){t.length=0;for(var n=!1,i=0;i<e.length;i++){for(var r=e[i].passes,o=-1,a=0;a<r.length;a++)if(r[a].phase===Vx){o=a,n=!0;break}t.push(o)}return n}var qx,Xx,Yx,Kx,Zx,Qx,Jx,$x,eA,tA,nA,iA=function(){function e(e){this._pipeline=void 0,this._device=void 0,this._validLights=[],this._lightPasses=[],this._descriptorSetMap=new Map,this._shadowUBO=new Float32Array(Xu.COUNT),this._lightBufferCount=16,this._lightBufferStride=void 0,this._lightBufferElementCount=void 0,this._lightBuffer=void 0,this._firstLightBufferView=void 0,this._lightBufferData=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._lightMeterScale=1e4,this._sampler=null,this._pipeline=e,this._device=e.device,this._instancedQueue=new Px,this._batchedQueue=new Ix;var t=this._device.capabilities.uboOffsetAlignment;this._lightBufferStride=Math.ceil(Eh.SIZE/t)*t,this._lightBufferElementCount=this._lightBufferStride/Float32Array.BYTES_PER_ELEMENT,this._lightBuffer=this._device.createBuffer(new ps(Ta.UNIFORM|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,this._lightBufferStride*this._lightBufferCount,this._lightBufferStride)),this._firstLightBufferView=this._device.createBuffer(new ms(this._lightBuffer,0,Eh.SIZE)),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount);var n=Wf(Nx);this._sampler=id.getSampler(this._device,n)}var t=e.prototype;return t.clear=function(){this._instancedQueue.clear(),this._batchedQueue.clear(),this._validLights.length=0;for(var e=0;e<this._lightPasses.length;e++){var t=this._lightPasses[e];t.dynamicOffsets.length=0,t.lights.length=0}Mx.freeArray(this._lightPasses),this._lightPasses.length=0},t.destroy=function(){for(var e=Array.from(this._descriptorSetMap.values()),t=0;t<e.length;++t){var n=e[t];n&&(n.getBuffer(ju.BINDING).destroy(),n.getBuffer(Xu.BINDING).destroy(),n.getSampler(Yu).destroy(),n.getSampler(ph).destroy(),n.getTexture(Yu).destroy(),n.getTexture(ph).destroy(),n.destroy())}this._descriptorSetMap.clear()},t.gatherLightPasses=function(e,t){var n=this._validLights;if(this.clear(),this._gatherValidLights(e,n),n.length){this._updateUBOs(e,t),this._updateLightDescriptorSet(e,t);for(var i=this._pipeline.pipelineSceneData.renderObjects,r=0;r<i.length;r++){var o=i[r].model,a=o.subModels;if(jx(a,Wx)&&(zx.length=0,this._lightCulling(o,n),zx.length))for(var s=0;s<a.length;s++){var c=Wx[s];if(!(c<0)){var l=a[s],u=l.passes[c];l.descriptorSet.bindBuffer(Eh.BINDING,this._firstLightBufferView),l.descriptorSet.update(),this._addRenderQueue(u,l,o,c,n)}}}this._instancedQueue.uploadBuffers(t),this._batchedQueue.uploadBuffers(t)}},t.recordCommandBuffer=function(e,t,n){this._instancedQueue.recordCommandBuffer(e,t,n),this._batchedQueue.recordCommandBuffer(e,t,n);for(var i=0;i<this._lightPasses.length;i++){var r=this._lightPasses[i],o=r.subModel,a=r.passIdx,s=r.dynamicOffsets,c=r.lights,l=mr.get(Lr.get(o.handle,Pr.SHADER_0+a)),u=o.passes[a],h=o.inputAssembler,_=px.getOrCreatePipelineState(e,u,l,t,h),f=gr.get(Dr.get(u.handle,pr.DESCRIPTOR_SET)),d=o.descriptorSet;n.bindPipelineState(_),n.bindDescriptorSet(Gu.MATERIAL,f),n.bindInputAssembler(h);for(var p=0;p<s.length;++p){var m=c[p],g=this._getOrCreateDescriptorSet(m);Fx[0]=s[p],n.bindDescriptorSet(Gu.GLOBAL,g),n.bindDescriptorSet(Gu.LOCAL,d,Fx),n.draw(h)}}},t._gatherValidLights=function(e,t){for(var n=e.scene.sphereLights,i=0;i<n.length;i++){var r=n[i];r.baked||(Ja.set(Bx,r.position.x,r.position.y,r.position.z,r.range),Gl.sphereFrustum(Bx,e.frustum)&&(t.push(r),this._getOrCreateDescriptorSet(r)))}for(var o=e.scene.spotLights,a=0;a<o.length;a++){var s=o[a];s.baked||(Ja.set(Bx,s.position.x,s.position.y,s.position.z,s.range),Gl.sphereFrustum(Bx,e.frustum)&&(t.push(s),this._getOrCreateDescriptorSet(s)))}},t._lightCulling=function(e,t){for(var n=0;n<t.length;n++){var i=t[n],r=!1;switch(i.type){case nm.SPHERE:r=Gx(i,e);break;case nm.SPOT:r=kx(i,e)}r||zx.push(n)}},t._addRenderQueue=function(e,t,n,i,r){var o=e.batchingScheme;if(o===qp.INSTANCING)for(var a=0;a<zx.length;a++){var s=zx[a],c=Dx.get(e,s);c.merge(t,n.instancedAttributes,i),c.dynamicOffsets[0]=this._lightBufferStride*s,this._instancedQueue.queue.add(c)}else if(o===qp.VB_MERGING)for(var l=0;l<zx.length;l++){var u=zx[l],h=Ox.get(e,u);h.merge(t,i,n),h.dynamicOffsets[0]=this._lightBufferStride*u,this._batchedQueue.queue.add(h)}else{var _=Mx.alloc();_.subModel=t,_.passIdx=i;for(var f=0;f<zx.length;f++){var d=zx[f];_.lights.push(r[d]),_.dynamicOffsets.push(this._lightBufferStride*d)}this._lightPasses.push(_)}},t._updateLightDescriptorSet=function(e,t){for(var n=this._pipeline.device,i=this._pipeline.pipelineSceneData,r=i.shadows,o=i.shadowFrameBufferMap,a=e.scene.mainLight,s=$h(n),c=r.linear&&s?1:0,l=r.packing?1:s?0:1,u=0;u<this._validLights.length;u++){var h=this._validLights[u],_=this._getOrCreateDescriptorSet(h);if(_){switch(h.type){case nm.SPHERE:a&&pE(r,a,this._shadowUBO),this._shadowUBO[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=r.size.x,this._shadowUBO[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=r.size.y,this._shadowUBO[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=r.pcf,this._shadowUBO[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=r.bias,this._shadowUBO[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=2,this._shadowUBO[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=l,this._shadowUBO[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=r.normalBias,this._shadowUBO[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,gn.toArray(this._shadowUBO,r.shadowColor,Xu.SHADOW_COLOR_OFFSET);break;case nm.SPOT:if(a&&pE(r,a,this._shadowUBO),Mn.toArray(this._shadowUBO,h.node.getWorldMatrix(),Xu.MAT_LIGHT_VIEW_OFFSET),Mn.invert(Ux,h.node.getWorldMatrix()),Mn.perspective(Hx,h.spotAngle,h.aspect,.001,h.range),Mn.multiply(Hx,Hx,Ux),Mn.toArray(this._shadowUBO,Hx,Xu.MAT_LIGHT_VIEW_PROJ_OFFSET),this._shadowUBO[Xu.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+0]=.01,this._shadowUBO[Xu.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+1]=h.range,this._shadowUBO[Xu.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+2]=c,this._shadowUBO[Xu.SHADOW_NEAR_FAR_LINEAR_SELF_INFO_OFFSET+3]=r.selfShadow?1:0,this._shadowUBO[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=r.size.x,this._shadowUBO[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=r.size.y,this._shadowUBO[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=r.pcf,this._shadowUBO[Xu.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=r.bias,this._shadowUBO[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=1,this._shadowUBO[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=l,this._shadowUBO[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=r.normalBias,this._shadowUBO[Xu.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,gn.toArray(this._shadowUBO,r.shadowColor,Xu.SHADOW_COLOR_OFFSET),o.has(h)&&o.has(h)){var f,d=null===(f=o.get(h))||void 0===f?void 0:f.colorTextures[0];d&&_.bindTexture(ph,d)}}_.update(),t.updateBuffer(_.getBuffer(Xu.BINDING),this._shadowUBO)}}},t._updateUBOs=function(e,t){var n=e.exposure,i=this._pipeline.pipelineSceneData,r=i.isHDR,o=i.fpScale;this._validLights.length>this._lightBufferCount&&(this._firstLightBufferView.destroy(),this._lightBufferCount=un(this._validLights.length),this._lightBuffer.resize(this._lightBufferStride*this._lightBufferCount),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount),this._firstLightBufferView.initialize(new ms(this._lightBuffer,0,Eh.SIZE)));for(var a=0,s=0;a<this._validLights.length;a++,s+=this._lightBufferElementCount){var c=this._validLights[a];switch(c.type){case nm.SPHERE:if(yn.toArray(Lx,c.position),Lx[3]=0,this._lightBufferData.set(Lx,s+Eh.LIGHT_POS_OFFSET),Lx[0]=c.size,Lx[1]=c.range,Lx[2]=0,this._lightBufferData.set(Lx,s+Eh.LIGHT_SIZE_RANGE_ANGLE_OFFSET),yn.toArray(Lx,c.color),c.useColorTemperature){var l=c.colorTemperatureRGB;Lx[0]*=l.x,Lx[1]*=l.y,Lx[2]*=l.z}Lx[3]=r?c.luminance*o*this._lightMeterScale:c.luminance*n*this._lightMeterScale,this._lightBufferData.set(Lx,s+Eh.LIGHT_COLOR_OFFSET);break;case nm.SPOT:if(yn.toArray(Lx,c.position),Lx[3]=1,this._lightBufferData.set(Lx,s+Eh.LIGHT_POS_OFFSET),Lx[0]=c.size,Lx[1]=c.range,Lx[2]=c.spotAngle,this._lightBufferData.set(Lx,s+Eh.LIGHT_SIZE_RANGE_ANGLE_OFFSET),yn.toArray(Lx,c.direction),this._lightBufferData.set(Lx,s+Eh.LIGHT_DIR_OFFSET),yn.toArray(Lx,c.color),c.useColorTemperature){var u=c.colorTemperatureRGB;Lx[0]*=u.x,Lx[1]*=u.y,Lx[2]*=u.z}Lx[3]=r?c.luminance*o*this._lightMeterScale:c.luminance*n*this._lightMeterScale,this._lightBufferData.set(Lx,s+Eh.LIGHT_COLOR_OFFSET)}}t.updateBuffer(this._lightBuffer,this._lightBufferData)},t._getOrCreateDescriptorSet=function(e){if(!this._descriptorSetMap.has(e)){var t=this._device,n=t.createDescriptorSet(new Ws(this._pipeline.descriptorSetLayout));n.bindBuffer(ju.BINDING,this._pipeline.descriptorSet.getBuffer(ju.BINDING)),n.bindBuffer(qu.BINDING,this._pipeline.descriptorSet.getBuffer(qu.BINDING));var i=t.createBuffer(new ps(Ta.UNIFORM|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,Xu.SIZE,Xu.SIZE));return n.bindBuffer(Xu.BINDING,i),n.bindSampler(Yu,this._sampler),n.bindTexture(Yu,Kp.get("default-texture").getGFXTexture()),n.bindSampler(ph,this._sampler),n.bindTexture(ph,Kp.get("default-texture").getGFXTexture()),n.update(),this._descriptorSetMap.set(e,n),n}return this._descriptorSetMap.get(e)},e}(),rA=new $l,oA=function(){function e(e){this._pendingModels=[],this._instancedQueue=new Px,this._pipeline=void 0,this._pipeline=e}var t=e.prototype;return t.gatherShadowPasses=function(e,t){var n=this._pipeline.pipelineSceneData,i=this._pipeline.pipelineUBO,r=n.shadows;if(this._instancedQueue.clear(),this._pendingModels.length=0,r.enabled&&r.type===JS.Planar){i.updateShadowUBO(e);var o=e.scene,a=e.frustum,s=0!=(e.visibility&Ru.BitMask.DEFAULT);if(o.mainLight&&s){var c=n.renderObjects,l=Dx.get(r.instancingMaterial.passes[0]);this._instancedQueue.queue.add(l);for(var u=0;u<c.length;u++){var h=c[u].model;if(h.enabled&&h.node&&h.castShadow&&(!h.worldBounds||($l.transform(rA,h.worldBounds,r.matLight),Gl.aabbFrustum(rA,a))))if(h.isInstancingEnabled)for(var _=h.subModels,f=0;f<_.length;f++){var d=_[f];l.merge(d,h.instancedAttributes,0,d.planarInstanceShaderHandle)}else this._pendingModels.push(h)}this._instancedQueue.uploadBuffers(t)}}},t.recordCommandBuffer=function(e,t,n){var i=this._pipeline.pipelineSceneData.shadows;if(i.enabled&&i.type===JS.Planar&&(this._instancedQueue.recordCommandBuffer(e,t,n),this._pendingModels.length)){var r=i.material.passes[0],o=gr.get(Dr.get(r.handle,pr.DESCRIPTOR_SET));n.bindDescriptorSet(Gu.MATERIAL,o);for(var a=this._pendingModels.length,s=0;s<a;s++)for(var c=this._pendingModels[s],l=0;l<c.subModels.length;l++){var u=c.subModels[l],h=mr.get(u.planarShaderHandle),_=u.inputAssembler,f=px.getOrCreatePipelineState(e,r,h,t,_);n.bindPipelineState(f),n.bindDescriptorSet(Gu.LOCAL,u.descriptorSet),n.bindInputAssembler(_),n.draw(_)}}},e}(),aA=function(){function e(){this._phaseID=Zp("default")}var t=e.prototype;return t.activate=function(e){this._pipeline=e},t.render=function(e,t){for(var n=this._pipeline,i=n.device,r=n.commandBuffers[0],o=e.scene.batches,a=0;a<o.length;a++){var s=o[a],c=!1;if(e.visibility&s.visFlags&&(c=!0),c)for(var l=s.handle,u=Gr.get(l,Br.PASS_COUNT),h=0;h<u;h++){var _=s.passes[h];if(_.phase===this._phaseID){var f=Gr.get(l,Br.SHADER_0+h),d=mr.get(f),p=vr.get(s.hInputAssembler),m=gr.get(s.hDescriptorSet),g=px.getOrCreatePipelineState(i,_,d,t,p);r.bindPipelineState(g),r.bindDescriptorSet(Gu.MATERIAL,_.descriptorSet),r.bindDescriptorSet(Gu.LOCAL,m),r.bindInputAssembler(p),r.draw(p)}}}},e}(),sA=[new fs(0,0,0,1)],cA=e("ForwardStage",(qx=S_("ForwardStage"),Xx=K_([Ex]),Yx=k_(),qx(($x=Jx=function(e){function t(){var t;return ee(t=e.call(this)||this,"renderQueues",Qx,Q(t)),t._renderQueues=[],t._renderArea=new os,t._batchedQueue=void 0,t._instancedQueue=void 0,t._phaseID=Zp("default"),t._clearFlag=4294967295,t._batchedQueue=new Ix,t._instancedQueue=new Px,t._uiPhase=new aA,t}K(t,e);var n=t.prototype;return n.initialize=function(t){return e.prototype.initialize.call(this,t),t.renderQueues&&(this.renderQueues=t.renderQueues),!0},n.activate=function(t,n){e.prototype.activate.call(this,t,n);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=Cx(this.renderQueues[i]);this._additiveLightQueue=new iA(this._pipeline),this._planarQueue=new oA(this._pipeline),this._uiPhase.activate(t)},n.destroy=function(){},n.render=function(e){this._instancedQueue.clear(),this._batchedQueue.clear();var t=this._pipeline,n=t.device;this._renderQueues.forEach(bx);for(var i=t.pipelineSceneData.renderObjects,r=0,o=0,a=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(r=0;r<l.length;++r){var u=l[r],h=u.passes;for(o=0;o<h.length;++o){var _=h[o];if(_.phase===this._phaseID){var f=_.batchingScheme;if(f===qp.INSTANCING){var d=Dx.get(_);d.merge(u,c.model.instancedAttributes,o),this._instancedQueue.queue.add(d)}else if(f===qp.VB_MERGING){var p=Ox.get(_);p.merge(u,o,c.model),this._batchedQueue.queue.add(p)}else for(a=0;a<this._renderQueues.length;a++)this._renderQueues[a].insertRenderPass(c,r,o)}}}}this._renderQueues.forEach(wx);var m=t.commandBuffers[0];this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),this._additiveLightQueue.gatherLightPasses(e,m),this._planarQueue.gatherShadowPasses(e,m);var g=t.pipelineSceneData;if(this._renderArea=t.generateRenderArea(e),e.clearFlag&Qa.COLOR)if(g.isHDR){Rx(sA[0],e.clearColor);var v=g.fpScale/e.exposure;sA[0].x*=v,sA[0].y*=v,sA[0].z*=v}else sA[0].x=e.clearColor.x,sA[0].y=e.clearColor.y,sA[0].z=e.clearColor.z;sA[0].w=e.clearColor.w;var y=e.window.framebuffer,S=y.colorTextures[0]?y.renderPass:t.getRenderPass(e.clearFlag&this._clearFlag);m.beginRenderPass(S,y,this._renderArea,sA,e.clearDepth,e.clearStencil),m.bindDescriptorSet(Gu.GLOBAL,t.descriptorSet),this._renderQueues[0].recordCommandBuffer(n,S,m),this._instancedQueue.recordCommandBuffer(n,S,m),this._batchedQueue.recordCommandBuffer(n,S,m),this._additiveLightQueue.recordCommandBuffer(n,S,m),this._planarQueue.recordCommandBuffer(n,S,m),this._renderQueues[1].recordCommandBuffer(n,S,m),this._uiPhase.render(e,S),m.endRenderPass()},t}(dS),Jx.initInfo={name:"ForwardStage",priority:UE.FORWARD,tag:0,renderQueues:[{isTransparent:!1,sortMode:mx.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:mx.BACK_TO_FRONT,stages:["default","planarShadow"]}]},Qx=te((Zx=$x).prototype,"renderQueues",[Xx,C_,Yx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kx=Zx))||Kx)),lA=e("ForwardFlow",S_("ForwardFlow")((nA=tA=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new cA;n.initialize(cA.initInfo),this._stages.push(n)}return!0},n.activate=function(t){e.prototype.activate.call(this,t)},n.render=function(t){e.prototype.render.call(this,t)},n.destroy=function(){e.prototype.destroy.call(this)},t}(xS),tA.initInfo={name:Nu,priority:HE.FORWARD,stages:[]},eA=nA))||eA),uA=Zp("shadow-caster"),hA=[];function _A(e,t){t.length=0;for(var n=!1,i=0;i<e.length;i++){for(var r=e[i].passes,o=-1,a=0;a<r.length;a++)if(r[a].phase===uA){o=a,n=!0;break}t.push(o)}return n}var fA,dA,pA,mA,gA,vA,yA,SA,EA,TA,xA,AA,CA,bA,wA,RA,IA,PA,OA,DA,NA,MA,LA,BA,FA,zA,UA=function(){function e(e){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._instancedQueue=void 0,this._batchedQueue=void 0,this._pipeline=e,this._instancedQueue=new Px,this._batchedQueue=new Ix}var t=e.prototype;return t.gatherLightPasses=function(e,t){this.clear();var n=this._pipeline.pipelineSceneData.shadows,i=this._pipeline.pipelineSceneData.shadowObjects;if(e&&n.enabled&&n.type===JS.ShadowMap){this._pipeline.pipelineUBO.updateShadowUBOLight(e);for(var r=0;r<i.length;r++){var o=i[r].model;if(_A(o.subModels,hA))switch(e.type){case nm.DIRECTIONAL:this.add(o,t,hA);break;case nm.SPOT:if(o.worldBounds&&(!Gl.aabbWithAABB(o.worldBounds,e.aabb)||!Gl.aabbFrustum(o.worldBounds,e.frustum)))continue;this.add(o,t,hA)}}}},t.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._batchedQueue.clear()},t.add=function(e,t,n){for(var i=e.subModels,r=0;r<i.length;r++){var o=i[r],a=n[r],s=o.passes[a];if(s.batchingScheme===qp.INSTANCING){var c=Dx.get(s);c.merge(o,e.instancedAttributes,a),this._instancedQueue.queue.add(c)}else if(s.batchingScheme===qp.VB_MERGING){var l=Ox.get(s);l.merge(o,a,e),this._batchedQueue.queue.add(l)}else{var u=mr.get(Lr.get(o.handle,Pr.SHADER_0+a));this._subModelsArray.push(o),this._shaderArray.push(u),this._passArray.push(s)}}this._instancedQueue.uploadBuffers(t),this._batchedQueue.uploadBuffers(t)},t.recordCommandBuffer=function(e,t,n){this._instancedQueue.recordCommandBuffer(e,t,n),this._batchedQueue.recordCommandBuffer(e,t,n);for(var i=0;i<this._subModelsArray.length;++i){var r=this._subModelsArray[i],o=this._shaderArray[i],a=this._passArray[i],s=r.inputAssembler,c=px.getOrCreatePipelineState(e,a,o,t,s),l=a.descriptorSet;n.bindPipelineState(c),n.bindDescriptorSet(Gu.MATERIAL,l),n.bindDescriptorSet(Gu.LOCAL,r.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},e}(),HA=[new fs(1,1,1,1)],GA=e("ShadowStage",S_("ShadowStage")((pA=dA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._shadowFrameBuffer=null,t._renderArea=new os,t._light=null,t}K(t,e);var n=t.prototype;return n.setUsage=function(e,t){this._light=e,this._shadowFrameBuffer=t},n.destroy=function(){this._additiveShadowQueue.clear()},n.clearFramebuffer=function(e){if(this._light&&this._shadowFrameBuffer){HA[0].w=e.clearColor.w;var t=this._pipeline.commandBuffers[0],n=this._shadowFrameBuffer.renderPass;t.beginRenderPass(n,this._shadowFrameBuffer,this._renderArea,HA,e.clearDepth,e.clearStencil),t.endRenderPass()}},n.render=function(e){var t=this._pipeline,n=t.pipelineSceneData,i=n.shadows,r=n.shadingScale,o=t.commandBuffers[0];if(this._light&&this._shadowFrameBuffer){this._additiveShadowQueue.gatherLightPasses(this._light,o);var a=e.viewport,s=i.size;this._renderArea.x=a.x*s.x,this._renderArea.y=a.y*s.y,this._renderArea.width=a.width*s.x*r,this._renderArea.height=a.height*s.y*r;var c=t.device,l=this._shadowFrameBuffer.renderPass;o.beginRenderPass(l,this._shadowFrameBuffer,this._renderArea,HA,e.clearDepth,e.clearStencil),o.bindDescriptorSet(Gu.GLOBAL,t.descriptorSet),this._additiveShadowQueue.recordCommandBuffer(c,l,o),o.endRenderPass()}},n.activate=function(t,n){e.prototype.activate.call(this,t,n),this._additiveShadowQueue=new UA(t)},t}(dS),dA.initInfo={name:"ShadowStage",priority:UE.FORWARD,tag:0},fA=pA))||fA),kA=e("ShadowFlow",S_("ShadowFlow")((vA=gA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._shadowRenderPass=null,t}K(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new GA;n.initialize(GA.initInfo),this._stages.push(n)}return!0},n.render=function(e){var t=this._pipeline,n=t.pipelineSceneData.shadows,i=t.pipelineSceneData.shadowFrameBufferMap,r=t.pipelineSceneData.shadowObjects;if(n.enabled&&n.type===JS.ShadowMap){var o=function(e,t){cE.length=0;var n=e.scene;cE.push(n.mainLight);for(var i=n.spotLights,r=0;r<i.length;r++){var o=i[r];Ja.set(lE,o.position.x,o.position.y,o.position.z,o.range),Gl.sphereFrustum(lE,e.frustum)&&t>cE.length&&cE.push(o)}return cE}(e,n.maxReceived);if(0!==r.length){for(var a=0;a<o.length;a++){var s=o[a];i.has(s)||this._initShadowFrameBuffer(t,s);var c=i.get(s);n.shadowMapDirty&&this.resizeShadowMap(s,n);for(var l=0;l<this._stages.length;l++){var u=this._stages[l];u.setUsage(s,c),u.render(e)}}t.pipelineUBO.updateShadowUBO(e)}else this.clearShadowMap(o,e)}},n.destroy=function(){e.prototype.destroy.call(this);for(var t=this._pipeline.pipelineSceneData.shadowFrameBufferMap,n=Array.from(t.values()),i=0;i<n.length;i++){var r=n[i];if(r){for(var o=r.colorTextures,a=0;a<o.length;a++){var s=o[i];s&&s.destroy()}o.length=0;var c=r.depthStencilTexture;c&&c.destroy(),r.destroy()}}t.clear(),this._shadowRenderPass&&this._shadowRenderPass.destroy()},n._initShadowFrameBuffer=function(e,t){var n=e.device,i=e.pipelineSceneData.shadows,r=i.size,o=e.pipelineSceneData.shadowFrameBufferMap,a=$h(n)?i.packing?ya.RGBA8:ya.RGBA16F:ya.RGBA8;if(!this._shadowRenderPass){var s=new Ls;s.format=a,s.loadOp=za.CLEAR,s.storeOp=Ua.STORE,s.sampleCount=1;var c=new Bs;c.format=n.depthStencilFormat,c.depthLoadOp=za.CLEAR,c.depthStoreOp=Ua.DISCARD,c.stencilLoadOp=za.CLEAR,c.stencilStoreOp=Ua.DISCARD,c.sampleCount=1;var l=new zs([s],c);this._shadowRenderPass=n.createRenderPass(l)}var u=[];u.push(n.createTexture(new Ss(ba.TEX2D,wa.COLOR_ATTACHMENT|wa.SAMPLED,a,r.x,r.y)));var h=n.createTexture(new Ss(ba.TEX2D,wa.DEPTH_STENCIL_ATTACHMENT,n.depthStencilFormat,r.x,r.y)),_=n.createFramebuffer(new Gs(this._shadowRenderPass,u,h));o.set(t,_)},n.clearShadowMap=function(e,t){for(var n=this._pipeline.pipelineSceneData,i=0;i<e.length;i++){var r=e[i],o=n.shadowFrameBufferMap.get(r);if(n.shadowFrameBufferMap.has(r))for(var a=0;a<this._stages.length;a++){var s=this._stages[a];s.setUsage(r,o),s.clearFramebuffer(t)}}},n.resizeShadowMap=function(e,t){var n=t.size.x,i=t.size.y,r=this._pipeline,o=r.device,a=r.pipelineSceneData.shadowFrameBufferMap,s=$h(o)?t.packing?ya.RGBA8:ya.RGBA16F:ya.RGBA8;if(a.has(e)){var c=a.get(e);if(!c)return;var l=[];l.push(r.device.createTexture(new Ss(ba.TEX2D,wa.COLOR_ATTACHMENT|wa.SAMPLED,s,n,i)));var u=c.depthStencilTexture;u&&u.resize(n,i);var h=c.renderPass;c.destroy(),c.initialize(new Gs(h,l,u))}t.shadowMapDirty=!1},t}(xS),gA.initInfo={name:Mu,priority:HE.SHADOW,tag:dx.SCENE,stages:[]},mA=vA))||mA),VA=[Pa.LINEAR,Pa.LINEAR,Pa.NONE,Oa.CLAMP,Oa.CLAMP,Oa.CLAMP],WA=e("ForwardPipeline",(yA=S_("ForwardPipeline"),SA=K_([gx]),EA=k_(),TA=K_([vx]),xA=k_(),yA((RA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"renderTextures",bA,Q(t)),ee(t,"materials",wA,Q(t)),t._renderPasses=new Map,t}K(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._flows.length){var n=new kA;n.initialize(kA.initInfo),this._flows.push(n);var i=new lA;i.initialize(lA.initInfo),this._flows.push(i)}return!0},n.activate=function(){return!(!e.prototype.activate.call(this)||!this._activeRenderer()&&(b(2402),1))},n.render=function(e){this._commandBuffers[0].begin(),this._pipelineUBO.updateGlobalUBO();for(var t=0;t<e.length;t++){var n=e[t];if(n.scene){mE(this,n),this._pipelineUBO.updateCameraUBO(n);for(var i=0;i<this._flows.length;i++)this._flows[i].render(n)}}this._commandBuffers[0].end(),this._device.flushCommands(this._commandBuffers),this._device.queue.submit(this._commandBuffers)},n.getRenderPass=function(e){var t=this._renderPasses.get(e);if(t)return t;var n=this.device,i=new Ls,r=new Bs;i.format=n.colorFormat,r.format=n.depthStencilFormat,r.stencilStoreOp=Ua.DISCARD,r.depthStoreOp=Ua.DISCARD,e&Qa.COLOR||(e&c_?i.loadOp=za.DISCARD:(i.loadOp=za.LOAD,i.beginAccesses=[Ha.PRESENT])),(e&Qa.DEPTH_STENCIL)!==Qa.DEPTH_STENCIL&&(e&Qa.DEPTH||(r.depthLoadOp=za.LOAD),e&Qa.STENCIL||(r.stencilLoadOp=za.LOAD),r.beginAccesses=[Ha.DEPTH_STENCIL_ATTACHMENT_WRITE]);var o=new zs([i],r);return t=n.createRenderPass(o),this._renderPasses.set(e,t),t},n._activeRenderer=function(){var e=this.device;this._commandBuffers.push(e.commandBuffer);var t=Wf(VA),n=id.getSampler(e,t);return this._descriptorSet.bindSampler(Yu,n),this._descriptorSet.bindTexture(Yu,Kp.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(ph,n),this._descriptorSet.bindTexture(ph,Kp.get("default-texture").getGFXTexture()),this._descriptorSet.update(),!0},n.destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(ju.BINDING).destroy(),this._descriptorSet.getBuffer(Xu.BINDING).destroy(),this._descriptorSet.getBuffer(qu.BINDING).destroy(),this._descriptorSet.getSampler(Yu).destroy(),this._descriptorSet.getSampler(ph).destroy(),this._descriptorSet.getTexture(Yu).destroy(),this._descriptorSet.getTexture(ph).destroy())},n.destroy=function(){this.destroyUBOs();for(var t=this._renderPasses.values(),n=t.next();!n.done;)n.value.destroy(),n=t.next();return this._commandBuffers.length=0,e.prototype.destroy.call(this)},t}(kE),bA=te((CA=RA).prototype,"renderTextures",[SA,C_,EA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wA=te(CA.prototype,"materials",[TA,C_,xA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AA=CA))||AA));!function(e){e[e.GBUFFER=10]="GBUFFER",e[e.LIGHTING=15]="LIGHTING",e[e.TRANSPARENT=18]="TRANSPARENT",e[e.POSTPROCESS=19]="POSTPROCESS",e[e.UI=20]="UI"}(IA||(IA={})),function(e){e[e.SHADOW=0]="SHADOW",e[e.GBUFFER=1]="GBUFFER",e[e.LIGHTING=5]="LIGHTING",e[e.UI=10]="UI"}(PA||(PA={}));var jA,qA,XA,YA,KA,ZA,QA,JA,$A,eC,tC,nC,iC,rC,oC,aC,sC,cC,lC,uC,hC,_C,fC,dC,pC,mC,gC,vC,yC,SC,EC,TC,xC,AC,CC,bC=[new fs(0,0,0,0),new fs(0,0,0,0),new fs(0,0,0,0),new fs(0,0,0,0)],wC=e("GbufferStage",(OA=S_("GbufferStage"),DA=K_([Ex]),NA=k_(),OA((zA=FA=function(e){function t(){var t;return ee(t=e.call(this)||this,"renderQueues",BA,Q(t)),t._renderQueues=[],t._renderArea=new os,t._batchedQueue=void 0,t._instancedQueue=void 0,t._phaseID=Zp("deferred"),t._batchedQueue=new Ix,t._instancedQueue=new Px,t}K(t,e);var n=t.prototype;return n.initialize=function(t){return e.prototype.initialize.call(this,t),t.renderQueues&&(this.renderQueues=t.renderQueues),!0},n.activate=function(t,n){e.prototype.activate.call(this,t,n);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=Cx(this.renderQueues[i])},n.destroy=function(){},n.render=function(e){this._instancedQueue.clear(),this._batchedQueue.clear();var t=this._pipeline,n=t.device;this._renderQueues.forEach(bx);var i=t.pipelineSceneData.renderObjects;if(0!==i.length){for(var r=0,o=0,a=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(r=0;r<l.length;++r){var u=l[r],h=u.passes;for(o=0;o<h.length;++o){var _=h[o];if(_.phase===this._phaseID){var f=_.batchingScheme;if(f===qp.INSTANCING){var d=Dx.get(_);d.merge(u,c.model.instancedAttributes,o),this._instancedQueue.queue.add(d)}else if(f===qp.VB_MERGING){var p=Ox.get(_);p.merge(u,o,c.model),this._batchedQueue.queue.add(p)}else for(a=0;a<this._renderQueues.length;a++)this._renderQueues[a].insertRenderPass(c,r,o)}}}}this._renderQueues.forEach(wx);var m=t.commandBuffers[0];if(this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),this._renderArea=t.generateRenderArea(e),t.updateQuadVertexData(this._renderArea),e.clearFlag&Qa.COLOR)if(t.pipelineSceneData.isHDR){Rx(bC[0],e.clearColor);var g=t.pipelineSceneData.fpScale/e.exposure;bC[0].x*=g,bC[0].y*=g,bC[0].z*=g}else bC[0].x=e.clearColor.x,bC[0].y=e.clearColor.y,bC[0].z=e.clearColor.z;bC[0].w=e.clearColor.w;var v=t.getDeferredRenderData(e).gbufferFrameBuffer,y=v.renderPass;m.beginRenderPass(y,v,this._renderArea,bC,e.clearDepth,e.clearStencil),m.bindDescriptorSet(Gu.GLOBAL,t.descriptorSet);for(var S=0;S<this.renderQueues.length;S++)this._renderQueues[S].recordCommandBuffer(n,y,m);this._instancedQueue.recordCommandBuffer(n,y,m),this._batchedQueue.recordCommandBuffer(n,y,m),m.endRenderPass()}},t}(dS),FA.initInfo={name:"GbufferStage",priority:IA.GBUFFER,tag:0,renderQueues:[{isTransparent:!1,sortMode:mx.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:mx.BACK_TO_FRONT,stages:["default"]}]},BA=te((LA=zA).prototype,"renderQueues",[DA,C_,NA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),MA=LA))||MA)),RC=e("GbufferFlow",S_("GbufferFlow")((XA=qA=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new wC;n.initialize(wC.initInfo),this._stages.push(n)}return!0},n.activate=function(t){e.prototype.activate.call(this,t)},n.render=function(t){e.prototype.render.call(this,t)},n.destroy=function(){e.prototype.destroy.call(this)},t}(xS),qA.initInfo={name:Ou,priority:PA.GBUFFER,stages:[]},jA=XA))||jA),IC=[new fs(0,0,0,1)],PC=e("LightingStage",(YA=S_("LightingStage"),KA=K_(QS),ZA=k_(),QA=K_([Ex]),JA=k_(),YA((rC=iC=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._deferredLitsBufs=null,t._maxDeferredLights=Th.LIGHTS_PER_PASS,t._lightMeterScale=1e4,t._descriptorSet=null,t._renderArea=new os,ee(t,"_deferredMaterial",tC,Q(t)),ee(t,"renderQueues",nC,Q(t)),t._phaseID=Zp("default"),t._defPhaseID=Zp("deferred"),t._renderQueues=[],t}K(t,e);var n=t.prototype;return n.initialize=function(t){return e.prototype.initialize.call(this,t),!0},n.gatherLights=function(e){for(var t=this._pipeline,n=t.commandBuffers[0],i=e.scene.sphereLights,r=e.scene.spotLights,o=Ja.create(0,0,0,1),a=new Float32Array(4),s=e.exposure,c=0,l=kn.length,u=l*this._maxDeferredLights,h=0;h<i.length&&c<this._maxDeferredLights;h++,++c){var _=i[h];if(Ja.set(o,_.position.x,_.position.y,_.position.z,_.range),Gl.sphereFrustum(o,e.frustum)){if(yn.toArray(a,_.position),a[3]=0,this._lightBufferData.set(a,c*l),yn.toArray(a,_.color),_.useColorTemperature){var f=_.colorTemperatureRGB;a[0]*=f.x,a[1]*=f.y,a[2]*=f.z}t.pipelineSceneData.isHDR?a[3]=_.luminance*t.pipelineSceneData.fpScale*this._lightMeterScale:a[3]=_.luminance*s*this._lightMeterScale,this._lightBufferData.set(a,c*l+1*u),a[0]=_.size,a[1]=_.range,a[2]=0,this._lightBufferData.set(a,c*l+2*u)}}for(var d=0;d<r.length&&c<this._maxDeferredLights;d++,++c){var p=r[d];if(Ja.set(o,p.position.x,p.position.y,p.position.z,p.range),Gl.sphereFrustum(o,e.frustum)){if(yn.toArray(a,p.position),a[3]=1,this._lightBufferData.set(a,c*l+0*u),yn.toArray(a,p.color),p.useColorTemperature){var m=p.colorTemperatureRGB;a[0]*=m.x,a[1]*=m.y,a[2]*=m.z}t.pipelineSceneData.isHDR?a[3]=p.luminance*t.pipelineSceneData.fpScale*this._lightMeterScale:a[3]=p.luminance*s*this._lightMeterScale,this._lightBufferData.set(a,c*l+1*u),a[0]=p.size,a[1]=p.range,a[2]=p.spotAngle,this._lightBufferData.set(a,c*l+2*u),yn.toArray(a,p.direction),this._lightBufferData.set(a,c*l+3*u)}}var g=3*u+3;this._lightBufferData.set([c],g),n.updateBuffer(this._deferredLitsBufs,this._lightBufferData)},n.activate=function(t,n){e.prototype.activate.call(this,t,n);for(var i=t.device,r=0;r<this.renderQueues.length;r++)this._renderQueues[r]=Cx(this.renderQueues[r]);var o=16*Float32Array.BYTES_PER_ELEMENT*this._maxDeferredLights;o=Math.ceil(o/i.capabilities.uboOffsetAlignment)*i.capabilities.uboOffsetAlignment,this._deferredLitsBufs=i.createBuffer(new ps(Ta.UNIFORM|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,o,i.capabilities.uboOffsetAlignment));var a=i.createBuffer(new ms(this._deferredLitsBufs,0,o));this._lightBufferData=new Float32Array(o/Float32Array.BYTES_PER_ELEMENT);var s=new Vs(Fu.bindings);this._descriptorSetLayout=i.createDescriptorSetLayout(s),this._descriptorSet=i.createDescriptorSet(new Ws(this._descriptorSetLayout)),this._descriptorSet.bindBuffer(Eh.BINDING,a),this._planarQueue=new oA(this._pipeline)},n.destroy=function(){this._deferredLitsBufs.destroy(),this._deferredLitsBufs=null,this._descriptorSet=null},n.render=function(e){var t=this._pipeline,n=t.device,i=t.commandBuffers[0],r=t.pipelineSceneData.renderObjects;if(0!==r.length){if(this.gatherLights(e),this._descriptorSet.update(),this._planarQueue.gatherShadowPasses(e,i),i.bindDescriptorSet(Gu.LOCAL,this._descriptorSet,[0]),this._renderArea=t.generateRenderArea(e),e.clearFlag&Qa.COLOR)if(t.pipelineSceneData.isHDR){Rx(IC[0],e.clearColor);var o=t.pipelineSceneData.fpScale/e.exposure;IC[0].x*=o,IC[0].y*=o,IC[0].z*=o}else IC[0].x=e.clearColor.x,IC[0].y=e.clearColor.y,IC[0].z=e.clearColor.z;IC[0].w=0;var a,s,c=t.getDeferredRenderData(e).lightingFrameBuffer,l=c.renderPass;i.beginRenderPass(l,c,this._renderArea,IC,e.clearDepth,e.clearStencil),i.bindDescriptorSet(Gu.GLOBAL,t.descriptorSet);var u=Kp.get("builtin-deferred-material");u?(a=u.passes[0],s=mr.get(a.getShaderVariant())):(a=this._deferredMaterial.passes[1],s=mr.get(this._deferredMaterial.passes[1].getShaderVariant()));var h=t.quadIAOffscreen,_=null;null!=a&&null!=s&&null!=h&&(_=px.getOrCreatePipelineState(n,a,s,l,h)),null!=_&&(i.bindPipelineState(_),i.bindInputAssembler(h),i.draw(h)),this._renderQueues.forEach(bx);for(var f=0,d=0,p=0,m=0;m<r.length;++m){var g=r[m],v=g.model.subModels;for(f=0;f<v.length;++f){var y=v[f].passes;for(d=0;d<y.length;++d){var S=y[d];if(S.phase===this._phaseID||S.phase===this._defPhaseID)for(p=0;p<this._renderQueues.length;p++)this._renderQueues[p].insertRenderPass(g,f,d)}}}this._renderQueues.forEach(wx);for(var E=0;E<this._renderQueues.length;E++)this._renderQueues[E].recordCommandBuffer(n,l,i);this._planarQueue.recordCommandBuffer(n,l,i),i.endRenderPass()}},X(t,[{key:"material",set:function(e){this._deferredMaterial!==e&&(this._deferredMaterial=e)}}]),t}(dS),iC.initInfo={name:"LightingStage",priority:IA.LIGHTING,tag:0},tC=te((eC=rC).prototype,"_deferredMaterial",[KA,C_,ZA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nC=te(eC.prototype,"renderQueues",[QA,C_,JA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$A=eC))||$A)),OC=e("LightingFlow",S_("LightingFlow")((sC=aC=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new PC;n.initialize(PC.initInfo),this._stages.push(n)}return!0},n.activate=function(t){e.prototype.activate.call(this,t)},n.render=function(t){e.prototype.render.call(this,t)},n.destroy=function(){e.prototype.destroy.call(this)},t}(xS),aC.initInfo={name:Du,priority:PA.LIGHTING,stages:[]},oC=sC))||oC),DC=Wf([Pa.LINEAR,Pa.LINEAR,Pa.NONE,Oa.CLAMP,Oa.CLAMP,Oa.CLAMP]),NC=function(){this.quadIB=null,this.quadVB=null,this.quadIA=null},MC=function(){this.gbufferFrameBuffer=null,this.gbufferRenderTargets=[],this.lightingFrameBuffer=null,this.lightingRenderTargets=[],this.depthTex=null},LC=e("DeferredPipeline",(cC=S_("DeferredPipeline"),lC=K_([gx]),uC=k_(),hC=K_([vx]),_C=k_(),cC((gC=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._quadIB=null,t._quadVBOnscreen=null,t._quadVBOffscreen=null,t._quadIAOnscreen=null,t._quadIAOffscreen=null,t._deferredRenderData=null,t._gbufferRenderPass=null,t._lightingRenderPass=null,t._width=0,t._height=0,t._lastUsedRenderArea=new os,ee(t,"renderTextures",pC,Q(t)),ee(t,"materials",mC,Q(t)),t._renderPasses=new Map,t}K(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._flows.length){var n=new kA;n.initialize(kA.initInfo),this._flows.push(n);var i=new RC;i.initialize(RC.initInfo),this._flows.push(i);var r=new OC;r.initialize(OC.initInfo),this._flows.push(r)}return!0},n.activate=function(){return this._macros.CC_PIPELINE_TYPE=1,!(!e.prototype.activate.call(this)||!this._activeRenderer()&&(b(2402),1))},n.render=function(e){if(0!==e.length){this._commandBuffers[0].begin(),this._pipelineUBO.updateGlobalUBO();for(var t=0;t<e.length;t++){var n=e[t];if(n.scene){mE(this,n),this._pipelineUBO.updateCameraUBO(n);for(var i=0;i<this._flows.length;i++)this._flows[i].render(n)}}this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)}},n.getRenderPass=function(e){var t=this._renderPasses.get(e);if(t)return t;var n=this.device,i=new Ls,r=new Bs;i.format=n.colorFormat,r.format=n.depthStencilFormat,r.stencilStoreOp=Ua.DISCARD,r.depthStoreOp=Ua.DISCARD,e&Qa.COLOR||(e&c_?i.loadOp=za.DISCARD:(i.loadOp=za.LOAD,i.beginAccesses=[Ha.PRESENT])),(e&Qa.DEPTH_STENCIL)!==Qa.DEPTH_STENCIL&&(e&Qa.DEPTH||(r.depthLoadOp=za.LOAD),e&Qa.STENCIL||(r.stencilLoadOp=za.LOAD),r.beginAccesses=[Ha.DEPTH_STENCIL_ATTACHMENT_WRITE]);var o=new zs([i],r);return t=n.createRenderPass(o),this._renderPasses.set(e,t),t},n.getDeferredRenderData=function(){return this._deferredRenderData||this._generateDeferredRenderData(),this._deferredRenderData},n._activeRenderer=function(){var e=this.device;this._commandBuffers.push(e.commandBuffer);var t=id.getSampler(e,DC);this._descriptorSet.bindSampler(Yu,t),this._descriptorSet.bindTexture(Yu,Kp.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(ph,t),this._descriptorSet.bindTexture(ph,Kp.get("default-texture").getGFXTexture()),this._descriptorSet.update();var n=new NC;if(!(n=this.createQuadInputAssembler(ga.IDENTITY)).quadIB||!n.quadVB||!n.quadIA)return!1;this._quadIB=n.quadIB,this._quadVBOffscreen=n.quadVB,this._quadIAOffscreen=n.quadIA;var i=this.createQuadInputAssembler(e.surfaceTransform);if(!i.quadIB||!i.quadVB||!i.quadIA)return!1;if(this._quadVBOnscreen=i.quadVB,this._quadIAOnscreen=i.quadIA,!this._gbufferRenderPass){var r=new Ls;r.format=ya.RGBA16F,r.loadOp=za.CLEAR,r.storeOp=Ua.STORE;var o=new Ls;o.format=ya.RGBA16F,o.loadOp=za.CLEAR,o.storeOp=Ua.STORE;var a=new Ls;a.format=ya.RGBA16F,a.loadOp=za.CLEAR,a.storeOp=Ua.STORE;var s=new Ls;s.format=ya.RGBA16F,s.loadOp=za.CLEAR,s.storeOp=Ua.STORE;var c=new Bs;c.format=e.depthStencilFormat,c.depthLoadOp=za.CLEAR,c.depthStoreOp=Ua.STORE,c.stencilLoadOp=za.CLEAR,c.stencilStoreOp=Ua.STORE;var l=new zs([r,o,a,s],c);this._gbufferRenderPass=e.createRenderPass(l)}if(!this._lightingRenderPass){var u=new Ls;u.format=ya.RGBA16F,u.loadOp=za.CLEAR,u.storeOp=Ua.STORE,u.endAccesses=[Ha.COLOR_ATTACHMENT_WRITE];var h=new Bs;h.format=e.depthStencilFormat,h.depthLoadOp=za.LOAD,h.depthStoreOp=Ua.DISCARD,h.stencilLoadOp=za.LOAD,h.stencilStoreOp=Ua.DISCARD,h.beginAccesses=[Ha.DEPTH_STENCIL_ATTACHMENT_WRITE],h.endAccesses=[Ha.DEPTH_STENCIL_ATTACHMENT_WRITE];var _=new zs([u],h);this._lightingRenderPass=e.createRenderPass(_)}return this._width=e.width,this._height=e.height,this._generateDeferredRenderData(),e.surfaceTransform===ga.IDENTITY||e.surfaceTransform===ga.ROTATE_180?(this._width=e.width,this._height=e.height):(this._width=e.height,this._height=e.width),!0},n.destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(ju.BINDING).destroy(),this._descriptorSet.getBuffer(Xu.BINDING).destroy(),this._descriptorSet.getBuffer(qu.BINDING).destroy(),this._descriptorSet.getSampler(Yu).destroy(),this._descriptorSet.getSampler(ph).destroy(),this._descriptorSet.getTexture(Yu).destroy(),this._descriptorSet.getTexture(ph).destroy())},n.destroyDeferredData=function(){var e=this._deferredRenderData;if(e){e.gbufferFrameBuffer&&e.gbufferFrameBuffer.destroy(),e.lightingFrameBuffer&&e.lightingFrameBuffer.destroy(),e.depthTex&&e.depthTex.destroy();for(var t=0;t<e.gbufferRenderTargets.length;t++)e.gbufferRenderTargets[t].destroy();e.gbufferRenderTargets.length=0;for(var n=0;n<e.lightingRenderTargets.length;n++)e.lightingRenderTargets[n].destroy();e.lightingRenderTargets.length=0}this._deferredRenderData=null},n.destroy=function(){this.destroyUBOs(),this.destroyQuadInputAssembler(),this.destroyDeferredData();for(var t=this._renderPasses.values(),n=t.next();!n.done;)n.value.destroy(),n=t.next();return this._commandBuffers.length=0,e.prototype.destroy.call(this)},n.resize=function(e,t){this._width===e&&this._height===t||(this._width=e,this._height=t,this.destroyDeferredData(),this._generateDeferredRenderData())},n.createQuadInputAssembler=function(){var e=new NC,t=4*Float32Array.BYTES_PER_ELEMENT,n=4*t,i=this._device.createBuffer(new ps(Ta.VERTEX|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,n,t));if(!i)return e;var r=Uint8Array.BYTES_PER_ELEMENT,o=6*r,a=this._device.createBuffer(new ps(Ta.INDEX|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,o,r));if(!a)return e;var s=new Uint8Array(6);s[0]=0,s[1]=1,s[2]=2,s[3]=1,s[4]=3,s[5]=2,a.update(s);var c=new Array(2);c[0]=new Ds("a_position",ya.RG32F),c[1]=new Ds("a_texCoord",ya.RG32F);var l=this._device.createInputAssembler(new Ms(c,[i],a));return e.quadIB=a,e.quadVB=i,e.quadIA=l,e},n.updateQuadVertexData=function(e){if(this._lastUsedRenderArea!==e){this._lastUsedRenderArea=e;var t=this.genQuadVertexData(ga.IDENTITY,e);this._quadVBOffscreen.update(t);var n=this.genQuadVertexData(this.device.surfaceTransform,e);this._quadVBOnscreen.update(n)}},n.genQuadVertexData=function(e,t){var n=new Float32Array(16),i=t.x/this.device.width,r=(t.x+t.width)/this.device.width,o=t.y/this.device.height,a=(t.y+t.height)/this.device.height;if(this.device.capabilities.screenSpaceSignY>0){var s=a;a=o,o=s}var c=0;switch(e){case ga.IDENTITY:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=a,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=o;break;case ga.ROTATE_90:c=0,n[c++]=-1,n[c++]=-1,n[c++]=r,n[c++]=a,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=o,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=1,n[c++]=i,n[c++]=o;break;case ga.ROTATE_180:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=o,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=a;break;case ga.ROTATE_270:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=-1,n[c++]=i,n[c++]=a,n[c++]=-1,n[c++]=1,n[c++]=r,n[c++]=o,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=a}return n},n.destroyQuadInputAssembler=function(){this._quadIB&&(this._quadIB.destroy(),this._quadIB=null),this._quadVBOnscreen&&(this._quadVBOnscreen.destroy(),this._quadVBOnscreen=null),this._quadVBOffscreen&&(this._quadVBOffscreen.destroy(),this._quadVBOffscreen=null),this._quadIAOnscreen&&(this._quadIAOnscreen.destroy(),this._quadIAOnscreen=null),this._quadIAOffscreen&&(this._quadIAOffscreen.destroy(),this._quadIAOffscreen=null)},n._generateDeferredRenderData=function(){var e=this.device,t=this._deferredRenderData=new MC;t.gbufferRenderTargets.push(e.createTexture(new Ss(ba.TEX2D,wa.COLOR_ATTACHMENT|wa.SAMPLED,ya.RGBA16F,this._width,this._height))),t.gbufferRenderTargets.push(e.createTexture(new Ss(ba.TEX2D,wa.COLOR_ATTACHMENT|wa.SAMPLED,ya.RGBA16F,this._width,this._height))),t.gbufferRenderTargets.push(e.createTexture(new Ss(ba.TEX2D,wa.COLOR_ATTACHMENT|wa.SAMPLED,ya.RGBA16F,this._width,this._height))),t.gbufferRenderTargets.push(e.createTexture(new Ss(ba.TEX2D,wa.COLOR_ATTACHMENT|wa.SAMPLED,ya.RGBA16F,this._width,this._height))),t.depthTex=e.createTexture(new Ss(ba.TEX2D,wa.DEPTH_STENCIL_ATTACHMENT,e.depthStencilFormat,this._width,this._height)),t.gbufferFrameBuffer=e.createFramebuffer(new Gs(this._gbufferRenderPass,t.gbufferRenderTargets,t.depthTex)),t.lightingRenderTargets.push(e.createTexture(new Ss(ba.TEX2D,wa.COLOR_ATTACHMENT|wa.SAMPLED,ya.RGBA16F,this._width,this._height))),t.lightingFrameBuffer=e.createFramebuffer(new Gs(this._lightingRenderPass,t.lightingRenderTargets,t.depthTex)),this._descriptorSet.bindTexture(Qu,t.gbufferFrameBuffer.colorTextures[0]),this._descriptorSet.bindTexture(eh,t.gbufferFrameBuffer.colorTextures[1]),this._descriptorSet.bindTexture(ih,t.gbufferFrameBuffer.colorTextures[2]),this._descriptorSet.bindTexture(lh,t.gbufferFrameBuffer.colorTextures[3]),this._descriptorSet.bindTexture(ah,t.lightingFrameBuffer.colorTextures[0]);var n=id.getSampler(e,DC);this._descriptorSet.bindSampler(Qu,n),this._descriptorSet.bindSampler(eh,n),this._descriptorSet.bindSampler(ih,n),this._descriptorSet.bindSampler(lh,n),this._descriptorSet.bindSampler(ah,n)},X(t,[{key:"quadIAOnscreen",get:function(){return this._quadIAOnscreen}},{key:"quadIAOffscreen",get:function(){return this._quadIAOffscreen}}]),t}(kE),pC=te((dC=gC).prototype,"renderTextures",[lC,C_,uC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mC=te(dC.prototype,"materials",[hC,C_,_C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fC=dC))||fC)),BC=[new fs(0,0,0,1)];function FC(){var e=new WA;return e.initialize({flows:[]}),e}e("PostprocessStage",(vC=S_("PostprocessStage"),yC=K_(QS),SC=k_(),vC((CC=AC=function(e){function t(){var t;return ee(t=e.call(this)||this,"_postprocessMaterial",xC,Q(t)),t._renderArea=new os,t._uiPhase=void 0,t._uiPhase=new aA,t}K(t,e);var n=t.prototype;return n.initialize=function(t){return e.prototype.initialize.call(this,t),!0},n.activate=function(t,n){e.prototype.activate.call(this,t,n),this._uiPhase.activate(t)},n.destroy=function(){},n.render=function(e){var t=this._pipeline,n=t.device,i=t.commandBuffers[0];t.pipelineUBO.updateCameraUBO(e);var r=e.viewport;this._renderArea.x=r.x*e.width,this._renderArea.y=r.y*e.height,this._renderArea.width=r.width*e.width*t.pipelineSceneData.shadingScale,this._renderArea.height=r.height*e.height*t.pipelineSceneData.shadingScale;var o,a,s=e.window.framebuffer,c=s.colorTextures[0]?s.renderPass:t.getRenderPass(e.clearFlag);e.clearFlag&Qa.COLOR&&(BC[0].x=e.clearColor.x,BC[0].y=e.clearColor.y,BC[0].z=e.clearColor.z),BC[0].w=e.clearColor.w,i.beginRenderPass(c,s,this._renderArea,BC,e.clearDepth,e.clearStencil),i.bindDescriptorSet(Gu.GLOBAL,t.descriptorSet);var l=Kp.get("builtin-post-process-material");l?(o=l.passes[0],a=mr.get(o.getShaderVariant())):(o=this._postprocessMaterial.passes[0],a=mr.get(this._postprocessMaterial.passes[0].getShaderVariant()));var u=e.window.hasOffScreenAttachments?t.quadIAOffscreen:t.quadIAOnscreen,h=null;null!=o&&null!=a&&null!=u&&(h=px.getOrCreatePipelineState(n,o,a,c,u));var _=t.pipelineSceneData.renderObjects;null!=h&&_.length>0&&(i.bindPipelineState(h),i.bindInputAssembler(u),i.draw(u)),this._uiPhase.render(e,c),i.endRenderPass()},X(t,[{key:"material",set:function(e){this._postprocessMaterial!==e&&(this._postprocessMaterial=e)}}]),t}(dS),AC.initInfo={name:"PostprocessStage",priority:IA.POSTPROCESS,tag:0},xC=te((TC=CC).prototype,"_postprocessMaterial",[yC,C_,SC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),EC=TC))||EC));var zC=e("Game",function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).frame=null,t.container=null,t.canvas=null,t.renderType=-1,t.eventTargetOn=e.prototype.on,t.eventTargetOnce=e.prototype.once,t.config={},t.onStart=null,t.collisionMatrix=[],t.groupList=[],t._persistRootNodes={},t._paused=!0,t._configLoaded=!1,t._isCloning=!1,t._inited=!1,t._engineInited=!1,t._rendererInitialized=!1,t._gfxDevice=null,t._intervalId=null,t}K(t,e);var n=t.prototype;return n.setFrameRate=function(e){var t=this.config;"number"!=typeof e&&(e=parseInt(e,10),Number.isNaN(e)&&(e=60)),t.frameRate=e,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},n.getFrameRate=function(){return this.config.frameRate||0},n.step=function(){i.director.mainLoop()},n.pause=function(){this._paused||(this._paused=!0,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0))},n.resume=function(){this._paused&&this._runMainLoop()},n.isPaused=function(){return this._paused},n.restart=function(){var e=this;return new Promise((function(e){return i.director.once(i.Director.EVENT_AFTER_DRAW,(function(){return e()}))})).then((function(){for(var n in e._persistRootNodes)e.removePersistRootNode(e._persistRootNodes[n]);return i.director.getScene().destroy(),i.Object._deferredDestroy(),i.director.reset(),e.pause(),e._setRenderPipelineNShowSplash().then((function(){e.resume(),e._safeEmit(t.EVENT_RESTART)}))}))},n.end=function(){this._gfxDevice&&(this._gfxDevice.destroy(),this._gfxDevice=null),window.close()},n.on=function(e,n,i,r){return this._engineInited&&e===t.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOn(e,n,i,r)},n.once=function(e,n,i){return this._engineInited&&e===t.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOnce(e,n,i)},n.init=function(e){var t=this;return this._initConfig(e),this.config.assetOptions&&i.assetManager.init(this.config.assetOptions),this._initEngine().then((function(){return t._initEvents(),i.director.root.dataPoolManager&&i.director.root.dataPoolManager.jointTexturePool.registerCustomTextureLayouts(e.customJointTextureLayouts),t._engineInited}))},n.run=function(e,t){var n,i=this;return"function"!=typeof e&&e?(n=this.init(e),this.onStart=null!=t?t:null):this.onStart=null!=e?e:null,Promise.resolve(n).then((function(){return UC.config.registerSystemEvent&&Ly.registerSystemEvent(),i._setRenderPipelineNShowSplash()}))},n.addPersistRootNode=function(e){if(i.Node.isNode(e)&&e.uuid){var t=e.uuid;if(!this._persistRootNodes[t]){var n=i.director._scene;if(i.isValid(n))if(e.parent){if(!(e.parent instanceof i.Scene))return void A(3801);if(e.parent!==n)return void A(3802);e._originalSceneId=n.uuid}else e.parent=n;this._persistRootNodes[t]=e,e._persistNode=!0,i.assetManager._releaseManager._addPersistNodeRef(e)}}else A(3800)},n.removePersistRootNode=function(e){var t=e.uuid||"";e===this._persistRootNodes[t]&&(delete this._persistRootNodes[t],e._persistNode=!1,e._originalSceneId="",i.assetManager._releaseManager._removePersistNodeRef(e))},n.isPersistRootNode=function(e){return!!e._persistNode},n._initEngine=function(){var e=this;return this._initDevice(),Promise.resolve(i.director._init()).then((function(){f("Cocos Creator v"+r),e.emit(t.EVENT_ENGINE_INITED),e._engineInited=!0,i.internal.dynamicAtlasManager.enabled=!nt.CLEANUP_IMAGE_CACHE}))},n._setAnimFrame=function(){this._lastTime=performance.now();var e=this.config.frameRate;this._frameTime=1e3/e,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0);var t=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==e&&30!==e?(window.rAF=t?this._stTimeWithRAF:this._stTime,window.cAF=this._ctTime):(window.rAF=t||this._stTime,window.cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame||this._ctTime)},n._stTimeWithRAF=function(e){var t=performance.now(),n=Math.max(0,t-UC._lastTime),i=Math.max(0,UC._frameTime-n),r=window.setTimeout((function(){window.requestAnimationFrame(e)}),i);return UC._lastTime=t+i,r},n._stTime=function(e){var t=performance.now(),n=Math.max(0,t-UC._lastTime),i=Math.max(0,UC._frameTime-n),r=window.setTimeout(e,i);return UC._lastTime=t+i,r},n._ctTime=function(e){window.clearTimeout(e)},n._runMainLoop=function(){var e=this;if(this._inited){var t,n=this.config,r=i.director,o=n.frameRate;if(D(!!n.showFPS),r.startAnimation(),30===o){var a=!0;t=function(n){e._intervalId=window.rAF(t),(a=!a)||r.mainLoop(n)}}else t=function(n){e._intervalId=window.rAF(t),r.mainLoop(n)};this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0),this._intervalId=window.rAF(t),this._paused=!1}},n._initConfig=function(e){"number"!=typeof e.debugMode&&(e.debugMode=w.NONE),e.exposeClassName=!!e.exposeClassName,"number"!=typeof e.frameRate&&(e.frameRate=60);var t=e.renderMode;("number"!=typeof t||t>2||t<0)&&(e.renderMode=0),"boolean"!=typeof e.registerSystemEvent&&(e.registerSystemEvent=!0),e.showFPS=!!e.showFPS,this.collisionMatrix=e.collisionMatrix||[],this.groupList=e.groupList||[],v(e.debugMode),this.config=e,this._configLoaded=!0,this._setAnimFrame()},n._determineRenderType=function(){var e=this.config,n=parseInt(e.renderMode,10);this.renderType=t.RENDER_TYPE_CANVAS;var r=!1;if(0===n?i.sys.capabilities.opengl?(this.renderType=t.RENDER_TYPE_WEBGL,r=!0):i.sys.capabilities.canvas&&(this.renderType=t.RENDER_TYPE_CANVAS,r=!0):1===n&&i.sys.capabilities.canvas?(this.renderType=t.RENDER_TYPE_CANVAS,r=!0):2===n&&i.sys.capabilities.opengl&&(this.renderType=t.RENDER_TYPE_WEBGL,r=!0),!r)throw new Error(P(3820,n))},n._initDevice=function(){if(!this._rendererInitialized){if(this.canvas=this.config.adapter.canvas,this.frame=this.config.adapter.frame,this.container=this.config.adapter.container,this._determineRenderType(),this.renderType===t.RENDER_TYPE_WEBGL){var e=[],n=!!window.WebGL2RenderingContext,r=window.navigator.userAgent.toLowerCase();(-1!==r.indexOf("safari")&&-1===r.indexOf("chrome")||yi.browserType===hi.UC)&&(n=!1),n&&i.WebGL2Device&&e.push(i.WebGL2Device),i.WebGLDevice&&e.push(i.WebGLDevice);for(var o=new Js(this.canvas,nt.ENABLE_WEBGL_ANTIALIAS,!1,window.devicePixelRatio,eS.windowPixelResolution.width,eS.windowPixelResolution.height,Wu),a=0;a<e.length&&(this._gfxDevice=new e[a],!this._gfxDevice.initialize(o));a++);}if(!this._gfxDevice)return p("can not support canvas rendering in 3D"),void(this.renderType=t.RENDER_TYPE_CANVAS);this.canvas.oncontextmenu=function(){return!1}}},n._initEvents=function(){yi.onShow(this._onShow.bind(this)),yi.onHide(this._onHide.bind(this))},n._onHide=function(){this.emit(t.EVENT_HIDE),this.pause()},n._onShow=function(){this.emit(t.EVENT_SHOW),this.resume()},n._setRenderPipelineNShowSplash=function(){var e=this;return Promise.resolve(this._setupRenderPipeline()).then((function(){return Promise.resolve(e._showSplashScreen()).then((function(){e._inited=!0,e._setAnimFrame(),e._runMainLoop(),e._safeEmit(t.EVENT_GAME_INITED),e.onStart&&e.onStart()}))}))},n._setupRenderPipeline=function(){var e=this,t=this.config.renderPipeline;return t?new Promise((function(e,n){i.assetManager.loadAny(t,(function(t,i){return!t&&i instanceof kE?e(i):n(t)}))})).then((function(t){e._setRenderPipeline(t)})).catch((function(n){d(n),d("Failed load render pipeline: "+t+", engine failed to initialize, will fallback to default pipeline"),e._setRenderPipeline()})):this._setRenderPipeline()},n._showSplashScreen=function(){if(i.internal.SplashScreen){var e=i.internal.SplashScreen.instance;return e.main(i.director.root),new Promise((function(t){e.setOnFinish((function(){return t()})),e.loadFinish=!0}))}return null},n._setRenderPipeline=function(e){i.director.root.setRenderPipeline(e)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(t.EVENT_RENDERER_INITED)},n._safeEmit=function(e){this.emit(e)},X(t,[{key:"inited",get:function(){return this._inited}},{key:"frameTime",get:function(){return this._frameTime}}]),t}(vi));zC.EVENT_HIDE="game_on_hide",zC.EVENT_SHOW="game_on_show",zC.EVENT_LOW_MEMORY="game_on_low_memory",zC.EVENT_GAME_INITED="game_inited",zC.EVENT_ENGINE_INITED="engine_inited",zC.EVENT_RENDERER_INITED="renderer_inited",zC.EVENT_RESTART="game_on_restart",zC.RENDER_TYPE_CANVAS=0,zC.RENDER_TYPE_WEBGL=1,zC.RENDER_TYPE_OPENGL=2,i.Game=zC;var UC=e("game",i.game=new zC),HC={topLeft:i.v2(0,0),topRight:i.v2(0,0),top:i.v2(0,0),bottomLeft:i.v2(0,0),bottomRight:i.v2(0,0),bottom:i.v2(0,0),center:i.v2(0,0),left:i.v2(0,0),right:i.v2(0,0),width:0,height:0,init:function(e){var t=this.width=e.width,n=this.height=e.height,i=e.x,r=e.y,o=r+n,a=i+t;this.topLeft.x=i,this.topLeft.y=o,this.topRight.x=a,this.topRight.y=o,this.top.x=i+t/2,this.top.y=o,this.bottomLeft.x=i,this.bottomLeft.y=r,this.bottomRight.x=a,this.bottomRight.y=r,this.bottom.x=i+t/2,this.bottom.y=r,this.center.x=i+t/2,this.center.y=r+n/2,this.left.x=i,this.left.y=r+n/2,this.right.x=a,this.right.y=r+n/2}};i.visibleRect=HC;var GC=new(function(){function e(){this.html=void 0,this.meta={width:"device-width"},this.adaptationType=i.sys.browserType}var t=e.prototype;return t.init=function(){this.html=document.getElementsByTagName("html")[0]},t.availWidth=function(e){return i.sys.isMobile||!e||e===this.html?window.innerWidth:e.clientWidth},t.availHeight=function(e){return i.sys.isMobile||!e||e===this.html?window.innerHeight:e.clientHeight},e}());switch(yi.os===pi.IOS&&(GC.adaptationType=hi.SAFARI),GC.adaptationType){case hi.SAFARI:GC.meta["minimal-ui"]="true",GC.availWidth=function(e){return e.clientWidth},GC.availHeight=function(e){return e.clientHeight};break;case hi.SOUGOU:case hi.UC:GC.availWidth=function(e){return e.clientWidth},GC.availHeight=function(e){return e.clientHeight}}var kC=e("View",function(e){function t(){var t;(t=e.call(this)||this)._resizeWithBrowserSize=void 0,t._designResolutionSize=void 0,t._originalDesignResolutionSize=void 0,t._frameSize=void 0,t._scaleX=void 0,t._scaleY=void 0,t._viewportRect=void 0,t._visibleRect=void 0,t._autoFullScreen=void 0,t._devicePixelRatio=void 0,t._maxPixelRatio=void 0,t._retinaEnabled=void 0,t._resizeCallback=void 0,t._resizing=void 0,t._orientationChanging=void 0,t._isRotated=void 0,t._orientation=void 0,t._isAdjustViewport=void 0,t._resolutionPolicy=void 0,t._rpExactFit=void 0,t._rpShowAll=void 0,t._rpNoBorder=void 0,t._rpFixedHeight=void 0,t._rpFixedWidth=void 0;var n=VC,r=WC;return t._frameSize=new jn(0,0),t._designResolutionSize=new jn(0,0),t._originalDesignResolutionSize=new jn(0,0),t._scaleX=1,t._scaleY=1,t._viewportRect=new Xn(0,0,0,0),t._visibleRect=new Xn(0,0,0,0),t._autoFullScreen=!1,t._devicePixelRatio=1,t._maxPixelRatio=2,t._retinaEnabled=!1,t._resizeCallback=null,t._resizing=!1,t._resizeWithBrowserSize=!1,t._orientationChanging=!0,t._isRotated=!1,t._orientation=i.macro.ORIENTATION_AUTO,t._isAdjustViewport=!0,t._rpExactFit=new jC(n.EQUAL_TO_FRAME,r.EXACT_FIT),t._rpShowAll=new jC(n.EQUAL_TO_FRAME,r.SHOW_ALL),t._rpNoBorder=new jC(n.EQUAL_TO_FRAME,r.NO_BORDER),t._rpFixedHeight=new jC(n.EQUAL_TO_FRAME,r.FIXED_HEIGHT),t._rpFixedWidth=new jC(n.EQUAL_TO_FRAME,r.FIXED_WIDTH),t._resolutionPolicy=t._rpShowAll,i.game.once(i.Game.EVENT_ENGINE_INITED,t.init,Q(t)),t}K(t,e);var n=t.prototype;return n.init=function(){GC.init(),this._initFrameSize();var e=i.game.canvas.width,t=i.game.canvas.height;this._designResolutionSize.width=e,this._designResolutionSize.height=t,this._originalDesignResolutionSize.width=e,this._originalDesignResolutionSize.height=t,this._viewportRect.width=e,this._viewportRect.height=t,this._visibleRect.width=e,this._visibleRect.height=t,i.winSize.width=this._visibleRect.width,i.winSize.height=this._visibleRect.height,i.visibleRect&&i.visibleRect.init(this._visibleRect)},n.resizeWithBrowserSize=function(e){e?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,yi.onViewResize(this._resizeEvent),yi.onOrientationChange(this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,yi.offViewResize(this._resizeEvent),yi.offOrientationChange(this._orientationChange))},n.setResizeCallback=function(e){"function"!=typeof e&&null!=e||(this._resizeCallback=e)},n.setOrientation=function(e){(e&=i.macro.ORIENTATION_AUTO)&&this._orientation!==e&&(this._orientation=e)},n.adjustViewportMeta=function(e){this._isAdjustViewport=e},n.enableRetina=function(e){this._retinaEnabled=!!e},n.isRetinaEnabled=function(){return this._retinaEnabled},n.enableAutoFullScreen=function(e){e&&e!==this._autoFullScreen&&i.sys.isMobile&&yi.browserType!==hi.WECHAT?(this._autoFullScreen=!0,i.screen.autoFullScreen(i.game.frame)):this._autoFullScreen=!1},n.isAutoFullScreenEnabled=function(){return this._autoFullScreen},n.setCanvasSize=function(e,t){var n=i.game.canvas,r=i.game.container;this._devicePixelRatio=window.devicePixelRatio,n.width=eS.windowPixelResolution.width,n.height=eS.windowPixelResolution.height,n.style.width=e+"px",n.style.height=t+"px",r.style.width=e+"px",r.style.height=t+"px",this._resizeEvent()},n.getCanvasSize=function(){return new jn(i.game.canvas.width,i.game.canvas.height)},n.getFrameSize=function(){return new jn(this._frameSize.width,this._frameSize.height)},n.setFrameSize=function(e,t){this._frameSize.width=e,this._frameSize.height=t,i.game.frame.style.width=e+"px",i.game.frame.style.height=t+"px",this._resizeEvent()},n.getVisibleSize=function(){return new jn(this._visibleRect.width,this._visibleRect.height)},n.getVisibleSizeInPixel=function(){return new jn(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},n.getVisibleOrigin=function(){return new zn(this._visibleRect.x,this._visibleRect.y)},n.getVisibleOriginInPixel=function(){return new zn(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},n.getResolutionPolicy=function(){return this._resolutionPolicy},n.setResolutionPolicy=function(e){if(e instanceof jC)this._resolutionPolicy=e;else{var t=jC;e===t.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),e===t.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),e===t.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),e===t.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),e===t.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},n.setDesignResolutionSize=function(e,t,n){if(e>0&&t>0){this.setResolutionPolicy(n);var r=this._resolutionPolicy;if(r&&r.preApply(this),i.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),r){this._originalDesignResolutionSize.width=this._designResolutionSize.width=e,this._originalDesignResolutionSize.height=this._designResolutionSize.height=t;var o=r.apply(this,this._designResolutionSize);if(o.scale&&2===o.scale.length&&(this._scaleX=o.scale[0],this._scaleY=o.scale[1]),o.viewport){var a=this._viewportRect,s=this._visibleRect,c=o.viewport;a.x=c.x,a.y=c.y,a.width=c.width,a.height=c.height,s.x=0,s.y=0,s.width=c.width/this._scaleX,s.height=c.height/this._scaleY}r.postApply(this),i.winSize.width=this._visibleRect.width,i.winSize.height=this._visibleRect.height,HC&&HC.init(this._visibleRect),this.emit("design-resolution-changed")}else T(2201)}else b(2200)},n.getDesignResolutionSize=function(){return new jn(this._designResolutionSize.width,this._designResolutionSize.height)},n.setRealPixelResolution=function(e,t,n){this._setViewportMeta({width:e},!0),document.documentElement.style.width=e+"px",document.body.style.width=e+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(e,t,n)},n.getViewportRect=function(){return this._viewportRect},n.getScaleX=function(){return this._scaleX},n.getScaleY=function(){return this._scaleY},n.getDevicePixelRatio=function(){return this._devicePixelRatio},n.convertToLocationInView=function(e,t,n,r){var o=r||new zn,a=this._devicePixelRatio*(e-n.left),s=this._devicePixelRatio*(n.top+n.height-t);return this._isRotated?(o.x=i.game.canvas.width-s,o.y=a):(o.x=a,o.y=s),i.GAME_VIEW&&(o.x/=i.gameView.canvas.width/i.game.canvas.width,o.y/=i.gameView.canvas.height/i.game.canvas.height),o},n._convertPointWithScale=function(e){var t=this._viewportRect;e.x=(e.x-t.x)/this._scaleX,e.y=(e.y-t.y)/this._scaleY},n._resizeEvent=function(){var e=i.view,t=e._frameSize.width,n=e._frameSize.height,r=e._isRotated;if(i.sys.isMobile){var o=i.game.container.style,a=o.margin;o.margin="0",o.display="none",e._initFrameSize(),o.margin=a,o.display="block"}else e._initFrameSize();if(e._orientationChanging||e._isRotated!==r||e._frameSize.width!==t||e._frameSize.height!==n){var s=e._originalDesignResolutionSize.width,c=e._originalDesignResolutionSize.height;e._resizing=!0,s>0&&e.setDesignResolutionSize(s,c,e._resolutionPolicy),e._resizing=!1,e.emit("canvas-resize"),e._resizeCallback&&e._resizeCallback.call()}},n._orientationChange=function(){i.view._orientationChanging=!0,i.view._resizeEvent()},n._initFrameSize=function(){var e=this._frameSize,t=GC.availWidth(i.game.frame),n=GC.availHeight(i.game.frame),r=t>=n;!i.sys.isMobile||r&&this._orientation&i.macro.ORIENTATION_LANDSCAPE||!r&&this._orientation&i.macro.ORIENTATION_PORTRAIT?(e.width=t,e.height=n,i.game.container.style["-webkit-transform"]="rotate(0deg)",i.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(e.width=n,e.height=t,i.game.container.style["-webkit-transform"]="rotate(90deg)",i.game.container.style.transform="rotate(90deg)",i.game.container.style["-webkit-transform-origin"]="0px 0px 0px",i.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0,i.game.canvas.style["-webkit-transform"]="translateZ(0px)",i.game.canvas.style.transform="translateZ(0px)"),this._orientationChanging&&setTimeout((function(){i.view._orientationChanging=!1}),1e3)},n._adjustSizeKeepCanvasSize=function(){var e=this._originalDesignResolutionSize.width,t=this._originalDesignResolutionSize.height;e>0&&this.setDesignResolutionSize(e,t,this._resolutionPolicy)},n._setViewportMeta=function(e,t){var n=document.getElementById("cocosMetaElement");n&&t&&document.head.removeChild(n);var i,r,o,a=document.getElementsByName("viewport"),s=a?a[0]:null;for(r in i=s?s.content:"",(n=n||document.createElement("meta")).id="cocosMetaElement",n.name="viewport",n.content="",e)-1===i.indexOf(r)?i+=","+r+"="+e[r]:t&&(o=new RegExp(r+"s*=s*[^,]+"),i=i.replace(o,r+"="+e[r]));/^,/.test(i)&&(i=i.substr(1)),n.content=i,s&&(s.content=i),document.head.appendChild(n)},n._adjustViewportMeta=function(){this._isAdjustViewport&&(this._setViewportMeta(GC.meta,!1),this._isAdjustViewport=!1)},n._convertMouseToLocation=function(e,t){e.x=this._devicePixelRatio*(e.x-t.left),e.y=this._devicePixelRatio*(t.top+t.height-e.y),i.GAME_VIEW&&(e.x/=i.gameView.canvas.width/i.game.canvas.width,e.y/=i.gameView.canvas.height/i.game.canvas.height)},n._convertTouchWidthScale=function(e){var t=this._viewportRect,n=this._scaleX,i=this._scaleY;e._point.x=(e._point.x-t.x)/n,e._point.y=(e._point.y-t.y)/i,e._prevPoint.x=(e._prevPoint.x-t.x)/n,e._prevPoint.y=(e._prevPoint.y-t.y)/i},n._convertTouchesWithScale=function(e){for(var t,n,i=this._viewportRect,r=this._scaleX,o=this._scaleY,a=0;a<e.length;a++){var s=e[a];t=s._point,n=s._prevPoint,t.x=(t.x-i.x)/r,t.y=(t.y-i.y)/o,n.x=(n.x-i.x)/r,n.y=(n.y-i.y)/o}},t}(vi));kC.instance=void 0;var VC=function(){function e(){this.name="ContainerStrategy"}var t=e.prototype;return t.preApply=function(){},t.apply=function(){},t.postApply=function(){},t._setupContainer=function(e,t,n){var r=i.game.canvas,o=i.game.container;yi.os!==pi.ANDROID&&yi.os!==pi.OHOS||(document.body.style.width=(e._isRotated?n:t)+"px",document.body.style.height=(e._isRotated?t:n)+"px"),o.style.width=r.style.width=t+"px",o.style.height=r.style.height=n+"px",e._devicePixelRatio=1,e.isRetinaEnabled()&&(e._devicePixelRatio=Math.min(e._maxPixelRatio,window.devicePixelRatio||1)),r.width=t*e._devicePixelRatio,r.height=n*e._devicePixelRatio},t._fixContainer=function(){document.body.insertBefore(i.game.container,document.body.firstChild);var e=document.body.style;e.width=window.innerWidth+"px",e.height=window.innerHeight+"px",e.overflow="hidden";var t=i.game.container.style;t.position="fixed",t.left=t.top="0px",document.body.scrollTop=0},e}();VC.EQUAL_TO_FRAME=void 0,VC.PROPORTION_TO_FRAME=void 0;var WC=function(){function e(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var t=e.prototype;return t.preApply=function(){},t.apply=function(){return{scale:[1,1]}},t.postApply=function(){},t._buildResult=function(e,t,n,i,r,o){Math.abs(e-n)<2&&(n=e),Math.abs(t-i)<2&&(i=t);var a=new Xn(Math.round((e-n)/2),Math.round((t-i)/2),n,i);return this._result.scale=[r,o],this._result.viewport=a,this._result},e}();WC.EXACT_FIT=void 0,WC.SHOW_ALL=void 0,WC.NO_BORDER=void 0,WC.FIXED_HEIGHT=void 0,WC.FIXED_WIDTH=void 0,function(){var e=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="EqualToFrame",t}return K(t,e),t.prototype.apply=function(e){var t=e._frameSize.height,n=i.game.container.style;this._setupContainer(e,e._frameSize.width,e._frameSize.height),e._isRotated?n.margin="0 0 0 "+t+"px":n.margin="0px",n.padding="0px"},t}(VC),t=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ProportionalToFrame",t}return K(t,e),t.prototype.apply=function(e,t){var n,r,o=e._frameSize.width,a=e._frameSize.height,s=i.game.container.style,c=t.width,l=t.height,u=o/c,h=a/l;u<h?(n=o,r=l*u):(n=c*h,r=a);var _=Math.round((o-n)/2),f=Math.round((a-r)/2);n=o-2*_,r=a-2*f,this._setupContainer(e,n,r),e._isRotated?s.margin="0 0 0 "+a+"px":s.margin="0px",s.paddingLeft=_+"px",s.paddingRight=_+"px",s.paddingTop=f+"px",s.paddingBottom=f+"px"},t}(VC),n=("undefined"==typeof window?global:window).__globalAdapter;n&&(n.adaptContainerStrategy&&n.adaptContainerStrategy(VC.prototype),n.adaptView&&n.adaptView(kC.prototype)),VC.EQUAL_TO_FRAME=new e,VC.PROPORTION_TO_FRAME=new t;var r=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ExactFit",t}return K(t,e),t.prototype.apply=function(e,t){var n=i.game.canvas.width,r=i.game.canvas.height,o=n/t.width,a=r/t.height;return this._buildResult(n,r,n,r,o,a)},t}(WC),o=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ShowAll",t}return K(t,e),t.prototype.apply=function(e,t){var n,r,o=i.game.canvas.width,a=i.game.canvas.height,s=t.width,c=t.height,l=o/s,u=a/c,h=0;return l<u?(n=o,r=c*(h=l)):(n=s*(h=u),r=a),this._buildResult(o,a,n,r,h,h)},t}(WC),a=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="NoBorder",t}return K(t,e),t.prototype.apply=function(e,t){var n,r,o,a=i.game.canvas.width,s=i.game.canvas.height,c=t.width,l=t.height,u=a/c,h=s/l;return u<h?(r=c*(n=h),o=s):(r=a,o=l*(n=u)),this._buildResult(a,s,r,o,n,n)},t}(WC),s=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="FixedHeight",t}return K(t,e),t.prototype.apply=function(e,t){var n=i.game.canvas.width,r=i.game.canvas.height,o=r/t.height,a=n,s=r;return this._buildResult(n,r,a,s,o,o)},t}(WC),c=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="FixedWidth",t}return K(t,e),t.prototype.apply=function(e,t){var n=i.game.canvas.width,r=i.game.canvas.height,o=n/t.width,a=n,s=r;return this._buildResult(n,r,a,s,o,o)},t}(WC);WC.EXACT_FIT=new r,WC.SHOW_ALL=new o,WC.NO_BORDER=new a,WC.FIXED_HEIGHT=new s,WC.FIXED_WIDTH=new c}();var jC=e("ResolutionPolicy",function(){function e(e,t){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(e),this.setContentStrategy(t)}var t=e.prototype;return t.preApply=function(e){this._containerStrategy.preApply(e),this._contentStrategy.preApply(e)},t.apply=function(e,t){return this._containerStrategy.apply(e,t),this._contentStrategy.apply(e,t)},t.postApply=function(e){this._containerStrategy.postApply(e),this._contentStrategy.postApply(e)},t.setContainerStrategy=function(e){e instanceof VC&&(this._containerStrategy=e)},t.setContentStrategy=function(e){e instanceof WC&&(this._contentStrategy=e)},X(e,[{key:"canvasSize",get:function(){return new zn(i.game.canvas.width,i.game.canvas.height)}}]),e}());jC.EXACT_FIT=0,jC.NO_BORDER=1,jC.SHOW_ALL=2,jC.FIXED_HEIGHT=3,jC.FIXED_WIDTH=4,jC.UNKNOWN=5,jC.ContainerStrategy=VC,jC.ContentStrategy=WC,i.ResolutionPolicy=jC;var qC=e("view",kC.instance=i.view=new kC);i.winSize=new jn,z(kC.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),F(Cy,"EventMouse",["DOWN","UP","MOVE"].map((function(e){return{name:e,newName:"MOUSE_"+e,target:Hy.EventType,targetName:"SystemEvent.EventType"}}))),F(Cy,"EventMouse",[{name:"SCROLL",newName:"MOUSE_WHEEL",target:Hy.EventType,targetName:"SystemEvent.EventType"}]),F(by,"EventTouch",[{name:"BEGAN",newName:"TOUCH_START",target:Hy.EventType,targetName:"SystemEvent.EventType"}]),F(by,"EventTouch",[{name:"MOVED",newName:"TOUCH_MOVE",target:Hy.EventType,targetName:"SystemEvent.EventType"}]),F(by,"EventTouch",[{name:"ENDED",newName:"TOUCH_END",target:Hy.EventType,targetName:"SystemEvent.EventType"}]),F(by,"EventTouch",[{name:"CANCELLED",newName:"TOUCH_CANCEL",target:Hy.EventType,targetName:"SystemEvent.EventType"}]),F(eS,"sys",["UNKNOWN","ENGLISH","CHINESE","FRENCH","ITALIAN","GERMAN","SPANISH","DUTCH","RUSSIAN","KOREAN","JAPANESE","HUNGARIAN","PORTUGUESE","ARABIC","NORWEGIAN","POLISH","TURKISH","UKRAINIAN","ROMANIAN","BULGARIAN"].map((function(e){return{name:"LANGUAGE_"+e,newName:e,target:eS.Language,targetName:"sys.Language"}}))),F(eS,"sys",["UNKNOWN","IOS","ANDROID","WINDOWS","LINUX","OSX"].map((function(e){return{name:"OS_"+e,newName:e,target:eS.OS,targetName:"sys.OS"}}))),F(eS,"sys",["UNKNOWN","WECHAT","ANDROID","IE","EDGE","QQ","MOBILE_QQ","UC","UCBS","BAIDU_APP","BAIDU","MAXTHON","OPERA","OUPENG","MIUI","FIREFOX","SAFARI","CHROME","LIEBAO","QZONE","SOUGOU","HUAWEI"].map((function(e){return{name:"BROWSER_TYPE_"+e,newName:e,target:eS.BrowserType,targetName:"sys.BrowserType"}}))),F(eS,"sys",[{name:"BROWSER_TYPE_360",newName:"BROWSER_360",target:eS.BrowserType,targetName:"sys.BrowserType"}]),F(eS,"sys",["UNKNOWN","EDITOR_PAGE","EDITOR_CORE","MOBILE_BROWSER","DESKTOP_BROWSER","WIN32","MACOS","IOS","ANDROID","OHOS","WECHAT_GAME","BAIDU_MINI_GAME","XIAOMI_QUICK_GAME","ALIPAY_MINI_GAME","BYTEDANCE_MINI_GAME","OPPO_MINI_GAME","VIVO_MINI_GAME","HUAWEI_QUICK_GAME","COCOSPLAY","LINKSURE_MINI_GAME","QTT_MINI_GAME"].map((function(e){return{name:e,target:eS.Platform,targetName:"sys.Platform"}}))),F(eS,"sys",[{name:"IPHONE",newName:"IOS",target:eS.Platform,targetName:"sys.Platform"},{name:"IPAD",newName:"IOS",target:eS.Platform,targetName:"sys.Platform"}]),z(eS,"sys",["LINUX","BLACKBERRY","NACL","EMSCRIPTEN","TIZEN","WINRT","WP8","QQ_PLAY","FB_PLAYABLE_ADS"].map((function(e){return{name:e}})));var XC=e("screen",{_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){var e,t,n;this._fn={};var i,r=this._fnMap;for(e=0,t=r.length;e<t;e++)if((n=r[e])&&void 0!==document[n[1]]){for(e=0,i=n.length;e<i;e++)this._fn[r[0][e]]=n[e];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},get supportsFullScreen(){return this._supportsFullScreen},fullScreen:function(){return!!this._supportsFullScreen&&void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement]},requestFullScreen:function(e,t,n){if(this._supportsFullScreen){if(e=e||document.documentElement,t){var i=this._fn.fullscreenchange;this._onfullscreenchange&&document.removeEventListener(i,this._onfullscreenchange),this._onfullscreenchange=t,document.addEventListener(i,t,!1)}if(n){var r=this._fn.fullscreenerror;this._onfullscreenerror&&document.removeEventListener(r,this._onfullscreenerror),this._onfullscreenerror=n,document.addEventListener(r,n,{once:!0})}var o=e[this._fn.requestFullscreen]();return window.Promise&&o instanceof Promise&&o.catch((function(){})),o}},exitFullScreen:function(){var e;return this.fullScreen()&&(e=document[this._fn.exitFullscreen]()).catch((function(){})),e},autoFullScreen:function(e,t){e=e||document.body,this._ensureFullScreen(e,t),this.requestFullScreen(e,t)},disableAutoFullScreen:function(e){if(this._preOnTouch){var t=i.game.canvas||e,n=this._touchEvent;t.removeEventListener(n,this._preOnTouch),this._preOnTouch=null}},_ensureFullScreen:function(e,t){var n=this,r=i.game.canvas||e,o=this._fn.fullscreenerror,a=this._touchEvent,s=function(){n._preOnFullScreenError=null,n._preOnTouch&&r.removeEventListener(a,n._preOnTouch),n._preOnTouch=function(){n._preOnTouch=null,n.requestFullScreen(e,t)},r.addEventListener(a,n._preOnTouch,{once:!0})};this._preOnFullScreenError&&e.removeEventListener(o,this._preOnFullScreenError),this._preOnFullScreenError=s,e.addEventListener(o,s,{once:!0})}});XC.init(),i.screen=XC;var YC,KC=new Ws(null),ZC=function(){function e(){this._device=null,this._passes=null,this._subMesh=null,this._patches=null,this._handle=0,this._priority=Pu.DEFAULT,this._inputAssembler=null,this._descriptorSet=null}var t=e.prototype;return t.initialize=function(e,t,n){void 0===n&&(n=null),this._device=i.director.root.device,this._subMesh=e,this._patches=n,this._passes=t,this._handle=Lr.alloc(),this._flushPassInfo(),t[0].batchingScheme===qp.VB_MERGING&&this._subMesh.genFlatBuffers(),KC.layout=t[0].localSetLayout;var r=gr.alloc(this._device,KC),o=vr.alloc(this._device,e.iaInfo);Lr.set(this._handle,Pr.PRIORITY,Pu.DEFAULT),Lr.set(this._handle,Pr.INPUT_ASSEMBLER,o),Lr.set(this._handle,Pr.DESCRIPTOR_SET,r),Lr.set(this._handle,Pr.SUB_MESH,e.handle),this._inputAssembler=vr.get(o),this._descriptorSet=gr.get(r)},t.initPlanarShadowShader=function(){var e=i.director.root.pipeline.pipelineSceneData.shadows.getPlanarShader(this._patches);Lr.set(this._handle,Pr.PLANAR_SHADER,e)},t.initPlanarShadowInstanceShader=function(){var e=i.director.root.pipeline.pipelineSceneData.shadows.getPlanarInstanceShader(this._patches);Lr.set(this._handle,Pr.PLANAR_INSTANCE_SHADER,e)},t.destroy=function(){gr.free(Lr.get(this._handle,Pr.DESCRIPTOR_SET)),vr.free(Lr.get(this._handle,Pr.INPUT_ASSEMBLER)),Lr.free(this._handle),this._descriptorSet=null,this._inputAssembler=null,this._priority=Pu.DEFAULT,this._handle=0,this._patches=null,this._subMesh=null,this._passes=null},t.update=function(){for(var e=0;e<this._passes.length;++e)this._passes[e].update();this._descriptorSet.update()},t.onPipelineStateChanged=function(){var e=this._passes;if(e){for(var t=0;t<e.length;t++){var n=e[t];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently()}this._flushPassInfo()}},t.onMacroPatchesStateChanged=function(e){this._patches=e;var t=this._passes;if(t){for(var n=0;n<t.length;n++){var i=t[n];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}this._flushPassInfo()}},t._flushPassInfo=function(){var e=this._passes;if(e){Lr.set(this._handle,Pr.PASS_COUNT,e.length);for(var t=Pr.PASS_0,n=Pr.SHADER_0,i=0;i<e.length;i++,t++,n++)Lr.set(this._handle,t,e[i].handle),Lr.set(this._handle,n,e[i].getShaderVariant(this._patches))}},X(e,[{key:"passes",get:function(){return this._passes},set:function(e){if(e.length>8)b(12004,8);else if(this._passes=e,this._flushPassInfo(),this._descriptorSet){gr.free(Lr.get(this._handle,Pr.DESCRIPTOR_SET)),KC.layout=e[0].localSetLayout;var t=gr.alloc(this._device,KC);Lr.set(this._handle,Pr.DESCRIPTOR_SET,t),this._descriptorSet=gr.get(t)}}},{key:"subMesh",get:function(){return this._subMesh},set:function(e){this._subMesh=e,this._inputAssembler.destroy(),this._inputAssembler.initialize(e.iaInfo),this._passes[0].batchingScheme===qp.VB_MERGING&&this._subMesh.genFlatBuffers(),Lr.set(this._handle,Pr.SUB_MESH,e.handle)}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e,Lr.set(this._handle,Pr.PRIORITY,e)}},{key:"handle",get:function(){return this._handle}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"planarShaderHandle",get:function(){return Lr.get(this._handle,Pr.PLANAR_SHADER)}},{key:"planarInstanceShaderHandle",get:function(){return Lr.get(this._handle,Pr.PLANAR_INSTANCE_SHADER)}}]),e}(),QC=new hr(lr.ATTRIBUTE,(function(e,t){return t||new Ds})),JC=new Mn,$C=new Zn((function(){return new ZC}),32),eb=[{name:"CC_RECEIVE_SHADOW",value:!0}];!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SKINNING=1]="SKINNING",e[e.BAKED_SKINNING=2]="BAKED_SKINNING",e[e.BATCH_2D=3]="BATCH_2D",e[e.PARTICLE_BATCH=4]="PARTICLE_BATCH",e[e.LINE=5]="LINE"}(YC||(YC={}));var tb,nb,ib=Wf([Pa.LINEAR,Pa.LINEAR,Pa.NONE,Oa.CLAMP,Oa.CLAMP,Oa.CLAMP]),rb=Wf([Pa.LINEAR,Pa.LINEAR,Pa.LINEAR,Oa.CLAMP,Oa.CLAMP,Oa.CLAMP]),ob=function(){function e(){this.type=YC.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this.instancedAttributes={buffer:null,views:[],attributes:[]},this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._transformUpdated=!0,this._handle=0,this._hWorldBounds=0,this._localData=new Float32Array(vh.COUNT),this._localBuffer=null,this._instMatWorldIdx=-1,this._lightmap=null,this._lightmapUVParam=new kn,this._device=i.director.root.device}var t=e.prototype;return t.initialize=function(){if(!this._inited){this._handle=zr.alloc();var e=Er.alloc(),t=xr.alloc();zr.set(this._handle,Nr.INSTANCED_ATTR_ARRAY,t),zr.set(this._handle,Nr.SUB_MODEL_ARRAY,e),zr.set(this._handle,Nr.VIS_FLAGS,Ru.Enum.NONE),zr.set(this._handle,Nr.ENABLED,1),zr.set(this._handle,Nr.RECEIVE_SHADOW,1),zr.set(this._handle,Nr.CAST_SHADOW,0),this._inited=!0}},t.destroy=function(){for(var e=this._subModels,t=0;t<e.length;t++){var n=this._subModels[t];n.destroy(),$C.free(n)}if(this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._transformUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1,this._handle){var i=zr.get(this._handle,Nr.SUB_MODEL_ARRAY);i&&Er.free(i);var r=zr.get(this._handle,Nr.INSTANCED_BUFFER);r&&Rr.free(r);var o=zr.get(this._handle,Nr.INSTANCED_ATTR_ARRAY);o&&dr(o,xr,QC),zr.free(this._handle),this._handle=0}this._hWorldBounds&&(Wr.free(this._hWorldBounds),this._hWorldBounds=0)},t.attachToScene=function(e){this.scene=e},t.detachFromScene=function(){this.scene=null},t.updateTransform=function(){var e=this.transform;if(e.hasChangedFlags||e._dirtyFlags){e.updateWorldTransform(),this._transformUpdated=!0;var t=this._worldBounds;this._modelBounds&&t&&(this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,t),Wr.setVec3(this._hWorldBounds,Ur.CENTER,t.center),Wr.setVec3(this._hWorldBounds,Ur.HALF_EXTENSION,t.halfExtents))}},t.updateWorldBound=function(){var e=this.transform;if(null!==e){e.updateWorldTransform(),this._transformUpdated=!0;var t=this._worldBounds;this._modelBounds&&t&&(this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,t),Wr.setVec3(this._hWorldBounds,Ur.CENTER,t.center),Wr.setVec3(this._hWorldBounds,Ur.HALF_EXTENSION,t.halfExtents))}},t.updateUBOs=function(e){for(var t=this._subModels,n=0;n<t.length;n++)t[n].update();if(this._updateStamp=e,this._transformUpdated){this._transformUpdated=!1;var i=this.transform._mat,r=this._instMatWorldIdx;if(r>=0){var o=this.instancedAttributes.views;!function(e,t,n,i){t[0]=e.m00,t[1]=e.m01,t[2]=e.m02,t[3]=e.m12,n[0]=e.m04,n[1]=e.m05,n[2]=e.m06,n[3]=e.m13,i[0]=e.m08,i[1]=e.m09,i[2]=e.m10,i[3]=e.m14}(i,o[r],o[r+1],o[r+2])}else this._localBuffer&&(Mn.toArray(this._localData,i,vh.MAT_WORLD_OFFSET),Mn.inverseTranspose(JC,i),Mn.toArray(this._localData,JC,vh.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData))}},t.createBoundingShape=function(e,t){e&&t&&(this._modelBounds=$l.fromPoints($l.create(),e,t),this._worldBounds=$l.clone(this._modelBounds),0===this._hWorldBounds&&(this._hWorldBounds=Wr.alloc(),zr.set(this._handle,Nr.WORLD_BOUNDS,this._hWorldBounds)),Wr.setVec3(this._hWorldBounds,Ur.CENTER,this._worldBounds.center),Wr.setVec3(this._hWorldBounds,Ur.HALF_EXTENSION,this._worldBounds.halfExtents))},t.initSubModel=function(e,t,n){this.initialize();var i=!1;if(null==this._subModels[e]?(this._subModels[e]=$C.alloc(),i=!0):this._subModels[e].destroy(),this._subModels[e].initialize(t,n.passes,this.getMacroPatches(e)),this._subModels[e].initPlanarShadowShader(),this._subModels[e].initPlanarShadowInstanceShader(),this._updateAttributesAndBinding(e),i){var r=zr.get(this._handle,Nr.SUB_MODEL_ARRAY);Er.assign(r,e,this._subModels[e].handle)}},t.setSubModelMesh=function(e,t){this._subModels[e]&&(this._subModels[e].subMesh=t)},t.setSubModelMaterial=function(e,t){this._subModels[e]&&(this._subModels[e].passes=t.passes,this._updateAttributesAndBinding(e))},t.onGlobalPipelineStateChanged=function(){for(var e=this._subModels,t=0;t<e.length;t++)e[t].onPipelineStateChanged()},t.onMacroPatchesStateChanged=function(){for(var e=this._subModels,t=0;t<e.length;t++)e[t].onMacroPatchesStateChanged(this.getMacroPatches(t))},t.updateLightingmap=function(e,t){kn.toArray(this._localData,t,vh.LIGHTINGMAP_UVPARAM),this._lightmap=e,this._lightmapUVParam=t,null===e&&(e=Kp.get("empty-texture"));var n=e.getGFXTexture();if(n)for(var i=id.getSampler(this._device,e.mipmaps.length>1?rb:ib),r=this._subModels,o=0;o<r.length;o++){var a=r[o].descriptorSet;a.bindTexture(Uh,n),a.bindSampler(Uh,i),a.update()}},t.getMacroPatches=function(){return this.receiveShadow?eb:null},t._updateAttributesAndBinding=function(e){var t=this._subModels[e];if(t){this._initLocalDescriptors(e),this._updateLocalDescriptors(e,t.descriptorSet);var n=mr.get(Lr.get(t.handle,Pr.SHADER_0));this._updateInstancedAttributes(n.attributes,t.passes[0])}},t._getInstancedAttributeIndex=function(e){for(var t=this.instancedAttributes.attributes,n=0;n<t.length;n++)if(t[n].name===e)return n;return-1},t._updateInstancedAttributes=function(e,t){if(t.device.hasFeature(va.INSTANCED_ARRAYS)){var n=zr.get(this._handle,Nr.INSTANCED_BUFFER);n&&Rr.free(n);var i=zr.get(this._handle,Nr.INSTANCED_ATTR_ARRAY);i&&dr(i,xr,QC,!1);for(var r=0,o=0;o<e.length;o++){var a=e[o];a.isInstanced&&(r+=$s[a.format].size)}var s=Rr.alloc(r),c=Rr.getBuffer(s);zr.set(this._handle,Nr.INSTANCED_BUFFER,s);var l=this.instancedAttributes;l.buffer=new Uint8Array(c),l.views.length=l.attributes.length=0;for(var u=0,h=0;h<e.length;h++){var _=e[h];if(_.isInstanced){var f=QC.alloc(),d=QC.get(f);d.format=_.format,d.name=_.name,d.isNormalized=_.isNormalized,d.location=_.location,l.attributes.push(d),xr.push(i,f);var p=$s[_.format];l.views.push(new(cc(p))(c,u,p.count)),u+=p.size}}t.batchingScheme===qp.INSTANCING&&Dx.get(t).destroy(),this._instMatWorldIdx=this._getInstancedAttributeIndex(yh),this._transformUpdated=!0}},t._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new ps(Ta.UNIFORM|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,vh.SIZE,vh.SIZE)))},t._updateLocalDescriptors=function(e,t){this._localBuffer&&t.bindBuffer(vh.BINDING,this._localBuffer)},X(e,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"isInstancingEnabled",get:function(){return this._instMatWorldIdx>=0}},{key:"receiveShadow",get:function(){return!!zr.get(this._handle,Nr.RECEIVE_SHADOW)},set:function(e){zr.set(this._handle,Nr.RECEIVE_SHADOW,e?1:0),this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return!!zr.get(this._handle,Nr.CAST_SHADOW)},set:function(e){zr.set(this._handle,Nr.CAST_SHADOW,e?1:0)}},{key:"handle",get:function(){return this._handle}},{key:"node",get:function(){return this._node},set:function(e){this._node=e,zr.set(this._handle,Nr.NODE,e.handle)}},{key:"transform",get:function(){return this._transform},set:function(e){this._transform=e,zr.set(this._handle,Nr.TRANSFORM,e.handle)}},{key:"visFlags",get:function(){return zr.get(this._handle,Nr.VIS_FLAGS)},set:function(e){zr.set(this._handle,Nr.VIS_FLAGS,e)}},{key:"enabled",get:function(){return!!zr.get(this._handle,Nr.ENABLED)},set:function(e){zr.set(this._handle,Nr.ENABLED,e?1:0)}}]),e}(),ab=function(e){function t(){var t;return(t=e.call(this)||this)._needUpdate=!1,t._pos=void 0,t._aabb=void 0,t._hAABB=0,t._aabb=$l.create(),t._pos=new yn,t}K(t,e);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),this._hAABB=Wr.alloc(),wo.set(this._handle,To.TYPE,nm.SPHERE),wo.set(this._handle,To.SIZE,.15),wo.set(this._handle,To.RANGE,1),wo.set(this._handle,To.AABB,this._hAABB),wo.set(this._handle,To.ILLUMINANCE,1700/om(.15))},n.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var e=wo.get(this._handle,To.RANGE);$l.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,e,e,e),this._needUpdate=!1,wo.setVec3(this._handle,To.POSITION,this._pos),Wr.setVec3(this._hAABB,Ur.CENTER,this._aabb.center),Wr.setVec3(this._hAABB,Ur.HALF_EXTENSION,this._aabb.halfExtents)}},n.destroy=function(){return this._hAABB&&(Wr.free(this._hAABB),this._hAABB=0),e.prototype.destroy.call(this)},X(t,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return wo.get(this._handle,To.SIZE)},set:function(e){wo.set(this._handle,To.SIZE,e)}},{key:"range",get:function(){return wo.get(this._handle,To.RANGE)},set:function(e){wo.set(this._handle,To.RANGE,e),this._needUpdate=!0}},{key:"luminance",get:function(){return wo.get(this._handle,To.ILLUMINANCE)},set:function(e){wo.set(this._handle,To.ILLUMINANCE,e)}},{key:"aabb",get:function(){return this._aabb}}]),t}(am),sb=new yn(0,0,-1),cb=new bn,lb=new Mn,ub=new Mn,hb=new Mn,_b=new Mn,fb=function(e){function t(){var t;return(t=e.call(this)||this)._dir=new yn(1,-1,-1),t._range=5,t._spotAngle=Math.cos(Math.PI/6),t._pos=void 0,t._aabb=void 0,t._frustum=void 0,t._angle=0,t._needUpdate=!1,t._hAABB=0,t._hFrustum=0,t._aabb=$l.create(),t._frustum=lu.create(),t._pos=new yn,t}K(t,e);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),this._hAABB=Wr.alloc(),this._hFrustum=co.alloc(),wo.set(this._handle,To.TYPE,nm.SPOT),wo.set(this._handle,To.SIZE,.15),wo.set(this._handle,To.AABB,this._hAABB),wo.set(this._handle,To.ILLUMINANCE,1700/om(.15)),wo.set(this._handle,To.RANGE,Math.cos(Math.PI/6)),wo.set(this._handle,To.ASPECT,1),wo.setVec3(this._handle,To.DIRECTION,this._dir),wo.set(this._handle,To.FRUSTUM,this._hFrustum)},n.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),yn.transformQuat(this._dir,sb,this._node.getWorldRotation(cb)),yn.normalize(this._dir,this._dir),wo.setVec3(this._handle,To.DIRECTION,this._dir),$l.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(lb),Mn.invert(lb,lb),Mn.perspective(ub,this._angle,1,.001,this._range),Mn.multiply(hb,ub,lb),this._frustum.update(hb,_b),this._needUpdate=!1,wo.setVec3(this._handle,To.POSITION,this._pos),Wr.setVec3(this._hAABB,Ur.CENTER,this._aabb.center),Wr.setVec3(this._hAABB,Ur.HALF_EXTENSION,this._aabb.halfExtents),uu(this._hFrustum,this._frustum))},n.destroy=function(){return this._hAABB&&(Wr.free(this._hAABB),this._hAABB=0),this._hFrustum&&(co.free(this._hFrustum),this._hFrustum=0),e.prototype.destroy.call(this)},X(t,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return wo.get(this._handle,To.SIZE)},set:function(e){wo.set(this._handle,To.SIZE,e)}},{key:"range",get:function(){return wo.get(this._handle,To.RANGE)},set:function(e){this._range=e,wo.set(this._handle,To.RANGE,e),this._needUpdate=!0}},{key:"luminance",get:function(){return wo.get(this._handle,To.ILLUMINANCE)},set:function(e){wo.set(this._handle,To.ILLUMINANCE,e)}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return wo.get(this._handle,To.SPOT_ANGLE)},set:function(e){this._angle=e,wo.set(this._handle,To.SPOT_ANGLE,Math.cos(.5*e)),this._needUpdate=!0}},{key:"aspect",get:function(){return wo.get(this._handle,To.ASPECT)},set:function(e){wo.set(this._handle,To.ASPECT,e),this._needUpdate=!0}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}}]),t}(am),db=Object.freeze({__proto__:null,Ambient:Xo,get CameraFOVAxis(){return jh},get CameraProjection(){return qh},get CameraAperture(){return Xh},get CameraISO(){return Yh},get CameraShutter(){return Kh},SKYBOX_FLAG:c_,Camera:u_,CameraVisFlags:tm,VisibilityFlags:im,DirectionalLight:lm,ColorTemperatureToRGB:rm,get LightType(){return nm},nt2lm:om,Light:am,get ModelType(){return YC},Model:ob,ShadowType:JS,PCFType:$S,Shadows:tE,RenderScene:h_,Skybox:IE,SphereLight:ab,SpotLight:fb,SubModel:ZC});function pb(e){return--e,e|=e>>16,e|=e>>8,e|=e>>4,e|=e>>2,e|=e>>1,++e}function mb(e,t){return Math.ceil(e/t)*t}!function(e){e[e.OPAQUE=0]="OPAQUE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OVERLAY=2]="OVERLAY"}(tb||(tb={})),function(e){e[e.DEFAULT=1]="DEFAULT",e[e.FORWARD=2]="FORWARD",e[e.SHADOWCAST=4]="SHADOWCAST"}(nb||(nb={}));var gb=function(){function e(e){this._device=void 0,this._format=ya.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new hs,this._region1=new hs,this._region2=new hs,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=e}var t=e.prototype;return t.initialize=function(e){var t=$s[e.format];this._format=e.format,this._formatSize=t.size,this._channels=t.count,this._bufferViewCtor=cc(t),this._roundUpFn=e.roundUpFn||null,this._alignment=e.alignment||1,e.inOrderFree&&(this.alloc=this._McDonaldAlloc)},t.destroy=function(){for(var e=0;e<this._chunkCount;++e)this._chunks[e].texture.destroy();this._chunks.length=0,this._handles.length=0},t.alloc=function(e,t){e=mb(e,this._alignment);var n=-1,i=-1;if(void 0!==t&&(n=t,i=this._findAvailableSpace(e,n)),i<0)for(var r=0;r<this._chunkCount&&(n=r,!((i=this._findAvailableSpace(e,n))>=0));++r);if(i>=0){var o=this._chunks[n];o.start+=e;var a={chunkIdx:n,start:i,end:i+e,texture:o.texture};return this._handles.push(a),a}var s=Math.sqrt(e/this._formatSize),c=this._roundUpFn&&this._roundUpFn(s,this._formatSize)||Math.max(1024,pb(s)),l=this._chunks[this.createChunk(c)];l.start+=e;var u={chunkIdx:this._chunkCount-1,start:0,end:e,texture:l.texture};return this._handles.push(u),u},t.free=function(e){for(var t=0;t<this._handles.length;++t)if(this._handles[t]===e)return this._chunks[e.chunkIdx].end=e.end,void this._handles.splice(t,1)},t.createChunk=function(e){var t=e*e*this._formatSize;console.info("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+t+", format: "+this._format);var n={texture:this._device.createTexture(new Ss(ba.TEX2D,wa.SAMPLED|wa.TRANSFER_DST,this._format,e,e,Ra.IMMUTABLE)),size:t,start:0,end:t};return this._chunks[this._chunkCount]=n,this._chunkCount++},t.update=function(e,t){var n=[],i=[],r=e.start/this._formatSize,o=t.byteLength/this._formatSize,a=r%e.texture.width,s=Math.floor(r/e.texture.width),c=Math.min(e.texture.width-a,o),l=0;a>0&&(this._region0.texOffset.x=a,this._region0.texOffset.y=s,this._region0.texExtent.width=c,this._region0.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region0),a=0,s+=1,o-=c,l+=c),o>0&&(this._region1.texOffset.x=a,this._region1.texOffset.y=s,o>e.texture.width?(this._region1.texExtent.width=e.texture.width,this._region1.texExtent.height=Math.floor(o/e.texture.width),c=this._region1.texExtent.width*this._region1.texExtent.height):(c=o,this._region1.texExtent.width=c,this._region1.texExtent.height=1),n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region1),a=0,s+=this._region1.texExtent.height,o-=c,l+=c),o>0&&(this._region2.texOffset.x=a,this._region2.texOffset.y=s,this._region2.texExtent.width=o,this._region2.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,o*this._channels)),i.push(this._region2)),this._device.copyBuffersToTexture(n,e.texture,i)},t._findAvailableSpace=function(e,t){var n=this._chunks[t],i=!1,r=n.start;if(r+e<=n.size)i=!0;else{r=0;for(var o=this._handles.filter((function(e){return e.chunkIdx===t})).sort((function(e,t){return e.start-t.start})),a=0;a<o.length;a++){var s=o[a];if(r+e<=s.start){i=!0;break}r=s.end}!i&&r+e<=n.size&&(i=!0)}return i?r:-1},t._McDonaldAlloc=function(e){e=mb(e,this._alignment);for(var t=0;t<this._chunkCount;++t){var n=this._chunks[t],i=!1,r=n.start;if(r+e<=n.end?i=!0:r>n.end?r+e<=n.size?i=!0:e<=n.end&&(n.start=r=0,i=!0):r===n.end&&(n.start=r=0,n.end=n.size,e<=n.end&&(i=!0)),i){n.start+=e;var o={chunkIdx:t,start:r,end:r+e,texture:n.texture};return this._handles.push(o),o}}var a=Math.sqrt(e/this._formatSize),s=this._roundUpFn&&this._roundUpFn(a,this._formatSize)||Math.max(1024,pb(a)),c=this._chunks[this.createChunk(s)];c.start+=e;var l={chunkIdx:this._chunkCount,start:0,end:e,texture:c.texture};return this._handles.push(l),l},e}(),vb=function(e){if(void 0===or[e]){var t=1<<rr;or[e]=t,rr+=1}},yb=Object.freeze({__proto__:null,addStage:vb,scene:db,createIA:function(e,t){if(!t.positions)return console.error("The data must have positions field"),null;for(var n=[],i=t.positions.length/3,r=0;r<i;++r)n.push(t.positions[3*r],t.positions[3*r+1],t.positions[3*r+2]),t.normals&&n.push(t.normals[3*r],t.normals[3*r+1],t.normals[3*r+2]),t.uvs&&n.push(t.uvs[2*r],t.uvs[2*r+1]),t.colors&&n.push(t.colors[3*r],t.colors[3*r+1],t.colors[3*r+2]);var o=[];o.push(new Ds(ts.ATTR_POSITION,ya.RGB32F)),t.normals&&o.push(new Ds(ts.ATTR_NORMAL,ya.RGB32F)),t.uvs&&o.push(new Ds(ts.ATTR_TEX_COORD,ya.RG32F)),t.colors&&o.push(new Ds(ts.ATTR_COLOR,ya.RGB32F));var a=e.createBuffer(new ps(Ta.VERTEX|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,4*n.length,4*n.length/i));a.update(new Float32Array(n));var s=null;return t.indices&&(s=e.createBuffer(new ps(Ta.INDEX|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,2*t.indices.length,2))).update(new Uint16Array(t.indices)),e.createInputAssembler(new Ms(o,[a],s))},get RenderQueue(){return tb},get PassStage(){return nb},get PropertyType(){return yp},genHandle:Cp,getPropertyTypeFromHandle:bp,getTypeFromHandle:wp,getSetIndexFromHandle:function(e){return(e&xp)>>>20},getBindingFromHandle:Rp,getOffsetFromHandle:Ip,customizeType:Pp,type2reader:Op,type2writer:Dp,getDefaultFromType:Mp,overrideMacros:Lp,get BatchingSchemes(){return qp},Pass:em,getDeviceShaderVersion:kp,programLib:Vp,get SamplerInfoIndex(){return zf},defaultSamplerHash:Gf,genSamplerHash:Wf,samplerLib:id,nearestPOT:pb,TextureBufferPool:gb,MaterialInstance:bE,PassInstance:CE,ObjectPool:hr,freeHandleArray:dr,get PoolType(){return lr},NULL_HANDLE:0,ShaderPool:mr,DSPool:gr,IAPool:vr,PipelineLayoutPool:yr,FramebufferPool:Sr,SubModelArrayPool:Er,ModelArrayPool:Tr,AttributeArrayPool:xr,FlatBufferArrayPool:Ar,LightArrayPool:Cr,BlendTargetArrayPool:br,UIBatchArrayPool:wr,RawBufferPool:Rr,RawObjectPool:Ir,get PassView(){return pr},PassPool:Dr,get SubModelView(){return Pr},SubModelPool:Lr,get ModelView(){return Nr},ModelPool:zr,get BatchView2D(){return Br},BatchPool2D:Gr,get AABBView(){return Ur},AABBPool:Wr,get SceneView(){return kr},ScenePool:Xr,get CameraView(){return jr},CameraPool:Zr,get NodeView(){return Yr},NodePool:$r,get RootView(){return Jr},RootPool:no,get RenderWindowView(){return eo},RenderWindowPool:oo,get FrustumView(){return io},FrustumPool:co,get AmbientView(){return ao},AmbientPool:ho,get SkyboxView(){return uo},SkyboxPool:po,get FogView(){return _o},FogPool:vo,get ShadowsView(){return go},ShadowsPool:Eo,get PipelineSceneDataView(){return So},PipelineSceneDataPool:Ao,get LightView(){return To},LightPool:wo,get SphereView(){return Co},SpherePool:Po,get FlatBufferView(){return Io},FlatBufferPool:No,get SubMeshView(){return Oo},SubMeshPool:Bo,get RasterizerStateView(){return Mo},RasterizerStatePool:Uo,get DepthStencilStateView(){return Fo},DepthStencilStatePool:ko,get BlendTargetView(){return Ho},BlendTargetPool:Wo,get BlendStateView(){return Vo},BlendStatePool:qo});function Sb(e){return e*e}function Eb(e){return e*(2-e)}function Tb(e){return e*e*e}function xb(e){return--e*e*e+1}function Ab(e){return e*e*e*e}function Cb(e){return 1- --e*e*e*e}function bb(e){return e*e*e*e*e}function wb(e){return--e*e*e*e*e+1}function Rb(e){return 1===e?1:1-Math.cos(e*Math.PI/2)}function Ib(e){return Math.sin(e*Math.PI/2)}function Pb(e){return 0===e?0:Math.pow(1024,e-1)}function Ob(e){return 1===e?1:1-Math.pow(2,-10*e)}function Db(e){return 1-Math.sqrt(1-e*e)}function Nb(e){return Math.sqrt(1- --e*e)}function Mb(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4))}function Lb(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/.4)+1)}function Bb(e){if(1===e)return 1;var t=1.70158;return e*e*((t+1)*e-t)}function Fb(e){if(0===e)return 0;var t=1.70158;return--e*e*((t+1)*e+t)+1}function zb(e){return 1-Ub(1-e)}function Ub(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}e("renderer",yb);var Hb=Zb(Sb,Eb),Gb=Zb(Tb,xb),kb=Zb(Ab,Cb),Vb=Zb(bb,wb),Wb=Zb(Rb,Ib),jb=Zb(Pb,Ob),qb=Zb(Db,Nb),Xb=Zb(Mb,Lb),Yb=Zb(Bb,Fb),Kb=Zb(zb,Ub);function Zb(e,t){return function(n){return n<.5?t(2*n)/2:e(2*n-1)/2+.5}}var Qb=Object.freeze({__proto__:null,constant:function(){return 0},linear:function(e){return e},quadIn:Sb,quadOut:Eb,quadInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:Tb,cubicOut:xb,cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quartIn:Ab,quartOut:Cb,quartInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quintIn:bb,quintOut:wb,quintInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sineIn:Rb,sineOut:Ib,sineInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},expoIn:Pb,expoOut:Ob,expoInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circIn:Db,circOut:Nb,circInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:Mb,elasticOut:Lb,elasticInOut:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)*.5+1)},backIn:Bb,backOut:Fb,backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:zb,bounceOut:Ub,bounceInOut:function(e){return e<.5?.5*zb(2*e):.5*Ub(2*e-1)+.5},smooth:function(e){return e<=0?0:e>=1?1:e*e*(3-2*e)},fade:function(e){return e<=0?0:e>=1?1:e*e*e*(e*(6*e-15)+10)},quadOutIn:Hb,cubicOutIn:Gb,quartOutIn:kb,quintOutIn:Vb,sineOutIn:Wb,expoOutIn:jb,circOutIn:qb,elasticOutIn:Xb,backOutIn:Yb,bounceOutIn:Kb});e("easing",Qb);var Jb=new zn,$b=function(){var e=t.prototype;function t(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return e.main=function(e){if(null!=e){if(window._CCSettings&&window._CCSettings.splashScreen){var t=this.settings=window._CCSettings.splashScreen;t.totalTime=null!=this.settings.totalTime?this.settings.totalTime:3e3,t.base64src=this.settings.base64src||"",t.effect=this.settings.effect||"FADE-INOUT",t.clearColor=this.settings.clearColor||new fs(.88,.88,.88,1),t.displayRatio=null!=this.settings.displayRatio?this.settings.displayRatio:.4,t.displayWatermark=null==this.settings.displayWatermark||this.settings.displayWatermark}else this.settings={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new fs(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.settings.base64src||this.settings.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.settings=null,this._directCall=!0;else{i.view.enableRetina(!0),i.view.resizeWithBrowserSize(!0);var n=window._CCSettings.designResolution;n?i.view.setDesignResolutionSize(n.width,n.height,n.policy):i.view.setDesignResolutionSize(960,640,4),this.root=e,this.device=e.device,i.game.once(i.Game.EVENT_GAME_INITED,(function(){i.director._lateUpdate=performance.now()}),i.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.preInit(),this.logoImage=new Image,this.logoImage.onload=this.init.bind(this),this.logoImage.src=this.settings.base64src}}else p("RENDER ROOT IS NULL.")},e.setOnFinish=function(e){if(this._directCall&&e)return t._ins=void 0,void e();this.callBack=e},e._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),i.game.resume())},e.preInit=function(){var e=this.settings.clearColor;this.clearColors=[new fs(e.x,e.y,e.z,e.w)];var t=this.device;this.renderArea=new os(0,0,t.width,t.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=t.commandBuffer;var n=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),i=4*Float32Array.BYTES_PER_ELEMENT,r=4*i;this.vertexBuffers=t.createBuffer(new ps(Ta.VERTEX|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,r,i)),this.vertexBuffers.update(n);var o=new Uint16Array([0,1,2,1,3,2]),a=Uint16Array.BYTES_PER_ELEMENT,s=6*a;this.indicesBuffers=t.createBuffer(new ps(Ta.INDEX|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,s,a)),this.indicesBuffers.update(o);var c=[new Ds("a_position",ya.RG32F),new Ds("a_texCoord",ya.RG32F)],l=new Ms(c,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=t.createInputAssembler(l),this.projection=new Mn,Mn.ortho(this.projection,-1,1,-1,1,-1,1,t.capabilities.clipSpaceMinZ,t.capabilities.clipSpaceSignY,t.surfaceTransform)},e.init=function(){var e=this;this.initLogo(),this.settings.displayWatermark&&this.initWarterMark(),i.game.pause(),this.handle=requestAnimationFrame((function t(n){if(!e.cancelAnimate){var i=e.settings,r=e.device;Mn.ortho(e.projection,-1,1,-1,1,-1,1,r.capabilities.clipSpaceMinZ,r.capabilities.clipSpaceSignY,r.surfaceTransform);var o=r.width,a=r.height,s=o<a?o:a;e.startTime<0&&(e.startTime=n);var c=n-e.startTime,l=xb($t(c/i.totalTime));"NONE"===i.effect&&(l=1);var u=e.logoTexture.width,h=e.logoTexture.height,_=s*i.displayRatio,f=_*u/h,d=_;if(r.surfaceTransform!==ga.ROTATE_90&&r.surfaceTransform!==ga.ROTATE_270||(f=_*o/a,d=_*h/u*a/o),e.logoMat.setProperty("resolution",Jb.set(o,a),0),e.logoMat.setProperty("scale",Jb.set(f,d),0),e.logoMat.setProperty("translate",Jb.set(.5*o,.5*a),0),e.logoMat.setProperty("precent",l),e.logoMat.setProperty("u_projection",e.projection),e.logoMat.passes[0].update(),i.displayWatermark&&e.watermarkMat){var p=.5*s,m=e.watermarkTexture.width,g=p,v=p*e.watermarkTexture.height/m;r.surfaceTransform!==ga.ROTATE_90&&r.surfaceTransform!==ga.ROTATE_270||(g=.5*p,v=p*o/a*.5),e.watermarkMat.setProperty("resolution",Jb.set(o,a),0),e.watermarkMat.setProperty("scale",Jb.set(g,v),0),e.watermarkMat.setProperty("translate",Jb.set(.5*o,.1*a),0),e.watermarkMat.setProperty("precent",l),e.watermarkMat.setProperty("u_projection",e.projection),e.watermarkMat.passes[0].update()}e.frame(),c>i.totalTime&&(e.splashFinish=!0),requestAnimationFrame(t)}}))},e.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},e.initLogo=function(){var e=this.device;this.logoMat=new QS,this.logoMat.initialize({effectName:"splash-screen"});var t=new Ts;t.addressU=Oa.CLAMP,t.addressV=Oa.CLAMP,t.addressW=Oa.CLAMP,this.sampler=e.createSampler(t),this.logoTexture=e.createTexture(new Ss(ba.TEX2D,wa.SAMPLED|wa.TRANSFER_DST,ya.RGBA8,this.logoImage.width,this.logoImage.height));var n=this.logoMat.passes[0],i=n.getBinding("mainTexture");n.bindTexture(i,this.logoTexture),this.shader=mr.get(n.getShaderVariant());var r=gr.get(Dr.get(n.handle,pr.DESCRIPTOR_SET));r.bindSampler(i,this.sampler),r.update();var o=new hs;o.texExtent.width=this.logoImage.width,o.texExtent.height=this.logoImage.height,o.texExtent.depth=1,e.copyTexImagesToTexture([this.logoImage],this.logoTexture,[o])},e.initWarterMark=function(){var e=document.createElement("canvas");e.width=330,e.height=30,e.style.width=""+e.width,e.style.height=""+e.height;var t=e.getContext("2d");t.font="18px Arial",t.textBaseline="top",t.textAlign="left",t.fillStyle="`#424242`";var n="Powered by Cocos Creator",i=t.measureText(n);t.fillText(n,(330-i.width)/2,6);var r=new hs;r.texExtent.width=e.width,r.texExtent.height=e.height,r.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new Ss(ba.TEX2D,wa.SAMPLED|wa.TRANSFER_DST,ya.RGBA8,e.width,e.height)),this.device.copyTexImagesToTexture([e],this.watermarkTexture,[r]),this.watermarkMat=new QS,this.watermarkMat.initialize({effectName:"splash-screen"});var o=this.watermarkMat.passes[0],a=o.getBinding("mainTexture");o.bindTexture(a,this.watermarkTexture),gr.get(Dr.get(o.handle,pr.DESCRIPTOR_SET)).update()},e.frame=function(){var e=this.device;e.acquire();var t=this.cmdBuff,n=this.framebuffer,i=this.renderArea;i.width=e.width,i.height=e.height,t.begin(),t.beginRenderPass(n.renderPass,n,i,this.clearColors,1,0);var r=this.logoMat.passes[0],o=px.getOrCreatePipelineState(e,r,this.shader,n.renderPass,this.quadAssmebler);if(t.bindPipelineState(o),t.bindDescriptorSet(Gu.MATERIAL,r.descriptorSet),t.bindInputAssembler(this.quadAssmebler),t.draw(this.quadAssmebler),this.settings.displayWatermark&&this.watermarkMat){var a=this.watermarkMat.passes[0],s=px.getOrCreatePipelineState(e,a,this.shader,n.renderPass,this.quadAssmebler);t.bindPipelineState(s),t.bindDescriptorSet(Gu.MATERIAL,a.descriptorSet),t.bindInputAssembler(this.quadAssmebler),t.draw(this.quadAssmebler)}t.endRenderPass(),t.end(),e.flushCommands([t]),e.queue.submit([t]),e.present()},e.destroy=function(){this.callBack=null,this.root=null,this.device=null,this.clearColors=null,this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.framebuffer=null,this.renderArea=null,this.cmdBuff=null,this.shader=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null,t._ins=void 0},X(t,[{key:"splashFinish",set:function(e){this._splashFinish=e,this._tryToStart()}},{key:"loadFinish",set:function(e){this._loadFinish=e,this._tryToStart()}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();$b._ins=void 0,i.internal.SplashScreen=$b;var ew=e("System",function(){function e(){this._id="",this._priority=0,this._executeInEditMode=!1}e.sortByPriority=function(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0};var t=e.prototype;return t.init=function(){},t.update=function(){},t.postUpdate=function(){},X(e,[{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}}]),e}()),tw=new ce("Scheduler"),nw=function(e,t,n,i){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=n,this.markedForDeletion=i};nw.get=function(e,t,n,i){var r=nw._listEntries.pop();return r?(r.target=e,r.priority=t,r.paused=n,r.markedForDeletion=i):r=new nw(e,t,n,i),r},nw.put=function(e){nw._listEntries.length<20&&(e.target=null,nw._listEntries.push(e))},nw._listEntries=[];var iw=function(e,t,n,i){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=n,this.callback=i};iw.get=function(e,t,n,i){var r=iw._hashUpdateEntries.pop();return r?(r.list=e,r.entry=t,r.target=n,r.callback=i):r=new iw(e,t,n,i),r},iw.put=function(e){iw._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,iw._hashUpdateEntries.push(e))},iw._hashUpdateEntries=[];var rw=function(e,t,n,i,r,o){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=n,this.currentTimer=i,this.currentTimerSalvaged=r,this.paused=o};rw.get=function(e,t,n,i,r,o){var a=rw._hashTimerEntries.pop();return a?(a.timers=e,a.target=t,a.timerIndex=n,a.currentTimer=i,a.currentTimerSalvaged=r,a.paused=o):a=new rw(e,t,n,i,r,o),a},rw.put=function(e){rw._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,rw._hashTimerEntries.push(e))},rw._hashTimerEntries=[];var ow=function(){function e(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var t=e.prototype;return t.initWithCallback=function(e,t,n,r,o,a){return this._lock=!1,this._scheduler=e,this._target=n,this._callback=t,this._elapsed=-1,this._interval=r,this._delay=a,this._useDelay=this._delay>0,this._repeat=o,this._runForever=this._repeat===i.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(e){this._interval=e},t.update=function(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},e}();ow._timers=[],ow.get=function(){return ow._timers.pop()||new ow},ow.put=function(e){ow._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,ow._timers.push(e))};var aw=e("Scheduler",function(e){function t(){var t;return(t=e.call(this)||this)._timeScale=void 0,t._updatesNegList=void 0,t._updates0List=void 0,t._updatesPosList=void 0,t._hashForUpdates=void 0,t._hashForTimers=void 0,t._currentTarget=void 0,t._currentTargetSalvaged=void 0,t._updateHashLocked=void 0,t._arrayForTimers=void 0,t._timeScale=1,t._updatesNegList=[],t._updates0List=[],t._updatesPosList=[],t._hashForUpdates=Se(!0),t._hashForTimers=Se(!0),t._currentTarget=null,t._currentTargetSalvaged=!1,t._updateHashLocked=!1,t._arrayForTimers=[],t}K(t,e),t.enableForTarget=function(e){var t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?A(1513):e.id=tw.getNewId())};var n=t.prototype;return n.setTimeScale=function(e){this._timeScale=e},n.getTimeScale=function(){return this._timeScale},n.update=function(e){var t,n,i,r,o;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,i=(n=this._updatesNegList).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,i=(n=this._updates0List).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,i=(n=this._updatesPosList).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);var a=this._arrayForTimers;for(t=0;t<a.length;t++){if(o=a[t],this._currentTarget=o,this._currentTargetSalvaged=!1,!o.paused)for(o.timerIndex=0;o.timerIndex<o.timers.length;++o.timerIndex)o.currentTimer=o.timers[o.timerIndex],o.currentTimerSalvaged=!1,o.currentTimer.update(e),o.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,n=this._updatesNegList;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,n=this._updates0List;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,n=this._updatesPosList;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;this._updateHashLocked=!1,this._currentTarget=null},n.schedule=function(e,t,n,r,o,a){if("function"!=typeof e){var s=e;e=t,t=s}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(a=!!r,r=i.macro.REPEAT_FOREVER,o=0),I(t,1502);var c=t.uuid||t.id;if(c){var l,u,h=this._hashForTimers[c];if(h?h.paused!==a&&A(1511):(h=rw.get(null,t,0,null,null,a),this._arrayForTimers.push(h),this._hashForTimers[c]=h),null==h.timers)h.timers=[];else for(u=0;u<h.timers.length;++u)if((l=h.timers[u])&&e===l._callback)return T(1507,l.getInterval(),n),void(l._interval=n);(l=ow.get()).initWithCallback(this,e,t,n,r,o),h.timers.push(l),this._currentTarget===h&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else b(1510)},n.scheduleUpdate=function(e,t,n){var i=e.uuid||e.id;if(i){var r=this._hashForUpdates[i];if(r&&r.entry){if(r.entry.priority===t)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return T(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(e)}var o,a=nw.get(e,t,n,!1);0===t?(o=this._updates0List,this._appendIn(o,a)):(o=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(o,a,t)),this._hashForUpdates[i]=iw.get(o,a,e,null)}else b(1510)},n.unschedule=function(e,t){if(t&&e){var n=t.uuid||t.id;if(n){var i=this,r=i._hashForTimers[n];if(r)for(var o=r.timers,a=0,s=o.length;a<s;a++){var c=o[a];if(e===c._callback)return c!==r.currentTimer||r.currentTimerSalvaged||(r.currentTimerSalvaged=!0),o.splice(a,1),ow.put(c),r.timerIndex>=a&&r.timerIndex--,void(0===o.length&&(i._currentTarget===r?i._currentTargetSalvaged=!0:i._removeHashElement(r)))}}else b(1510)}},n.unscheduleUpdate=function(e){if(e){var t=e.uuid||e.id;if(t){var n=this._hashForUpdates[t];n&&(this._updateHashLocked?n.entry.markedForDeletion=!0:this._removeUpdateFromHash(n.entry))}else b(1510)}},n.unscheduleAllForTarget=function(e){if(e){var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];if(n){var i=n.timers;i.indexOf(n.currentTimer)>-1&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0);for(var r=0,o=i.length;r<o;r++)ow.put(i[r]);i.length=0,this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)}this.unscheduleUpdate(e)}else b(1510)}},n.unscheduleAll=function(){this.unscheduleAllWithMinPriority(i.Scheduler.PRIORITY_SYSTEM)},n.unscheduleAllWithMinPriority=function(e){var t,n,i,r=this._arrayForTimers;for(t=r.length-1;t>=0;t--)n=r[t],this.unscheduleAllForTarget(n.target);var o=0;if(e<0)for(t=0;t<this._updatesNegList.length;)o=this._updatesNegList.length,(i=this._updatesNegList[t])&&i.priority>=e&&this.unscheduleUpdate(i.target),o===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)o=this._updates0List.length,(i=this._updates0List[t])&&this.unscheduleUpdate(i.target),o===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)o=this._updatesPosList.length,(i=this._updatesPosList[t])&&i.priority>=e&&this.unscheduleUpdate(i.target),o===this._updatesPosList.length&&t++},n.isScheduled=function(e,t){I(e,1508),I(t,1509);var n=t.uuid||t.id;if(n){var i=this._hashForTimers[n];if(!i)return!1;if(null==i.timers)return!1;for(var r=i.timers,o=0;o<r.length;++o)if(e===r[o]._callback)return!0;return!1}b(1510)},n.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(i.Scheduler.PRIORITY_SYSTEM)},n.pauseAllTargetsWithMinPriority=function(e){var t,n,i,r,o=[],a=this._arrayForTimers;for(n=0,i=a.length;n<i;n++)(t=a[n])&&(t.paused=!0,o.push(t.target));if(e<0)for(n=0;n<this._updatesNegList.length;n++)(r=this._updatesNegList[n])&&r.priority>=e&&(r.paused=!0,o.push(r.target));if(e<=0)for(n=0;n<this._updates0List.length;n++)(r=this._updates0List[n])&&(r.paused=!0,o.push(r.target));for(n=0;n<this._updatesPosList.length;n++)(r=this._updatesPosList[n])&&r.priority>=e&&(r.paused=!0,o.push(r.target));return o},n.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},n.pauseTarget=function(e){I(e,1503);var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];n&&(n.paused=!0);var i=this._hashForUpdates[t];i&&(i.entry.paused=!0)}else b(1510)},n.resumeTarget=function(e){I(e,1504);var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];n&&(n.paused=!1);var i=this._hashForUpdates[t];i&&(i.entry.paused=!1)}else b(1510)},n.isTargetPaused=function(e){I(e,1505);var t=e.uuid||e.id;if(!t)return b(1510),!1;var n=this._hashForTimers[t];if(n)return n.paused;var i=this._hashForUpdates[t];return!!i&&i.entry.paused},n._removeHashElement=function(e){var t=e.target.uuid||e.target.id;delete this._hashForTimers[t];for(var n=this._arrayForTimers,i=0,r=n.length;i<r;i++)if(n[i]===e){n.splice(i,1);break}rw.put(e)},n._removeUpdateFromHash=function(e){var t=e.target.uuid||e.target.id,n=this._hashForUpdates[t];if(n){for(var i=n.list,r=n.entry,o=0,a=i.length;o<a;o++)if(i[o]===r){i.splice(o,1);break}delete this._hashForUpdates[t],nw.put(r),iw.put(n)}},n._priorityIn=function(e,t,n){for(var i=0;i<e.length;i++)if(n<e[i].priority)return void e.splice(i,0,t);e.push(t)},n._appendIn=function(e,t){e.push(t)},t}(ew));aw.PRIORITY_SYSTEM=1<<31,aw.PRIORITY_NON_SYSTEM=aw.PRIORITY_SYSTEM+1,aw.ID="scheduler",i.Scheduler=aw;var sw=function(){function e(){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=0,this._cameras=[]}e.registerCreateFunc=function(t){t._createWindowFun=function(t){return new e(t)}};var t=e.prototype;return t.initialize=function(e,t){this._poolHandle=oo.alloc(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchainBufferIndices&&(this._swapchainBufferIndices=t.swapchainBufferIndices),void 0!==t.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=t.shouldSyncSizeWithSwapchain),this._width=t.width,this._height=t.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var n=t.renderPassInfo,i=n.colorAttachments,r=n.depthStencilAttachment,o=0;o<i.length;o++)i[o].format===ya.UNKNOWN&&(i[o].format=e.colorFormat);r&&r.format===ya.UNKNOWN&&(r.format=e.depthStencilFormat),this._renderPass=e.createRenderPass(t.renderPassInfo);for(var a=0;a<i.length;a++){var s=null;this._swapchainBufferIndices&1<<a?oo.set(this._poolHandle,eo.HAS_ON_SCREEN_ATTACHMENTS,1):(s=e.createTexture(new Ss(ba.TEX2D,wa.COLOR_ATTACHMENT|wa.SAMPLED,i[a].format,this._width,this._height)),oo.set(this._poolHandle,eo.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(s)}r&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=e.createTexture(new Ss(ba.TEX2D,wa.DEPTH_STENCIL_ATTACHMENT|wa.SAMPLED,r.format,this._width,this._height)),oo.set(this._poolHandle,eo.HAS_OFF_SCREEN_ATTACHMENTS,1)):oo.set(this._poolHandle,eo.HAS_ON_SCREEN_ATTACHMENTS,1));var c=Sr.alloc(e,new Gs(this._renderPass,this._colorTextures,this._depthStencilTexture));return oo.set(this._poolHandle,eo.FRAMEBUFFER,c),!0},t.destroy=function(){this.clearCameras(),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var e=0;e<this._colorTextures.length;e++){var t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._poolHandle&&(Sr.get(oo.get(this._poolHandle,eo.FRAMEBUFFER)).destroy(),this._poolHandle=0)},t.resize=function(e,t){if(this._width=e,this._height=t,e>this._nativeWidth||t>this._nativeHeight){this._nativeWidth=e,this._nativeHeight=t;var n=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(e,t),n=!0);for(var i=0;i<this._colorTextures.length;i++){var r=this._colorTextures[i];r&&(r.resize(e,t),n=!0)}var o=Sr.get(oo.get(this._poolHandle,eo.FRAMEBUFFER));n&&o&&(o.destroy(),o.initialize(new Gs(this._renderPass,this._colorTextures,this._depthStencilTexture)))}for(var a,s=$(this._cameras);!(a=s()).done;){var c=a.value;c.isWindowSize&&c.resize(e,t)}},t.extractRenderCameras=function(e){for(var t=0;t<this._cameras.length;t++){var n=this._cameras[t];n.enabled&&(n.update(),e.push(n))}},t.attachCamera=function(e){for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortCameras()},t.detachCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(e,t){return e.priority-t.priority}))},X(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return Sr.get(oo.get(this._poolHandle,eo.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===oo.get(this._poolHandle,eo.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===oo.get(this._poolHandle,eo.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}},{key:"cameras",get:function(){return this._cameras}}]),e}(),cw=function(){function e(e){var t=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=0,this._useDeferredPipeline=!1,this._device=e,this._dataPoolMgr=i.internal.DataPoolManager&&new i.internal.DataPoolManager(e),h_.registerCreateFunc(this),sw.registerCreateFunc(this),this._cameraPool=new Zn((function(){return new u_(t._device)}),4)}var t=e.prototype;return t.initialize=function(){var e=this;this._poolHandle=no.alloc();var t=new Ls,n=new Bs;n.depthStoreOp=Ua.DISCARD,n.stencilStoreOp=Ua.DISCARD;var r=new zs([t],n);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:r,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(Kp.initBuiltinRes(this._device)).then((function(){i.view.on("design-resolution-changed",(function(){var t=i.game.canvas.width,n=i.game.canvas.height;e.resize(t,n)}),e)}))},t.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(no.free(this._poolHandle),this._poolHandle=0)},t.resize=function(e,t){this._device.resize(e,t),this._mainWindow.resize(e,t);for(var n,i=$(this._windows);!(n=i()).done;){var r=n.value;r.shouldSyncSizeWithSwapchain&&r.resize(e,t)}this._pipeline&&this._pipeline.resize(e,t)},t.setRenderPipeline=function(e){if(e instanceof LC&&(this._useDeferredPipeline=!0),e||(e=FC()),this._pipeline=e,!this._pipeline.activate())return!1;var t=i.director.getScene();return t&&t.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&i.internal.Batcher2D&&(this._batcher=new i.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},t.onGlobalPipelineStateChanged=function(){for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged();this._pipeline.pipelineSceneData.initDeferredPassInfo()},t.activeWindow=function(e){this._curWindow=e},t.resetCumulativeTime=function(){no.set(this._poolHandle,Jr.CUMULATIVE_TIME,0)},t.frameMove=function(e){no.set(this._poolHandle,Jr.FRAME_TIME,e),++this._frameCount,no.set(this._poolHandle,Jr.CUMULATIVE_TIME,no.get(this._poolHandle,Jr.CUMULATIVE_TIME)+e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var t=0;t<this._scenes.length;++t)this._scenes[t].removeBatches();this._batcher&&this._batcher.update();for(var n=this._windows,r=[],o=0;o<n.length;o++)n[o].extractRenderCameras(r);if(this._pipeline&&r.length>0){this._device.acquire();var a=this._scenes,s=i.director.getTotalFrames();this._batcher&&this._batcher.uploadBuffers();for(var c=0;c<a.length;c++)a[c].update(s);i.director.emit(i.Director.EVENT_BEFORE_COMMIT),r.sort((function(e,t){return e.priority-t.priority})),this._pipeline.render(r),this._device.present()}this._batcher&&this._batcher.reset()},t.createWindow=function(e){var t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t},t.destroyWindow=function(e){for(var t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)},t.destroyWindows=function(){for(var e,t=$(this._windows);!(e=t()).done;)e.value.destroy();this._windows=[]},t.createScene=function(e){var t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t},t.destroyScene=function(e){for(var t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)},t.destroyScenes=function(){for(var e,t=$(this._scenes);!(e=t()).done;)e.value.destroy();this._scenes=[]},t.createModel=function(e){var t=this._modelPools.get(e);t||(this._modelPools.set(e,new Zn((function(){return new e}),10)),t=this._modelPools.get(e));var n=t.alloc();return n.initialize(),n},t.destroyModel=function(e){var t=this._modelPools.get(e.constructor);t?(t.free(e),e.destroy(),e.scene&&e.scene.removeModel(e)):A(1300,e.constructor.name)},t.createCamera=function(){return this._cameraPool.alloc()},t.createLight=function(e){var t=this._lightPools.get(e);t||(this._lightPools.set(e,new Zn((function(){return new e}),4)),t=this._lightPools.get(e));var n=t.alloc();return n.initialize(),n},t.destroyLight=function(e){var t=this._lightPools.get(e.constructor);if(e.destroy(),t&&(t.free(e),e.scene))switch(e.type){case nm.SPHERE:e.scene.removeSphereLight(e);break;case nm.SPOT:e.scene.removeSpotLight(e)}},X(e,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",get:function(){return this._curWindow},set:function(e){this._curWindow=e}},{key:"tempWindow",get:function(){return this._tempWindow},set:function(e){this._tempWindow=e}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return no.get(this._poolHandle,Jr.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return no.get(this._poolHandle,Jr.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",get:function(){return this._fixedFPS},set:function(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}},{key:"useDeferredPipeline",get:function(){return this._useDeferredPipeline}}]),e}();i.Root=cw;var lw={};F(lw,"vmath",[{name:"vec2",newName:"Vec2",target:Kn,targetName:"math"},{name:"vec3",newName:"Vec3",target:Kn,targetName:"math"},{name:"vec4",newName:"Vec4",target:Kn,targetName:"math"},{name:"quat",newName:"Quat",target:Kn,targetName:"math"},{name:"mat3",newName:"Mat3",target:Kn,targetName:"math"},{name:"mat4",newName:"Mat4",target:Kn,targetName:"math"},{name:"color4",newName:"Color",target:Kn,targetName:"math"},{name:"rect",newName:"Rect",target:Kn,targetName:"math"},{name:"approx",newName:"approx",target:Kn,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:Kn,targetName:"math"},{name:"equals",newName:"equals",target:Kn,targetName:"math"},{name:"clamp",newName:"clamp",target:Kn,targetName:"math"},{name:"clamp01",newName:"clamp01",target:Kn,targetName:"math"},{name:"lerp",newName:"lerp",target:Kn,targetName:"math"},{name:"toRadian",newName:"toRadian",target:Kn,targetName:"math"},{name:"toDegree",newName:"toDegree",target:Kn,targetName:"math"},{name:"random",newName:"random",target:Kn,targetName:"math"},{name:"randomRange",newName:"randomRange",target:Kn,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:Kn,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:Kn,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:Kn,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:Kn,targetName:"math"},{name:"repeat",newName:"repeat",target:Kn,targetName:"math"},{name:"pingPong",newName:"pingPong",target:Kn,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:Kn,targetName:"math"}]),i.vmath=lw,F(aw.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:aw,targetName:"Scheduler"}]),F(by.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:by,targetName:"EventTouch"}]),F(ZC.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),z(ZC.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),F(cw.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]);var uw=Object.freeze({__proto__:null,ccclass:S_,property:A_,requireComponent:E_,executionOrder:T_,disallowMultiple:x_,executeInEditMode:w_,menu:R_,playOnFocus:I_,inspector:P_,icon:O_,help:D_,type:K_,integer:j_,float:q_,boolean:X_,string:Y_});e("_decorator",uw);var hw,_w,fw,dw,pw,mw,gw,vw,yw,Sw,Ew,Tw=ei.Flags.Destroyed,xw=ei.Flags.PersistentMask,Aw=[];function Cw(e){var t;if(e instanceof ei){if(e._instantiate)return i.game._isCloning=!0,t=e._instantiate(null,!0),i.game._isCloning=!1,t;if(e instanceof i.Asset)throw new TypeError(P(6903))}return i.game._isCloning=!0,t=bw(e),i.game._isCloning=!1,t}function bw(e,t){var n;ww(e,n=e._iN$t?e._iN$t:e.constructor?new(0,e.constructor):Object.create(null),t);for(var i=0,r=Aw.length;i<r;++i)Aw[i]._iN$t=null;return Aw.length=0,n}function ww(e,t,n){Ke.value(e,"_iN$t",t,!0),Aw.push(e);var r=e.constructor;if(i.Class._isCCClass(r))!function(e,t,n,i){for(var r=e.__values__,o=0;o<r.length;o++){var a=r[o],s=t[a];if("object"==typeof s&&s){var c=n[a];c instanceof tt&&c.constructor===s.constructor?c.set(s):n[a]=s._iN$t||Rw(s,i)}else n[a]=s}}(r,e,t,n);else for(var o in e)if(e.hasOwnProperty(o)&&(95!==o.charCodeAt(0)||95!==o.charCodeAt(1)||"__type__"===o)){var a=e[o];if("object"==typeof a&&a){if(a===t)continue;t[o]=a._iN$t||Rw(a,n)}else t[o]=a}e instanceof ei&&(t._objFlags&=xw)}function Rw(e,t){if(e instanceof tt)return e.clone();if(e instanceof i.Asset)return e;var n;if(ArrayBuffer.isView(e)){var r=e.length;n=new e.constructor(r),e._iN$t=n,Aw.push(e);for(var o=0;o<r;++o)n[o]=e[o];return n}if(Array.isArray(e)){var a=e.length;n=new Array(a),e._iN$t=n,Aw.push(e);for(var s=0;s<a;++s){var c=e[s];n[s]="object"==typeof c&&c?c._iN$t||Rw(c,t):c}return n}if(e._objFlags&Tw)return null;var l=e.constructor;if(i.Class._isCCClass(l)){if(t)if(t instanceof i.Component){if(e instanceof i._BaseNode||e instanceof i.Component)return e}else if(t instanceof i._BaseNode)if(e instanceof i._BaseNode){if(!e.isChildOf(t))return e}else if(e instanceof i.Component&&e.node&&!e.node.isChildOf(t))return e;n=new l}else if(l===Object)n={};else{if(l)return e;n=Object.create(null)}return ww(e,n,t),n}function Iw(e,t){return(t<<3)+e}Cw._clone=bw,i.instantiate=Cw,function(e){e[e.Uint8=0]="Uint8",e[e.Uint16=1]="Uint16",e[e.Uint32=2]="Uint32",e[e.Int8=3]="Int8",e[e.Int16=4]="Int16",e[e.Int32=5]="Int32",e[e.Float32=6]="Float32",e[e.Float64=7]="Float64"}(Sw||(Sw={})),function(e){e[e.Scalar=0]="Scalar",e[e.Vec2=1]="Vec2",e[e.Vec3=2]="Vec3",e[e.Vec4=3]="Vec4",e[e.Quat=4]="Quat",e[e.Mat4=5]="Mat4"}(Ew||(Ew={}));var Pw=e("CompactValueTypeArray",S_("cc.CompactValueTypeArray")((vw=gw=function(){function e(){ee(this,"_byteOffset",fw,this),ee(this,"_unitCount",dw,this),ee(this,"_unitElement",pw,this),ee(this,"_length",mw,this)}return e.lengthFor=function(e,t,n){return Ow(t).requiredUnits*e.length*Dw(n).BYTES_PER_ELEMENT},e.compress=function(t,n,i,r,o,a){for(var s=Ow(n),c=Dw(i),l=s.requiredUnits*t.length,u=new c(r,o,l),h=0;h<t.length;++h)s.compress(u,h,t[h]);var _=new e;return _._unitElement=Iw(i,n),_._byteOffset=a,_._unitCount=l,_._length=t.length,_},e.prototype.decompress=function(e){for(var t,n={storageUnit:7&(t=this._unitElement),elementType:t>>3},i=n.storageUnit,r=Ow(n.elementType),o=new(Dw(i))(e,this._byteOffset,this._unitCount),a=new Array(this._length),s=0;s<this._length;++s)a[s]=r.decompress(o,s);return a},e}(),gw.StorageUnit=Sw,gw.ElementType=Ew,fw=te((_w=vw).prototype,"_byteOffset",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dw=te(_w.prototype,"_unitCount",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pw=te(_w.prototype,"_unitElement",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Iw(Sw.Uint8,Ew.Scalar)}}),mw=te(_w.prototype,"_length",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hw=_w))||hw);function Ow(e){return Lw[e]}function Dw(e){switch(e){case Sw.Uint8:return Uint8Array;case Sw.Uint16:return Uint16Array;case Sw.Uint32:return Uint32Array;case Sw.Int8:return Int8Array;case Sw.Int16:return Int16Array;case Sw.Int32:return Int32Array;case Sw.Float32:return Float32Array;case Sw.Float64:return Float64Array}}var Nw,Mw,Lw=((yw={})[Ew.Scalar]={requiredUnits:1,compress:function(e,t,n){e[t]=n},decompress:function(e,t){return e[t]}},yw[Ew.Vec2]={requiredUnits:2,compress:function(e,t,n){e[2*t]=n.x,e[2*t+1]=n.y},decompress:function(e,t){return new yn(e[2*t],e[2*t+1])}},yw[Ew.Vec3]={requiredUnits:3,compress:function(e,t,n){e[3*t]=n.x,e[3*t+1]=n.y,e[3*t+2]=n.z},decompress:function(e,t){return new yn(e[3*t],e[3*t+1],e[3*t+2])}},yw[Ew.Vec4]={requiredUnits:4,compress:function(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:function(e,t){return new kn(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])}},yw[Ew.Quat]={requiredUnits:4,compress:function(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:function(e,t){return new bn(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])}},yw[Ew.Mat4]={requiredUnits:16,compress:function(e,t,n){Mn.toArray(e,n,16*t)},decompress:function(e,t){return Mn.fromArray(new Mn,e,16*t)}},yw);i._decorator=uw,z(od.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),F(ZS.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var Bw,Fw=e("BufferAsset",S_("cc.BufferAsset")((te((Mw=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._buffer=null,t}K(t,e);var n=t.prototype;return n.buffer=function(){return this._buffer},n.validate=function(){return!!this.buffer},X(t,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(e){e instanceof ArrayBuffer?this._buffer=e:this._buffer=e.buffer}}]),t}(Rf)).prototype,"_nativeAsset",[Z_],Object.getOwnPropertyDescriptor(Mw.prototype,"_nativeAsset"),Mw.prototype),Nw=Mw))||Nw);i.BufferAsset=Fw;var zw=((Bw={})[Sa.UNORM]="Uint",Bw[Sa.SNORM]="Int",Bw[Sa.UINT]="Uint",Bw[Sa.INT]="Int",Bw[Sa.UFLOAT]="Float",Bw[Sa.FLOAT]="Float",Bw.default="Uint",Bw);function Uw(e){return""+(zw[e.type]||zw.default)+e.size/e.count*8}function Hw(e,t,n,i,r,o,a){void 0===n&&(n=ya.R32F),void 0===i&&(i=0),void 0===r&&(r=e.byteLength-i),void 0===o&&(o=0),a||(a=new DataView(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)));var s=$s[n];o||(o=s.size);for(var c="set"+Uw(s),l="get"+Uw(s),u=s.size/s.count,h=Math.floor(r/o),_=eS.isLittleEndian,f=0;f<h;++f)for(var d=i+o*f,p=0;p<s.count;++p){var m=d+u*p,g=e[l](m,_);a[c](m,t(g,p,e),_)}return a}var Gw=e("RenderingSubMesh",function(){function e(e,t,n,i,r){void 0===i&&(i=null),void 0===r&&(r=null),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._handle=0,this._attributes=t,this._vertexBuffers=e,this._indexBuffer=i,this._indirectBuffer=r,this._primitiveMode=n,this._iaInfo=new Ms(t,e,i,r),this._handle=Bo.alloc();var o=Ar.alloc();Bo.set(this._handle,Oo.FLAT_BUFFER_ARRAY,o)}var t=e.prototype;return t.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var e=this.mesh,t=0,n=e.struct.primitives[this.subMeshIdx],i=Bo.get(this._handle,Oo.FLAT_BUFFER_ARRAY);n.indexView&&(t=n.indexView.count);for(var r=0;r<n.vertexBundelIndices.length;r++){var o=n.vertexBundelIndices[r],a=e.struct.vertexBundles[o],s=n.indexView?n.indexView.count:a.view.count,c=a.view.stride,l=c*s,u=new Uint8Array(e.data.buffer,a.view.offset,a.view.length),h=Rr.alloc(n.indexView?l:a.view.length),_=No.alloc();No.set(_,Io.STRIDE,c),No.set(_,Io.AMOUNT,s),No.set(_,Io.BUFFER,h),Ar.push(i,_);var f=Rr.getBuffer(h),d=new Uint8Array(f);if(n.indexView){for(var p=e.readIndices(this.subMeshIdx),m=0;m<t;++m)for(var g=m*c,v=p[m]*c,y=0;y<c;++y)d[g+y]=u[v+y];this._flatBuffers.push({stride:c,count:s,buffer:d})}else d.set(e.data.subarray(a.view.offset,a.view.offset+a.view.length)),this._flatBuffers.push({stride:c,count:s,buffer:d})}}},t.destroy=function(){for(var e=0;e<this.vertexBuffers.length;e++)this.vertexBuffers[e].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var t=0;t<this._jointMappedBufferIndices.length;t++)this._jointMappedBuffers[this._jointMappedBufferIndices[t]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null),this._handle&&(dr(Bo.get(this._handle,Oo.FLAT_BUFFER_ARRAY),Ar,No),Bo.free(this._handle),this._handle=0)},t.enableVertexIdChannel=function(e){if(!this._vertexIdChannel){var t=this.vertexBuffers.length,n=this.attributes.length,i=this._allocVertexIdBuffer(e);this._vertexBuffers.push(i),this._attributes.push(new Ds("a_vertexId",ya.R32F,!1,t)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:t,index:n}}},t._allocVertexIdBuffer=function(e){for(var t=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(t),i=0;i<t;++i)n[i]=i+.5;var r=e.createBuffer(new ps(Ta.VERTEX|Ta.TRANSFER_DST,Ca.DEVICE,n.byteLength,n.BYTES_PER_ELEMENT));return r.update(n),r},X(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:yn.ZERO,max:yn.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:yn.ZERO,max:yn.ZERO}};var e=this.mesh,t=this.subMeshIdx,n=e.readAttribute(t,ts.ATTR_POSITION),i=e.readIndices(t),r=new yn,o=new yn,a=this.attributes.find((function(e){return e.name===ts.ATTR_POSITION}));if(a){var s=$s[a.format].count;2===s?(r.set(n[0],n[1],0),o.set(n[0],n[1],0)):(r.set(n[0],n[1],n[2]),o.set(n[0],n[1],n[2]));for(var c=0;c<n.length;c+=s)2===s?(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,o.x=n[c]<o.x?n[c]:o.x,o.y=n[c+1]<o.y?n[c+1]:o.y):(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,r.z=n[c+2]>r.z?n[c+2]:r.z,o.x=n[c]<o.x?n[c]:o.x,o.y=n[c+1]<o.y?n[c+1]:o.y,o.z=n[c+2]<o.z?n[c+2]:o.z)}return this._geometricInfo={positions:n,indices:i,boundingBox:{max:r,min:o}},this._geometricInfo}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var e=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var t=this._jointMappedBuffers=[],n=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var r,o,a=this.mesh.struct,s=a.primitives[this.subMeshIdx];if(!a.jointMaps||void 0===s.jointMapIndex||!a.jointMaps[s.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var c=i.director.root.device,l=0;l<s.vertexBundelIndices.length;l++){var u=a.vertexBundles[s.vertexBundelIndices[l]];o=0,r=ya.UNKNOWN;for(var h=0;h<u.attributes.length;h++){var _=u.attributes[h];if(_.name===ts.ATTR_JOINTS){r=_.format;break}o+=$s[_.format].size}r?function(){var i=new Uint8Array(e.mesh.data.buffer,u.view.offset,u.view.length),h=new DataView(i.slice().buffer),_=a.jointMaps[s.jointMapIndex];Hw(h,(function(e){return _.indexOf(e)}),r,o,u.view.length,u.view.stride,h);var f=c.createBuffer(new ps(Ta.VERTEX|Ta.TRANSFER_DST,Ca.DEVICE,u.view.length,u.view.stride));f.update(h.buffer),t.push(f),n.push(l)}():t.push(this.vertexBuffers[s.vertexBundelIndices[l]])}return this._vertexIdChannel&&t.push(this._allocVertexIdBuffer(c)),t}},{key:"iaInfo",get:function(){return this._iaInfo}},{key:"handle",get:function(){return this._handle}}]),e}()),kw=new Array(16),Vw=null,Ww=new zn,jw=[bm.TOUCH_START.toString(),bm.TOUCH_MOVE.toString(),bm.TOUCH_END.toString(),bm.TOUCH_CANCEL.toString()],qw=[bm.MOUSE_DOWN.toString(),bm.MOUSE_ENTER.toString(),bm.MOUSE_MOVE.toString(),bm.MOUSE_LEAVE.toString(),bm.MOUSE_UP.toString(),bm.MOUSE_WHEEL.toString()];function Xw(e,t){var n=this.owner;return!(!n||!n._uiProps.uiTransformComp||(e.getUILocation(Ww),!n._uiProps.uiTransformComp.isHit(Ww,this)||(t.type=bm.TOUCH_START.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t),0)))}function Yw(e,t){var n=this.owner;return!(!n||!n._uiProps.uiTransformComp||(t.type=bm.TOUCH_MOVE.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t),0))}function Kw(e,t){var n=this.owner;n&&n._uiProps.uiTransformComp&&(e.getUILocation(Ww),n._uiProps.uiTransformComp.isHit(Ww,this)?t.type=bm.TOUCH_END.toString():t.type=bm.TOUCH_CANCEL.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t))}function Zw(e,t){var n=this.owner;n&&n._uiProps.uiTransformComp&&(t.type=bm.TOUCH_CANCEL.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t))}function Qw(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(Ww=e.getUILocation(),t._uiProps.uiTransformComp.isHit(Ww,this)&&(e.type=bm.MOUSE_DOWN.toString(),e.bubbles=!0,t.dispatchEvent(e)))}function Jw(e){var t=this.owner;if(t&&t._uiProps.uiTransformComp){if(Ww=e.getUILocation(),t._uiProps.uiTransformComp.isHit(Ww,this))this._previousIn||(Vw&&Vw.eventProcessor.mouseListener&&(e.type=bm.MOUSE_LEAVE,Vw.dispatchEvent(e),Vw.eventProcessor.mouseListener&&(Vw.eventProcessor.mouseListener._previousIn=!1)),Vw=t,e.type=bm.MOUSE_ENTER.toString(),t.dispatchEvent(e),this._previousIn=!0),e.type=bm.MOUSE_MOVE.toString(),e.bubbles=!0,t.dispatchEvent(e);else{if(!this._previousIn)return;e.type=bm.MOUSE_LEAVE.toString(),t.dispatchEvent(e),this._previousIn=!1,Vw=null}e.propagationStopped=!0}}function $w(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(Ww=e.getUILocation(),t._uiProps.uiTransformComp.isHit(Ww,this)&&(e.type=bm.MOUSE_UP.toString(),e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0))}function eR(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(Ww=e.getUILocation(),t._uiProps.uiTransformComp.isHit(Ww,this)&&(e.type=bm.MOUSE_WHEEL.toString(),e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0))}function tR(e,t){if(t){for(var n=0,i=[],r=e;r&&Vv.isNode(r);r=r.parent,++n){var o=r.getComponent(t);if(o){var a={index:n,comp:o};i?i.push(a):i=[a]}}return i.length>0?i:null}return null}function nR(e,t){if(!e._persistNode){if(e.eventProcessor.bubblingTargets)for(var n=0;n<t.length;++n)if(e.eventProcessor.bubblingTargets.hasEventListener(t[n]))return!0;if(e.eventProcessor.capturingTargets)for(var i=0;i<t.length;++i)if(e.eventProcessor.capturingTargets.hasEventListener(t[i]))return!0;return!1}return!0}var iR,rR=function(){function e(e){this.bubblingTargets=null,this.capturingTargets=null,this.touchListener=null,this.mouseListener=null,this._node=void 0,this._node=e}var t=e.prototype;return t.reattach=function(){var t;this.node.walk((function(n){t||(t=tR(n,e._comp)),n.eventProcessor.touchListener&&(n.eventProcessor.touchListener.mask=t),n.eventProcessor.mouseListener&&(n.eventProcessor.mouseListener.mask=t)}))},t.destroy=function(){Vw===this._node&&(Vw=null),(this.touchListener||this.mouseListener)&&(zm.removeListeners(this._node),this.touchListener&&(this.touchListener.owner=null,this.touchListener.mask=null,this.touchListener=null),this.mouseListener&&(this.mouseListener.owner=null,this.mouseListener.mask=null,this.mouseListener=null)),this.capturingTargets&&this.capturingTargets.clear(),this.bubblingTargets&&this.bubblingTargets.clear()},t.on=function(e,t,n,i){return this._checknSetupSysEvent(e)?this._onDispatch(e,t,n,i):(this.bubblingTargets||(this.bubblingTargets=new li),this.bubblingTargets.on(e,t,n))},t.once=function(e,t,n,i){var r,o=this;(r=this._checknSetupSysEvent(e)&&i?this.capturingTargets=this.capturingTargets||new li:this.bubblingTargets=this.bubblingTargets||new li).on(e,t,n,!0),r.on(e,(function(){o.off(e,t,n)}),void 0,!0)},t.off=function(e,t,n,i){var r=-1!==jw.indexOf(e),o=!r&&-1!==qw.indexOf(e);r||o?(this._offDispatch(e,t,n,i),r?this.touchListener&&!nR(this._node,jw)&&(zm.removeListener(this.touchListener),this.touchListener=null):o&&this.mouseListener&&!nR(this._node,qw)&&(zm.removeListener(this.mouseListener),this.mouseListener=null)):this.bubblingTargets&&this.bubblingTargets.off(e,t,n)},t.emit=function(e,t,n,i,r,o){this.bubblingTargets&&this.bubblingTargets.emit(e,t,n,i,r,o)},t.dispatchEvent=function(e){!function(e,t){var n,i=0;for(t.target=e,kw.length=0,e.eventProcessor.getCapturingTargets(t.type,kw),t.eventPhase=1,i=kw.length-1;i>=0;--i)if((n=kw[i]).eventProcessor.capturingTargets&&(t.currentTarget=n,n.eventProcessor.capturingTargets.emit(t.type,t,kw),t.propagationStopped))return void(kw.length=0);if(kw.length=0,t.eventPhase=2,t.currentTarget=e,e.eventProcessor.capturingTargets&&e.eventProcessor.capturingTargets.emit(t.type,t),!t.propagationImmediateStopped&&e.eventProcessor.bubblingTargets&&e.eventProcessor.bubblingTargets.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(e.eventProcessor.getBubblingTargets(t.type,kw),t.eventPhase=3,i=0;i<kw.length;++i)if((n=kw[i]).eventProcessor.bubblingTargets&&(t.currentTarget=n,n.eventProcessor.bubblingTargets.emit(t.type,t),t.propagationStopped))return void(kw.length=0);kw.length=0}(this._node,e),kw.length=0},t.hasEventListener=function(e,t,n){var i=!1;return this.bubblingTargets&&(i=this.bubblingTargets.hasEventListener(e,t,n)),!i&&this.capturingTargets&&(i=this.capturingTargets.hasEventListener(e,t,n)),i},t.targetOff=function(e){this.capturingTargets&&this.capturingTargets.removeAll(e),this.bubblingTargets&&this.bubblingTargets.removeAll(e),this.touchListener&&!nR(this.node,jw)&&(zm.removeListener(this.touchListener),this.touchListener=null),this.mouseListener&&!nR(this.node,qw)&&(zm.removeListener(this.mouseListener),this.mouseListener=null)},t.getCapturingTargets=function(e,t){for(var n=this._node.parent;n;)n.eventProcessor.capturingTargets&&n.eventProcessor.capturingTargets.hasEventListener(e)&&t.push(n),n=n.parent},t.getBubblingTargets=function(e,t){for(var n=this._node.parent;n;)n.eventProcessor.bubblingTargets&&n.eventProcessor.bubblingTargets.hasEventListener(e)&&t.push(n),n=n.parent},t._checknSetupSysEvent=function(t){var n=this,r=!1,o=!1;return-1!==jw.indexOf(t)?(this.touchListener||(this.touchListener=i.EventListener.create({event:i.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this._node,mask:tR(this._node,e._comp),onTouchBegan:Xw,onTouchMoved:Yw,onTouchEnded:Kw,onTouchCancelled:Zw}),zm.addListener(this.touchListener,this._node),r=!0),o=!0):-1!==qw.indexOf(t)&&(this.mouseListener||(this.mouseListener=i.EventListener.create({event:i.EventListener.MOUSE,_previousIn:!1,owner:this._node,mask:tR(this._node,e._comp),onMouseDown:Qw,onMouseMove:Jw,onMouseUp:$w,onMouseScroll:eR}),zm.addListener(this.mouseListener,this._node),r=!0),o=!0),r&&!this._node.activeInHierarchy&&i.director.getScheduler().schedule((function(){n._node.activeInHierarchy||zm.pauseTarget(n._node)}),this._node,0,0,0,!1),o},t._onDispatch=function(e,t,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,t){var r=null;return(r=i?this.capturingTargets=this.capturingTargets||new li:this.bubblingTargets=this.bubblingTargets||new li).hasEventListener(e,t,n)||r.on(e,t,n),t}b(6800)},t._offDispatch=function(e,t,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,t){var r=i?this.capturingTargets:this.bubblingTargets;r&&r.off(e,t,n)}else this.capturingTargets&&this.capturingTargets.removeAll(e),this.bubblingTargets&&this.bubblingTargets.removeAll(e)},X(e,[{key:"node",get:function(){return this._node}}]),e}();rR._comp=null,i.NodeEventProcessor=rR,F(ug.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),F(Vv.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(e){this._uiProps.uiTransformComp.width=e}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(e){this._uiProps.uiTransformComp.height=e}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(e){this._uiProps.uiTransformComp.anchorX=e}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(e){this._uiProps.uiTransformComp.anchorY=e}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new zn),e.set(this._uiProps.uiTransformComp.anchorPoint),e}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){this._uiProps.uiTransformComp.setAnchorPoint(e,t)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new jn),e.set(this._uiProps.uiTransformComp.contentSize),e}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){"number"==typeof e?this._uiProps.uiTransformComp.setContentSize(e,t):this._uiProps.uiTransformComp.setContentSize(e)}}]),z(Vv.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),z(Ru,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),F(Ru,"Layers",[{name:"Default",newName:"DEFAULT",target:Ru.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:Ru.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:Ru.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:Ru.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:Ru.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:Ru.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:Ru.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:Ru.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:Ru,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:Ru,targetName:"Layers"}]),z(Ru.Enum,"Layers.Enum",[{name:"ALWAYS"}]),z(Ru.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var oR,aR,sR,cR,lR,uR,hR,_R,fR,dR,pR,mR,gR,vR,yR,SR,ER,TR,xR,AR,CR,bR,wR,RR,IR,PR,OR,DR,NR,MR,LR,BR,FR,zR,UR,HR,GR,kR,VR,WR,jR,qR,XR,YR,KR,ZR,QR,JR,$R,eI,tI,nI,iI,rI,oI,aI,sI,cI,lI,uI,hI,_I,fI,dI,pI,mI,gI,vI,yI,SI,EI,TI,xI,AI,CI,bI,wI,RI,II,PI,OI,DI,NI,MI,LI,BI,FI,zI,UI,HI,GI,kI,VI,WI,jI,qI,XI,YI,KI,ZI,QI,JI,$I,eP,tP,nP,iP,rP,oP,aP,sP,cP,lP,uP,hP,_P,fP,dP,pP,mP=ei.Flags.HideInHierarchy,gP=ei.Flags.DontSave,vP=e("PrivateNode",S_("cc.PrivateNode")(iR=function(e){function t(t){var n;return A(12003,(n=e.call(this,t)||this).name),n.hideFlags|=gP|mP,n}return K(t,e),t}(Vv))||iR);i.PrivateNode=vP;var yP=new yn(0,1,0),SP=new yn,EP=new bn,TP=(oR=S_("cc.AmbientInfo"),aR=K_(Ct),oR((_R=function(){function e(){ee(this,"_skyColor",lR,this),ee(this,"_skyIllum",uR,this),ee(this,"_groundAlbedo",hR,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this)},X(e,[{key:"skyColor",get:function(){return this._skyColor},set:function(e){this._skyColor.set(e),this._resource&&(this._resource.skyColor=this._skyColor)}},{key:"skyIllum",get:function(){return this._skyIllum},set:function(e){this._skyIllum=e,this._resource&&(this._resource.skyIllum=this.skyIllum)}},{key:"groundAlbedo",get:function(){return this._groundAlbedo},set:function(e){this._groundAlbedo.set(e),this._resource&&(this._resource.groundAlbedo=this._groundAlbedo)}}]),e}(),lR=te((cR=_R).prototype,"_skyColor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn(51,128,204,1)}}),uR=te(cR.prototype,"_skyIllum",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Xo.SKY_ILLUM}}),hR=te(cR.prototype,"_groundAlbedo",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn(51,51,51,255)}}),te(cR.prototype,"skyColor",[N_],Object.getOwnPropertyDescriptor(cR.prototype,"skyColor"),cR.prototype),te(cR.prototype,"skyIllum",[N_,aR],Object.getOwnPropertyDescriptor(cR.prototype,"skyIllum"),cR.prototype),te(cR.prototype,"groundAlbedo",[N_],Object.getOwnPropertyDescriptor(cR.prototype,"groundAlbedo"),cR.prototype),sR=cR))||sR);i.AmbientInfo=TP;var xP=(fR=S_("cc.SkyboxInfo"),dR=K_(pp),pR=K_(pp),fR((TR=function(){function e(){ee(this,"_envmap",vR,this),ee(this,"_isRGBE",yR,this),ee(this,"_enabled",SR,this),ee(this,"_useIBL",ER,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},X(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=this._enabled))}},{key:"useIBL",get:function(){return this._useIBL},set:function(e){this._useIBL=e,this._resource&&(this._resource.useIBL=this._useIBL)}},{key:"envmap",get:function(){return this._envmap},set:function(e){this._envmap=e,this._resource&&(this._resource.envmap=this._envmap)}},{key:"isRGBE",get:function(){return this._isRGBE},set:function(e){this._isRGBE=e,this._resource&&(this._resource.isRGBE=this._isRGBE)}}]),e}(),vR=te((gR=TR).prototype,"_envmap",[dR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yR=te(gR.prototype,"_isRGBE",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),SR=te(gR.prototype,"_enabled",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ER=te(gR.prototype,"_useIBL",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),te(gR.prototype,"enabled",[N_],Object.getOwnPropertyDescriptor(gR.prototype,"enabled"),gR.prototype),te(gR.prototype,"useIBL",[N_],Object.getOwnPropertyDescriptor(gR.prototype,"useIBL"),gR.prototype),te(gR.prototype,"envmap",[N_,pR],Object.getOwnPropertyDescriptor(gR.prototype,"envmap"),gR.prototype),te(gR.prototype,"isRGBE",[N_],Object.getOwnPropertyDescriptor(gR.prototype,"isRGBE"),gR.prototype),mR=gR))||mR);i.SkyboxInfo=xP;var AP=(xR=S_("cc.FogInfo"),AR=K_(TE),CR=M_(),bR=K_(Ct),wR=F_(),RR=H_(),IR=k_(),PR=M_(),OR=K_(Ct),DR=H_(),NR=k_(),MR=M_(),LR=K_(Ct),BR=H_(),FR=k_(),zR=M_(),UR=K_(Ct),HR=z_(),GR=H_(),kR=k_(),VR=M_(),WR=K_(Ct),jR=H_(),qR=k_(),XR=M_(),YR=K_(Ct),KR=H_(),ZR=k_(),xR((lI=cI=function(){function e(){ee(this,"_type",$R,this),ee(this,"_fogColor",eI,this),ee(this,"_enabled",tI,this),ee(this,"_fogDensity",nI,this),ee(this,"_fogStart",iI,this),ee(this,"_fogEnd",rI,this),ee(this,"_fogAtten",oI,this),ee(this,"_fogTop",aI,this),ee(this,"_fogRange",sI,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},X(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))}},{key:"fogColor",get:function(){return this._fogColor},set:function(e){this._fogColor.set(e),this._resource&&(this._resource.fogColor=this._fogColor)}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._resource&&(this._resource.type=e)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(e){this._fogDensity=e,this._resource&&(this._resource.fogDensity=e)}},{key:"fogStart",get:function(){return this._fogStart},set:function(e){this._fogStart=e,this._resource&&(this._resource.fogStart=e)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(e){this._fogEnd=e,this._resource&&(this._resource.fogEnd=e)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(e){this._fogAtten=e,this._resource&&(this._resource.fogAtten=e)}},{key:"fogTop",get:function(){return this._fogTop},set:function(e){this._fogTop=e,this._resource&&(this._resource.fogTop=e)}},{key:"fogRange",get:function(){return this._fogRange},set:function(e){this._fogRange=e,this._resource&&(this._resource.fogRange=e)}}]),e}(),cI.FogType=TE,$R=te((JR=lI).prototype,"_type",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return TE.LINEAR}}),eI=te(JR.prototype,"_fogColor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn("#C8C8C8")}}),tI=te(JR.prototype,"_enabled",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nI=te(JR.prototype,"_fogDensity",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),iI=te(JR.prototype,"_fogStart",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),rI=te(JR.prototype,"_fogEnd",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),oI=te(JR.prototype,"_fogAtten",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),aI=te(JR.prototype,"_fogTop",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),sI=te(JR.prototype,"_fogRange",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),te(JR.prototype,"enabled",[N_],Object.getOwnPropertyDescriptor(JR.prototype,"enabled"),JR.prototype),te(JR.prototype,"fogColor",[N_],Object.getOwnPropertyDescriptor(JR.prototype,"fogColor"),JR.prototype),te(JR.prototype,"type",[N_,AR],Object.getOwnPropertyDescriptor(JR.prototype,"type"),JR.prototype),te(JR.prototype,"fogDensity",[CR,bR,wR,RR,G_,IR],Object.getOwnPropertyDescriptor(JR.prototype,"fogDensity"),JR.prototype),te(JR.prototype,"fogStart",[PR,OR,DR,NR],Object.getOwnPropertyDescriptor(JR.prototype,"fogStart"),JR.prototype),te(JR.prototype,"fogEnd",[MR,LR,BR,FR],Object.getOwnPropertyDescriptor(JR.prototype,"fogEnd"),JR.prototype),te(JR.prototype,"fogAtten",[zR,UR,HR,GR,kR],Object.getOwnPropertyDescriptor(JR.prototype,"fogAtten"),JR.prototype),te(JR.prototype,"fogTop",[VR,WR,jR,qR],Object.getOwnPropertyDescriptor(JR.prototype,"fogTop"),JR.prototype),te(JR.prototype,"fogRange",[XR,YR,KR,ZR],Object.getOwnPropertyDescriptor(JR.prototype,"fogRange"),JR.prototype),QR=JR))||QR),CP=(uI=S_("cc.ShadowsInfo"),hI=K_(JS),_I=M_(),fI=K_(Ct),dI=M_(),pI=K_($S),mI=M_(),gI=K_(At),vI=M_(),yI=K_(Ct),SI=M_(),EI=K_(bt),TI=M_(),xI=K_(bt),AI=M_(),CI=K_(bt),bI=M_(),wI=K_(Ct),RI=M_(),II=K_(bt),PI=M_(),OI=K_(Ct),DI=M_(),NI=K_(Ct),MI=M_(),LI=K_(Ct),BI=M_(),FI=M_(),zI=K_(Ct),UI=M_(),uI((aP=function(){function e(){ee(this,"_type",kI,this),ee(this,"_enabled",VI,this),ee(this,"_normal",WI,this),ee(this,"_distance",jI,this),ee(this,"_shadowColor",qI,this),ee(this,"_autoAdapt",XI,this),ee(this,"_pcf",YI,this),ee(this,"_bias",KI,this),ee(this,"_packing",ZI,this),ee(this,"_linear",QI,this),ee(this,"_selfShadow",JI,this),ee(this,"_normalBias",$I,this),ee(this,"_near",eP,this),ee(this,"_far",tP,this),ee(this,"_aspect",nP,this),ee(this,"_orthoSize",iP,this),ee(this,"_maxReceived",rP,this),ee(this,"_size",oP,this),this._resource=null}var t=e.prototype;return t.setPlaneFromNode=function(e){e.getWorldRotation(EP),this.normal=yn.transformQuat(SP,yP,EP),e.getWorldPosition(SP),this.distance=yn.dot(this._normal,SP)},t.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},X(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._resource&&(this._resource.type=e)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(e){this._shadowColor.set(e),this._resource&&(this._resource.shadowColor=e)}},{key:"normal",get:function(){return this._normal},set:function(e){yn.copy(this._normal,e),this._resource&&(this._resource.normal=e)}},{key:"distance",get:function(){return this._distance},set:function(e){this._distance=e,this._resource&&(this._resource.distance=e)}},{key:"pcf",get:function(){return this._pcf},set:function(e){this._pcf=e,this._resource&&(this._resource.pcf=e)}},{key:"maxReceived",get:function(){return this._maxReceived},set:function(e){this._maxReceived=e,this._resource&&(this._resource.maxReceived=e)}},{key:"bias",get:function(){return this._bias},set:function(e){this._bias=e,this._resource&&(this._resource.bias=e)}},{key:"packing",get:function(){return this._packing},set:function(e){this._packing=e,e&&(this._linear=!this._linear&&this._linear,this._resource&&(this._resource.linear=this._linear)),this._resource&&(this._resource.packing=e,this._resource.shadowMapDirty=!0)}},{key:"linear",get:function(){return this._linear},set:function(e){this._linear=e,e&&(this._packing=!this._packing&&this._packing,this._resource&&(this._resource.packing=this._packing)),this._resource&&(this._resource.linear=e)}},{key:"selfShadow",get:function(){return this._selfShadow},set:function(e){this._selfShadow=e,this._resource&&(this._resource.selfShadow=e)}},{key:"normalBias",get:function(){return this._normalBias},set:function(e){this._normalBias=e,this._resource&&(this._resource.normalBias=e)}},{key:"autoAdapt",get:function(){return this._autoAdapt},set:function(e){this._autoAdapt=e,this._resource&&(this._resource.autoAdapt=e)}},{key:"near",get:function(){return this._near},set:function(e){this._near=e,this._resource&&(this._resource.near=e)}},{key:"far",get:function(){return this._far},set:function(e){this._far=e,this._resource&&(this._resource.far=e)}},{key:"orthoSize",get:function(){return this._orthoSize},set:function(e){this._orthoSize=e,this._resource&&(this._resource.orthoSize=e)}},{key:"shadowMapSize",get:function(){return this._size},set:function(e){this._size.set(e),this._resource&&(this._resource.size=e,this._resource.shadowMapDirty=!0)}},{key:"aspect",get:function(){return this._aspect},set:function(e){this._aspect=e,this._resource&&(this._resource.aspect=e)}}]),e}(),kI=te((GI=aP).prototype,"_type",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return JS.Planar}}),VI=te(GI.prototype,"_enabled",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),WI=te(GI.prototype,"_normal",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new yn(0,1,0)}}),jI=te(GI.prototype,"_distance",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qI=te(GI.prototype,"_shadowColor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn(0,0,0,76)}}),XI=te(GI.prototype,"_autoAdapt",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),YI=te(GI.prototype,"_pcf",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $S.HARD}}),KI=te(GI.prototype,"_bias",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e-5}}),ZI=te(GI.prototype,"_packing",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),QI=te(GI.prototype,"_linear",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),JI=te(GI.prototype,"_selfShadow",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$I=te(GI.prototype,"_normalBias",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eP=te(GI.prototype,"_near",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),tP=te(GI.prototype,"_far",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),nP=te(GI.prototype,"_aspect",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),iP=te(GI.prototype,"_orthoSize",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),rP=te(GI.prototype,"_maxReceived",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),oP=te(GI.prototype,"_size",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn(512,512)}}),te(GI.prototype,"enabled",[N_],Object.getOwnPropertyDescriptor(GI.prototype,"enabled"),GI.prototype),te(GI.prototype,"type",[N_,hI],Object.getOwnPropertyDescriptor(GI.prototype,"type"),GI.prototype),te(GI.prototype,"shadowColor",[N_],Object.getOwnPropertyDescriptor(GI.prototype,"shadowColor"),GI.prototype),te(GI.prototype,"normal",[_I],Object.getOwnPropertyDescriptor(GI.prototype,"normal"),GI.prototype),te(GI.prototype,"distance",[fI,dI],Object.getOwnPropertyDescriptor(GI.prototype,"distance"),GI.prototype),te(GI.prototype,"pcf",[pI,mI],Object.getOwnPropertyDescriptor(GI.prototype,"pcf"),GI.prototype),te(GI.prototype,"maxReceived",[gI,vI],Object.getOwnPropertyDescriptor(GI.prototype,"maxReceived"),GI.prototype),te(GI.prototype,"bias",[yI,SI],Object.getOwnPropertyDescriptor(GI.prototype,"bias"),GI.prototype),te(GI.prototype,"packing",[EI,TI],Object.getOwnPropertyDescriptor(GI.prototype,"packing"),GI.prototype),te(GI.prototype,"linear",[xI,AI],Object.getOwnPropertyDescriptor(GI.prototype,"linear"),GI.prototype),te(GI.prototype,"selfShadow",[CI,bI],Object.getOwnPropertyDescriptor(GI.prototype,"selfShadow"),GI.prototype),te(GI.prototype,"normalBias",[wI,RI],Object.getOwnPropertyDescriptor(GI.prototype,"normalBias"),GI.prototype),te(GI.prototype,"autoAdapt",[II,PI],Object.getOwnPropertyDescriptor(GI.prototype,"autoAdapt"),GI.prototype),te(GI.prototype,"near",[OI,DI],Object.getOwnPropertyDescriptor(GI.prototype,"near"),GI.prototype),te(GI.prototype,"far",[NI,MI],Object.getOwnPropertyDescriptor(GI.prototype,"far"),GI.prototype),te(GI.prototype,"orthoSize",[LI,BI],Object.getOwnPropertyDescriptor(GI.prototype,"orthoSize"),GI.prototype),te(GI.prototype,"shadowMapSize",[FI],Object.getOwnPropertyDescriptor(GI.prototype,"shadowMapSize"),GI.prototype),te(GI.prototype,"aspect",[zI,UI],Object.getOwnPropertyDescriptor(GI.prototype,"aspect"),GI.prototype),HI=GI))||HI);i.ShadowsInfo=CP;var bP,wP,RP,IP,PP=(sP=S_("cc.SceneGlobals"),cP=K_(xP),sP((pP=function(){function e(){ee(this,"ambient",hP,this),ee(this,"shadows",_P,this),ee(this,"_skybox",fP,this),ee(this,"fog",dP,this)}return e.prototype.activate=function(){var e=i.director.root.pipeline.pipelineSceneData;this.ambient.activate(e.ambient),this.skybox.activate(e.skybox),this.shadows.activate(e.shadows),this.fog.activate(e.fog)},X(e,[{key:"skybox",get:function(){return this._skybox},set:function(e){this._skybox=e}}]),e}(),hP=te((uP=pP).prototype,"ambient",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new TP}}),_P=te(uP.prototype,"shadows",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new CP}}),fP=te(uP.prototype,"_skybox",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new xP}}),dP=te(uP.prototype,"fog",[N_,C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new AP}}),te(uP.prototype,"skybox",[N_,cP],Object.getOwnPropertyDescriptor(uP.prototype,"skybox"),uP.prototype),lP=uP))||lP);i.SceneGlobals=PP;var OP=e("Scene",S_("cc.Scene")((te((wP=function(e){K(n,e);var t=n.prototype;function n(t){var n;return ee(n=e.call(this,t)||this,"autoReleaseAssets",RP,Q(n)),ee(n,"_globals",IP,Q(n)),n._renderScene=null,n.dependAssets=null,n._inited=void 0,n._prefabSyncedInLiveReload=!1,n._pos=yn.ZERO,n._rot=bn.IDENTITY,n._scale=yn.ONE,n._mat=Mn.IDENTITY,n._dirtyFlags=0,n._activeInHierarchy=!1,i.director&&i.director.root&&(n._renderScene=i.director.root.createScene({})),n._inited=!i.game||!i.game._isCloning,n}return t._updateScene=function(){this._scene=this},t.destroy=function(){var e=ei.prototype.destroy.call(this);if(e)for(var t=this._children,n=0;n<t.length;++n)t[n].active=!1;return i.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,e},t.addComponent=function(){throw new Error(P(3822))},t._onHierarchyChanged=function(){},t._onBatchCreated=function(t){e.prototype._onBatchCreated.call(this,t);for(var n=this._children.length,i=0;i<n;++i)this.children[i]._siblingIndex=i,this._children[i]._onBatchCreated(t);vg(this)},t.getPosition=function(e){return yn.copy(e||new yn,yn.ZERO)},t.getRotation=function(e){return bn.copy(e||new bn,bn.IDENTITY)},t.getScale=function(e){return yn.copy(e||new yn,yn.ONE)},t.getWorldPosition=function(e){return yn.copy(e||new yn,yn.ZERO)},t.getWorldRotation=function(e){return bn.copy(e||new bn,bn.IDENTITY)},t.getWorldScale=function(e){return yn.copy(e||new yn,yn.ONE)},t.getWorldMatrix=function(e){return Mn.copy(e||new Mn,Mn.IDENTITY)},t.getWorldRS=function(e){return Mn.copy(e||new Mn,Mn.IDENTITY)},t.getWorldRT=function(e){return Mn.copy(e||new Mn,Mn.IDENTITY)},t.updateWorldTransform=function(){},t._instantiate=function(){},t._load=function(){this._inited||(this._onBatchCreated(false),this._inited=!0),this.walk(ug._setScene)},t._activate=function(e){e=!1!==e,i.director._nodeActivator.activateNode(this,e),this._globals.activate()},X(n,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}},{key:"position",get:function(){return yn.ZERO}},{key:"worldPosition",get:function(){return yn.ZERO}},{key:"rotation",get:function(){return bn.IDENTITY}},{key:"worldRotation",get:function(){return bn.IDENTITY}},{key:"scale",get:function(){return yn.ONE}},{key:"worldScale",get:function(){return yn.ONE}},{key:"eulerAngles",get:function(){return yn.ZERO}},{key:"worldMatrix",get:function(){return Mn.IDENTITY}}]),n}(ug)).prototype,"globals",[N_],Object.getOwnPropertyDescriptor(wP.prototype,"globals"),wP.prototype),RP=te(wP.prototype,"autoReleaseAssets",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),IP=te(wP.prototype,"_globals",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new PP}}),bP=wP))||bP);function DP(e,t){if(!t){var n=i.director.getScene();if(!n)return null;t=n}return t.getChildByPath(e)}i.Scene=OP,i.find=DP;var NP=Ye.fastRemoveAt,MP=ei.Flags.IsStartCalled,LP=ei.Flags.IsOnEnableCalled;function BP(e,t){for(var n=t.constructor._executionOrder,i=t._id,r=0,o=e.length-1,a=o>>>1;r<=o;a=r+o>>>1){var s=e[a],c=s.constructor._executionOrder;if(c>n)o=a-1;else if(c<n)r=a+1;else{var l=s._id;if(l>i)o=a-1;else{if(!(l<i))return a;r=a+1}}}return~r}function FP(e,t){for(var n=e.array,i=e.i+1;i<n.length;){var r=n[i];r.node._activeInHierarchy?++i:(e.removeAt(i),t&&(r._objFlags&=~t))}}ei.Flags.IsEditorOnEnableCalled;var zP=function(e){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var t=ne;this._zero=new t([]),this._neg=new t([]),this._pos=new t([]),this._invoke=e};function UP(e,t){return e.constructor._executionOrder-t.constructor._executionOrder}zP.stableRemoveInactive=FP;var HP=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.add=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).array.push(e)},n.remove=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).fastRemove(e)},n.cancelInactive=function(e){FP(this._zero,e),FP(this._neg,e),FP(this._pos,e)},n.invoke=function(){var e=this._neg;e.array.length>0&&(e.array.sort(UP),this._invoke(e),e.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var t=this._pos;t.array.length>0&&(t.array.sort(UP),this._invoke(t),t.array.length=0)},t}(zP),GP=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.add=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.array.push(e);else{var n=t<0?this._neg.array:this._pos.array,i=BP(n,e);i<0&&n.splice(~i,0,e)}},n.remove=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.fastRemove(e);else{var n=t<0?this._neg:this._pos,i=BP(n.array,e);i>=0&&n.removeAt(i)}},n.invoke=function(e){this._neg.array.length>0&&this._invoke(this._neg,e),this._invoke(this._zero,e),this._pos.array.length>0&&this._invoke(this._pos,e)},t}(zP);function kP(e,t,n){var r="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+e+"}",o=t?Function("it","dt",r):Function("it",r);return function(e,t,n){return function(r,o){try{t(r,o)}catch(t){i._throw(t);var a=r.array;for(n&&(a[r.i]._objFlags|=n),++r.i;r.i<a.length;++r.i)try{e(a[r.i],o)}catch(e){i._throw(e),n&&(a[r.i]._objFlags|=n)}}}}(Function("c","dt",e),o,n)}var VP=kP("c.start();c._objFlags|="+MP,!1,MP),WP=kP("c.update(dt)",!0),jP=kP("c.lateUpdate(dt)",!0),qP=function(e){var t=i.director._compScheduler,n=e.array;for(e.i=0;e.i<n.length;++e.i){var r=n[e.i];r._enabled&&(r.onEnable(),!r.node._activeInHierarchy||t._onEnabled(r))}},XP=function(){function e(){this._deferredComps=[],this.unscheduleAll()}var t=e.prototype;return t.unscheduleAll=function(){this.startInvoker=new HP(VP),this.updateInvoker=new GP(WP),this.lateUpdateInvoker=new GP(jP),this._updating=!1},t._onEnabled=function(e){i.director.getScheduler().resumeTarget(e),e._objFlags|=LP,this._updating?this._deferredComps.push(e):this._scheduleImmediate(e)},t._onDisabled=function(e){i.director.getScheduler().pauseTarget(e),e._objFlags&=~LP;var t=this._deferredComps.indexOf(e);t>=0?NP(this._deferredComps,t):(!e.start||e._objFlags&MP||this.startInvoker.remove(e),e.update&&this.updateInvoker.remove(e),e.lateUpdate&&this.lateUpdateInvoker.remove(e))},t.enableComp=function(e,t){if(!(e._objFlags&LP)){if(e.onEnable){if(t)return void t.add(e);if(e.onEnable(),!e.node._activeInHierarchy)return}this._onEnabled(e)}},t.disableComp=function(e){e._objFlags&LP&&(e.onDisable&&e.onDisable(),this._onDisabled(e))},t.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},t.updatePhase=function(e){this.updateInvoker.invoke(e)},t.lateUpdatePhase=function(e){this.lateUpdateInvoker.invoke(e),this._updating=!1,this._startForNewComps()},t._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},t._scheduleImmediate=function(e){"function"!=typeof e.start||e._objFlags&MP||this.startInvoker.add(e),"function"==typeof e.update&&this.updateInvoker.add(e),"function"==typeof e.lateUpdate&&this.lateUpdateInvoker.add(e)},t._deferredSchedule=function(){for(var e=this._deferredComps,t=0,n=e.length;t<n;t++)this._scheduleImmediate(e[t]);e.length=0},e}(),YP=ei.Flags.IsPreloadStarted,KP=ei.Flags.IsOnLoadStarted,ZP=ei.Flags.IsOnLoadCalled,QP=ei.Flags.Deactivating,JP=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.add=function(e){this._zero.array.push(e)},n.remove=function(e){this._zero.fastRemove(e)},n.cancelInactive=function(e){zP.stableRemoveInactive(this._zero,e)},n.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},t}(zP),$P=kP("c.__preload();"),eO=kP("c.onLoad();c._objFlags|="+ZP,!1,ZP),tO=new Xe(4);function nO(e,t,n){t?e._removeComponent(t):Ye.removeAt(e._components,n)}tO.get=function(){var e=this._get()||{preload:new JP($P),onLoad:new HP(eO),onEnable:new HP(qP)};e.preload._zero.i=-1;var t=e.onLoad;return t._zero.i=-1,t._neg.i=-1,t._pos.i=-1,(t=e.onEnable)._zero.i=-1,t._neg.i=-1,t._pos.i=-1,e};var iO,rO,oO,aO,sO,cO,lO,uO,hO=e("NodeActivator",function(){function e(){this.resetComp=void 0,this.reset()}var t=e.prototype;return t.reset=function(){this._activatingStack=[]},t.activateNode=function(e,t){if(t){var n=tO.get();this._activatingStack.push(n),this._activateNodeRecursively(e,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),tO.put(n)}else{this._deactivateNodeRecursively(e);for(var i,r=$(this._activatingStack);!(i=r()).done;){var o=i.value;o.preload.cancelInactive(YP),o.onLoad.cancelInactive(KP),o.onEnable.cancelInactive()}}e.emit("active-in-hierarchy-changed",e)},t.activateComp=function(e,t,n,r){if(ni(e,!0)&&(e._objFlags&YP||(e._objFlags|=YP,e.__preload&&(t?t.add(e):e.__preload())),e._objFlags&KP||(e._objFlags|=KP,e.onLoad?n?n.add(e):(e.onLoad(),e._objFlags|=ZP):e._objFlags|=ZP),e._enabled)){if(!e.node._activeInHierarchy)return;i.director._compScheduler.enableComp(e,r)}},t.destroyComp=function(e){i.director._compScheduler.disableComp(e),e.onDestroy&&e._objFlags&ZP&&e.onDestroy()},t._activateNodeRecursively=function(e,t,n,r){if(e._objFlags&QP)b(3816,e.name);else{e._activeInHierarchy=!0;for(var o=e._components.length,a=0;a<o;++a){var s=e._components[a];s instanceof i.Component?this.activateComp(s,t,n,r):(nO(e,s,a),--a,--o)}e._childArrivalOrder=e._children.length;for(var c=0,l=e._children.length;c<l;++c){var u=e._children[c];u._active&&this._activateNodeRecursively(u,t,n,r)}e._onPostActivated(!0)}},t._deactivateNodeRecursively=function(e){e._objFlags|=QP,e._activeInHierarchy=!1;for(var t=e._components.length,n=0;n<t;++n){var r=e._components[n];if(r._enabled&&(i.director._compScheduler.disableComp(r),e._activeInHierarchy))return void(e._objFlags&=~QP)}for(var o=0,a=e._children.length;o<a;++o){var s=e._children[o];if(s._activeInHierarchy&&(this._deactivateNodeRecursively(s),e._activeInHierarchy))return void(e._objFlags&=~QP)}e._onPostActivated(!1),e._objFlags&=~QP},e}()),_O=e("SceneAsset",S_("cc.SceneAsset")((aO=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"scene",oO,Q(t)),t}K(t,e);var n=t.prototype;return n.initDefault=function(t){e.prototype.initDefault.call(this,t),this.scene=new OP("New Scene")},n.validate=function(){return!!this.scene},t}(Rf),oO=te((rO=aO).prototype,"scene",[N_,C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iO=rO))||iO);i.SceneAsset=_O;var fO,dO,pO,mO,gO=e("TextAsset",S_("cc.TextAsset")((uO=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"text",lO,Q(t)),t}return K(t,e),t.prototype.toString=function(){return this.text},t}(Rf),lO=te((cO=uO).prototype,"text",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),sO=cO))||sO);i.TextAsset=gO;var vO=e("JsonAsset",S_("cc.JsonAsset")((mO=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"json",pO,Q(t)),t}return K(t,e),t}(Rf),pO=te((dO=mO).prototype,"json",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fO=dO))||fO);i.JsonAsset=vO;var yO=e("Director",function(e){function t(){var t;return(t=e.call(this)||this)._compScheduler=void 0,t._nodeActivator=void 0,t._invalid=void 0,t._paused=void 0,t._purgeDirectorInNextLoop=void 0,t._root=void 0,t._loadingScene=void 0,t._scene=void 0,t._totalFrames=void 0,t._lastUpdate=void 0,t._deltaTime=void 0,t._startTime=void 0,t._scheduler=void 0,t._systems=void 0,t._invalid=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._root=null,t._loadingScene="",t._scene=null,t._totalFrames=0,t._lastUpdate=0,t._deltaTime=0,t._startTime=0,t._scheduler=new aw,t._compScheduler=new XP,t._nodeActivator=new hO,t._systems=[],i.game.once(zC.EVENT_RENDERER_INITED,t._initOnRendererInitialized,Q(t)),t}K(t,e);var n=t.prototype;return n.calculateDeltaTime=function(e){e||(e=performance.now()),this._deltaTime=e>this._lastUpdate?(e-this._lastUpdate)/1e3:0,this._lastUpdate=e},n.convertToGL=function(e){var t=i.game.container,n=i.view,r=t.getBoundingClientRect(),o=r.left+window.pageXOffset-t.clientLeft,a=r.top+window.pageYOffset-t.clientTop,s=n._devicePixelRatio*(e.x-o),c=n._devicePixelRatio*(a+r.height-e.y);return n._isRotated?Gn(n._viewportRect.width-c,s):Gn(s,c)},n.convertToUI=function(e){var t=i.game.container,n=i.view,r=t.getBoundingClientRect(),o=r.left+window.pageXOffset-t.clientLeft,a=r.top+window.pageYOffset-t.clientTop,s=Gn(0,0);return n._isRotated?(s.x=o+e.y/n._devicePixelRatio,s.y=a+r.height-(n._viewportRect.width-e.x)/n._devicePixelRatio):(s.x=o+e.x*n._devicePixelRatio,s.y=a+r.height-e.y*n._devicePixelRatio),s},n.end=function(){this._purgeDirectorInNextLoop=!0},n.getWinSize=function(){return qn(i.winSize)},n.getWinSizeInPixels=function(){return qn(i.winSize)},n.pause=function(){this._paused||(this._paused=!0)},n.purgeCachedData=function(){i.assetManager.releaseAll()},n.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),zm&&zm.setEnabled(!1),i.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),i.assetManager.releaseAll()},n.reset=function(){this.purgeDirector(),this.emit(t.EVENT_RESET),zm&&zm.setEnabled(!0),this.startAnimation()},n.runSceneImmediate=function(e,t,n){e instanceof _O&&(e=e.scene),I(e instanceof OP,1216),e._load();for(var r=Object.keys(i.game._persistRootNodes).map((function(e){return i.game._persistRootNodes[e]})),o=0;o<r.length;o++){var a=r[o];a.emit(i.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);var s=e.uuid===a._originalSceneId&&e.getChildByUuid(a.uuid);if(s){var c=s.getSiblingIndex();s._destroyImmediate(),e.insertChild(a,c)}else a.parent=e}var l=this._scene;i.isValid(l)&&l.destroy(),i.assetManager._releaseManager._autoRelease(l,e,i.game._persistRootNodes),this._scene=null,ei._deferredDestroy(),t&&t(),this.emit(i.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,e._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),n&&n(null,e),this.emit(i.Director.EVENT_AFTER_SCENE_LAUNCH,e)},n.runScene=function(e,t,n){var r=this;e instanceof _O&&(e=e.scene),I(e,1205),I(e instanceof OP,1216),e._load(),this.once(i.Director.EVENT_AFTER_DRAW,(function(){r.runSceneImmediate(e,t,n)}))},n.loadScene=function(e,t,n){var r=this;if(this._loadingScene)return A(1208,e,this._loadingScene),!1;var o=i.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));return o?(this.emit(i.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time("LoadScene "+e),o.loadScene(e,(function(i,o){console.timeEnd("LoadScene "+e),r._loadingScene="",i?(p(i),t&&t(i)):r.runSceneImmediate(o,n,t)})),!0):(b(1209,e),!1)},n.preloadScene=function(e,t,n){var r=i.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));if(r)r.preloadScene(e,null,t,n);else{var o='Can not preload the scene "'+e+'" because it is not in the build settings.';n&&n(new Error(o)),p("preloadScene: "+o)}},n.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||T(1200),this._paused=!1,this._deltaTime=0)},n.setDepthTest=function(e){i.Camera.main&&(i.Camera.main.depth=!!e)},n.setClearColor=function(e){i.Camera.main&&(i.Camera.main.backgroundColor=e)},n.getRunningScene=function(){return this._scene},n.getScene=function(){return this._scene},n.getAnimationInterval=function(){return 1e3/i.game.getFrameRate()},n.setAnimationInterval=function(e){i.game.setFrameRate(Math.round(1e3/e))},n.getDeltaTime=function(){return this._deltaTime},n.getTotalTime=function(){return performance.now()-this._startTime},n.getCurrentTime=function(){return this._lastUpdate},n.getTotalFrames=function(){return this._totalFrames},n.isPaused=function(){return this._paused},n.getScheduler=function(){return this._scheduler},n.setScheduler=function(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem(aw.ID,e,200))},n.registerSystem=function(e,t,n){t.id=e,t.priority=n,t.init(),this._systems.push(t),this._systems.sort(ew.sortByPriority)},n.unregisterSystem=function(e){Ye.fastRemove(this._systems,e),this._systems.sort(ew.sortByPriority)},n.getSystem=function(e){return this._systems.find((function(t){return t.id===e}))},n.getAnimationManager=function(){return this.getSystem(i.AnimationManager.ID)},n.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},n.stopAnimation=function(){this._invalid=!0},n.mainLoop=function(e){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(e),this.emit(t.EVENT_BEGIN_FRAME);var n=this._deltaTime;if(!this._paused){this.emit(t.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(n);for(var i=0;i<this._systems.length;++i)this._systems[i].update(n);this._compScheduler.lateUpdatePhase(n),this.emit(t.EVENT_AFTER_UPDATE),ei._deferredDestroy();for(var r=0;r<this._systems.length;++r)this._systems[r].postUpdate(n)}this.emit(t.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(t.EVENT_AFTER_DRAW),zm.frameUpdateListeners(),Vv.clearBooks(),this.emit(t.EVENT_END_FRAME),this._totalFrames++}},n._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,zm&&zm.setEnabled(!0),this.registerSystem(aw.ID,this._scheduler,200),this.emit(t.EVENT_INIT)},n._init=function(){return this._root=new cw(i.game._gfxDevice),this._root.initialize({}).catch((function(e){return b(1217),Promise.reject(e)}))},X(t,[{key:"root",get:function(){return this._root}}]),t}(vi));yO.EVENT_INIT="director_init",yO.EVENT_RESET="director_reset",yO.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",yO.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",yO.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",yO.EVENT_BEFORE_UPDATE="director_before_update",yO.EVENT_AFTER_UPDATE="director_after_update",yO.EVENT_BEFORE_DRAW="director_before_draw",yO.EVENT_AFTER_DRAW="director_after_draw",yO.EVENT_BEFORE_COMMIT="director_before_commit",yO.EVENT_BEFORE_PHYSICS="director_before_physics",yO.EVENT_AFTER_PHYSICS="director_after_physics",yO.EVENT_BEGIN_FRAME="director_begin_frame",yO.EVENT_END_FRAME="director_end_frame",yO.instance=void 0,i.Director=yO;var SO=e("director",yO.instance=i.director=new yO),EO=function(){function e(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Q_,this.scenes=new Q_,this.paths=new Q_}var t=e.prototype;return t.init=function(e){!function(e){var t=e.uuids,n=e.paths,i=e.types,r=e.deps,o=e.paths=Object.create(null);if(!1===e.debug){for(var a=0,s=t.length;a<s;a++)t[a]=pf(t[a]);for(var c in n){var l=n[c],u=l[1];l[1]=i[u]}}else{for(var h=Object.create(null),_=0,f=t.length;_<f;_++){var d=t[_];t[_]=h[d]=pf(d)}t=h}for(var p in n){var m=n[p];o[t[p]]=m}var g=e.scenes;for(var v in g){var y=g[v];g[v]=t[y]}var S=e.packs;for(var E in S)for(var T=S[E],x=0;x<T.length;++x)T[x]=t[T[x]];var A=e.versions;if(A)for(var C in A)for(var b=A[C],w=0;w<b.length;w+=2){var R=b[w];b[w]=t[R]||R}var I=e.redirect;if(I)for(var P=0;P<I.length;P+=2)I[P]=t[I[P]],I[P+1]=r[I[P+1]]}(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect)},t.getInfoWithPath=function(e,t){if(!e)return null;e=Sf(e);var n=this.paths.get(e);if(n){if(!t)return n[0];for(var i=0,r=n.length;i<r;i++){var o=n[i];if(Ke.isChildClassOf(o.ctor,t))return o}}return null},t.getDirWithPath=function(e,t,n){"/"===(e=Sf(e))[e.length-1]&&(e=e.slice(0,-1));var i=n||[];return this.paths.forEach((function(n,r){if(r.startsWith(e)&&function(e,t){return!(e.length>t.length)||47===e.charCodeAt(t.length)}(r,e)||!e)for(var o=0,a=n.length;o<a;o++){var s=n[o];t&&!Ke.isChildClassOf(s.ctor,t)||i.push(s)}})),i},t.getAssetInfo=function(e){return this.assetInfos.get(e)||null},t.getSceneInfo=function(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e="/"+e),this.scenes.find((function(t,n){return n.endsWith(e)}))},t.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},t._initUuid=function(e){if(e){this.assetInfos.clear();for(var t=0,n=e.length;t<n;t++){var i=e[t];this.assetInfos.add(i,{uuid:i})}}},t._initPath=function(e){if(e){var t=this.paths;for(var n in t.clear(),e){var i=e[n],r=i[0],o=i[1],a=3===i.length,s=this.assetInfos.get(n);s.path=r,s.ctor=Ke._getClassById(o),t.has(r)?a?t.get(r).push(s):t.get(r).splice(0,0,s):t.add(r,[s])}}},t._initScene=function(e){if(e){var t=this.scenes;t.clear();var n=this.assetInfos;for(var i in e){var r=e[i],o=n.get(r);o.url=i,t.add(i,o)}}},t._initPackage=function(e){if(e){var t=this.assetInfos;for(var n in e){var i=e[n],r={uuid:n,packedUuids:i,ext:".json"};t.add(n,r);for(var o=0,a=i.length;o<a;o++){var s=i[o],c=t.get(s),l=c.packs;l?1===a?l.splice(0,0,r):l.push(r):c.packs=[r]}}}},t._initVersion=function(e){if(e){var t=this.assetInfos,n=e.import;if(n)for(var i=0,r=n.length;i<r;i+=2){var o=n[i];t.get(o).ver=n[i+1]}if(n=e.native)for(var a=0,s=n.length;a<s;a+=2){var c=n[a];t.get(c).nativeVer=n[a+1]}}},t._initRedirect=function(e){if(e)for(var t=this.assetInfos,n=0,i=e.length;n<i;n+=2){var r=e[n];t.get(r).redirect=e[n+1]}},e}();function TO(e,t){e._uuid&&t.push(e._uuid)}function xO(e,t){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var r=n[i];if("node"!==r&&"__eventTargets"!==r){var o=e[r];if("object"==typeof o&&o)if(Array.isArray(o))for(var a=0;a<o.length;a++){var s=o[a];s instanceof Rf&&TO(s,t)}else if(o.constructor&&o.constructor!==Object)o instanceof Rf&&TO(o,t);else for(var c=Object.getOwnPropertyNames(o),l=0;l<c.length;l++){var u=o[c[l]];u instanceof Rf&&TO(u,t)}}}}function AO(e,t){for(var n=0;n<e._components.length;n++)xO(e._components[n],t);for(var i=0;i<e._children.length;i++)AO(e._children[i],t)}function CO(e,t,n,i){n.push(e._uuid);for(var r=Jd.getDeps(e._uuid),o=0,a=r.length;o<a;o++){var s=ef.get(r[o]);if(s){var c=s._uuid;c in t?t[c]+=i:t[c]=s.refCount+i,n.includes(c)||CO(s,t,n,i)}}}var bO=[],wO=new(function(){function e(){this._persistNodeDeps=new Q_,this._toDelete=new Q_,this._eventListener=!1}var t=e.prototype;return t.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},t._addPersistNodeRef=function(e){var t=[];AO(e,t);for(var n=0,i=t.length;n<i;n++){var r=ef.get(t[n]);r&&r.addRef()}this._persistNodeDeps.add(e.uuid,t)},t._removePersistNodeRef=function(e){if(this._persistNodeDeps.has(e.uuid)){for(var t=this._persistNodeDeps.get(e.uuid),n=0,i=t.length;n<i;n++){var r=ef.get(t[n]);r&&r.decRef()}this._persistNodeDeps.remove(e.uuid)}},t._autoRelease=function(e,t,n){if(e){for(var i=Jd.getDeps(e.uuid),r=0,o=i.length;r<o;r++){var a=ef.get(i[r]);a&&a.decRef(e.autoReleaseAssets)}var s=Jd._depends.get(e.uuid);if(s&&s.persistDeps)for(var c=s.persistDeps,l=0,u=c.length;l<u;l++){var h=ef.get(c[l]);h&&h.decRef(e.autoReleaseAssets)}e.uuid!==t.uuid&&Jd.remove(e.uuid)}var _=Jd._depends.get(t.uuid);for(var f in _&&(_.persistDeps=[]),n){for(var d,p,m=n[f],g=this._persistNodeDeps.get(m.uuid),v=$(g);!(p=v()).done;){var y=p.value,S=ef.get(y);S&&S.addRef()}_&&(d=_.persistDeps).push.apply(d,g)}},t.tryRelease=function(e,t){void 0===t&&(t=!1),e instanceof Rf&&(t?this._free(e,t):(this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,_t(this._freeAssets.bind(this)))))},t._freeAssets=function(){var e=this;this._eventListener=!1,this._toDelete.forEach((function(t){e._free(t)})),this._toDelete.clear()},t._free=function(e,t){void 0===t&&(t=!1);var n=e._uuid;if(this._toDelete.remove(n),ni(e,!0)&&!(!t&&e.refCount>0&&function(e){var t=Object.create(null);if(t[e._uuid]=e.refCount,CO(e,t,bO,-1),bO.length=0,0!==t[e._uuid])return t[e._uuid];for(var n in t)0!==t[n]&&CO(ef.get(n),t,bO,1);return bO.length=0,t[e._uuid]}(e)>0)){ef.remove(n);for(var i=Jd.getDeps(n),r=0,o=i.length;r<o;r++){var a=ef.get(i[r]);a&&(a.decRef(!1),this._free(a,!1))}e.destroy(),Jd.remove(n)}},e}()),RO=null;function IO(e,t){for(var n=0,i=e.input.length;n<i;n++){var r=e.input[n];t&&!r.isNative&&r.content instanceof Rf&&r.content.decRef(!1),r.recycle()}e.input=null}function PO(e,t){return t?/\?/.test(e)?e+"&_t="+Date.now():e+"?_t="+Date.now():e}function OO(e,t,n,i,r){void 0===r&&(r=0),e(r,(function(o,a){r++,!o||r>t?i&&i(o,a):setTimeout((function(){OO(e,t,n,i,r)}),n)}))}function DO(e,t,n,i,r){try{for(var o=Jd.parse(e,t),a=0,s=o.deps.length;a<s;a++){var c=o.deps[a];c in n||(n[c]=!0,i.push({uuid:c,bundle:r&&r.name}))}o.nativeDep&&(r&&(o.nativeDep.bundle=r.name),i.push(Y({},o.nativeDep)))}catch(e){p(e.message,e.stack)}}function NO(e,t,n){t&&(n=void 0!==n?n:i.assetManager.cacheAsset,yf(t)||!n||t.isDefault||ef.add(e,t))}function MO(e,t,n){var i=0,r=[],o=e.length;0===o&&n&&n(r);for(var a=function(e){e&&r.push(e),++i===o&&n&&n(r)},s=0;s<o;s++)t(e[s],a)}function LO(e,t,n){var i=e,r=t,o=n;if(void 0===n){var a="function"==typeof e;t?(o=t,a||(r=null)):void 0===t&&a&&(o=e,i=null,r=null),void 0!==t&&a&&(r=e,i=null)}return{options:i||Object.create(null),onProgress:r,onComplete:o}}function BO(e,t,n){var i=e,r=t,o=n;if(void 0===n){var a=Ke.isChildClassOf(e,Rf);t?(o=t,a&&(r=null)):void 0!==t||a||(o=e,r=null,i=null),void 0===t||a||(r=e,i=null)}return{type:i,onProgress:r||RO,onComplete:o}}function FO(e,t,n,i){if(void 0===i&&(i={}),!n[t]||i[t])return!1;i[t]=!0;var r=!1,o=Jd.getDeps(t);if(o)for(var a=0,s=o.length;a<s;a++){var c=o[a];if(c===e||FO(e,c,n,i)){r=!0;break}}return r}function zO(e){return function(t,n){if(e){var i=[];Array.isArray(n)?n.forEach((function(e){return e instanceof Rf&&i.push(e.addRef())})):n instanceof Rf&&i.push(n.addRef()),_t((function(){i.forEach((function(e){return e.decRef(!1)})),e(t,n)}))}}}var UO=function(){function e(){this._config=new EO}var t=e.prototype;return t.getInfoWithPath=function(e,t){return this._config.getInfoWithPath(e,t)},t.getDirWithPath=function(e,t,n){return this._config.getDirWithPath(e,t,n)},t.getAssetInfo=function(e){return this._config.getAssetInfo(e)},t.getSceneInfo=function(e){return this._config.getSceneInfo(e)},t.init=function(e){this._config.init(e),rf.add(e.name,this)},t.load=function(e,t,n,r){var o=BO(t,n,r),a=o.type,s=o.onProgress,c=o.onComplete,l={__requestType__:$_.PATH,type:a,bundle:this.name,__outputAsArray__:Array.isArray(e)};i.assetManager.loadAny(e,l,s,c)},t.preload=function(e,t,n,r){var o=BO(t,n,r),a=o.type,s=o.onProgress,c=o.onComplete;i.assetManager.preloadAny(e,{__requestType__:$_.PATH,type:a,bundle:this.name},s,c)},t.loadDir=function(e,t,n,r){var o=BO(t,n,r),a=o.type,s=o.onProgress,c=o.onComplete;i.assetManager.loadAny(e,{__requestType__:$_.DIR,type:a,bundle:this.name,__outputAsArray__:!0},s,c)},t.preloadDir=function(e,t,n,r){var o=BO(t,n,r),a=o.type,s=o.onProgress,c=o.onComplete;i.assetManager.preloadAny(e,{__requestType__:$_.DIR,type:a,bundle:this.name},s,c)},t.loadScene=function(e,t,n,r){var o=LO(t,n,r),a=o.options,s=o.onProgress,c=o.onComplete;a.preset=a.preset||"scene",a.bundle=this.name,i.assetManager.loadAny({scene:e},a,s,(function(e,t){if(e)p(e.message,e.stack);else if(t instanceof _O&&t.scene){var n=t.scene;n._id=t._uuid,n.name=t.name}else e=new Error("The asset "+t._uuid+" is not a scene");c&&c(e,t)}))},t.preloadScene=function(e,t,n,r){var o=LO(t,n,r),a=o.options,s=o.onProgress,c=o.onComplete;a.bundle=this.name,i.assetManager.preloadAny({scene:e},a,s,(function(t){t&&b(1210,e,t.message),c&&c(t)}))},t.get=function(e,t){var n=this.getInfoWithPath(e,t);return n&&ef.get(n.uuid)||null},t.release=function(e,t){var n=this.get(e,t);n&&wO.tryRelease(n,!0)},t.releaseUnusedAssets=function(){var e=this;ef.forEach((function(t){var n=e.getAssetInfo(t._uuid);n&&!n.redirect&&wO.tryRelease(t)}))},t.releaseAll=function(){var e=this;ef.forEach((function(t){var n=e.getAssetInfo(t._uuid);n&&!n.redirect&&wO.tryRelease(t,!0)}))},t._destroy=function(){this._config.destroy()},X(e,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),e}(),HO=e("resources",new UO);function GO(e,t,n){var i=new Image;function r(){i.removeEventListener("load",r),i.removeEventListener("error",o),n&&n(null,i)}function o(){i.removeEventListener("load",r),i.removeEventListener("error",o),n&&n(new Error(P(4930,e)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.addEventListener("load",r),i.addEventListener("error",o),i.src=e,i}function kO(e,t,n,i){var r=new XMLHttpRequest,o="download failed: "+e+", status: ";if(r.open("GET",e,!0),void 0!==t.xhrResponseType&&(r.responseType=t.xhrResponseType),void 0!==t.xhrWithCredentials&&(r.withCredentials=t.xhrWithCredentials),void 0!==t.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(t.xhrMimeType),void 0!==t.xhrTimeout&&(r.timeout=t.xhrTimeout),t.xhrHeader)for(var a in t.xhrHeader)r.setRequestHeader(a,t.xhrHeader[a]);return r.onload=function(){200===r.status||0===r.status?i&&i(null,r.response):i&&i(new Error(""+o+r.status+"(no response)"))},n&&(r.onprogress=function(e){e.lengthComputable&&n(e.loaded,e.total)}),r.onerror=function(){i&&i(new Error(""+o+r.status+"(error)"))},r.ontimeout=function(){i&&i(new Error(""+o+r.status+"(time out)"))},r.onabort=function(){i&&i(new Error(""+o+r.status+"(abort)"))},r.send(null),r}i.resources=HO;var VO={};function WO(e,t,n){if(VO[e])return n&&n(null),null;var i=document.createElement("script");function r(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",o,!1),VO[e]=!0,n&&n(null)}function o(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",o,!1),n&&n(new Error(P(4928,e)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.async=t.scriptAsyncLoading||!1,i.src=e,i.addEventListener("load",r,!1),i.addEventListener("error",o,!1),document.body.appendChild(i),i}var jO=/^(?:\w+:\/\/|\.+\/).+/,qO=function(e,t,n){(eS.capabilities.imageBitmap&&i.assetManager.allowImageBitmap?XO:GO)(e,t,n)},XO=function(e,t,n){t.xhrResponseType="blob",kO(e,t,t.onFileProgress,n)},YO=function(e,t,n){t.xhrResponseType="json",kO(e,t,t.onFileProgress,n)},KO=function(e,t,n){t.xhrResponseType="arraybuffer",kO(e,t,t.onFileProgress,n)},ZO=function(e,t,n){t.xhrResponseType="text",kO(e,t,t.onFileProgress,n)},QO=function(e,t,n){var i=bi(e),r=e;jO.test(r)||(r=-1!==JO.remoteBundles.indexOf(i)?JO.remoteServerAddress+"remote/"+i:"assets/"+i);var o=t.version||JO.bundleVers[i],a=0,s=null,c=null;YO(r+"/config."+(o?o+".":"")+"json",t,(function(e,t){c=e,(s=t)&&(s.base=r+"/"),2==++a&&n(c,s)})),WO(r+"/index."+(o?o+".":"")+"js",t,(function(e){c=e,2==++a&&n(e,s)}))},JO=new(function(){function e(){this.maxConcurrency=6,this.maxRequestsPerFrame=6,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=GO,this.downloadDomAudio=null,this.downloadFile=kO,this.downloadScript=WO,this._downloaders={".png":qO,".jpg":qO,".bmp":qO,".jpeg":qO,".gif":qO,".ico":qO,".tiff":qO,".webp":qO,".image":qO,".pvr":KO,".pkm":KO,".astc":KO,".txt":ZO,".xml":ZO,".vsh":ZO,".fsh":ZO,".atlas":ZO,".tmx":ZO,".tsx":ZO,".json":YO,".ExportJson":YO,".plist":ZO,".fnt":ZO,".binary":KO,".bin":KO,".dbbin":KO,".skel":KO,".js":WO,bundle:QO,default:ZO},this._downloading=new Q_,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var t=e.prototype;return t.init=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t={}),void 0===n&&(n=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=n},t.register=function(e,t){"object"==typeof e?Oe(this._downloaders,e):this._downloaders[e]=t},t.download=function(e,t,n,i,r){var o=this,a=tf.get(e);if(a)r(null,a);else{var s=this._downloading.get(e);if(s){s.push(r);var c=this._queue.find((function(t){return t.id===e}));if(!c)return;var l=i.priority||0;c.priority<l&&(c.priority=l,this._queueDirty=!0)}else{var u=void 0!==i.maxRetryCount?i.maxRetryCount:this.maxRetryCount,h=void 0!==i.maxConcurrency?i.maxConcurrency:this.maxConcurrency,_=void 0!==i.maxRequestsPerFrame?i.maxRequestsPerFrame:this.maxRequestsPerFrame,f=this._downloaders[n]||this._downloaders.default;OO((function(n,a){if(0===n&&o._downloading.add(e,[r]),o.limited){o._updateTime();var s=function(e,t){o._totalNum--,o._handleQueueInNextFrame(h,_),a(e,t)};o._totalNum<h&&o._totalNumThisPeriod<_?(f(PO(t,o.appendTimeStamp),i,s),o._totalNum++,o._totalNumThisPeriod++):(o._queue.push({id:e,priority:i.priority||0,url:t,options:i,done:s,handler:f}),o._queueDirty=!0,o._totalNum<h&&o._handleQueueInNextFrame(h,_))}else f(PO(t,o.appendTimeStamp),i,a)}),u,this.retryInterval,(function(t,n){t||tf.add(e,n);for(var i=o._downloading.remove(e),r=0,a=i.length;r<a;r++)i[r](t,n)}))}}},t.loadSubpackage=function(e,t){i.assetManager.loadBundle(e,null,t)},t._updateTime=function(){var e=Date.now(),t=i.director.getDeltaTime(),n=t>this._maxInterval?this._maxInterval:t;e-this._lastDate>1e3*n&&(this._totalNumThisPeriod=0,this._lastDate=e)},t._handleQueue=function(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort((function(e,t){return e.priority-t.priority})),this._queueDirty=!1);var n=this._queue.pop();if(!n)break;this._totalNum++,this._totalNumThisPeriod++,n.handler(PO(n.url,this.appendTimeStamp),n.options,n.done)}this._handleQueueInNextFrame(e,t)},t._handleQueueInNextFrame=function(e,t){!this._checkNextPeriod&&this._queue.length>0&&(_t(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)},X(e,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),e}());function $O(e,t,n,i){var r=null,o=null;try{(r=new Uf)._nativeUrl=e,r._nativeAsset=t}catch(e){o=e}i(o,r)}function eD(e,t,n,i){var r=new vO;r.json=t,i(null,r)}function tD(e,t,n,i){var r=new gO;r.text=t,i(null,r)}function nD(e,t,n,i){var r=new Fw;r._nativeUrl=e,r._nativeAsset=t,i(null,r)}function iD(e,t,n,i){var r=new Rf;r._nativeUrl=e,r._nativeAsset=t,i(null,r)}function rD(e,n,i,r){var o=rf.get(n.name);o||(o=n.name===cf.RESOURCES?HO:new UO,n.base=n.base||e+"/",o.init(n)),t.import("virtual:///prerequisite-imports/"+o.name).then((function(){r(null,o)})).catch(r)}var oD=new(function(){function e(){this._creating=new Q_,this._producers={".png":$O,".jpg":$O,".bmp":$O,".jpeg":$O,".gif":$O,".ico":$O,".tiff":$O,".webp":$O,".image":$O,".pvr":$O,".pkm":$O,".txt":tD,".xml":tD,".vsh":tD,".fsh":tD,".atlas":tD,".tmx":tD,".tsx":tD,".fnt":tD,".json":eD,".ExportJson":eD,".binary":nD,".bin":nD,".dbbin":nD,".skel":nD,bundle:rD,default:iD}}var t=e.prototype;return t.register=function(e,t){"object"==typeof e?Ke.mixin(this._producers,e):this._producers[e]=t},t.create=function(e,t,n,i,r){var o=this,a=this._producers[n]||this._producers.default,s=ef.get(e);if(i.reloadAsset||!s){var c=this._creating.get(e);c?c.push(r):(this._creating.add(e,[r]),a(e,t,i,(function(t,n){!t&&n instanceof Rf&&(n._uuid=e,NO(e,n,i.cacheAsset));for(var r=o._creating.remove(e),a=0,s=r.length;a<s;a++)r[a](t,n)})))}else r(null,s)},e}()),aD=new(function(){function e(){this._loading=new Q_,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,n,i){var r=Ke.createMap(!0),o=null;if(Array.isArray(t)){(t=function(e){if(e[0]<1)throw new Error(P(5304,e[0]));yd(e,!0,void 0),Sd(e);for(var t=new Cd(e[0]),n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=0;s<a.length;++s)a[s].unshift(t,n,i,r,o);return a}(t)).length!==e.length&&b(4915);for(var a=0;a<e.length;a++)r[e[a]+"@import"]=t[a]}else{var s=Ke._getClassId(dp),c=Ke._getClassId(Uf);if(t.type===s&&t.data){var l=t.data;l.length!==e.length&&b(4915);for(var u=0;u<e.length;u++)r[e[u]+"@import"]=bd(s,{base:l[u][0],mipmaps:l[u][1]})}else if(t.type===c&&t.data){var h=t.data;h.length!==e.length&&b(4915);for(var _=0;_<e.length;_++)r[e[_]+"@import"]=h[_]}else o=new Error("unmatched type pack!"),r=null}i(o,r)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?Ke.mixin(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,n,i,r){t?(0,this._unpackers[n])(e,t,i,r):r(new Error("package data is wrong!"))},t.load=function(e,t,n){var i=this;if(!e.isNative&&e.info&&e.info.packs)if(tf.has(e.id))n(null,tf.get(e.id));else{var r=e.info.packs,o=r.find((function(e){return i._loading.has(e.uuid)}));if(o)this._loading.get(o.uuid).push({onComplete:n,id:e.id});else{o=r[0],this._loading.add(o.uuid,[{onComplete:n,id:e.id}]);var a=Ef(o.uuid,{ext:o.ext,bundle:e.config.name});JO.download(o.uuid,a,o.ext,e.options,(function(t,n){tf.remove(o.uuid),t&&p(t.message,t.stack),i.unpack(o.packedUuids,n,o.ext,e.options,(function(e,n){if(!e)for(var r in n)tf.add(r,n[r]);for(var a=i._loading.remove(o.uuid),s=0,c=a.length;s<c;s++){var l=a[s];if(t||e)l.onComplete(t||e);else{var u=n[l.id];u?l.onComplete(null,u):l.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else JO.download(e.id,e.url,e.ext,e.options,n)},e}());function sD(e,t){var n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);var r=e.options,o=e.progress,a=[],s=o.total,c=r.__exclude__=r.__exclude__||Object.create(null);e.output=[],MO(e.input,(function(r,l){if(!r.isNative&&ef.has(r.uuid)){var u=ef.get(r.uuid);return r.content=u.addRef(),e.output.push(r),o.canInvoke&&e.dispatch("progress",++o.finish,o.total,r),void l()}aD.load(r,e.options,(function(u,h){u?e.isFinish||(!i.assetManager.force||n?(p(u.message,u.stack),o.canInvoke=!1,t(u)):(e.output.push(r),o.canInvoke&&e.dispatch("progress",++o.finish,o.total,r))):e.isFinish||(r.file=h,e.output.push(r),r.isNative||(c[r.uuid]=!0,DO(r.uuid,h,c,a,r.config),o.total=s+a.length),o.canInvoke&&e.dispatch("progress",++o.finish,o.total,r)),l()}))}),(function(){if(e.isFinish)return IO(e,!0),void e.dispatch("error");if(a.length>0){var i=uf.create({input:a,progress:o,options:r,onProgress:e.onProgress,onError:uf.prototype.recycle,onComplete:function(r){var o;r||((o=e.output).push.apply(o,i.output),i.recycle()),n&&cD(e),t(r)}});af.async(i)}else n&&cD(e),t()}))}function cD(e){for(var t=e.output,n=0,i=t.length;n<i;n++)t[n].content&&t[n].content.decRef(!1)}var lD=new(function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return A(5100),{};for(var n=null,i=0,r=t.childNodes.length;i<r&&1!==(n=t.childNodes[i]).nodeType;i++);return this._parseNode(n)},n._parseNode=function(e){var t=null,n=e.tagName;if("dict"===n)t=this._parseDict(e);else if("array"===n)t=this._parseArray(e);else if("string"===n)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var i=0;i<e.childNodes.length;i++)t+=e.childNodes[i].nodeValue}else"false"===n?t=!1:"true"===n?t=!0:"real"===n?t=parseFloat(e.firstChild.nodeValue):"integer"===n&&(t=parseInt(e.firstChild.nodeValue,10));return t},n._parseArray=function(e){for(var t=[],n=0,i=e.childNodes.length;n<i;n++){var r=e.childNodes[n];1===r.nodeType&&t.push(this._parseNode(r))}return t},n._parseDict=function(e){for(var t={},n="",i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];1===o.nodeType&&("key"===o.tagName?n=o.firstChild.nodeValue:t[n]=this._parseNode(o))}return t},t}(function(){function e(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")},e}()));function uD(e,t){return e[t]<<8|e[t+1]}var hD=new(function(){function e(){this._parsing=new Q_,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,n){e instanceof HTMLImageElement?n(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){n(null,e)}),(function(e){n(e,null)}))},t.parseAudio=function(e,t,n){e instanceof ArrayBuffer?eS.__audioSupport.context.decodeAudioData(e,(function(e){n(null,e)}),(function(e){n(new Error("Error with decoding audio data"+e.err),null)})):n(null,e)},t.parsePVRTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Int32Array(o,0,13);if(55727696===a[0]){var s=a[7],c=a[6],l=a[12]+52;r={_data:new Uint8Array(o,l),_compressed:!0,width:s,height:c,format:0}}else{if(559044176!==a[11])throw new Error("Invalid magic number in PVR header");var u=a[0],h=a[1],_=a[2];r={_data:new Uint8Array(o,u),_compressed:!0,width:_,height:h,format:0}}}catch(e){i=e}n(i,r)},t.parsePKMTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(o),s=uD(a,6);if(0!==s&&1!==s&&3!==s)throw new Error("Invalid magic number in ETC header");var c=uD(a,12),l=uD(a,14);uD(a,8),uD(a,10),r={_data:new Uint8Array(o,16),_compressed:!0,width:c,height:l,format:0}}catch(e){i=e}n(i,r)},t.parseASTCTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(o);if(1554098963!==a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24))throw new Error("Invalid magic number in ASTC header");var s=a[4],c=a[5],l=a[6];if((s<3||s>6||c<3||c>6||l<3||l>6)&&(s<4||7===s||9===s||11===s||s>12||c<4||7===c||9===c||11===c||c>12||1!==l))throw new Error("Invalid block number in ASTC header");var u=function(e,t){return 4===e?If.RGBA_ASTC_4x4:5===e?4===t?If.RGBA_ASTC_5x4:If.RGBA_ASTC_5x5:6===e?5===t?If.RGBA_ASTC_6x5:If.RGBA_ASTC_6x6:8===e?5===t?If.RGBA_ASTC_8x5:6===t?If.RGBA_ASTC_8x6:If.RGBA_ASTC_8x8:10===e?5===t?If.RGBA_ASTC_10x5:6===t?If.RGBA_ASTC_10x6:8===t?If.RGBA_ASTC_10x8:If.RGBA_ASTC_10x10:10===t?If.RGBA_ASTC_12x10:If.RGBA_ASTC_12x12}(s,c),h=a[7]+(a[8]<<8)+(a[9]<<16),_=a[10]+(a[11]<<8)+(a[12]<<16);a[13],a[14],a[15],r={_data:new Uint8Array(o,16),_compressed:!0,width:h,height:_,format:u}}catch(e){i=e}n(i,r)},t.parsePlist=function(e,t,n){var i=null,r=lD.parse(e);r||(i=new Error("parse failed")),n(i,r)},t.parseImport=function(e,t,n){if(e){var i=null,r=null;try{i=Zd(e,t)}catch(e){r=e}n(r,i)}else n(new Error("The json file of asset "+t.__uuid__+" is empty or missing"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?Oe(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,n,i,r){var o=this,a=nf.get(e);if(a)r(null,a);else{var s=this._parsing.get(e);if(s)s.push(r);else{var c=this._parsers[n];c?(this._parsing.add(e,[r]),c(t,i,(function(t,n){t?tf.remove(e):yf(n)||nf.add(e,n);for(var i=o._parsing.remove(e),r=0,a=i.length;r<a;r++)i[r](t,n)}))):r(null,t)}}},e}());function _D(e,t){var n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);var r=e.options,o=e.progress;r.__exclude__=r.__exclude__||Object.create(null),e.output=[],MO(e.input,(function(a,s){var c=uf.create({input:a,onProgress:e.onProgress,options:r,progress:o,onComplete:function(r,l){r&&!e.isFinish&&(!i.assetManager.force||n?(p(r.message,r.stack),o.canInvoke=!1,t(r)):o.canInvoke&&e.dispatch("progress",++o.finish,o.total,a)),e.output.push(l),c.recycle(),s(null)}});fD.async(c)}),(function(){if(r.__exclude__=null,e.isFinish)return IO(e,!0),void e.dispatch("error");!function(e){var t=e.source;if(e.options.__outputAsArray__||1!==t.length)for(var n=e.output=[],i=0,r=t.length;i<r;i++)n.push(t[i].content);else e.output=t[0].content}(e),IO(e,!0),t()}))}var fD=new J_("loadOneAsset",[function(e,t){var n=e.output=e.input,i=n.options,r=n.isNative,o=n.uuid,a=n.file,s=i.reloadAsset;a||!s&&!r&&ef.has(o)?t():aD.load(n,e.options,(function(e,i){n.file=i,t(e)}))},function(e,t){var n=e.output=e.input,i=e.progress,r=e.options.__exclude__,o=n.id,a=n.file,s=n.options;if(n.isNative)hD.parse(o,a,n.ext,s,(function(r,a){r?t(r):(n.content=a,i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),tf.remove(o),nf.remove(o),t())}));else{var c=n.uuid;if(c in r){var l=r[c],u=l.finish,h=l.content,_=l.err,f=l.callbacks;i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),u||FO(c,c,r)?(h&&h.addRef(),n.content=h,t(_)):f.push({done:t,item:n})}else if(!s.reloadAsset&&ef.has(c)){var d=ef.get(c);n.content=d.addRef(),i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),t()}else s.__uuid__=c,hD.parse(o,a,"import",s,(function(n,i){n?t(n):function(e,t,n){var i=e.input,r=e.progress,o=i,a=o.uuid,s=o.id,c=o.options,l=o.config,u=c.cacheAsset,h=[];t.addRef&&t.addRef(),DO(a,t,Object.create(null),h,l),r.canInvoke&&e.dispatch("progress",++r.finish,r.total+=h.length,i);var _=e.options.__exclude__[a]={content:t,finish:!1,callbacks:[{done:n,item:i}]},f=uf.create({input:h,options:e.options,onProgress:e.onProgress,onError:uf.prototype.recycle,progress:r,onComplete:function(e){if(t.decRef&&t.decRef(!1),_.finish=!0,_.err=e,!e){for(var n,i=Array.isArray(f.output)?f.output:[f.output],r=Object.create(null),o=$(i);!(n=o()).done;){var c=n.value;c&&(r[c instanceof Rf?c._uuid+"@import":a+"@native"]=c)}!function(e,t,n){var i=t.__depends__;if(i){for(var r=0,o=i.length;r<o;r++){var a=i[r],s=n[a.uuid+"@import"];if(s)a.owner[a.prop]=s.addRef();else{if(p("The asset "+a.uuid+" is missing!"),a.type&&a.type!==Rf){var c=new a.type;c.initDefault(a.uuid),a.owner[a.prop]=c}!0}}t.__depends__=null}t.__nativeDepend__&&(n[e+"@native"]?t._nativeAsset=n[e+"@native"]:(!0,console.error("the native asset of "+e+" is missing!")),t.__nativeDepend__=!1)}(a,t,r);try{"function"!=typeof t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){p("The asset "+a+" is invalid for some reason, detail message: "+e.message+", stack: "+e.stack)}tf.remove(s),nf.remove(s),NO(a,t,u),f.recycle()}for(var l=_.callbacks,h=0,d=l.length;h<d;h++){var m=l[h];t.addRef&&t.addRef(),m.item.content=t,m.done(e)}l.length=0}});of.async(f)}(e,i,t)}))}}]);function dD(e,t){var n=e.options,i=Object.create(null),r=Object.create(null);for(var o in n)switch(o){case $_.PATH:case $_.UUID:case $_.DIR:case $_.SCENE:case $_.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":i[o]=n[o];break;case"__exclude__":case"__outputAsArray__":r[o]=n[o];break;default:i[o]=n[o],r[o]=n[o]}e.options=r;var a=uf.create({input:e.input,options:i}),s=null;try{e.output=e.source=sf.sync(a)}catch(e){s=e;for(var c=0,l=a.output.length;c<l;c++)a.output[c].recycle()}a.recycle(),t(s)}var pD=function(){function e(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},X(e,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),e}();pD.MAX_DEAD_NUM=500,pD._deadPool=[];var mD=[];function gD(e){var t=e.options,n=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(var i=function(i){var r=n[i],o=pD.create(),a=null,s=null;if("string"==typeof r&&((r=Object.create(null))[t.__requestType__||$_.UUID]=n[i]),"object"==typeof r)for(var c in Pe(r,t),r.preset&&Pe(r,lf[r.preset]),r){switch(c){case $_.UUID:if("break"===function(){var e=o.uuid=pf(r.uuid);if(!r.bundle){var t=rf.find((function(t){return!!t.getAssetInfo(e)}));r.bundle=t&&t.name}if(rf.has(r.bundle)){if(a=rf.get(r.bundle).config,(s=a.getAssetInfo(e))&&s.redirect){if(!rf.has(s.redirect))throw new Error("Please load bundle "+s.redirect+" first");a=rf.get(s.redirect).config,s=a.getAssetInfo(e)}o.config=a,o.info=s}return o.ext=r.ext||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case $_.DIR:if(rf.has(r.bundle)){rf.get(r.bundle).config.getDirWithPath(r.dir,r.type,mD);for(var l,u=$(mD);!(l=u()).done;){var h=l.value;n.push({uuid:h.uuid,__isNative__:!1,ext:".json",bundle:r.bundle})}mD.length=0}o.recycle(),o=null;break;case $_.PATH:if(rf.has(r.bundle)){if(a=rf.get(r.bundle).config,(s=a.getInfoWithPath(r.path,r.type))&&s.redirect){if(!rf.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");a=rf.get(s.redirect).config,s=a.getAssetInfo(s.uuid)}if(!s)throw o.recycle(),new Error("Bundle "+r.bundle+" doesn't contain "+r.path);o.config=a,o.uuid=s.uuid,o.info=s}o.ext=r.ext||".json";break;case $_.SCENE:if(!r.bundle){var _=rf.find((function(e){return!!e.getSceneInfo(r.scene)}));r.bundle=_&&_.name}if(rf.has(r.bundle)){if(a=rf.get(r.bundle).config,(s=a.getSceneInfo(r.scene))&&s.redirect){if(!rf.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");a=rf.get(s.redirect).config,s=a.getAssetInfo(s.uuid)}if(!s)throw o.recycle(),new Error("Bundle "+a.name+" doesn't contain scene "+r.scene);o.config=a,o.uuid=s.uuid,o.info=s}break;case"__isNative__":o.isNative=r.__isNative__;break;case $_.URL:o.url=r.url,o.uuid=r.uuid||r.url,o.ext=r.ext||Ai(r.url),o.isNative=void 0===r.__isNative__||r.__isNative__;break;default:o.options[c]=r[c]}if(!o)break}if(!o)return"continue";if(e.output.push(o),!o.uuid&&!o.url)throw new Error("Can not parse this input:"+JSON.stringify(r))},r=0;r<n.length;r++)i(r);return null}function vD(e){for(var t=e.output=e.input,n=0;n<t.length;n++){var r=t[n];if(!r.url){var o,a,s=r.config;a=r.isNative?s&&s.nativeBase?s.base+s.nativeBase:i.assetManager.generalNativeBase:s&&s.importBase?s.base+s.importBase:i.assetManager.generalImportBase;var c=r.uuid,l="";r.info&&(l=r.isNative?r.info.nativeVer?"."+r.info.nativeVer:"":r.info.ver?"."+r.info.ver:""),o=".ttf"===r.ext?a+"/"+c.slice(0,2)+"/"+c+l+"/"+r.options.__nativeName__:a+"/"+c.slice(0,2)+"/"+c+l+r.ext,r.url=o}}return null}var yD=e("AssetManager",function(){function e(){this.pipeline=of.append(dD).append(_D),this.fetchPipeline=af.append(dD).append(sD),this.transformPipeline=sf.append(gD).append(vD),this.bundles=rf,this.assets=ef,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=Jd,this.force=!1,this.allowImageBitmap=!eS.isMobile,this.utils=bf,this.downloader=JO,this.parser=hD,this.packManager=aD,this.cacheAsset=!0,this.cacheManager=null,this.presets=lf,this.factory=oD,this.preprocessPipe=dD,this.fetchPipe=sD,this.loadPipe=_D,this.references=null,this._releaseManager=wO,this._files=tf,this._parsed=nf,this._parsePipeline=null}var t=e.prototype;return t.init=function(e){void 0===e&&(e={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();var t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));var n=e.nativeBase||"";n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),this.generalImportBase=t,this.generalNativeBase=n},t.getBundle=function(e){return rf.get(e)||null},t.removeBundle=function(e){e._destroy(),rf.remove(e.name)},t.loadAny=function(e,t,n,i){var r=LO(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.preset=o.preset||"default",e=Array.isArray(e)?e.slice():e;var c=uf.create({input:e,onProgress:a,onComplete:zO(s),options:o});of.async(c)},t.preloadAny=function(e,t,n,i){var r=LO(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.preset=o.preset||"preload",e=Array.isArray(e)?e.slice():e;var c=uf.create({input:e,onProgress:a,onComplete:zO(s),options:o});af.async(c)},t.postLoadNative=function(e,t,n){var i=LO(t,void 0,n),r=i.options,o=i.onComplete;if(e._native&&e.__nativeDepend__){var a=Jd.getNativeDep(e._uuid);if(a){if(!rf.has(a.bundle)){var s=rf.find((function(t){return!!t.getAssetInfo(e._uuid)}));s&&(a.bundle=s.name)}this.loadAny(a,r,(function(t,n){t?p(t.message,t.stack):e.isValid&&e.__nativeDepend__&&(e._nativeAsset=n,e.__nativeDepend__=!1),o&&o(t)}))}}else zO(o)(null)},t.loadRemote=function(e,t,n){var i=LO(t,void 0,n),r=i.options,o=i.onComplete;r.reloadAsset||!this.assets.has(e)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:e},r,null,(function(t,n){t?(p(t.message,t.stack),o&&o(t,n)):oD.create(e,n,r.ext||Ai(e),r,(function(e,t){o&&o(e,t)}))}))):zO(o)(null,this.assets.get(e))},t.loadBundle=function(e,t,n){var i=LO(t,void 0,n),r=i.options,o=i.onComplete,a=bi(e);this.bundles.has(a)?zO(o)(null,this.getBundle(a)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:e},r,null,(function(t,n){t?(p(t.message,t.stack),o&&o(t,n)):oD.create(e,n,"bundle",r,(function(e,t){o&&o(e,t)}))})))},t.releaseAsset=function(e){wO.tryRelease(e,!0)},t.releaseUnusedAssets=function(){ef.forEach((function(e){wO.tryRelease(e)}))},t.releaseAll=function(){ef.forEach((function(e){wO.tryRelease(e,!0)}))},t.loadWithJson=function(){throw new Error("Only valid in Editor")},X(e,[{key:"main",get:function(){return rf.get(cf.MAIN)||null}},{key:"resources",get:function(){return rf.get(cf.RESOURCES)||null}}]),e}());yD.Pipeline=J_,yD.Task=uf,yD.Cache=Q_,yD.RequestItem=pD,yD.Bundle=UO,yD.BuiltinBundleName=cf;var SD=e("assetManager",i.assetManager=new yD);i.AssetManager=yD;var ED=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],TD=[".mp3",".ogg",".wav",".m4a"];function xD(){return!0}var AD={transformURL:function(e){var t=gf(e);if(!t)return e;var n=rf.find((function(e){return!!e.getAssetInfo(t)}));if(!n)return e;var i,r=n.getAssetInfo(t);if(!(i=e.startsWith(n.base+n.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==e.indexOf(i))return e;var o=!1;if(".ttf"===Ai(e)&&(o=!0),o){var a=wi(e),s=bi(e);e=a+"."+i+"/"+s}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(e){return e+"."+i}));return e}},CD=e("CCLoader",function(){function e(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=BO}var t=e.prototype;return t.load=function(e,t,n){void 0===n&&void 0!==t&&(n=t,t=null);for(var i=Array.isArray(e)?e:[e],r=0;r<i.length;r++){var o=i[r];"string"==typeof o?i[r]={url:o,__isNative__:!0}:(o.type&&(o.ext="."+o.type,o.type=void 0),o.url&&(o.__isNative__=!0))}var a=[],s=[];SD.loadAny(i,null,(function(e,n,i){i.content&&(ED.includes(i.ext)?a.push(i.content):TD.includes(i.ext)&&s.push(i.content)),t&&t(e,n,i)}),(function(e,t){var r=null;if(!e){t=Array.isArray(t)?t:[t];for(var o=function(e){var n=t[e];if(!(n instanceof Rf)){var r=n,o=i[e].url;a.includes(r)?oD.create(o,n,".png",{},(function(n,i){r=t[e]=i})):s.includes(r)&&oD.create(o,n,".mp3",{},(function(n,i){r=t[e]=i})),ef.add(o,r)}},c=0;c<t.length;c++)o(c);if(t.length>1){var l=Object.create(null);t.forEach((function(e){l[e._uuid]=e})),r={isCompleted:xD,_map:l}}else r=t[0]}n&&n(e,r)}))},t.getXMLHttpRequest=function(){return new XMLHttpRequest},t.getItem=function(e){return SD.assets.has(e)?{content:SD.assets.get(e)}:null},t.loadRes=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete,c=Ai(e);c&&!HO.getInfoWithPath(e,o)&&(e=e.slice(0,-c.length)),HO.load(e,o,a,s)},t.loadResArray=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;e.forEach((function(t,n){var i=Ai(t);i&&!HO.getInfoWithPath(t,o)&&(e[n]=t.slice(0,-i.length))})),HO.load(e,o,a,s)},t.loadResDir=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;HO.loadDir(e,o,a,(function(t,n){var i=[];t||(i=HO.getDirWithPath(e,o).map((function(e){return e.path}))),s&&s(t,n,i)}))},t.getRes=function(e,t){return ef.has(e)?ef.get(e):HO.get(e,t)},t.getResCount=function(){return ef.count},t.getDependsRecursively=function(e){if(!e)return[];var t="string"==typeof e?e:e._uuid;return Jd.getDepsRecursively(t).concat([t])},t.addDownloadHandlers=function(e){var t=Object.create(null),n=function(n){var i=e[n];t["."+n]=function(e,t,n){i({url:e},n)}};for(var i in e)n(i);JO.register(t)},t.addLoadHandlers=function(e){var t=Object.create(null),n=function(n){var i=e[n];t["."+n]=function(e,t,n){i({content:e},n)}};for(var i in e)n(i);hD.register(t)},t.release=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];"string"==typeof n&&(n=ef.get(n)),SD.releaseAsset(n)}else e&&("string"==typeof e&&(e=ef.get(e)),SD.releaseAsset(e))},t.releaseAsset=function(e){SD.releaseAsset(e)},t.releaseRes=function(e,t){HO.release(e,t)},t.releaseAll=function(){SD.releaseAll(),ef.clear()},t.removeItem=function(e){return!!ef.remove(e)},t.setAutoRelease=function(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t},t.setAutoReleaseRecursively=function(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;for(var n=Jd.getDepsRecursively(e),i=0;i<n.length;i++)this._autoReleaseSetting[n[i]]=t},t.isAutoRelease=function(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]},X(e,[{key:"onProgress",set:function(e){RO=e}},{key:"_cache",get:function(){return ef._map}},{key:"md5Pipe",get:function(){return AD}},{key:"downloader",get:function(){return JO}},{key:"loader",get:function(){return SD.parser}}]),e}()),bD=e("loader",new CD),wD=e("AssetLibrary",{init:function(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,SD.init(e),e.rawAssets&&HO.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:cf.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets)})},loadAsset:function(e,t){SD.loadAny(e,t)}}),RD=e("url",{});F(RD,"url",[{name:"normalize",target:SD.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(e){return e.startsWith("resources/")?Ef({path:Ri(e.substr(10)),bundle:cf.RESOURCES,__isNative__:!0,ext:Ai(e)}):""}}]),z(wD,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),z(bD,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),F(i,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return bD}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return wD}},{name:"Pipeline",target:yD,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return RD}}]),z(i,"cc",[{name:"LoadingItems",suggest:P(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),F(nt,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:JO,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),F(SO,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return SD.main?null===(t=SD.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),F(UC,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return SD.main&&SD.main.config.scenes.forEach((function(t){e.push(t)})),e}}]);var ID,PD,OD,DD,ND,MD,LD,BD,FD,zD,UD,HD,GD,kD,VD=wO._autoRelease;wO._autoRelease=function(e,t,n){VD.call(wO,e,t,n);for(var i=bD._autoReleaseSetting,r=Object.keys(i),o=0;o<r.length;o++){var a=r[o];if(!0===i[a]){var s=ef.get(a);s&&wO.tryRelease(s)}}};var WD,jD,qD,XD,YD,KD,ZD,QD,JD,$D,eN,tN,nN,iN,rN,oN,aN,sN,cN,lN,uN,hN,_N,fN,dN,pN,mN,gN,vN,yN,SN,EN,TN,xN,AN,CN,bN,wN,RN,IN,PN,ON,DN,NN,MN,LN,BN,FN,zN,UN,HN,GN,kN,VN,WN,jN,qN,XN,YN,KN,ZN,QN,JN,$N,eM,tM,nM,iM=e("EventHandler",(ID=S_("cc.ClickEvent"),PD=K_(i.Node),OD=B_(),DD=B_(),ND=B_(),MD=B_(),ID((kD=function(){function e(){ee(this,"target",FD,this),ee(this,"component",zD,this),ee(this,"_componentId",UD,this),ee(this,"handler",HD,this),ee(this,"customEventData",GD,this)}e.emitEvents=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var o=0,a=t.length;o<a;o++){var s=t[o];s instanceof e&&s.emit(i)}};var t=e.prototype;return t.emit=function(e){var t=this.target;if(i.isValid(t)){this._genCompIdIfNeeded();var n=i.js._getClassById(this._componentId),r=t.getComponent(n);if(i.isValid(r)){var o=r[this.handler];"function"==typeof o&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),o.apply(r,e))}}},t._compName2Id=function(e){var t=i.js.getClassByName(e);return i.js._getClassId(t)},t._compId2Name=function(e){var t=i.js._getClassById(e);return i.js.getClassName(t)},t._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},X(e,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(e){this._componentId=this._compName2Id(e)}}]),e}(),FD=te((BD=kD).prototype,"target",[C_,PD,OD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zD=te(BD.prototype,"component",[C_,N_,DD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),UD=te(BD.prototype,"_componentId",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),HD=te(BD.prototype,"handler",[C_,N_,ND],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),GD=te(BD.prototype,"customEventData",[C_,N_,MD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),LD=BD))||LD));i.Component.EventHandler=iM;var rM,oM,aM,sM,cM,lM,uM,hM,_M,fM,dM,pM=new yn,mM=Qe(qh),gM=Qe(jh),vM=Qe(Xh),yM=Qe(Kh),SM=Qe(Yh),EM=Qe({SKYBOX:c_|Qa.DEPTH_STENCIL,SOLID_COLOR:Qa.ALL,DEPTH_ONLY:Qa.DEPTH_STENCIL,DONT_CLEAR:Qa.NONE}),TM=(WD=S_("cc.Camera"),jD=D_(),qD=R_(),XD=k_(),YD=B_(),KD=K_(Ru.BitMask),ZD=k_(),QD=B_(),JD=K_(EM),$D=k_(),eN=B_(),tN=k_(),nN=B_(),iN=k_(),rN=B_(),oN=k_(),aN=B_(),sN=K_(mM),cN=k_(),lN=B_(),uN=K_(gM),hN=k_(),_N=B_(),fN=k_(),dN=B_(),pN=k_(),mN=B_(),gN=k_(),vN=B_(),yN=k_(),SN=B_(),EN=K_(vM),TN=k_(),xN=B_(),AN=K_(yM),CN=k_(),bN=B_(),wN=K_(SM),RN=k_(),IN=B_(),PN=k_(),ON=B_(),DN=K_(ZS),NN=k_(),MN=B_(),rM=WD(LN=jD(LN=qD(LN=w_((nM=tM=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_projection",FN,Q(t)),ee(t,"_priority",zN,Q(t)),ee(t,"_fov",UN,Q(t)),ee(t,"_fovAxis",HN,Q(t)),ee(t,"_orthoHeight",GN,Q(t)),ee(t,"_near",kN,Q(t)),ee(t,"_far",VN,Q(t)),ee(t,"_color",WN,Q(t)),ee(t,"_depth",jN,Q(t)),ee(t,"_stencil",qN,Q(t)),ee(t,"_clearFlags",XN,Q(t)),ee(t,"_rect",YN,Q(t)),ee(t,"_aperture",KN,Q(t)),ee(t,"_shutter",ZN,Q(t)),ee(t,"_iso",QN,Q(t)),ee(t,"_screenScale",JN,Q(t)),ee(t,"_visibility",$N,Q(t)),ee(t,"_targetTexture",eM,Q(t)),t._camera=null,t._inEditorMode=!1,t._flows=void 0,t}K(t,e);var n=t.prototype;return n.onLoad=function(){this._createCamera()},n.onEnable=function(){this.node.hasChangedFlags|=t_.POSITION,this._camera&&this._attachToScene()},n.onDisable=function(){this._camera&&this._detachFromScene()},n.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},n.screenPointToRay=function(e,t,n){return n||(n=ca.create()),this._camera&&this._camera.screenPointToRay(n,e,t),n},n.worldToScreen=function(e,t){return t||(t=new yn),this._camera&&this._camera.worldToScreen(t,e),t},n.screenToWorld=function(e,t){return t||(t=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(t,e),t},n.convertToUINode=function(e,t,n){if(n||(n=new yn),!this._camera)return n;this.worldToScreen(e,pM);var r=t.getComponent("cc.UITransform"),o=qC.getVisibleSize(),a=pM.x-.5*this._camera.width,s=pM.y-.5*this._camera.height;return pM.x=a/i.view.getScaleX()+.5*o.width,pM.y=s/i.view.getScaleY()+.5*o.height,r&&r.convertToNodeSpaceAR(pM,n),n},n._createCamera=function(){this._camera||(this._camera=i.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?i.director.root&&i.director.root.mainWindow:i.director.root&&i.director.root.tempWindow,priority:this._priority}),this._camera.viewport=this._rect,this._camera.fovAxis=this._fovAxis,this._camera.fov=tn(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},n._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},n._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},n._chechTargetTextureEvent=function(e){var t=this;e&&e.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(e){t._camera&&t._camera.setFixedSize(e.width,e.height)}),this)},n._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var e=this._targetTexture.window;this._camera.changeTargetWindow(e),this._camera.setFixedSize(e.width,e.height)}},X(t,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e,this._camera&&(this._camera.priority=e)}},{key:"visibility",get:function(){return this._visibility},set:function(e){this._visibility=e,this._camera&&(this._camera.visibility=e)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(e){this._clearFlags=e,this._camera&&(this._camera.clearFlag=e)}},{key:"clearColor",get:function(){return this._color},set:function(e){this._color.set(e),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(e){this._depth=e,this._camera&&(this._camera.clearDepth=e)}},{key:"clearStencil",get:function(){return this._stencil},set:function(e){this._stencil=e,this._camera&&(this._camera.clearStencil=e)}},{key:"projection",get:function(){return this._projection},set:function(e){this._projection=e,this._camera&&(this._camera.projectionType=e)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(e){e!==this._fovAxis&&(this._fovAxis=e,this._camera&&(this._camera.fovAxis=e,e===jh.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._camera&&(this._camera.fov=tn(e))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(e){this._orthoHeight=e,this._camera&&(this._camera.orthoHeight=e)}},{key:"near",get:function(){return this._near},set:function(e){this._near=e,this._camera&&(this._camera.nearClip=e)}},{key:"far",get:function(){return this._far},set:function(e){this._far=e,this._camera&&(this._camera.farClip=e)}},{key:"aperture",get:function(){return this._aperture},set:function(e){this._aperture=e,this._camera&&(this._camera.aperture=e)}},{key:"shutter",get:function(){return this._shutter},set:function(e){this._shutter=e,this._camera&&(this._camera.shutter=e)}},{key:"iso",get:function(){return this._iso},set:function(e){this._iso=e,this._camera&&(this._camera.iso=e)}},{key:"rect",get:function(){return this._rect},set:function(e){this._rect=e,this._camera&&(this._camera.viewport=e)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(e){if(this._targetTexture!==e){var t=this._targetTexture;this._targetTexture=e,this._chechTargetTextureEvent(t),this._updateTargetTexture(),!e&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(e){this._screenScale=e,this._camera&&(this._camera.screenScale=e)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(e){this._inEditorMode=e,this._camera&&this._camera.changeTargetWindow(e?i.director.root&&i.director.root.mainWindow:i.director.root&&i.director.root.tempWindow)}}]),t}(Xd),tM.ProjectionType=mM,tM.FOVAxis=gM,tM.ClearFlag=EM,tM.Aperture=vM,tM.Shutter=yM,tM.ISO=SM,FN=te((BN=nM).prototype,"_projection",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mM.PERSPECTIVE}}),zN=te(BN.prototype,"_priority",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),UN=te(BN.prototype,"_fov",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),HN=te(BN.prototype,"_fovAxis",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gM.VERTICAL}}),GN=te(BN.prototype,"_orthoHeight",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),kN=te(BN.prototype,"_near",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),VN=te(BN.prototype,"_far",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),WN=te(BN.prototype,"_color",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn("#333333")}}),jN=te(BN.prototype,"_depth",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),qN=te(BN.prototype,"_stencil",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XN=te(BN.prototype,"_clearFlags",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return EM.SOLID_COLOR}}),YN=te(BN.prototype,"_rect",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xn(0,0,1,1)}}),KN=te(BN.prototype,"_aperture",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vM.F16_0}}),ZN=te(BN.prototype,"_shutter",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yM.D125}}),QN=te(BN.prototype,"_iso",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return SM.ISO100}}),JN=te(BN.prototype,"_screenScale",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$N=te(BN.prototype,"_visibility",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Zh}}),eM=te(BN.prototype,"_targetTexture",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te(BN.prototype,"priority",[XD,YD],Object.getOwnPropertyDescriptor(BN.prototype,"priority"),BN.prototype),te(BN.prototype,"visibility",[KD,ZD,QD],Object.getOwnPropertyDescriptor(BN.prototype,"visibility"),BN.prototype),te(BN.prototype,"clearFlags",[JD,$D,eN],Object.getOwnPropertyDescriptor(BN.prototype,"clearFlags"),BN.prototype),te(BN.prototype,"clearColor",[tN,nN],Object.getOwnPropertyDescriptor(BN.prototype,"clearColor"),BN.prototype),te(BN.prototype,"clearDepth",[iN,rN],Object.getOwnPropertyDescriptor(BN.prototype,"clearDepth"),BN.prototype),te(BN.prototype,"clearStencil",[oN,aN],Object.getOwnPropertyDescriptor(BN.prototype,"clearStencil"),BN.prototype),te(BN.prototype,"projection",[sN,cN,lN],Object.getOwnPropertyDescriptor(BN.prototype,"projection"),BN.prototype),te(BN.prototype,"fovAxis",[uN,hN,_N],Object.getOwnPropertyDescriptor(BN.prototype,"fovAxis"),BN.prototype),te(BN.prototype,"fov",[fN,dN],Object.getOwnPropertyDescriptor(BN.prototype,"fov"),BN.prototype),te(BN.prototype,"orthoHeight",[pN,mN],Object.getOwnPropertyDescriptor(BN.prototype,"orthoHeight"),BN.prototype),te(BN.prototype,"near",[gN,vN],Object.getOwnPropertyDescriptor(BN.prototype,"near"),BN.prototype),te(BN.prototype,"far",[yN,SN],Object.getOwnPropertyDescriptor(BN.prototype,"far"),BN.prototype),te(BN.prototype,"aperture",[EN,TN,xN],Object.getOwnPropertyDescriptor(BN.prototype,"aperture"),BN.prototype),te(BN.prototype,"shutter",[AN,CN,bN],Object.getOwnPropertyDescriptor(BN.prototype,"shutter"),BN.prototype),te(BN.prototype,"iso",[wN,RN,IN],Object.getOwnPropertyDescriptor(BN.prototype,"iso"),BN.prototype),te(BN.prototype,"rect",[PN,ON],Object.getOwnPropertyDescriptor(BN.prototype,"rect"),BN.prototype),te(BN.prototype,"targetTexture",[DN,NN,MN],Object.getOwnPropertyDescriptor(BN.prototype,"targetTexture"),BN.prototype),LN=BN))||LN)||LN)||LN)||LN,e({Camera:rM,CameraComponent:rM}),rM);i.Camera=TM;var xM,AM,CM,bM,wM,RM,IM,PM,OM={parent:null,owner:null,subModelIdx:0},DM=e("RenderableComponent",(oM=S_("cc.RenderableComponent"),aM=K_([QS]),sM=K_(QS),cM=k_(),lM=L_(),oM((dM=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_materials",_M,Q(t)),ee(t,"_visFlags",fM,Q(t)),t._materialInstances=[],t._models=[],t}K(t,e);var n=t.prototype;return n.getMaterial=function(e){return e<0||e>=this._materials.length?null:this._materials[e]},n.setMaterial=function(e,t){e&&e instanceof bE&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[t]=e;var n=this._materialInstances[t];n?n.parent!==this._materials[t]&&(n.destroy(),this._materialInstances[t]=null,this._onMaterialModified(t,this._materials[t])):this._onMaterialModified(t,this._materials[t])},n.getMaterialInstance=function(e){if(!this._materials[e])return null;if(!this._materialInstances[e]){OM.parent=this._materials[e],OM.owner=this,OM.subModelIdx=e;var t=new bE(OM);this.setMaterialInstance(e,t)}return this._materialInstances[e]},n.setMaterialInstance=function(e,t){t&&t.parent?t!==this._materialInstances[e]&&(this._materialInstances[e]=t,this._onMaterialModified(e,t)):t!==this._materials[e]&&this.setMaterial(t,e)},n.getRenderMaterial=function(e){return this._materialInstances[e]||this._materials[e]},n._collectModels=function(){return this._models},n._attachToScene=function(){},n._detachFromScene=function(){},n._onMaterialModified=function(){},n._onRebuildPSO=function(){},n._clearMaterials=function(){},n._onVisibilityChange=function(){},X(t,[{key:"visibility",get:function(){return this._visFlags},set:function(e){this._visFlags=e,this._onVisibilityChange(e)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(e){for(var t=0;t<e.length;t++)e[t]!==this._materials[t]&&this.setMaterial(e[t],t);if(e.length<this._materials.length){for(var n=e.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(e.length)}}},{key:"materials",get:function(){for(var e=0;e<this._materials.length;e++)this._materialInstances[e]=this.getMaterialInstance(e);return this._materialInstances},set:function(e){var t=e.length-this._materials.length;if(t>0)this._materials.length=e.length,this._materialInstances.length=e.length;else if(t<0)for(var n=this._materials.length-t;n<this._materials.length;++n)this.setMaterialInstance(n,null);for(var i=0;i<this._materialInstances.length;i++)this._materialInstances[i]!=e[i]&&this.setMaterialInstance(i,e[i])}},{key:"sharedMaterial",get:function(){return this.getMaterial(0)}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(e){1===this._materials.length&&this._materials[0]===e||this.setMaterialInstance(0,e)}}]),t}(Xd),_M=te((hM=dM).prototype,"_materials",[aM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fM=te(hM.prototype,"_visFlags",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ru.Enum.NONE}}),te(hM.prototype,"sharedMaterials",[sM,cM,lM],Object.getOwnPropertyDescriptor(hM.prototype,"sharedMaterials"),hM.prototype),uM=hM))||uM));function NM(e){return"string"==typeof e||"number"==typeof e}function MM(e,t){return e instanceof t}i.RenderableComponent=DM,F(TM,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),F(TM.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),i.CameraComponent=TM,Ke.setClassAlias(TM,"cc.CameraComponent");var LM,BM,FM,zM,UM,HM,GM=S_("cc.animation.HierarchyPath")((bM=function(){function e(e){ee(this,"path",CM,this),this.path=e||""}return e.prototype.get=function(e){return e instanceof Vv?e.getChildByPath(this.path)||(d('Node "'+e.name+'" has no path "'+this.path+'"'),null):(d("Target of hierarchy path should be of type Node."),null)},e}(),CM=te((AM=bM).prototype,"path",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),xM=AM))||xM,kM=S_("cc.animation.ComponentPath")((PM=function(){function e(e){ee(this,"component",IM,this),this.component=e||""}return e.prototype.get=function(e){return e instanceof Vv?e.getComponent(this.component)||(d('Node "'+e.name+'" has no component "'+this.component+'"'),null):(d("Target of component path should be of type Node."),null)},e}(),IM=te((RM=PM).prototype,"component",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),wM=RM))||wM;function VM(e){for(var t=e,n=0;n<(arguments.length<=1?0:arguments.length-1);++n){var i=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];if(NM(i)){if(!(i in t))return d('Target object has no property "'+i+'"'),null;t=t[i]}else t=i.get(t);if(null===t)break}return t}var WM,jM,qM,XM,YM,KM,ZM,QM,JM,$M,eL,tL=S_("cc.animation.UniformProxyFactory")((HM=function(){function e(e,t){ee(this,"passIndex",FM,this),ee(this,"uniformName",zM,this),ee(this,"channelIndex",UM,this),this.passIndex=t||0,this.uniformName=e||""}return e.prototype.forTarget=function(e){var t=e.passes[this.passIndex],n=t.getHandle(this.uniformName);if(!n)throw new Error('Material "'+e.name+'" has no uniform "'+this.uniformName+'"');var r=em.getPropertyTypeFromHandle(n);if(r===yp.BUFFER){var o=void 0===this.channelIndex?n:t.getHandle(this.uniformName,this.channelIndex,Ea.FLOAT);if(!o)throw new Error('Uniform "'+this.uniformName+" (in material "+e.name+") has no channel "+this.channelIndex+'"');return function(e,t){for(var n,i=$(e.shaderInfo.blocks);!(n=i()).done;)for(var r,o=$(n.value.members);!(r=o()).done;){var a=r.value;if(a.name===t)return a.count>1}return!1}(t,this.uniformName)?{set:function(e){t.setUniformArray(o,e)}}:{set:function(e){t.setUniform(o,e)}}}if(r===yp.TEXTURE){var a=em.getBindingFromHandle(n),s=t.properties[this.uniformName],c=s&&s.value?s.value+"-texture":Mp(s.type),l=Kp.get(c);return l||(d("Illegal texture default value: "+c+"."),l=Kp.get("default-texture")),{set:function(e){e||(e=l);var n=e.getGFXTexture();n&&n.width&&n.height&&(t.bindTexture(a,n),e instanceof od&&t.bindSampler(a,id.getSampler(i.game._gfxDevice,e.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+r+".")},e}(),FM=te((BM=HM).prototype,"passIndex",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zM=te(BM.prototype,"uniformName",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),UM=te(BM.prototype,"channelIndex",[q_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),LM=BM))||LM,nL=S_("cc.animation.MorphWeightsValueProxy")((XM=function(){function e(){ee(this,"subMeshIndex",qM,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(n){e.setWeights(n,t.subMeshIndex)}}},e}(),qM=te((jM=XM).prototype,"subMeshIndex",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WM=jM))||WM,iL=S_("cc.animation.MorphWeightsAllValueProxy")(YM=function(){function e(){}return e.prototype.forTarget=function(e){return{set:function(t){for(var n,i,r=null!==(n=null===(i=e.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0,o=0;o<r;++o)e.setWeights(t,o)}}},e}())||YM;function rL(e,t,n,i){var r,o,a,s,c,l,u=new t,h=new t,_=new t,f=S_(e)((l=function(){function e(e,n,i){ee(this,"dataPoint",a,this),ee(this,"inTangent",s,this),ee(this,"outTangent",c,this),this.dataPoint=e||new t,this.inTangent=n||new t,this.outTangent=i||new t}var r=e.prototype;return r.lerp=function(e,t,r){var o=this.dataPoint,a=e.dataPoint;h=n(h,this.inTangent,r),_=n(_,e.outTangent,r);var s=t*t*t,c=t*t,l=s-2*c+t,f=-2*s+3*c,d=s-c;return u=n(u,o,2*s-3*c+1),u=i(u,u,h,l),u=i(u,u,a,f),u=i(u,u,_,d)},r.getNoLerp=function(){return this.dataPoint},e}(),a=te((o=l).prototype,"dataPoint",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),s=te(o.prototype,"inTangent",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),c=te(o.prototype,"outTangent",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),r=o))||r;if(t===bn){var d=f.prototype.lerp;f.prototype.lerp=function(e,t,n){var i=d.call(this,e,t,n);return bn.normalize(i,i),i}}return f}var oL=e("CubicSplineVec2Value",rL("cc.CubicSplineVec2Value",zn,zn.multiplyScalar,zn.scaleAndAdd));i.CubicSplineVec2Value=oL;var aL=e("CubicSplineVec3Value",rL("cc.CubicSplineVec3Value",yn,yn.multiplyScalar,yn.scaleAndAdd));i.CubicSplineVec3Value=aL;var sL=e("CubicSplineVec4Value",rL("cc.CubicSplineVec4Value",kn,kn.multiplyScalar,kn.scaleAndAdd));i.CubicSplineVec4Value=sL;var cL=e("CubicSplineQuatValue",rL("cc.CubicSplineQuatValue",bn,bn.multiplyScalar,bn.scaleAndAdd));i.CubicSplineQuatValue=cL;var lL=e("CubicSplineNumberValue",S_("cc.CubicSplineNumberValue")((eL=function(){function e(e,t,n){ee(this,"dataPoint",QM,this),ee(this,"inTangent",JM,this),ee(this,"outTangent",$M,this),this.dataPoint=e,this.inTangent=t,this.outTangent=n}var t=e.prototype;return t.lerp=function(e,t,n){var i=this.dataPoint,r=e.dataPoint,o=t*t*t,a=t*t;return i*(2*o-3*a+1)+this.outTangent*n*(o-2*a+t)+r*(-2*o+3*a)+e.inTangent*n*(o-a)},t.getNoLerp=function(){return this.dataPoint},e}(),QM=te((ZM=eL).prototype,"dataPoint",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),JM=te(ZM.prototype,"inTangent",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$M=te(ZM.prototype,"outTangent",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),KM=ZM))||KM);function uL(e,t,n){void 0===n&&(n=1e-6);for(var i=0,r=e.length-1,o=r>>>1;i<=r;o=i+r>>>1){var a=e[o];if(a>t+n)r=o-1;else{if(!(a<t-n))return o;i=o+1}}return~i}function hL(e,t,n,i,r){var o=1-r;return o*(o*(e+(3*t-e)*r)+3*n*r*r)+i*r*r*r}i.CubicSplineNumberValue=lL,e("animation",Object.freeze({__proto__:null,UniformProxyFactory:tL,MorphWeightsValueProxy:nL,MorphWeightsAllValueProxy:iL,isPropertyPath:NM,isCustomPath:MM,HierarchyPath:GM,ComponentPath:kM,evaluatePath:VM,CubicSplineVec2Value:oL,CubicSplineVec3Value:aL,CubicSplineVec4Value:sL,CubicSplineQuatValue:cL,CubicSplineNumberValue:lL})),i.bezier=hL;var _L=Math.cos,fL=Math.acos,dL=Math.max,pL=2*Math.PI,mL=Math.sqrt;function gL(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}function vL(e,t){var n=function(e,t){var n,i,r,o,a=t-0,s=t-e[0],c=3*a,l=3*s,u=3*(t-e[2]),h=1/(-a+l-u+(t-1)),_=1/3,f=(c-6*s+u)*h,d=f*_,p=(-c+l)*h,m=(3*p-f*f)*_,g=m*_,v=(2*f*f*f-9*f*p+a*h*27)/27,y=v/2,S=y*y+g*g*g;if(S<0){var E=-m*_,T=mL(E*E*E),x=-v/(2*T),A=fL(x<-1?-1:x>1?1:x),C=2*gL(T);return i=C*_L(A*_)-d,r=C*_L((A+pL)*_)-d,o=C*_L((A+2*pL)*_)-d,i>=0&&i<=1?r>=0&&r<=1?o>=0&&o<=1?dL(i,r,o):dL(i,r):o>=0&&o<=1?dL(i,o):i:r>=0&&r<=1?o>=0&&o<=1?dL(r,o):r:o}if(0===S)return r=-(n=y<0?gL(-y):-gL(y))-d,(i=2*n-d)>=0&&i<=1?r>=0&&r<=1?dL(i,r):i:r;var b=mL(S);return(n=gL(-y+b))-gL(y+b)-d}(e,t),i=e[1];return((1-n)*(i+(e[3]-i)*n)*3+n*n)*n}i.bezierByTime=vL;var yL=e("RatioSampler",function(){function e(e){var t,n;this.ratios=void 0,this._findRatio=void 0,this.ratios=e;for(var i=!0,r=1,o=e.length;r<o;r++)if(t=e[r]-e[r-1],1===r)n=t;else if(Math.abs(t-n)>1e-6){i=!1;break}this._findRatio=i?xL:uL}return e.prototype.sample=function(e){return this._findRatio(this.ratios,e)},e}());i.RatioSampler=yL;var SL=e("AnimCurve",function(){function e(t,n){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=n,this._values=t.values;var i=function(t){return"string"==typeof t?t:Array.isArray(t)?t[0]===t[1]&&t[2]===t[3]?e.Linear:e.Bezier(t):e.Linear};if(void 0!==t.easingMethod)this.type=i(t.easingMethod);else if(Array.isArray(t.easingMethods))this.types=t.easingMethods.map(i);else if(void 0!==t.easingMethods){this.types=new Array(this._values.length).fill(null);for(var r=0,o=Object.keys(t.easingMethods);r<o.length;r++){var a=o[r];this.types[a]=i(t.easingMethods[a])}}else this.type=null;var s=t.values[0];(void 0===t.interpolate||t.interpolate)&&(this._lerp=UL(s)),void 0!==t._arrayLength&&(this._array=new Array(t._arrayLength))}e.Bezier=function(e){return e};var t=e.prototype;return t.hasLerp=function(){return!!this._lerp},t.valueAt=function(e){if(void 0===this._array){var t=this._values[e];return t&&t.getNoLerp?t.getNoLerp():t}for(var n=0;n<this._array.length;++n)this._array[n]=this._values[this._array.length*e+n];return this._array},t.valueBetween=function(e,t,n,i,r){if(this._lerp){var o=this.types?this.types[t]:this.type,a=r-n,s=(e-n)/a;if(o&&(s=TL(s,o)),void 0===this._array){var c=this._values[t],l=this._values[i];return this._lerp(c,l,s,a*this._duration)}for(var u=0;u<this._array.length;++u){var h=this._values[this._array.length*t+u],_=this._values[this._array.length*i+u];this._array[u]=this._lerp(h,_,s,a*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(t);for(var f=0;f<this._array.length;++f)this._array[f]=this._values[this._array.length*t+f];return this._array},t.empty=function(){return 0===this._values.length},t.constant=function(){return 1===this._values.length},e}());function EL(e,t,n){var i=t.sample(n);if(i<0)if((i=~i)<=0)i=0;else{if(!(i>=t.ratios.length))return e.valueBetween(n,i-1,t.ratios[i-1],i,t.ratios[i]);i=t.ratios.length-1}return e.valueAt(i)}function TL(e,t){if("string"==typeof t){var n=Qb[t];n?e=n(e):b(3906,t)}else Array.isArray(t)&&(e=vL(t,e));return e}function xL(e,t){var n=e.length-1;if(0===n)return 0;var i=e[0];if(t<i)return 0;var r=e[n];if(t>r)return n;var o=(t=(t-i)/(r-i))/(1/n),a=0|o,s=1e-6;return o-a<s?a:a+1-o<s?a+1:~(a+1)}SL.Linear=null,i.AnimCurve=SL,e("EventInfo",function(){function e(){this.events=[]}return e.prototype.add=function(e,t){this.events.push({func:e||"",params:t||[]})},e}()),i.sampleAnimationCurve=EL;var AL,CL,bL,wL,RL,IL,PL,OL,DL,NL,ML,LL,BL,FL,zL,UL=function(){function e(e,t,n,i){return e.lerp(t,n,i)}return function(t){if(null!==t){if("number"==typeof t)return en;if("object"==typeof t&&t.constructor){if(t instanceof bn)return n=new bn,function(e,t,i){return bn.slerp(n,e,t,i)};if(t instanceof tt)return function(e){var t=new e;return function(n,i,r){return e.lerp(t,n,i,r),t}}(t.constructor);if(t.constructor===Number)return en;if("function"==typeof t.lerp)return e}var n}}}(),HL=function(){function e(){}return e.getOrExtract=function(t){var n=e.pool.get(t);return n&&n.info.sample===t.sample||(n&&i.director.root.dataPoolManager.releaseAnimationClip(t),n=function(e){var t={};e.curves.forEach((function(e){if(!e.valueAdapter&&MM(e.modifiers[0],GM)&&NM(e.modifiers[1])){var n=e.modifiers[0].path,i=t[n];i||(i=t[n]={}),i[e.modifiers[1]]={values:e.data.values,keys:e.data.keys}}}));for(var n=Math.ceil(e.sample*e.duration)+1,i=function(){var i=o[r],a=t[i];if(!a)return"continue";Object.defineProperty(a,"worldMatrix",{get:function(){if(!a._worldMatrix){var r=a.position,o=a.rotation,s=a.scale;GL(e,r,n),GL(e,o,n),GL(e,s,n),function(e,t,n){var i=n.position.values,r=n.rotation.values,o=n.scale.values,a=i.map((function(){return new Mn})),s=t.lastIndexOf("/"),c=null;if(s>0){var l=e[t.substring(0,s)];if(!l)return void console.warn("no data for parent bone?");c=l.worldMatrix.values}for(var u=0;u<i.length;u++){var h=i[u],_=r[u],f=o[u],d=a[u];Mn.fromRTS(d,_,h,f),c&&Mn.multiply(d,c[u],d)}Object.keys(n).forEach((function(e){return delete n[e]})),n._worldMatrix={keys:0,interpolate:!1,values:a}}(t,i,a)}return a._worldMatrix}})},r=0,o=Object.keys(t);r<o.length;r++)i();return{info:{frames:n,sample:e.sample},data:t}}(t),e.pool.set(t,n)),n},e.destroy=function(t){e.pool.delete(t)},e}();function GL(e,t,n){var i=e.keys[t.keys],r=[];if(i&&1!==i.length)for(var o=t.values[0]instanceof bn,a=0,s=0;a<n;a++){for(var c=a/e.sample;i[s]<=c;)s++;s>i.length-1?c=i[s=i.length-1]:0===s&&(s=1);var l=t.values[s-1].clone(),u=i[s]-i[s-1],h=u?$t((c-i[s-1])/u):1;o?l.slerp(t.values[s],h):l.lerp(t.values[s],h),r[a]=l}else for(var _=0;_<n;_++)r[_]=t.values[0].clone();t.values=r}HL.pool=new Map;var kL=e("AnimationClip",S_("cc.AnimationClip")((zL=FL=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"sample",bL,Q(t)),ee(t,"speed",wL,Q(t)),ee(t,"wrapMode",RL,Q(t)),ee(t,"events",IL,Q(t)),ee(t,"enableTrsBlending",PL,Q(t)),ee(t,"_duration",OL,Q(t)),ee(t,"_keys",DL,Q(t)),ee(t,"_stepness",NL,Q(t)),ee(t,"_curves",ML,Q(t)),ee(t,"_commonTargets",LL,Q(t)),ee(t,"_hash",BL,Q(t)),t.frameRate=0,t._ratioSamplers=[],t._runtimeCurves=void 0,t._runtimeEvents=void 0,t._data=null,t}K(t,e),t.createWithSpriteFrames=function(e,n){if(!Array.isArray(e))return b(3905),null;var i=new t;i.sample=n||i.sample,i.duration=e.length/i.sample;for(var r=1/i.sample,o=new Array(e.length),a=new Array(o.length),s=0;s<e.length;s++)o[s]=s*r,a[s]=e[s];return i.keys=[o],i.curves=[{modifiers:[new kM("cc.Sprite"),"spriteFrame"],data:{keys:0,values:a}}],i};var n=t.prototype;return n.onLoaded=function(){this.frameRate=this.sample,this._decodeCVTAs()},n.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},n.updateEventDatas=function(){delete this._runtimeEvents},n.getEventGroupIndexAtRatio=function(e){return this._runtimeEvents||this._createRuntimeEvents(),uL(this._runtimeEvents.ratios,e)},n.hasEvents=function(){return 0!==this.events.length},n.destroy=function(){return i.director.root.dataPoolManager&&i.director.root.dataPoolManager.releaseAnimationClip(this),HL.destroy(this),e.prototype.destroy.call(this)},n._createPropertyCurves=function(){var e=this;this._ratioSamplers=this._keys.map((function(t){return new yL(t.map((function(t){return t/e._duration})))})),this._runtimeCurves=this._curves.map((function(t){return{curve:new SL(t.data,e._duration),modifiers:t.modifiers,valueAdapter:t.valueAdapter,sampler:e._ratioSamplers[t.data.keys],commonTarget:t.commonTarget}})),this._applyStepness()},n._createRuntimeEvents=function(){for(var e,t=this,n=[],i=[],r=function(){var r=e.value,o=r.frame/t._duration,a=n.findIndex((function(e){return e===o}));a<0&&(a=n.length,n.push(o),i.push({events:[]})),i[a].events.push({functionName:r.func,parameters:r.params})},o=$(this.events.sort((function(e,t){return e.frame-t.frame})));!(e=o()).done;)r();this._runtimeEvents={ratios:n,eventGroups:i}},n._applyStepness=function(){},n._decodeCVTAs=function(){var e=ArrayBuffer.isView(this._nativeAsset)?this._nativeAsset.buffer:this._nativeAsset;if(e){for(var t=this._keys,n=0;n<t.length;++n){var i=t[n];i instanceof Pw&&(t[n]=i.decompress(e))}for(var r=0;r<this._curves.length;++r){var o=this._curves[r];o.data.values instanceof Pw&&(o.data.values=o.data.values.decompress(e))}}},n.validate=function(){return this.keys.length>0&&this.curves.length>0},X(t,[{key:"duration",get:function(){return this._duration},set:function(e){this._duration=e}},{key:"keys",get:function(){return this._keys},set:function(e){this._keys=e}},{key:"eventGroups",get:function(){return this._runtimeEvents||this._createRuntimeEvents(),this._runtimeEvents.eventGroups}},{key:"stepness",get:function(){return this._stepness},set:function(e){this._stepness=e,this._applyStepness()}},{key:"hash",get:function(){if(this._hash)return this._hash;var e=this._nativeAsset,t=new Uint8Array(ArrayBuffer.isView(e)?e.buffer:e);return this._hash=mc(t,666)}},{key:"curves",get:function(){return this._curves},set:function(e){this._curves=e,delete this._runtimeCurves}},{key:"data",get:function(){return this._data}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(e){this._commonTargets=e}}]),t}(Rf),FL.WrapMode=cu,bL=te((CL=zL).prototype,"sample",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),wL=te(CL.prototype,"speed",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),RL=te(CL.prototype,"wrapMode",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cu.Normal}}),IL=te(CL.prototype,"events",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),PL=te(CL.prototype,"enableTrsBlending",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),OL=te(CL.prototype,"_duration",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),DL=te(CL.prototype,"_keys",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),NL=te(CL.prototype,"_stepness",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ML=te(CL.prototype,"_curves",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),LL=te(CL.prototype,"_commonTargets",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),BL=te(CL.prototype,"_hash",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),AL=CL))||AL);function VL(e,t,n){var i=t[t.length-1];if(0!==t.length&&NM(i)&&!n){var r=VM.apply(void 0,[e].concat(t.slice(0,t.length-1)));return null===r?null:{setValue:function(e){r[i]=e},getValue:function(){return r[i]}}}if(n){var o=VM.apply(void 0,[e].concat(t));if(null===o)return null;var a=n.forTarget(o);return{setValue:function(e){a.set(e)},getValue:function(){return a.get?a.get():(p("Target doesn't provide a get method."),null)}}}return p("Empty animation curve."),null}function WL(e,t,n){var i=VL(e,t,n);if(null===i)return null;var r=i.getValue(),o=qL(r);if(!o)return p("Value is not copyable!"),null;var a=o.createBuffer(),s=o.copy;return Object.assign(i,{peek:function(){return a},pull:function(){var e=i.getValue();s(a,e)},push:function(){i.setValue(a)}})}i.AnimationClip=kL;var jL,qL=((jL=new Map).set(zn,{createBuffer:function(){return new zn},copy:zn.copy}),jL.set(yn,{createBuffer:function(){return new yn},copy:yn.copy}),jL.set(kn,{createBuffer:function(){return new kn},copy:kn.copy}),jL.set(gn,{createBuffer:function(){return new gn},copy:gn.copy}),jL.set(jn,{createBuffer:function(){return new jn},copy:function(e,t){return e.set(t)}}),function(e){return jL.get(null==e?void 0:e.constructor)}),XL=function(){function e(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var t=e.prototype;return t.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(P(3912)):(this._isPlaying=!0,this.onPlay())},t.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},t.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},t.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},t.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},t.update=function(){},t.onPlay=function(){},t.onPause=function(){},t.onResume=function(){},t.onStop=function(){},t.onError=function(){},X(e,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),e}(),YL=function(){function e(){this._nodeBlendStates=new Map,this._states=new Set}var t=e.prototype;return t.ref=function(e,t){var n=this._nodeBlendStates.get(e);n||(n={dirty:!1,properties:{}},this._nodeBlendStates.set(e,n));var i=n.properties[t];return i||(i=n.properties[t]=new QL(n,KL(t)?new yn:new bn)),++i.refCount,i},t.deRef=function(e,t){var n=this._nodeBlendStates.get(e);if(n){var i=n.properties[t];i&&(--i.refCount,i.refCount>0||(delete n.properties[t],function(e){return!(e.properties.position||e.properties.rotation||e.properties.eulerAngles||e.properties.scale)}(n)&&this._nodeBlendStates.delete(e)))}},t.apply=function(){this._nodeBlendStates.forEach((function(e,t){if(e.dirty){e.dirty=!1;var n,i,r,o=e.properties,a=o.position,s=o.scale,c=o.rotation,l=o.eulerAngles,u=!1;a&&0!==a.weight&&(a.weight=0,n=a.value,u=!0),s&&0!==s.weight&&(s.weight=0,i=s.value,u=!0),c&&0!==c.weight&&(c.weight=0,r=c.value,u=!0),l&&0!==l.weight&&(l.weight=0,r=l.value,u=!0),u&&t.setRTS(r,n,i)}})),this._states.forEach((function(e){e.onBlendFinished()}))},t.bindState=function(e){this._states.add(e)},t.unbindState=function(e){this._states.delete(e)},e}();function KL(e){return!function(e){return"rotation"===e}(e)}var ZL,QL=function(){function e(e,t){this.weight=0,this.value=void 0,this.refCount=0,this._node=void 0,this._node=e,this.value=t}return e.prototype.markAsDirty=function(){this._node.dirty=!0},e}();function JL(e,t,n){return 0===n.weight&&yn.zero(n.value),0===t?n.value:1===t?yn.copy(n.value,e):yn.scaleAndAdd(n.value,n.value,e,t)}function $L(e,t,n){if(0===n.weight&&bn.identity(n.value),0===t)return n.value;if(1===t)return bn.copy(n.value,e);var i=t/(n.weight+t);return bn.slerp(n.value,n.value,e,i)}!function(e){e.PLAY="play",e.STOP="stop",e.PAUSE="pause",e.RESUME="resume",e.LASTFRAME="lastframe",e.FINISHED="finished"}(ZL||(ZL={})),et(ZL);var eB=function(){function e(e,t,n){this.commonTargetIndex=void 0,this._curve=void 0,this._boundTarget=void 0,this._rootTargetProperty=void 0,this._curveDetail=void 0,this._curve=e.curve,this._curveDetail=e,this._boundTarget=n,this._shouldLerp=e.curve.hasLerp()}var t=e.prototype;return t.applySample=function(e,t,n,i,r){var o;o=this._shouldLerp&&n?this._curve.valueBetween(e,i.from,i.fromRatio,i.to,i.toRatio):this._curve.valueAt(t),this._setValue(o,r)},t._setValue=function(e){this._boundTarget.setValue(e)},X(e,[{key:"propertyName",get:function(){return this._rootTargetProperty||""}},{key:"curveDetail",get:function(){return this._curveDetail}}]),e}(),tB=e("AnimationState",function(e){function t(t,n){var i;return void 0===n&&(n=""),(i=e.call(this)||this).duration=1,i.speed=1,i.time=0,i.weight=0,i.frameRate=0,i._targetNode=null,i._curveLoaded=!1,i._clip=void 0,i._process=i.process,i._samplerSharedGroups=[],i._target=null,i._ignoreIndex=-1,i._commonTargetStatuses=[],i._wrapMode=cu.Normal,i._repeatCount=1,i._delay=0,i._delayTime=0,i._currentFramePlayed=!1,i._name=void 0,i._lastIterations=void 0,i._lastWrapInfo=null,i._lastWrapInfoEvent=null,i._wrappedInfo=new hu,i._blendStateBuffer=null,i._blendStateWriters=[],i._allowLastFrame=!1,i._blendStateWriterHost={weight:0,enabled:!1},i._playbackRange=void 0,i._playbackDuration=0,i._invDuration=1,i._clip=t,i._name=n||t&&t.name,i._playbackRange={min:0,max:i._clip.duration},i._playbackDuration=t.duration,t.duration||g("Clip "+t.name+" has zero duration."),i}K(t,e);var n=t.prototype;return n.initialize=function(e,t){var n,r,o=this;if(!this._curveLoaded){this._curveLoaded=!0,this._destroyBlendStateWriters(),this._samplerSharedGroups.length=0,this._blendStateBuffer=null!==(n=null===(r=i.director.getAnimationManager())||void 0===r?void 0:r.blendState)&&void 0!==n?n:null,this._blendStateBuffer&&this._blendStateBuffer.bindState(this),this._targetNode=e;var a=this._clip;this.duration=a.duration,this._invDuration=1/this.duration,this.speed=a.speed,this.wrapMode=a.wrapMode,this.frameRate=a.sample,this._playbackRange={min:0,max:a.duration},this._playbackDuration=a.duration,(this.wrapMode&su.Loop)===su.Loop?this.repeatCount=1/0:this.repeatCount=1;var s=function(e,t,n,i,r){if(!(a.enableTrsBlending&&function(e){var t;if(1===e.length&&"string"==typeof e[0])t=e[0];else if(e.length>1){for(var n=0;n<e.length-1;++n)if(!(e[n]instanceof GM))return!1;t=e[e.length-1]}switch(t){case"position":case"scale":case"rotation":case"eulerAngles":return!0;default:return!1}}(n)&&o._blendStateBuffer))return e(t,n,i);var s=VM.apply(void 0,[t].concat(n.slice(0,n.length-1)));if(null!==s&&s instanceof Vv){var c=n[n.length-1],l=function(e,t,n,i,r){var o=KL(n)?JL:$L,a=e.ref(t,n),s=!1,c=-1;return{destroy:function(){a&&(e.deRef(t,n),a=null)},forTarget:function(){return{get:function(){return t[n]},set:function(e){if(a&&i.enabled){var t=i.weight;if(r)if(1!==t||t!==c)s=!1;else if(s)return;o(e,t,a),a.weight+=t,a.markAsDirty(),s=!0,c=t}}}}}}(o._blendStateBuffer,s,c,o._blendStateWriterHost,r);return o._blendStateWriters.push(l),e(t,[],l)}return null};this._commonTargetStatuses=a.commonTargets.map((function(t){var n=s(WL,e,t.modifiers,t.valueAdapter,!1);return null===n?null:{target:n,changed:!1}})),t||(t=a.getPropertyCurves());for(var c=function(n){var i=t[n];if(i.curve.empty())return"continue";var r=o._samplerSharedGroups.find((function(e){return e.sampler===i.sampler}));r||(r={sampler:i.sampler,curves:[],samplerResultCache:{from:0,fromRatio:0,to:0,toRatio:0}},o._samplerSharedGroups.push(r));var a=void 0;if(void 0===i.commonTarget)a=e;else{var c=o._commonTargetStatuses[i.commonTarget];if(!c)return"continue";a=c.target.peek()}var l=s(VL,a,i.modifiers,i.valueAdapter,i.curve.constant());if(null===l);else{var u=new eB(i,a,l);u.commonTargetIndex=i.commonTarget,r.curves.push(u)}},l=0;l<t.length;++l)c(l)}},n.destroy=function(){this._destroyBlendStateWriters()},n.onBlendFinished=function(){this._blendStateWriterHost.enabled=!1},n.emit=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.director.getAnimationManager().pushDelayEvent(this._emit,this,t)},n.on=function(e,t,n){return this._target&&this._target.isValid?this._target.on(e,t,n):null},n.once=function(e,t,n){return this._target&&this._target.isValid?this._target.once(e,t,n):null},n.off=function(e,t,n){this._target&&this._target.isValid&&this._target.off(e,t,n)},n.allowLastFrameEvent=function(e){this._allowLastFrame=e},n._setEventTarget=function(e){this._target=e},n.setTime=function(e){this._currentFramePlayed=!1,this.time=e||0,this._lastWrapInfoEvent=null,this._ignoreIndex=-1;var t=this.getWrappedInfo(e,this._wrappedInfo),n=t.direction,i=this._clip.getEventGroupIndexAtRatio(t.ratio);i<0&&(i=~i-1,n<0&&(i+=1),this._ignoreIndex=i)},n.update=function(e){this._delayTime>0&&(this._delayTime-=e,this._delayTime>0)||(this._currentFramePlayed?this.time+=e*this.speed:this._currentFramePlayed=!0,this._process())},n.sample=function(){var e=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(e.ratio),this._sampleEvents(e),e},n.onPlay=function(){this.setTime(0),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(ZL.PLAY,this)},n.onStop=function(){this.isPaused||this._onPauseOrStop(),this.emit(ZL.STOP,this)},n.onResume=function(){this._onReplayOrResume(),this.emit(ZL.RESUME,this)},n.onPause=function(){this._onPauseOrStop(),this.emit(ZL.PAUSE,this)},n._sampleCurves=function(e){this._blendStateWriterHost.weight=this.weight,this._blendStateWriterHost.enabled=!0;for(var t=this._commonTargetStatuses,n=0,i=t.length;n<i;++n){var r=t[n];r&&(r.target.pull(),r.changed=!1)}for(var o=0,a=!1,s=this._samplerSharedGroups,c=0,l=s.length;c<l;++c){var u=s[c],h=u.sampler,_=u.samplerResultCache;a=!1,h?(o=h.sample(e))<0&&((o=~o)<=0?o=0:o>=h.ratios.length?o=h.ratios.length-1:(a=!0,_.from=o-1,_.fromRatio=h.ratios[_.from],_.to=o,_.toRatio=h.ratios[_.to],o=_.from)):o=0;for(var f=u.curves,d=0,p=f.length;d<p;++d){var m=f[d];if(m.applySample(e,o,a,_,this.weight),void 0!==m.commonTargetIndex){var g=t[m.commonTargetIndex];g&&(g.changed=!0)}}}for(var v=0,y=t.length;v<y;++v){var S=t[v];S&&S.changed&&S.target.push()}},n.process=function(){var e,t=this.sample();this._allowLastFrame&&(e=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new hu(t),this.repeatCount>1&&(0|t.iterations)>(0|e.iterations)&&this.emit(ZL.LASTFRAME,this),e.set(t)),t.stopped&&(this.stop(),this.emit(ZL.FINISHED,this))},n.simpleProcess=function(){var e=this._playbackRange.min,t=this._playbackDuration,n=this.time%t;n<0&&(n+=t);var i=(e+n)*this._invDuration;this._sampleCurves(i),this._clip.hasEvents()&&this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(void 0===this._lastIterations&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit(ZL.LASTFRAME,this),this._lastIterations=i)},n.cache=function(){},n._needReverse=function(e){var t=this.wrapMode,n=!1;return(t&su.PingPong)===su.PingPong&&(e-(0|e)==0&&e>0&&(e-=1),1&e&&(n=!n)),(t&su.Reverse)===su.Reverse&&(n=!n),n},n.getWrappedInfo=function(e,t){t=t||new hu;var n=this._getPlaybackStart(),i=this._getPlaybackEnd()-n,r=!1,o=this.repeatCount,a=e>0?e/i:-e/i;if(a>=o){a=o,r=!0;var s=o-(0|o);0===s&&(s=1),e=s*i*(e>0?1:-1)}if(e>i){var c=e%i;e=0===c?i:c}else e<0&&0!=(e%=i)&&(e+=i);var l=!1,u=this._wrapMode&su.ShouldWrap;u&&(l=this._needReverse(a));var h=l?-1:1;return this.speed<0&&(h*=-1),u&&l&&(e=i-e),t.time=n+e,t.ratio=t.time/this.duration,t.direction=h,t.stopped=r,t.iterations=a,t},n._getPlaybackStart=function(){return this._playbackRange.min},n._getPlaybackEnd=function(){return this._playbackRange.max},n._sampleEvents=function(e){var t=this._clip.eventGroups.length,n=e.direction,r=this._clip.getEventGroupIndexAtRatio(e.ratio);if(r<0&&(r=~r-1,n<0&&(r+=1)),this._ignoreIndex!==r&&(this._ignoreIndex=-1),e.frameIndex=r,!this._lastWrapInfoEvent)return this._fireEvent(r),void(this._lastWrapInfoEvent=new hu(e));var o=this.wrapMode,a=nB(e.iterations),s=this._lastWrapInfoEvent,c=nB(s.iterations),l=s.frameIndex,u=s.direction,h=-1!==c&&a!==c;if(l===r&&h&&1===t)this._fireEvent(0);else if(l!==r||h){n=u;do{if(l!==r){if(-1===n&&0===l&&r>0?((o&su.PingPong)===su.PingPong?n*=-1:l=t,c++):1===n&&l===t-1&&r<t-1&&((o&su.PingPong)===su.PingPong?n*=-1:l=-1,c++),l===r)break;if(c>a)break}l+=n,i.director.getAnimationManager().pushDelayEvent(this._fireEvent,this,[l])}while(l!==r&&l>-1&&l<t)}this._lastWrapInfoEvent.set(e)},n._emit=function(e,t){this._target&&this._target.isValid&&this._target.emit(e,e,t)},n._fireEvent=function(e){if(this._targetNode&&this._targetNode.isValid){var t=this._clip.eventGroups;if(!(e<0||e>=t.length||this._ignoreIndex===e))for(var n,i=t[e],r=this._targetNode.components,o=$(i.events);!(n=o()).done;)for(var a,s=n.value,c=s.functionName,l=$(r);!(a=l()).done;){var u=a.value,h=u[c];"function"==typeof h&&h.apply(u,s.parameters)}}},n._onReplayOrResume=function(){i.director.getAnimationManager().addAnimation(this)},n._onPauseOrStop=function(){i.director.getAnimationManager().removeAnimation(this)},n._destroyBlendStateWriters=function(){for(var e=0;e<this._blendStateWriters.length;++e)this._blendStateWriters[e].destroy();this._blendStateWriters.length=0,this._blendStateBuffer&&(this._blendStateBuffer.unbindState(this),this._blendStateBuffer=null),this._blendStateWriterHost.enabled=!1},X(t,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(e){this._wrapMode=e,this.time=0,e&su.Loop?this.repeatCount=1/0:this.repeatCount=1}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(e){this._repeatCount=e;var t=this._wrapMode&su.ShouldWrap,n=(this.wrapMode&su.Reverse)===su.Reverse;this._process=e!==1/0||t||n?this.process:this.simpleProcess}},{key:"delay",get:function(){return this._delay},set:function(e){this._delayTime=this._delay=e}},{key:"playbackRange",get:function(){return this._playbackRange},set:function(e){e.max,e.min,this._playbackRange.min=Math.max(e.min,0),this._playbackRange.max=Math.min(e.max,this.duration),this._playbackDuration=this._playbackRange.max-this._playbackRange.min,this.setTime(0)}},{key:"current",get:function(){return this.getWrappedInfo(this.time).time}},{key:"ratio",get:function(){return this.current/this.duration}},{key:"curveLoaded",get:function(){return this._curveLoaded}}]),t}(XL));function nB(e){return e-(0|e)==0&&(e-=1),0|e}i.AnimationState=tB;var iB,rB,oB,aB,sB,cB,lB,uB,hB,_B,fB,dB,pB,mB,gB,vB,yB,SB=function(e){function t(){var t;return(t=e.call(this)||this)._managedStates=[],t._fadings=[],t}K(t,e);var n=t.prototype;return n.update=function(e){if(!this.isMotionless){var t=this._managedStates,n=this._fadings;if(1===t.length&&1===n.length){var i=t[0].state;i&&(i.weight=1)}else this._calculateWeights(e);for(var r=0;r<t.length;++r){var o=t[r].state;o&&o.isMotionless&&o.sample()}}},n.crossFade=function(e,t){var n;0===this._managedStates.length&&(t=0),0===t&&this.clear();var i=this._managedStates.find((function(t){return t.state===e}));i?(null===(n=i.state)||void 0===n?void 0:n.isMotionless)&&i.state.play():(i={state:e,reference:0},e&&e.play(),this._managedStates.push(i)),++i.reference,this._fadings.unshift({easeDuration:t,easeTime:0,target:i})},n.clear=function(){for(var e=0;e<this._managedStates.length;++e){var t=this._managedStates[e].state;t&&t.stop()}this._managedStates.length=0,this._fadings.length=0},n.onPlay=function(){e.prototype.onPlay.call(this),i.director.getAnimationManager().addCrossFade(this)},n.onPause=function(){e.prototype.onPause.call(this),i.director.getAnimationManager().removeCrossFade(this);for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&n.pause()}},n.onResume=function(){e.prototype.onResume.call(this),i.director.getAnimationManager().addCrossFade(this);for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&n.resume()}},n.onStop=function(){e.prototype.onStop.call(this),i.director.getAnimationManager().removeCrossFade(this),this.clear()},n._calculateWeights=function(e){for(var t=this._managedStates,n=(this._fadings,0);n<t.length;++n){var i=t[n].state;i&&(i.weight=0)}for(var r=1,o=this._fadings.length,a=0;a<this._fadings.length;++a){var s=this._fadings[a];s.easeTime+=e;var c=0===s.easeDuration?1:$t(s.easeTime/s.easeDuration),l=c*r;if(r*=1-c,s.target.state&&(s.target.state.weight+=l),s.easeTime>=s.easeDuration){o=a+1,s.easeTime=s.easeDuration;break}}if(o!==this._fadings.length){for(var u=o;u<this._fadings.length;++u){var h=this._fadings[u];--h.target.reference,h.target.reference<=0&&(h.target.state&&h.target.state.stop(),oe(this._managedStates,h.target))}this._fadings.splice(o)}},t}(XL),EB=function(t){return e({AnimationComponent:t,Animation:t}),t}((iB=S_("cc.Animation"),rB=D_(),oB=T_(99),aB=R_(),sB=K_([kL]),cB=B_(),lB=K_(kL),uB=B_(),hB=B_(),_B=K_([kL]),iB(fB=rB(fB=oB(fB=w_(fB=aB((yB=vB=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"playOnLoad",pB,Q(t)),t._crossFade=new SB,t._nameToState=Se(!0),ee(t,"_clips",mB,Q(t)),ee(t,"_defaultClip",gB,Q(t)),t._hasBeenPlayed=!1,t}K(t,e);var n=t.prototype;return n.onLoad=function(){for(var e in this.clips=this._clips,this._nameToState)this._nameToState[e].initialize(this.node)},n.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},n.onEnable=function(){this._crossFade.resume()},n.onDisable=function(){this._crossFade.pause()},n.onDestroy=function(){for(var e in this._crossFade.stop(),this._nameToState)this._nameToState[e].destroy();this._nameToState=Se(!0)},n.play=function(e){if(this._hasBeenPlayed=!0,!e){if(!this._defaultClip)return;e=this._defaultClip.name}this.crossFade(e,0)},n.crossFade=function(e,t){void 0===t&&(t=.3),this._hasBeenPlayed=!0;var n=this._nameToState[e];n&&(this._crossFade.play(),this._crossFade.crossFade(n,t))},n.pause=function(){this._crossFade.pause()},n.resume=function(){this._crossFade.resume()},n.stop=function(){this._crossFade.stop()},n.getAnimationState=function(e){return this.getState(e)},n.getState=function(e){var t=this._nameToState[e];return t&&!t.curveLoaded&&t.initialize(this.node),t||null},n.createState=function(e,t){return t=t||e.name,this.removeState(t),this._doCreateState(e,t)},n.removeState=function(e){var t=this._nameToState[e];t&&(t.allowLastFrameEvent(!1),t.stop(),delete this._nameToState[e])},n.addClip=function(e,t){return ae(this._clips,e)||this._clips.push(e),this.createState(e,t)},n.removeClip=function(e,t){var n;for(var i in this._nameToState){var r=this._nameToState[i];if(r.clip===e){n=r;break}}if(e===this._defaultClip){if(!t)return void A(3902);this._defaultClip=null}if(n&&n.isPlaying){if(!t)return void A(3903);n.stop()}this._clips=this._clips.filter((function(t){return t!==e})),n&&delete this._nameToState[n.name]},n.on=function(t,n,i,r){var o=e.prototype.on.call(this,t,n,i,r);return t===ZL.LASTFRAME&&this._syncAllowLastFrameEvent(),o},n.once=function(t,n,i){var r=e.prototype.once.call(this,t,n,i);return t===ZL.LASTFRAME&&this._syncAllowLastFrameEvent(),r},n.off=function(t,n,i){e.prototype.off.call(this,t,n,i),t===ZL.LASTFRAME&&this._syncDisallowLastFrameEvent()},n._createState=function(e,t){return new tB(e,t)},n._doCreateState=function(e,t){var n=this._createState(e,t);return n._setEventTarget(this),n.allowLastFrameEvent(this.hasEventListener(ZL.LASTFRAME)),this.node&&n.initialize(this.node),this._nameToState[n.name]=n,n},n._getStateByNameOrDefaultClip=function(e){if(!e){if(!this._defaultClip)return null;e=this._defaultClip.name}return this._nameToState[e]||null},n._removeStateOfAutomaticClip=function(e){for(var t in this._nameToState){var n=this._nameToState[t];TB(e,n.clip)&&(n.stop(),delete this._nameToState[t])}},n._syncAllowLastFrameEvent=function(){if(this.hasEventListener(ZL.LASTFRAME))for(var e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!0)},n._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(ZL.LASTFRAME))for(var e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!1)},X(t,[{key:"clips",get:function(){return this._clips},set:function(e){var t=this;this._crossFade&&this._crossFade.clear();for(var n,i=$(this._clips);!(n=i()).done;){var r=n.value;r&&this._removeStateOfAutomaticClip(r)}for(var o,a=$(e);!(o=a()).done;){var s=o.value;s&&this.createState(s)}var c=e.find((function(e){return TB(e,t._defaultClip)}));this._defaultClip=c||null,this._clips=e}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(e){this._defaultClip=e,e&&(this._clips.findIndex((function(t){return TB(t,e)}))>=0||(this._clips.push(e),this.createState(e)))}}]),t}(ui(Xd)),vB.EventType=ZL,te((dB=yB).prototype,"clips",[sB,cB],Object.getOwnPropertyDescriptor(dB.prototype,"clips"),dB.prototype),te(dB.prototype,"defaultClip",[lB,uB],Object.getOwnPropertyDescriptor(dB.prototype,"defaultClip"),dB.prototype),pB=te(dB.prototype,"playOnLoad",[C_,hB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mB=te(dB.prototype,"_clips",[_B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gB=te(dB.prototype,"_defaultClip",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fB=dB))||fB)||fB)||fB)||fB)||fB));function TB(e,t){return e===t||!!e&&!!t&&e._uuid===t._uuid&&e._uuid}F(EB.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var e=arguments.length<=0?void 0:arguments[0];return EB.prototype.removeState.call(this,e.name)}}]),i.AnimationComponent=EB,Ke.setClassAlias(EB,"cc.AnimationComponent");var xB,AB,CB,bB=[],wB=new Map;function RB(e,t){for(var n=0,i=Mn.IDENTITY;e;){if(e.stamp===t||e.stamp+1===t&&!e.node.hasChangedFlags){i=e.world,e.stamp=t;break}e.stamp=t,bB[n++]=e,e=e.parent}for(;n>0;){var r=(e=bB[--n]).node;Mn.fromRTS(e.local,r.rotation,r.position,r.scale),i=Mn.multiply(e.world,i,e.local)}return i}function IB(e){for(var t=wB.get(e.uuid)||null;t;)wB.delete(t.node.uuid),t=t.parent}var PB=e("AnimationManager",S_((CB=AB=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._anims=new ne([]),t._delayEvents=[],t._blendStateBuffer=new YL,t._crossFades=[],t._sockets=[],t}K(t,e);var n=t.prototype;return n.addCrossFade=function(e){this._crossFades.push(e)},n.removeCrossFade=function(e){oe(this._crossFades,e)},n.update=function(e){for(var t=this._delayEvents,n=this._crossFades,r=this._sockets,o=0,a=n.length;o<a;o++)n[o].update(e);var s=this._anims,c=s.array;for(s.i=0;s.i<c.length;++s.i){var l=c[s.i];l.isMotionless||l.update(e)}this._blendStateBuffer.apply();for(var u=i.director.getTotalFrames(),h=0,_=r.length;h<_;h++){var f=r[h],d=f.target,p=f.transform;d.matrix=RB(p,u)}for(var m=0,g=t.length;m<g;m++){var v=t[m];v.fn.apply(v.thisArg,v.args)}t.length=0},n.destruct=function(){},n.addAnimation=function(e){-1===this._anims.array.indexOf(e)&&this._anims.push(e)},n.removeAnimation=function(e){var t=this._anims.array.indexOf(e);t>=0?this._anims.fastRemoveAt(t):b(3907)},n.pushDelayEvent=function(e,t,n){this._delayEvents.push({fn:e,thisArg:t,args:n})},n.addSockets=function(e,t){for(var n=this,i=function(i){var r=t[i];if(n._sockets.find((function(e){return e.target===r.target})))return"continue";var o=e.getChildByPath(r.path),a=r.target&&o&&function(e,t){for(var n,i=null,r=0;e!==t;){var o=e.uuid;if(wB.has(o)){i=wB.get(o);break}i={node:e,local:new Mn,world:new Mn,stamp:-1,parent:null},wB.set(o,i),bB[r++]=i,e=e.parent,i=null}for(;r>0;)(n=bB[--r]).parent=i,i=n;return i}(o,e);a&&n._sockets.push({target:r.target,transform:a})},r=0;r<t.length;++r)i(r)},n.removeSockets=function(e,t){for(var n=0;n<t.length;++n)for(var i=t[n],r=0;r<this._sockets.length;++r){var o=this._sockets[r];if(o.target===i.target){IB(o.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},X(t,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),t}(ew),AB.ID="animation",xB=CB))||xB);SO.on(yO.EVENT_INIT,(function(){var e=new PB;SO.registerSystem(PB.ID,e,aw.PRIORITY_SYSTEM)})),i.AnimationManager=PB;var OB,DB,NB,MB,LB=new Mn;i.easing=Qb;var BB=e("HierachyModifier",S_("cc.HierachyModifier")(OB=function(e){function t(){return e.apply(this,arguments)||this}return K(t,e),t}(GM))||OB);i.HierachyModifier=BB;var FB=e("ComponentModifier",S_("cc.ComponentModifier")(DB=function(e){function t(){return e.apply(this,arguments)||this}return K(t,e),t}(kM))||DB);i.ComponentModifier=FB;var zB=e("CurveValueAdapter",S_("cc.CurveValueAdapter")(NB=function(){function e(){}return e.prototype.forTarget=function(){return{set:function(){}}},e}())||NB);i.CurveValueAdapter=zB;var UB=e("UniformCurveValueAdapter",S_("cc.UniformCurveValueAdapter")(MB=function(e){function t(){return e.apply(this,arguments)||this}return K(t,e),t}(tL))||MB);function HB(e){return"string"==typeof e}function GB(e){return"number"==typeof e}function kB(e,t){return e instanceof t}i.UniformCurveValueAdapter=UB,i.isPropertyModifier=HB,i.isElementModifier=GB,i.isCustomTargetModifier=kB,i.math=Kn,i.geometry=bu;var VB=e("NodePool",function(){function e(e){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=e,this._pool=[]}var t=e.prototype;return t.size=function(){return this._pool.length},t.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy();this._pool.length=0},t.put=function(e){if(e&&-1===this._pool.indexOf(e)){e.removeFromParent();var t=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;t&&t.unuse&&t.unuse(),this._pool.push(e)}},t.get=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this._pool.length-1;if(i<0)return null;var r=this._pool[i];this._pool.length=i;var o=this.poolHandlerComp?r.getComponent(this.poolHandlerComp):null;return o&&o.reuse&&o.reuse(arguments),r},e}());i.NodePool=VB,i.renderer=yb;var WB,jB=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gpuDescriptorSet=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){this._layout=e.layout;var t=e.layout.gpuDescriptorSetLayout,n=t.bindings,i=t.descriptorIndices,r=t.descriptorCount;this._buffers=Array(r).fill(null),this._textures=Array(r).fill(null),this._samplers=Array(r).fill(null);var o=[];this._gpuDescriptorSet={gpuDescriptors:o,descriptorIndices:i};for(var a=0;a<n.length;++a)for(var s=n[a],c=0;c<s.count;c++)o.push({type:s.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null});return!0},n.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},n.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var e=this._gpuDescriptorSet.gpuDescriptors,t=0;t<e.length;++t)if(e[t].type&ec){var n=this._buffers[t];n&&(e[t].gpuBuffer=n.gpuBuffer||n.gpuBufferView)}else e[t].type&tc&&(this._textures[t]&&(e[t].gpuTexture=this._textures[t].gpuTexture),this._samplers[t]&&(e[t].gpuSampler=this._samplers[t].gpuSampler));this._isDirty=!1}},X(t,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),t}(vc);function qB(e,t){switch(e){case ya.R8:return t.UNSIGNED_BYTE;case ya.R8SN:return t.BYTE;case ya.R8UI:return t.UNSIGNED_BYTE;case ya.R8I:return t.BYTE;case ya.R16F:return WB.HALF_FLOAT_OES;case ya.R16UI:return t.UNSIGNED_SHORT;case ya.R16I:return t.SHORT;case ya.R32F:return t.FLOAT;case ya.R32UI:return t.UNSIGNED_INT;case ya.R32I:return t.INT;case ya.RG8:return t.UNSIGNED_BYTE;case ya.RG8SN:return t.BYTE;case ya.RG8UI:return t.UNSIGNED_BYTE;case ya.RG8I:return t.BYTE;case ya.RG16F:return WB.HALF_FLOAT_OES;case ya.RG16UI:return t.UNSIGNED_SHORT;case ya.RG16I:return t.SHORT;case ya.RG32F:return t.FLOAT;case ya.RG32UI:return t.UNSIGNED_INT;case ya.RG32I:return t.INT;case ya.RGB8:case ya.SRGB8:return t.UNSIGNED_BYTE;case ya.RGB8SN:return t.BYTE;case ya.RGB8UI:return t.UNSIGNED_BYTE;case ya.RGB8I:return t.BYTE;case ya.RGB16F:return WB.HALF_FLOAT_OES;case ya.RGB16UI:return t.UNSIGNED_SHORT;case ya.RGB16I:return t.SHORT;case ya.RGB32F:return t.FLOAT;case ya.RGB32UI:return t.UNSIGNED_INT;case ya.RGB32I:return t.INT;case ya.BGRA8:case ya.RGBA8:case ya.SRGB8_A8:return t.UNSIGNED_BYTE;case ya.RGBA8SN:return t.BYTE;case ya.RGBA8UI:return t.UNSIGNED_BYTE;case ya.RGBA8I:return t.BYTE;case ya.RGBA16F:return WB.HALF_FLOAT_OES;case ya.RGBA16UI:return t.UNSIGNED_SHORT;case ya.RGBA16I:return t.SHORT;case ya.RGBA32F:return t.FLOAT;case ya.RGBA32UI:return t.UNSIGNED_INT;case ya.RGBA32I:return t.INT;case ya.R5G6B5:return t.UNSIGNED_SHORT_5_6_5;case ya.R11G11B10F:return t.FLOAT;case ya.RGB5A1:return t.UNSIGNED_SHORT_5_5_5_1;case ya.RGBA4:return t.UNSIGNED_SHORT_4_4_4_4;case ya.RGB10A2:return t.UNSIGNED_BYTE;case ya.RGB10A2UI:return t.UNSIGNED_INT;case ya.RGB9E5:return t.UNSIGNED_BYTE;case ya.D16:return t.UNSIGNED_SHORT;case ya.D16S8:return WB.UNSIGNED_INT_24_8_WEBGL;case ya.D24:return t.UNSIGNED_INT;case ya.D24S8:return WB.UNSIGNED_INT_24_8_WEBGL;case ya.D32F:return t.UNSIGNED_INT;case ya.D32F_S8:return WB.UNSIGNED_INT_24_8_WEBGL;case ya.BC1:case ya.BC1_SRGB:case ya.BC2:case ya.BC2_SRGB:case ya.BC3:case ya.BC3_SRGB:case ya.BC4:return t.UNSIGNED_BYTE;case ya.BC4_SNORM:return t.BYTE;case ya.BC5:return t.UNSIGNED_BYTE;case ya.BC5_SNORM:return t.BYTE;case ya.BC6H_SF16:case ya.BC6H_UF16:return t.FLOAT;case ya.BC7:case ya.BC7_SRGB:case ya.ETC_RGB8:case ya.ETC2_RGB8:case ya.ETC2_SRGB8:case ya.ETC2_RGB8_A1:case ya.ETC2_SRGB8_A1:case ya.EAC_R11:return t.UNSIGNED_BYTE;case ya.EAC_R11SN:return t.BYTE;case ya.EAC_RG11:return t.UNSIGNED_BYTE;case ya.EAC_RG11SN:return t.BYTE;case ya.PVRTC_RGB2:case ya.PVRTC_RGBA2:case ya.PVRTC_RGB4:case ya.PVRTC_RGBA4:case ya.PVRTC2_2BPP:case ya.PVRTC2_4BPP:return t.UNSIGNED_BYTE;case ya.ASTC_RGBA_4x4:case ya.ASTC_RGBA_5x4:case ya.ASTC_RGBA_5x5:case ya.ASTC_RGBA_6x5:case ya.ASTC_RGBA_6x6:case ya.ASTC_RGBA_8x5:case ya.ASTC_RGBA_8x6:case ya.ASTC_RGBA_8x8:case ya.ASTC_RGBA_10x5:case ya.ASTC_RGBA_10x6:case ya.ASTC_RGBA_10x8:case ya.ASTC_RGBA_10x10:case ya.ASTC_RGBA_12x10:case ya.ASTC_RGBA_12x12:case ya.ASTC_SRGBA_4x4:case ya.ASTC_SRGBA_5x4:case ya.ASTC_SRGBA_5x5:case ya.ASTC_SRGBA_6x5:case ya.ASTC_SRGBA_6x6:case ya.ASTC_SRGBA_8x5:case ya.ASTC_SRGBA_8x6:case ya.ASTC_SRGBA_8x8:case ya.ASTC_SRGBA_10x5:case ya.ASTC_SRGBA_10x6:case ya.ASTC_SRGBA_10x8:case ya.ASTC_SRGBA_10x10:case ya.ASTC_SRGBA_12x10:case ya.ASTC_SRGBA_12x12:default:return t.UNSIGNED_BYTE}}function XB(e,t){switch(e){case ya.A8:return t.ALPHA;case ya.L8:return t.LUMINANCE;case ya.LA8:return t.LUMINANCE_ALPHA;case ya.RGB8:case ya.RGB16F:case ya.RGB32F:return t.RGB;case ya.BGRA8:case ya.RGBA8:case ya.RGBA16F:case ya.RGBA32F:return t.RGBA;case ya.R5G6B5:return t.RGB565;case ya.RGB5A1:return t.RGB5_A1;case ya.RGBA4:return t.RGBA4;case ya.D16:return t.DEPTH_COMPONENT;case ya.D16S8:return t.DEPTH_STENCIL;case ya.D24:return t.DEPTH_COMPONENT;case ya.D24S8:return t.DEPTH_STENCIL;case ya.D32F:return t.DEPTH_COMPONENT;case ya.D32F_S8:return t.DEPTH_STENCIL;case ya.BC1:return WB.COMPRESSED_RGB_S3TC_DXT1_EXT;case ya.BC1_ALPHA:return WB.COMPRESSED_RGBA_S3TC_DXT1_EXT;case ya.BC1_SRGB:return WB.COMPRESSED_SRGB_S3TC_DXT1_EXT;case ya.BC1_SRGB_ALPHA:return WB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case ya.BC2:return WB.COMPRESSED_RGBA_S3TC_DXT3_EXT;case ya.BC2_SRGB:return WB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case ya.BC3:return WB.COMPRESSED_RGBA_S3TC_DXT5_EXT;case ya.BC3_SRGB:return WB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case ya.ETC_RGB8:return WB.COMPRESSED_RGB_ETC1_WEBGL;case ya.ETC2_RGB8:return WB.COMPRESSED_RGB8_ETC2;case ya.ETC2_SRGB8:return WB.COMPRESSED_SRGB8_ETC2;case ya.ETC2_RGB8_A1:return WB.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case ya.ETC2_SRGB8_A1:return WB.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case ya.ETC2_RGBA8:return WB.COMPRESSED_RGBA8_ETC2_EAC;case ya.ETC2_SRGB8_A8:return WB.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case ya.EAC_R11:return WB.COMPRESSED_R11_EAC;case ya.EAC_R11SN:return WB.COMPRESSED_SIGNED_R11_EAC;case ya.EAC_RG11:return WB.COMPRESSED_RG11_EAC;case ya.EAC_RG11SN:return WB.COMPRESSED_SIGNED_RG11_EAC;case ya.PVRTC_RGB2:return WB.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case ya.PVRTC_RGBA2:return WB.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case ya.PVRTC_RGB4:return WB.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case ya.PVRTC_RGBA4:return WB.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case ya.ASTC_RGBA_4x4:return WB.COMPRESSED_RGBA_ASTC_4x4_KHR;case ya.ASTC_RGBA_5x4:return WB.COMPRESSED_RGBA_ASTC_5x4_KHR;case ya.ASTC_RGBA_5x5:return WB.COMPRESSED_RGBA_ASTC_5x5_KHR;case ya.ASTC_RGBA_6x5:return WB.COMPRESSED_RGBA_ASTC_6x5_KHR;case ya.ASTC_RGBA_6x6:return WB.COMPRESSED_RGBA_ASTC_6x6_KHR;case ya.ASTC_RGBA_8x5:return WB.COMPRESSED_RGBA_ASTC_8x5_KHR;case ya.ASTC_RGBA_8x6:return WB.COMPRESSED_RGBA_ASTC_8x6_KHR;case ya.ASTC_RGBA_8x8:return WB.COMPRESSED_RGBA_ASTC_8x8_KHR;case ya.ASTC_RGBA_10x5:return WB.COMPRESSED_RGBA_ASTC_10x5_KHR;case ya.ASTC_RGBA_10x6:return WB.COMPRESSED_RGBA_ASTC_10x6_KHR;case ya.ASTC_RGBA_10x8:return WB.COMPRESSED_RGBA_ASTC_10x8_KHR;case ya.ASTC_RGBA_10x10:return WB.COMPRESSED_RGBA_ASTC_10x10_KHR;case ya.ASTC_RGBA_12x10:return WB.COMPRESSED_RGBA_ASTC_12x10_KHR;case ya.ASTC_RGBA_12x12:return WB.COMPRESSED_RGBA_ASTC_12x12_KHR;case ya.ASTC_SRGBA_4x4:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case ya.ASTC_SRGBA_5x4:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case ya.ASTC_SRGBA_5x5:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case ya.ASTC_SRGBA_6x5:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case ya.ASTC_SRGBA_6x6:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case ya.ASTC_SRGBA_8x5:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case ya.ASTC_SRGBA_8x6:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case ya.ASTC_SRGBA_8x8:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case ya.ASTC_SRGBA_10x5:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case ya.ASTC_SRGBA_10x6:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case ya.ASTC_SRGBA_10x8:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case ya.ASTC_SRGBA_10x10:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case ya.ASTC_SRGBA_12x10:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case ya.ASTC_SRGBA_12x12:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),t.RGBA}}function YB(e,t){switch(e){case ya.A8:return t.ALPHA;case ya.L8:return t.LUMINANCE;case ya.LA8:return t.LUMINANCE_ALPHA;case ya.RGB8:case ya.RGB16F:case ya.RGB32F:return t.RGB;case ya.BGRA8:case ya.RGBA8:case ya.RGBA16F:case ya.RGBA32F:return t.RGBA;case ya.R5G6B5:return t.RGB;case ya.RGB5A1:case ya.RGBA4:return t.RGBA;case ya.D16:return t.DEPTH_COMPONENT;case ya.D16S8:return t.DEPTH_STENCIL;case ya.D24:return t.DEPTH_COMPONENT;case ya.D24S8:return t.DEPTH_STENCIL;case ya.D32F:return t.DEPTH_COMPONENT;case ya.D32F_S8:return t.DEPTH_STENCIL;case ya.BC1:return WB.COMPRESSED_RGB_S3TC_DXT1_EXT;case ya.BC1_ALPHA:return WB.COMPRESSED_RGBA_S3TC_DXT1_EXT;case ya.BC1_SRGB:return WB.COMPRESSED_SRGB_S3TC_DXT1_EXT;case ya.BC1_SRGB_ALPHA:return WB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case ya.BC2:return WB.COMPRESSED_RGBA_S3TC_DXT3_EXT;case ya.BC2_SRGB:return WB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case ya.BC3:return WB.COMPRESSED_RGBA_S3TC_DXT5_EXT;case ya.BC3_SRGB:return WB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case ya.ETC_RGB8:return WB.COMPRESSED_RGB_ETC1_WEBGL;case ya.ETC2_RGB8:return WB.COMPRESSED_RGB8_ETC2;case ya.ETC2_SRGB8:return WB.COMPRESSED_SRGB8_ETC2;case ya.ETC2_RGB8_A1:return WB.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case ya.ETC2_SRGB8_A1:return WB.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case ya.ETC2_RGBA8:return WB.COMPRESSED_RGBA8_ETC2_EAC;case ya.ETC2_SRGB8_A8:return WB.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case ya.EAC_R11:return WB.COMPRESSED_R11_EAC;case ya.EAC_R11SN:return WB.COMPRESSED_SIGNED_R11_EAC;case ya.EAC_RG11:return WB.COMPRESSED_RG11_EAC;case ya.EAC_RG11SN:return WB.COMPRESSED_SIGNED_RG11_EAC;case ya.PVRTC_RGB2:return WB.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case ya.PVRTC_RGBA2:return WB.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case ya.PVRTC_RGB4:return WB.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case ya.PVRTC_RGBA4:return WB.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case ya.ASTC_RGBA_4x4:return WB.COMPRESSED_RGBA_ASTC_4x4_KHR;case ya.ASTC_RGBA_5x4:return WB.COMPRESSED_RGBA_ASTC_5x4_KHR;case ya.ASTC_RGBA_5x5:return WB.COMPRESSED_RGBA_ASTC_5x5_KHR;case ya.ASTC_RGBA_6x5:return WB.COMPRESSED_RGBA_ASTC_6x5_KHR;case ya.ASTC_RGBA_6x6:return WB.COMPRESSED_RGBA_ASTC_6x6_KHR;case ya.ASTC_RGBA_8x5:return WB.COMPRESSED_RGBA_ASTC_8x5_KHR;case ya.ASTC_RGBA_8x6:return WB.COMPRESSED_RGBA_ASTC_8x6_KHR;case ya.ASTC_RGBA_8x8:return WB.COMPRESSED_RGBA_ASTC_8x8_KHR;case ya.ASTC_RGBA_10x5:return WB.COMPRESSED_RGBA_ASTC_10x5_KHR;case ya.ASTC_RGBA_10x6:return WB.COMPRESSED_RGBA_ASTC_10x6_KHR;case ya.ASTC_RGBA_10x8:return WB.COMPRESSED_RGBA_ASTC_10x8_KHR;case ya.ASTC_RGBA_10x10:return WB.COMPRESSED_RGBA_ASTC_10x10_KHR;case ya.ASTC_RGBA_12x10:return WB.COMPRESSED_RGBA_ASTC_12x10_KHR;case ya.ASTC_RGBA_12x12:return WB.COMPRESSED_RGBA_ASTC_12x12_KHR;case ya.ASTC_SRGBA_4x4:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case ya.ASTC_SRGBA_5x4:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case ya.ASTC_SRGBA_5x5:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case ya.ASTC_SRGBA_6x5:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case ya.ASTC_SRGBA_6x6:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case ya.ASTC_SRGBA_8x5:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case ya.ASTC_SRGBA_8x6:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case ya.ASTC_SRGBA_8x8:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case ya.ASTC_SRGBA_10x5:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case ya.ASTC_SRGBA_10x6:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case ya.ASTC_SRGBA_10x8:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case ya.ASTC_SRGBA_10x10:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case ya.ASTC_SRGBA_12x10:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case ya.ASTC_SRGBA_12x12:return WB.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),t.RGBA}}function KB(e,t){switch(e){case Ea.BOOL:return t.BOOL;case Ea.BOOL2:return t.BOOL_VEC2;case Ea.BOOL3:return t.BOOL_VEC3;case Ea.BOOL4:return t.BOOL_VEC4;case Ea.INT:return t.INT;case Ea.INT2:return t.INT_VEC2;case Ea.INT3:return t.INT_VEC3;case Ea.INT4:return t.INT_VEC4;case Ea.UINT:return t.UNSIGNED_INT;case Ea.FLOAT:return t.FLOAT;case Ea.FLOAT2:return t.FLOAT_VEC2;case Ea.FLOAT3:return t.FLOAT_VEC3;case Ea.FLOAT4:return t.FLOAT_VEC4;case Ea.MAT2:return t.FLOAT_MAT2;case Ea.MAT3:return t.FLOAT_MAT3;case Ea.MAT4:return t.FLOAT_MAT4;case Ea.SAMPLER2D:return t.SAMPLER_2D;case Ea.SAMPLER_CUBE:return t.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),Ea.UNKNOWN}}function ZB(e){switch(e){case Ea.BOOL:case Ea.BOOL2:case Ea.BOOL3:case Ea.BOOL4:case Ea.INT:case Ea.INT2:case Ea.INT3:case Ea.INT4:case Ea.UINT:return Int32Array;case Ea.FLOAT:case Ea.FLOAT2:case Ea.FLOAT3:case Ea.FLOAT4:case Ea.MAT2:case Ea.MAT3:case Ea.MAT4:return Float32Array;default:return console.error("Unsupported GLType, convert to TypedArrayConstructor failed."),Float32Array}}function QB(e,t){switch(e){case t.BOOL:return Ea.BOOL;case t.BOOL_VEC2:return Ea.BOOL2;case t.BOOL_VEC3:return Ea.BOOL3;case t.BOOL_VEC4:return Ea.BOOL4;case t.INT:return Ea.INT;case t.INT_VEC2:return Ea.INT2;case t.INT_VEC3:return Ea.INT3;case t.INT_VEC4:return Ea.INT4;case t.UNSIGNED_INT:return Ea.UINT;case t.FLOAT:return Ea.FLOAT;case t.FLOAT_VEC2:return Ea.FLOAT2;case t.FLOAT_VEC3:return Ea.FLOAT3;case t.FLOAT_VEC4:return Ea.FLOAT4;case t.FLOAT_MAT2:return Ea.MAT2;case t.FLOAT_MAT3:return Ea.MAT3;case t.FLOAT_MAT4:return Ea.MAT4;case t.SAMPLER_2D:return Ea.SAMPLER2D;case t.SAMPLER_CUBE:return Ea.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),Ea.UNKNOWN}}function JB(e,t){switch(e){case t.BOOL:return 4;case t.BOOL_VEC2:return 8;case t.BOOL_VEC3:return 12;case t.BOOL_VEC4:return 16;case t.INT:return 4;case t.INT_VEC2:return 8;case t.INT_VEC3:return 12;case t.INT_VEC4:return 16;case t.UNSIGNED_INT:case t.FLOAT:return 4;case t.FLOAT_VEC2:return 8;case t.FLOAT_VEC3:return 12;case t.FLOAT_VEC4:case t.FLOAT_MAT2:return 16;case t.FLOAT_MAT3:return 36;case t.FLOAT_MAT4:return 64;case t.SAMPLER_2D:case t.SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function $B(e,t){switch(e){case t.FLOAT_MAT2:return 2;case t.FLOAT_MAT3:return 3;case t.FLOAT_MAT4:return 4;default:return 1}}!function(e){e[e.RGBA16F_EXT=34842]="RGBA16F_EXT",e[e.RGB16F_EXT=34843]="RGB16F_EXT",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(WB||(WB={}));var eF,tF=[512,513,514,515,516,517,518,519],nF=[0,7680,7681,7682,7683,5386,34055,34056],iF=[32774,32778,32779,32775,32776],rF=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(e){e[e.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",e[e.END_RENDER_PASS=1]="END_RENDER_PASS",e[e.BIND_STATES=2]="BIND_STATES",e[e.DRAW=3]="DRAW",e[e.UPDATE_BUFFER=4]="UPDATE_BUFFER",e[e.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",e[e.COUNT=6]="COUNT"}(eF||(eF={}));var oF=function(e){this.cmdType=void 0,this.refCount=0,this.cmdType=e},aF=function(e){function t(){var t;return(t=e.call(this,eF.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,t.gpuFramebuffer=null,t.renderArea=new os,t.clearFlag=Qa.NONE,t.clearColors=[],t.clearDepth=1,t.clearStencil=0,t}return K(t,e),t.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},t}(oF),sF=function(e){function t(){var t;return(t=e.call(this,eF.BIND_STATES)||this).gpuPipelineState=null,t.gpuInputAssembler=null,t.gpuDescriptorSets=[],t.dynamicOffsets=[],t.viewport=null,t.scissor=null,t.lineWidth=null,t.depthBias=null,t.blendConstants=[],t.depthBounds=null,t.stencilWriteMask=null,t.stencilCompareMask=null,t}return K(t,e),t.prototype.clear=function(){this.gpuPipelineState=null,this.gpuDescriptorSets.length=0,this.gpuInputAssembler=null,this.dynamicOffsets.length=0,this.viewport=null,this.scissor=null,this.lineWidth=null,this.depthBias=null,this.blendConstants.length=0,this.depthBounds=null,this.stencilWriteMask=null,this.stencilCompareMask=null},t}(oF),cF=function(e){function t(){var t;return(t=e.call(this,eF.DRAW)||this).drawInfo=new gs,t}return K(t,e),t.prototype.clear=function(){},t}(oF),lF=function(e){function t(){var t;return(t=e.call(this,eF.UPDATE_BUFFER)||this).gpuBuffer=null,t.buffer=null,t.offset=0,t.size=0,t}return K(t,e),t.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},t}(oF),uF=function(e){function t(){var t;return(t=e.call(this,eF.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,t.buffers=[],t.regions=[],t}return K(t,e),t.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},t}(oF),hF=function(){function e(){this.cmds=new Jn(1),this.beginRenderPassCmds=new Jn(1),this.bindStatesCmds=new Jn(1),this.drawCmds=new Jn(1),this.updateBufferCmds=new Jn(1),this.copyBufferToTextureCmds=new Jn(1)}return e.prototype.clearCmds=function(e){this.beginRenderPassCmds.length&&(e.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(e.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(e.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(e.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(e.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},e}();function _F(e,t,n,i,r){if(t.usage&Ta.UNIFORM)ArrayBuffer.isView(n)?t.vf32.set(n,i/Float32Array.BYTES_PER_ELEMENT):t.vf32.set(new Float32Array(n),i/Float32Array.BYTES_PER_ELEMENT);else if(t.usage&Ta.INDIRECT)t.indirects.length=i,Array.prototype.push.apply(t.indirects,n.drawInfos);else{var o=n,a=e.gl,s=e.stateCache;switch(t.glTarget){case a.ARRAY_BUFFER:e.useVAO&&s.glVAO&&(e.OES_vertex_array_object.bindVertexArrayOES(null),s.glVAO=fF.gpuInputAssembler=null),e.stateCache.glArrayBuffer!==t.glBuffer&&(a.bindBuffer(a.ARRAY_BUFFER,t.glBuffer),e.stateCache.glArrayBuffer=t.glBuffer);break;case a.ELEMENT_ARRAY_BUFFER:e.useVAO&&s.glVAO&&(e.OES_vertex_array_object.bindVertexArrayOES(null),s.glVAO=fF.gpuInputAssembler=null),e.stateCache.glElementArrayBuffer!==t.glBuffer&&(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t.glBuffer),e.stateCache.glElementArrayBuffer=t.glBuffer);break;default:return void console.error("Unsupported BufferType, update buffer failed.")}r===o.byteLength?a.bufferSubData(t.glTarget,i,o):a.bufferSubData(t.glTarget,i,o.slice(0,r))}}var fF={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0};function dF(e,t,n,i,r,o,a){var s=e.gl,c=e.stateCache,l=0;if(n&&t){c.glFramebuffer!==n.glFramebuffer&&(s.bindFramebuffer(s.FRAMEBUFFER,n.glFramebuffer),c.glFramebuffer=n.glFramebuffer),c.viewport.left===i.x&&c.viewport.top===i.y&&c.viewport.width===i.width&&c.viewport.height===i.height||(s.viewport(i.x,i.y,i.width,i.height),c.viewport.left=i.x,c.viewport.top=i.y,c.viewport.width=i.width,c.viewport.height=i.height),c.scissorRect.x===i.x&&c.scissorRect.y===i.y&&c.scissorRect.width===i.width&&c.scissorRect.height===i.height||(s.scissor(i.x,i.y,i.width,i.height),c.scissorRect.x=i.x,c.scissorRect.y=i.y,c.scissorRect.width=i.width,c.scissorRect.height=i.height);var u=r.length;e.WEBGL_draw_buffers||(u=1);for(var h=0;h<u;++h){var _=t.colorAttachments[h];if(_.format!==ya.UNKNOWN)switch(_.loadOp){case za.LOAD:break;case za.CLEAR:c.bs.targets[0].blendColorMask!==Ba.ALL&&s.colorMask(!0,!0,!0,!0);var f=r[0];s.clearColor(f.x,f.y,f.z,f.w),l|=s.COLOR_BUFFER_BIT;break;case za.DISCARD:}}if(t.depthStencilAttachment&&t.depthStencilAttachment.format!==ya.UNKNOWN){switch(t.depthStencilAttachment.depthLoadOp){case za.LOAD:break;case za.CLEAR:c.dss.depthWrite||s.depthMask(!0),s.clearDepth(o),l|=s.DEPTH_BUFFER_BIT;break;case za.DISCARD:}if($s[t.depthStencilAttachment.format].hasStencil)switch(t.depthStencilAttachment.stencilLoadOp){case za.LOAD:break;case za.CLEAR:c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,65535),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,65535),s.clearStencil(a),l|=s.STENCIL_BUFFER_BIT;break;case za.DISCARD:}}if(l&&s.clear(l),l&s.COLOR_BUFFER_BIT){var d=c.bs.targets[0].blendColorMask;if(d!==Ba.ALL){var p=(d&Ba.R)!==Ba.NONE,m=(d&Ba.G)!==Ba.NONE,g=(d&Ba.B)!==Ba.NONE,v=(d&Ba.A)!==Ba.NONE;s.colorMask(p,m,g,v)}}l&s.DEPTH_BUFFER_BIT&&!c.dss.depthWrite&&s.depthMask(!1),l&s.STENCIL_BUFFER_BIT&&(c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,0),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,0))}}function pF(e,t,n,i,r,o,a,s,c,l,u,h,_){var f,d,m,g=e.gl,v=e.stateCache,y=t&&t.gpuShader,S=!1;if(t&&fF.gpuPipelineState!==t){if(fF.gpuPipelineState=t,fF.glPrimitive=t.glPrimitive,t.gpuShader){var E=t.gpuShader.glProgram;v.glProgram!==E&&(g.useProgram(E),v.glProgram=E,S=!0)}var T=t.rs;if(T){if(v.rs.cullMode!==T.cullMode){switch(T.cullMode){case ja.NONE:g.disable(g.CULL_FACE);break;case ja.FRONT:g.enable(g.CULL_FACE),g.cullFace(g.FRONT);break;case ja.BACK:g.enable(g.CULL_FACE),g.cullFace(g.BACK)}v.rs.cullMode=T.cullMode}var x=T.isFrontFaceCCW;v.rs.isFrontFaceCCW!==x&&(g.frontFace(x?g.CCW:g.CW),v.rs.isFrontFaceCCW=x),v.rs.depthBias===T.depthBias&&v.rs.depthBiasSlop===T.depthBiasSlop||(g.polygonOffset(T.depthBias,T.depthBiasSlop),v.rs.depthBias=T.depthBias,v.rs.depthBiasSlop=T.depthBiasSlop),v.rs.lineWidth!==T.lineWidth&&(g.lineWidth(T.lineWidth),v.rs.lineWidth=T.lineWidth)}var A=t.dss;A&&(v.dss.depthTest!==A.depthTest&&(A.depthTest?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),v.dss.depthTest=A.depthTest),v.dss.depthWrite!==A.depthWrite&&(g.depthMask(A.depthWrite),v.dss.depthWrite=A.depthWrite),v.dss.depthFunc!==A.depthFunc&&(g.depthFunc(tF[A.depthFunc]),v.dss.depthFunc=A.depthFunc),v.dss.stencilTestFront===A.stencilTestFront&&v.dss.stencilTestBack===A.stencilTestBack||(A.stencilTestFront||A.stencilTestBack?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),v.dss.stencilTestFront=A.stencilTestFront,v.dss.stencilTestBack=A.stencilTestBack),v.dss.stencilFuncFront===A.stencilFuncFront&&v.dss.stencilRefFront===A.stencilRefFront&&v.dss.stencilReadMaskFront===A.stencilReadMaskFront||(g.stencilFuncSeparate(g.FRONT,tF[A.stencilFuncFront],A.stencilRefFront,A.stencilReadMaskFront),v.dss.stencilFuncFront=A.stencilFuncFront,v.dss.stencilRefFront=A.stencilRefFront,v.dss.stencilReadMaskFront=A.stencilReadMaskFront),v.dss.stencilFailOpFront===A.stencilFailOpFront&&v.dss.stencilZFailOpFront===A.stencilZFailOpFront&&v.dss.stencilPassOpFront===A.stencilPassOpFront||(g.stencilOpSeparate(g.FRONT,nF[A.stencilFailOpFront],nF[A.stencilZFailOpFront],nF[A.stencilPassOpFront]),v.dss.stencilFailOpFront=A.stencilFailOpFront,v.dss.stencilZFailOpFront=A.stencilZFailOpFront,v.dss.stencilPassOpFront=A.stencilPassOpFront),v.dss.stencilWriteMaskFront!==A.stencilWriteMaskFront&&(g.stencilMaskSeparate(g.FRONT,A.stencilWriteMaskFront),v.dss.stencilWriteMaskFront=A.stencilWriteMaskFront),v.dss.stencilFuncBack===A.stencilFuncBack&&v.dss.stencilRefBack===A.stencilRefBack&&v.dss.stencilReadMaskBack===A.stencilReadMaskBack||(g.stencilFuncSeparate(g.BACK,tF[A.stencilFuncBack],A.stencilRefBack,A.stencilReadMaskBack),v.dss.stencilFuncBack=A.stencilFuncBack,v.dss.stencilRefBack=A.stencilRefBack,v.dss.stencilReadMaskBack=A.stencilReadMaskBack),v.dss.stencilFailOpBack===A.stencilFailOpBack&&v.dss.stencilZFailOpBack===A.stencilZFailOpBack&&v.dss.stencilPassOpBack===A.stencilPassOpBack||(g.stencilOpSeparate(g.BACK,nF[A.stencilFailOpBack],nF[A.stencilZFailOpBack],nF[A.stencilPassOpBack]),v.dss.stencilFailOpBack=A.stencilFailOpBack,v.dss.stencilZFailOpBack=A.stencilZFailOpBack,v.dss.stencilPassOpBack=A.stencilPassOpBack),v.dss.stencilWriteMaskBack!==A.stencilWriteMaskBack&&(g.stencilMaskSeparate(g.BACK,A.stencilWriteMaskBack),v.dss.stencilWriteMaskBack=A.stencilWriteMaskBack));var C=t.bs;if(C){v.bs.isA2C!==C.isA2C&&(C.isA2C?g.enable(g.SAMPLE_ALPHA_TO_COVERAGE):g.disable(g.SAMPLE_ALPHA_TO_COVERAGE),v.bs.isA2C=C.isA2C),v.bs.blendColor.x===C.blendColor.x&&v.bs.blendColor.y===C.blendColor.y&&v.bs.blendColor.z===C.blendColor.z&&v.bs.blendColor.w===C.blendColor.w||(g.blendColor(C.blendColor.x,C.blendColor.y,C.blendColor.z,C.blendColor.w),v.bs.blendColor.x=C.blendColor.x,v.bs.blendColor.y=C.blendColor.y,v.bs.blendColor.z=C.blendColor.z,v.bs.blendColor.w=C.blendColor.w);var b=C.targets[0],w=v.bs.targets[0];w.blend!==b.blend&&(b.blend?g.enable(g.BLEND):g.disable(g.BLEND),w.blend=b.blend),w.blendEq===b.blendEq&&w.blendAlphaEq===b.blendAlphaEq||(g.blendEquationSeparate(iF[b.blendEq],iF[b.blendAlphaEq]),w.blendEq=b.blendEq,w.blendAlphaEq=b.blendAlphaEq),w.blendSrc===b.blendSrc&&w.blendDst===b.blendDst&&w.blendSrcAlpha===b.blendSrcAlpha&&w.blendDstAlpha===b.blendDstAlpha||(g.blendFuncSeparate(rF[b.blendSrc],rF[b.blendDst],rF[b.blendSrcAlpha],rF[b.blendDstAlpha]),w.blendSrc=b.blendSrc,w.blendDst=b.blendDst,w.blendSrcAlpha=b.blendSrcAlpha,w.blendDstAlpha=b.blendDstAlpha),w.blendColorMask!==b.blendColorMask&&(g.colorMask((b.blendColorMask&Ba.R)!==Ba.NONE,(b.blendColorMask&Ba.G)!==Ba.NONE,(b.blendColorMask&Ba.B)!==Ba.NONE,(b.blendColorMask&Ba.A)!==Ba.NONE),w.blendColorMask=b.blendColorMask)}}if(t&&t.gpuPipelineLayout&&y){for(var R=y.glBlocks.length,I=t.gpuPipelineLayout.dynamicOffsetIndices,P=0;P<R;P++){var O=y.glBlocks[P],D=i[O.set],N=D&&D.descriptorIndices[O.binding],M=N>=0&&D.gpuDescriptors[N],L=null,B=0;if(M&&M.gpuBuffer){var F=M.gpuBuffer,z=I[O.set],U=z&&z[O.binding];U>=0&&(B=r[U]),"vf32"in F?L=F.vf32:(B+=F.offset,L=F.gpuBuffer.vf32),B>>=2}if(L)for(var H=O.glActiveUniforms.length,G=0;G<H;G++){var k=O.glActiveUniforms[G];switch(k.glType){case g.BOOL:case g.INT:for(var V=0;V<k.array.length;++V){var W=k.begin+B+V;if(L[W]!==k.array[V]){for(var j=V,q=W;j<k.array.length;++j,++q)k.array[j]=L[q];g.uniform1iv(k.glLoc,k.array);break}}break;case g.BOOL_VEC2:case g.INT_VEC2:for(var X=0;X<k.array.length;++X){var Y=k.begin+B+X;if(L[Y]!==k.array[X]){for(var K=X,Z=Y;K<k.array.length;++K,++Z)k.array[K]=L[Z];g.uniform2iv(k.glLoc,k.array);break}}break;case g.BOOL_VEC3:case g.INT_VEC3:for(var Q=0;Q<k.array.length;++Q){var J=k.begin+B+Q;if(L[J]!==k.array[Q]){for(var $=Q,ee=J;$<k.array.length;++$,++ee)k.array[$]=L[ee];g.uniform3iv(k.glLoc,k.array);break}}break;case g.BOOL_VEC4:case g.INT_VEC4:for(var te=0;te<k.array.length;++te){var ne=k.begin+B+te;if(L[ne]!==k.array[te]){for(var ie=te,re=ne;ie<k.array.length;++ie,++re)k.array[ie]=L[re];g.uniform4iv(k.glLoc,k.array);break}}break;case g.FLOAT:for(var oe=0;oe<k.array.length;++oe){var ae=k.begin+B+oe;if(L[ae]!==k.array[oe]){for(var se=oe,ce=ae;se<k.array.length;++se,++ce)k.array[se]=L[ce];g.uniform1fv(k.glLoc,k.array);break}}break;case g.FLOAT_VEC2:for(var le=0;le<k.array.length;++le){var ue=k.begin+B+le;if(L[ue]!==k.array[le]){for(var he=le,_e=ue;he<k.array.length;++he,++_e)k.array[he]=L[_e];g.uniform2fv(k.glLoc,k.array);break}}break;case g.FLOAT_VEC3:for(var fe=0;fe<k.array.length;++fe){var de=k.begin+B+fe;if(L[de]!==k.array[fe]){for(var pe=fe,me=de;pe<k.array.length;++pe,++me)k.array[pe]=L[me];g.uniform3fv(k.glLoc,k.array);break}}break;case g.FLOAT_VEC4:for(var ge=0;ge<k.array.length;++ge){var ve=k.begin+B+ge;if(L[ve]!==k.array[ge]){for(var ye=ge,Se=ve;ye<k.array.length;++ye,++Se)k.array[ye]=L[Se];g.uniform4fv(k.glLoc,k.array);break}}break;case g.FLOAT_MAT2:for(var Ee=0;Ee<k.array.length;++Ee){var Te=k.begin+B+Ee;if(L[Te]!==k.array[Ee]){for(var xe=Ee,Ae=Te;xe<k.array.length;++xe,++Ae)k.array[xe]=L[Ae];g.uniformMatrix2fv(k.glLoc,!1,k.array);break}}break;case g.FLOAT_MAT3:for(var Ce=0;Ce<k.array.length;++Ce){var be=k.begin+B+Ce;if(L[be]!==k.array[Ce]){for(var we=Ce,Re=be;we<k.array.length;++we,++Re)k.array[we]=L[Re];g.uniformMatrix3fv(k.glLoc,!1,k.array);break}}break;case g.FLOAT_MAT4:for(var Ie=0;Ie<k.array.length;++Ie){var Pe=k.begin+B+Ie;if(L[Pe]!==k.array[Ie]){for(var Oe=Ie,De=Pe;Oe<k.array.length;++Oe,++De)k.array[Oe]=L[De];g.uniformMatrix4fv(k.glLoc,!1,k.array);break}}}}else p("Buffer binding '"+O.name+"' at set "+O.set+" binding "+O.binding+" is not bounded")}for(var Ne=y.glSamplerTextures.length,Me=0;Me<Ne;Me++)for(var Le=y.glSamplerTextures[Me],Be=i[Le.set],Fe=Be&&Be.descriptorIndices[Le.binding],ze=Fe>=0&&Be.gpuDescriptors[Fe],Ue=Le.units.length,He=0;He<Ue;He++){var Ge=Le.units[He];if(ze&&ze.gpuSampler){if(ze.gpuTexture&&ze.gpuTexture.size>0){var ke=ze.gpuTexture,Ve=v.glTexUnits[Ge];Ve.glTexture!==ke.glTexture&&(v.texUnit!==Ge&&(g.activeTexture(g.TEXTURE0+Ge),v.texUnit=Ge),ke.glTexture?g.bindTexture(ke.glTarget,ke.glTexture):g.bindTexture(ke.glTarget,e.nullTex2D.gpuTexture.glTexture),Ve.glTexture=ke.glTexture);var We=ze.gpuSampler;ke.isPowerOf2?(f=We.glWrapS,d=We.glWrapT):(f=g.CLAMP_TO_EDGE,d=g.CLAMP_TO_EDGE),m=ke.isPowerOf2?ke.mipLevel<=1&&(We.glMinFilter===g.LINEAR_MIPMAP_NEAREST||We.glMinFilter===g.LINEAR_MIPMAP_LINEAR)?g.LINEAR:We.glMinFilter:We.glMinFilter===g.LINEAR||We.glMinFilter===g.LINEAR_MIPMAP_NEAREST||We.glMinFilter===g.LINEAR_MIPMAP_LINEAR?g.LINEAR:g.NEAREST,ke.glWrapS!==f&&(v.texUnit!==Ge&&(g.activeTexture(g.TEXTURE0+Ge),v.texUnit=Ge),g.texParameteri(ke.glTarget,g.TEXTURE_WRAP_S,f),ke.glWrapS=f),ke.glWrapT!==d&&(v.texUnit!==Ge&&(g.activeTexture(g.TEXTURE0+Ge),v.texUnit=Ge),g.texParameteri(ke.glTarget,g.TEXTURE_WRAP_T,d),ke.glWrapT=d),ke.glMinFilter!==m&&(v.texUnit!==Ge&&(g.activeTexture(g.TEXTURE0+Ge),v.texUnit=Ge),g.texParameteri(ke.glTarget,g.TEXTURE_MIN_FILTER,m),ke.glMinFilter=m),ke.glMagFilter!==We.glMagFilter&&(v.texUnit!==Ge&&(g.activeTexture(g.TEXTURE0+Ge),v.texUnit=Ge),g.texParameteri(ke.glTarget,g.TEXTURE_MAG_FILTER,We.glMagFilter),ke.glMagFilter=We.glMagFilter)}ze=Be.gpuDescriptors[++Fe]}else p("Sampler binding '"+Le.name+"' at set "+Le.set+" binding "+Le.binding+" index "+He+" is not bounded")}}if(n&&y&&(S||fF.gpuInputAssembler!==n)){fF.gpuInputAssembler=n;var je=e.ANGLE_instanced_arrays;if(e.useVAO){var qe=e.OES_vertex_array_object,Xe=n.glVAOs.get(y.glProgram);if(!Xe){var Ye;Xe=qe.createVertexArrayOES(),n.glVAOs.set(y.glProgram,Xe),qe.bindVertexArrayOES(Xe),g.bindBuffer(g.ARRAY_BUFFER,null),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,null),v.glArrayBuffer=null,v.glElementArrayBuffer=null;for(var Ke=y.glInputs.length,Ze=0;Ze<Ke;Ze++){var Qe=y.glInputs[Ze];Ye=null;for(var Je=n.glAttribs.length,$e=0;$e<Je;$e++){var et=n.glAttribs[$e];if(et.name===Qe.name){Ye=et;break}}if(Ye){v.glArrayBuffer!==Ye.glBuffer&&(g.bindBuffer(g.ARRAY_BUFFER,Ye.glBuffer),v.glArrayBuffer=Ye.glBuffer);for(var tt=0;tt<Ye.componentCount;++tt){var nt=Qe.glLoc+tt,it=Ye.offset+Ye.size*tt;g.enableVertexAttribArray(nt),v.glCurrentAttribLocs[nt]=!0,g.vertexAttribPointer(nt,Ye.count,Ye.glType,Ye.isNormalized,Ye.stride,it),je&&je.vertexAttribDivisorANGLE(nt,Ye.isInstanced?1:0)}}}var rt=n.gpuIndexBuffer;rt&&g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,rt.glBuffer),qe.bindVertexArrayOES(null),g.bindBuffer(g.ARRAY_BUFFER,null),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,null),v.glArrayBuffer=null,v.glElementArrayBuffer=null}v.glVAO!==Xe&&(qe.bindVertexArrayOES(Xe),v.glVAO=Xe)}else{for(var ot=0;ot<e.capabilities.maxVertexAttributes;++ot)v.glCurrentAttribLocs[ot]=!1;for(var at=y.glInputs.length,st=0;st<at;st++){for(var ct=y.glInputs[st],lt=null,ut=n.glAttribs.length,ht=0;ht<ut;ht++){var _t=n.glAttribs[ht];if(_t.name===ct.name){lt=_t;break}}if(lt){v.glArrayBuffer!==lt.glBuffer&&(g.bindBuffer(g.ARRAY_BUFFER,lt.glBuffer),v.glArrayBuffer=lt.glBuffer);for(var ft=0;ft<lt.componentCount;++ft){var dt=ct.glLoc+ft,pt=lt.offset+lt.size*ft;!v.glEnabledAttribLocs[dt]&&dt>=0&&(g.enableVertexAttribArray(dt),v.glEnabledAttribLocs[dt]=!0),v.glCurrentAttribLocs[dt]=!0,g.vertexAttribPointer(dt,lt.count,lt.glType,lt.isNormalized,lt.stride,pt),je&&je.vertexAttribDivisorANGLE(dt,lt.isInstanced?1:0)}}}var mt=n.gpuIndexBuffer;mt&&v.glElementArrayBuffer!==mt.glBuffer&&(g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,mt.glBuffer),v.glElementArrayBuffer=mt.glBuffer);for(var gt=0;gt<e.capabilities.maxVertexAttributes;++gt)v.glEnabledAttribLocs[gt]!==v.glCurrentAttribLocs[gt]&&(g.disableVertexAttribArray(gt),v.glEnabledAttribLocs[gt]=!1)}}if(t&&t.dynamicStates.length)for(var vt=t.dynamicStates.length,yt=0;yt<vt;yt++)switch(t.dynamicStates[yt]){case qa.VIEWPORT:o&&(v.viewport.left===o.left&&v.viewport.top===o.top&&v.viewport.width===o.width&&v.viewport.height===o.height||(g.viewport(o.left,o.top,o.width,o.height),v.viewport.left=o.left,v.viewport.top=o.top,v.viewport.width=o.width,v.viewport.height=o.height));break;case qa.SCISSOR:a&&(v.scissorRect.x===a.x&&v.scissorRect.y===a.y&&v.scissorRect.width===a.width&&v.scissorRect.height===a.height||(g.scissor(a.x,a.y,a.width,a.height),v.scissorRect.x=a.x,v.scissorRect.y=a.y,v.scissorRect.width=a.width,v.scissorRect.height=a.height));break;case qa.LINE_WIDTH:s&&v.rs.lineWidth!==s&&(g.lineWidth(s),v.rs.lineWidth=s);break;case qa.DEPTH_BIAS:c&&(v.rs.depthBias===c.constantFactor&&v.rs.depthBiasSlop===c.slopeFactor||(g.polygonOffset(c.constantFactor,c.slopeFactor),v.rs.depthBias=c.constantFactor,v.rs.depthBiasSlop=c.slopeFactor));break;case qa.BLEND_CONSTANTS:v.bs.blendColor.x===l[0]&&v.bs.blendColor.y===l[1]&&v.bs.blendColor.z===l[2]&&v.bs.blendColor.w===l[3]||(g.blendColor(l[0],l[1],l[2],l[3]),v.bs.blendColor.x=l[0],v.bs.blendColor.y=l[1],v.bs.blendColor.z=l[2],v.bs.blendColor.w=l[3]);break;case qa.STENCIL_WRITE_MASK:if(h)switch(h.face){case Xa.FRONT:v.dss.stencilWriteMaskFront!==h.writeMask&&(g.stencilMaskSeparate(g.FRONT,h.writeMask),v.dss.stencilWriteMaskFront=h.writeMask);break;case Xa.BACK:v.dss.stencilWriteMaskBack!==h.writeMask&&(g.stencilMaskSeparate(g.BACK,h.writeMask),v.dss.stencilWriteMaskBack=h.writeMask);break;case Xa.ALL:v.dss.stencilWriteMaskFront===h.writeMask&&v.dss.stencilWriteMaskBack===h.writeMask||(g.stencilMask(h.writeMask),v.dss.stencilWriteMaskFront=h.writeMask,v.dss.stencilWriteMaskBack=h.writeMask)}break;case qa.STENCIL_COMPARE_MASK:if(_)switch(_.face){case Xa.FRONT:v.dss.stencilRefFront===_.reference&&v.dss.stencilReadMaskFront===_.compareMask||(g.stencilFuncSeparate(g.FRONT,tF[v.dss.stencilFuncFront],_.reference,_.compareMask),v.dss.stencilRefFront=_.reference,v.dss.stencilReadMaskFront=_.compareMask);break;case Xa.BACK:v.dss.stencilRefBack===_.reference&&v.dss.stencilReadMaskBack===_.compareMask||(g.stencilFuncSeparate(g.BACK,tF[v.dss.stencilFuncBack],_.reference,_.compareMask),v.dss.stencilRefBack=_.reference,v.dss.stencilReadMaskBack=_.compareMask);break;case Xa.ALL:v.dss.stencilRefFront===_.reference&&v.dss.stencilReadMaskFront===_.compareMask&&v.dss.stencilRefBack===_.reference&&v.dss.stencilReadMaskBack===_.compareMask||(g.stencilFunc(tF[v.dss.stencilFuncBack],_.reference,_.compareMask),v.dss.stencilRefFront=_.reference,v.dss.stencilReadMaskFront=_.compareMask,v.dss.stencilRefBack=_.reference,v.dss.stencilReadMaskBack=_.compareMask)}}}function mF(e,t){var n=e.gl,i=e.ANGLE_instanced_arrays,r=fF.gpuInputAssembler,o=fF.glPrimitive;if(r)if(r.gpuIndirectBuffer)for(var a=r.gpuIndirectBuffer.indirects.length,s=0;s<a;s++){var c=r.gpuIndirectBuffer.indirects[s],l=r.gpuIndexBuffer;if(c.instanceCount&&i)if(l){if(c.indexCount>0){var u=c.firstIndex*l.stride;i.drawElementsInstancedANGLE(o,c.indexCount,r.glIndexType,u,c.instanceCount)}}else c.vertexCount>0&&i.drawArraysInstancedANGLE(o,c.firstVertex,c.vertexCount,c.instanceCount);else if(l){if(c.indexCount>0){var h=c.firstIndex*l.stride;n.drawElements(o,c.indexCount,r.glIndexType,h)}}else c.vertexCount>0&&n.drawArrays(o,c.firstVertex,c.vertexCount)}else{var _=r.gpuIndexBuffer;if(t.instanceCount&&i)if(_){if(t.indexCount>0){var f=t.firstIndex*_.stride;i.drawElementsInstancedANGLE(o,t.indexCount,r.glIndexType,f,t.instanceCount)}}else t.vertexCount>0&&i.drawArraysInstancedANGLE(o,t.firstVertex,t.vertexCount,t.instanceCount);else if(_){if(t.indexCount>0){var d=t.firstIndex*_.stride;n.drawElements(o,t.indexCount,r.glIndexType,d)}}else t.vertexCount>0&&n.drawArrays(o,t.firstVertex,t.vertexCount)}}var gF=new Array(eF.COUNT);function vF(e,t){gF.fill(0);for(var n=0;n<t.cmds.length;++n){var i=t.cmds.array[n],r=gF[i]++;switch(i){case eF.BEGIN_RENDER_PASS:var o=t.beginRenderPassCmds.array[r];dF(e,o.gpuRenderPass,o.gpuFramebuffer,o.renderArea,o.clearColors,o.clearDepth,o.clearStencil);break;case eF.BIND_STATES:var a=t.bindStatesCmds.array[r];pF(e,a.gpuPipelineState,a.gpuInputAssembler,a.gpuDescriptorSets,a.dynamicOffsets,a.viewport,a.scissor,a.lineWidth,a.depthBias,a.blendConstants,a.depthBounds,a.stencilWriteMask,a.stencilCompareMask);break;case eF.DRAW:mF(e,t.drawCmds.array[r].drawInfo);break;case eF.UPDATE_BUFFER:var s=t.updateBufferCmds.array[r];_F(e,s.gpuBuffer,s.buffer,s.offset,s.size);break;case eF.COPY_BUFFER_TO_TEXTURE:var c=t.copyBufferToTextureCmds.array[r];yF(e,c.buffers,c.gpuTexture,c.regions)}}}function yF(e,t,n,i){var r=e.gl,o=e.stateCache.glTexUnits[e.stateCache.texUnit];o.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),o.glTexture=n.glTexture);var a=0,s=1,c=1,l=0,u=$s[n.format].isCompressed;switch(n.glTarget){case r.TEXTURE_2D:for(var h=0;h<i.length;h++){var _=i[h];s=_.texExtent.width,c=_.texExtent.height;var f=t[a++];u?n.glInternalFmt===WB.COMPRESSED_RGB_ETC1_WEBGL||e.noCompressedTexSubImage2D?r.compressedTexImage2D(r.TEXTURE_2D,_.texSubres.mipLevel,n.glInternalFmt,s,c,0,f):r.compressedTexSubImage2D(r.TEXTURE_2D,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,s,c,n.glFormat,f):r.texSubImage2D(r.TEXTURE_2D,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,s,c,n.glFormat,n.glType,f)}break;case r.TEXTURE_CUBE_MAP:for(var d=0;d<i.length;d++){var p=i[d],m=p.texSubres.baseArrayLayer+p.texSubres.layerCount;for(l=p.texSubres.baseArrayLayer;l<m;++l){s=p.texExtent.width,c=p.texExtent.height;var g=t[a++];u?n.glInternalFmt===WB.COMPRESSED_RGB_ETC1_WEBGL||e.noCompressedTexSubImage2D?r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,n.glInternalFmt,s,c,0,g):r.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,s,c,n.glFormat,g):r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,s,c,n.glFormat,n.glType,g)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Ra.GEN_MIPMAP&&r.generateMipmap(n.glTarget)}var SF,EF,TF,xF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gpuBuffer=null,t._gpuBufferView=null,t._uniformBuffer=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){if("buffer"in e){this._isBufferView=!0;var t=e.buffer;this._usage=t.usage,this._memUsage=t.memUsage,this._size=this._stride=e.range,this._count=1,this._flags=t.flags,this._gpuBufferView={gpuBuffer:t.gpuBuffer,offset:e.offset,range:e.range}}else this._usage=e.usage,this._memUsage=e.memUsage,this._size=e.size,this._stride=Math.max(e.stride||this._size,1),this._count=this._size/this._stride,this._flags=e.flags,this._usage&Ta.INDIRECT&&(this._indirectBuffer=new ys),this._usage&Ta.UNIFORM&&this._size>0&&(this._uniformBuffer=new Uint8Array(this._size)),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,vf32:null,indirects:[],glTarget:0,glBuffer:null},e.usage&Ta.INDIRECT&&(this._gpuBuffer.indirects=this._indirectBuffer.drawInfos),this._usage&Ta.UNIFORM&&(this._gpuBuffer.buffer=this._uniformBuffer),function(e,t){var n=e.gl,i=e.stateCache,r=t.memUsage&Ca.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;if(t.usage&Ta.VERTEX){t.glTarget=n.ARRAY_BUFFER;var o=n.createBuffer();o&&(t.glBuffer=o,t.size>0&&(e.useVAO&&i.glVAO&&(e.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=fF.gpuInputAssembler=null),e.stateCache.glArrayBuffer!==t.glBuffer&&(n.bindBuffer(n.ARRAY_BUFFER,t.glBuffer),e.stateCache.glArrayBuffer=t.glBuffer),n.bufferData(n.ARRAY_BUFFER,t.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),e.stateCache.glArrayBuffer=null))}else if(t.usage&Ta.INDEX){t.glTarget=n.ELEMENT_ARRAY_BUFFER;var a=n.createBuffer();a&&(t.glBuffer=a,t.size>0&&(e.useVAO&&i.glVAO&&(e.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=fF.gpuInputAssembler=null),e.stateCache.glElementArrayBuffer!==t.glBuffer&&(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.glBuffer),e.stateCache.glElementArrayBuffer=t.glBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),e.stateCache.glElementArrayBuffer=null))}else t.usage&Ta.UNIFORM?(t.glTarget=n.NONE,t.buffer&&(t.vf32=new Float32Array(t.buffer.buffer))):(t.usage&Ta.INDIRECT||t.usage&Ta.TRANSFER_DST||t.usage&Ta.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),t.glTarget=n.NONE)}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize+=this._size;return!0},n.destroy=function(){var e,t;this._gpuBuffer&&(e=this._device,(t=this._gpuBuffer).glBuffer&&(e.gl.deleteBuffer(t.glBuffer),t.glBuffer=null),this._device.memoryStatus.bufferSize-=this._size,this._gpuBuffer=null),this._gpuBufferView&&(this._gpuBufferView=null)},n.resize=function(e){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var t=this._size;t!==e&&(this._size=e,this._count=this._size/this._stride,this._uniformBuffer&&(this._uniformBuffer=new Uint8Array(e)),this._gpuBuffer&&(this._uniformBuffer&&(this._gpuBuffer.buffer=this._uniformBuffer),this._gpuBuffer.size=e,e>0&&(function(e,t){var n=e.gl,i=e.stateCache,r=t.memUsage&Ca.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;t.usage&Ta.VERTEX?(e.useVAO&&i.glVAO&&(e.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=fF.gpuInputAssembler=null),e.stateCache.glArrayBuffer!==t.glBuffer&&n.bindBuffer(n.ARRAY_BUFFER,t.glBuffer),t.buffer?n.bufferData(n.ARRAY_BUFFER,t.buffer,r):n.bufferData(n.ARRAY_BUFFER,t.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),e.stateCache.glArrayBuffer=null):t.usage&Ta.INDEX?(e.useVAO&&i.glVAO&&(e.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=fF.gpuInputAssembler=null),e.stateCache.glElementArrayBuffer!==t.glBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.glBuffer),t.buffer?n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.buffer,r):n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),e.stateCache.glElementArrayBuffer=null):t.usage&Ta.UNIFORM?t.buffer&&(t.vf32=new Float32Array(t.buffer.buffer)):(t.usage&Ta.INDIRECT||t.usage&Ta.TRANSFER_DST||t.usage&Ta.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),t.glTarget=n.NONE)}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize-=t,this._device.memoryStatus.bufferSize+=e)))}},n.update=function(e,t){var n;this._isBufferView?console.warn("cannot update through buffer views!"):(n=void 0!==t?t:this._usage&Ta.INDIRECT?0:e.byteLength,_F(this._device,this._gpuBuffer,e,0,n))},X(t,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}},{key:"gpuBufferView",get:function(){return this._gpuBufferView}}]),t}(uc),AF=function(){function e(e,t){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(t),this._freeCmds=new Jn(t);for(var n=0;n<t;++n)this._frees[n]=new e;this._freeIdx=t-1}var t=e.prototype;return t.alloc=function(e){if(this._freeIdx<0){var t=2*this._frees.length,n=this._frees;this._frees=new Array(t);for(var i=t-n.length,r=0;r<i;++r)this._frees[r]=new e;for(var o=i,a=0;o<t;++o,++a)this._frees[o]=n[a];this._freeIdx+=i}var s=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++s.refCount,s},t.free=function(e){0==--e.refCount&&this._freeCmds.push(e)},t.freeCmds=function(e){for(var t=0;t<e.length;++t)0==--e.array[t].refCount&&this._freeCmds.push(e.array[t])},t.release=function(){for(var e=0;e<this._freeCmds.length;++e){var t=this._freeCmds.array[e];t.clear(),this._frees[++this._freeIdx]=t}this._freeCmds.clear()},e}(),CF=function(){function e(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new AF(aF,1),this.bindStatesCmdPool=new AF(sF,1),this.drawCmdPool=new AF(cF,1),this.updateBufferCmdPool=new AF(lF,1),this.copyBufferToTextureCmdPool=new AF(uF,1)}var t=e.prototype;return t.clearCmds=function(e){e.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(e.beginRenderPassCmds),e.beginRenderPassCmds.clear()),e.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(e.bindStatesCmds),e.bindStatesCmds.clear()),e.drawCmds.length&&(this.drawCmdPool.freeCmds(e.drawCmds),e.drawCmds.clear()),e.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(e.updateBufferCmds),e.updateBufferCmds.clear()),e.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(e.copyBufferToTextureCmds),e.copyBufferToTextureCmds.clear()),e.cmds.clear()},t.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},e}(),bF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).cmdPackage=new hF,t._webGLAllocator=null,t._isInRenderPass=!1,t._curGPUPipelineState=null,t._curGPUInputAssembler=null,t._curGPUDescriptorSets=[],t._curDynamicOffsets=[],t._curViewport=null,t._curScissor=null,t._curLineWidth=null,t._curDepthBias=null,t._curBlendConstants=[],t._curDepthBounds=null,t._curStencilWriteMask=null,t._curStencilCompareMask=null,t._isStateInvalied=!1,t}K(t,e);var n=t.prototype;return n.initialize=function(e){this._type=e.type,this._queue=e.queue,this._webGLAllocator=this._device.cmdAllocator;for(var t=this._device.bindingMappingInfo.bufferOffsets.length,n=0;n<t;n++)this._curGPUDescriptorSets.push(null),this._curDynamicOffsets.push([]);return!0},n.destroy=function(){this._webGLAllocator&&(this._webGLAllocator.clearCmds(this.cmdPackage),this._webGLAllocator=null)},n.begin=function(){this._webGLAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0;for(var e=0;e<this._curDynamicOffsets.length;e++)this._curDynamicOffsets[e].length=0;this._curViewport=null,this._curScissor=null,this._curLineWidth=null,this._curDepthBias=null,this._curBlendConstants.length=0,this._curDepthBounds=null,this._curStencilWriteMask=null,this._curStencilCompareMask=null,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},n.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},n.beginRenderPass=function(e,t,n,i,r,o){var a=this._webGLAllocator.beginRenderPassCmdPool.alloc(aF);a.gpuRenderPass=e.gpuRenderPass,a.gpuFramebuffer=t.gpuFramebuffer,a.renderArea=n,a.clearColors.length=i.length;for(var s=0;s<i.length;++s)a.clearColors[s]=i[s];a.clearDepth=r,a.clearStencil=o,this.cmdPackage.beginRenderPassCmds.push(a),this.cmdPackage.cmds.push(eF.BEGIN_RENDER_PASS),this._isInRenderPass=!0},n.endRenderPass=function(){this._isInRenderPass=!1},n.bindPipelineState=function(e){var t=e.gpuPipelineState;t!==this._curGPUPipelineState&&(this._curGPUPipelineState=t,this._isStateInvalied=!0)},n.bindDescriptorSet=function(e,t,n){var i=t.gpuDescriptorSet;if(i!==this._curGPUDescriptorSets[e]&&(this._curGPUDescriptorSets[e]=i,this._isStateInvalied=!0),n){for(var r=this._curDynamicOffsets[e],o=0;o<n.length;o++)r[o]=n[o];r.length=n.length,this._isStateInvalied=!0}},n.bindInputAssembler=function(e){var t=e.gpuInputAssembler;this._curGPUInputAssembler=t,this._isStateInvalied=!0},n.setViewport=function(e){this._curViewport?this._curViewport.left===e.left&&this._curViewport.top===e.top&&this._curViewport.width===e.width&&this._curViewport.height===e.height&&this._curViewport.minDepth===e.minDepth&&this._curViewport.maxDepth===e.maxDepth||(this._curViewport.left=e.left,this._curViewport.top=e.top,this._curViewport.width=e.width,this._curViewport.height=e.height,this._curViewport.minDepth=e.minDepth,this._curViewport.maxDepth=e.maxDepth,this._isStateInvalied=!0):this._curViewport=new _s(e.left,e.top,e.width,e.height,e.minDepth,e.maxDepth)},n.setScissor=function(e){this._curScissor?this._curScissor.x===e.x&&this._curScissor.y===e.y&&this._curScissor.width===e.width&&this._curScissor.height===e.height||(this._curScissor.x=e.x,this._curScissor.y=e.y,this._curScissor.width=e.width,this._curScissor.height=e.height,this._isStateInvalied=!0):this._curScissor=new os(e.x,e.y,e.width,e.height)},n.setLineWidth=function(e){this._curLineWidth!==e&&(this._curLineWidth=e,this._isStateInvalied=!0)},n.setDepthBias=function(e,t,n){this._curDepthBias?this._curDepthBias.constantFactor===e&&this._curDepthBias.clamp===t&&this._curDepthBias.slopeFactor===n||(this._curDepthBias.constantFactor=e,this._curDepthBias.clamp=t,this._curDepthBias.slopeFactor=n,this._isStateInvalied=!0):(this._curDepthBias={constantFactor:e,clamp:t,slopeFactor:n},this._isStateInvalied=!0)},n.setBlendConstants=function(e){4!==e.length||this._curBlendConstants[0]===e[0]&&this._curBlendConstants[1]===e[1]&&this._curBlendConstants[2]===e[2]&&this._curBlendConstants[3]===e[3]||(this._curBlendConstants.length=0,Array.prototype.push.apply(this._curBlendConstants,e),this._isStateInvalied=!0)},n.setDepthBound=function(e,t){this._curDepthBounds&&this._curDepthBounds.minBounds===e&&this._curDepthBounds.maxBounds===t||(this._curDepthBounds={minBounds:e,maxBounds:t},this._isStateInvalied=!0)},n.setStencilWriteMask=function(e,t){this._curStencilWriteMask?this._curStencilWriteMask.face===e&&this._curStencilWriteMask.writeMask===t||(this._curStencilWriteMask.face=e,this._curStencilWriteMask.writeMask=t,this._isStateInvalied=!0):(this._curStencilWriteMask={face:e,writeMask:t},this._isStateInvalied=!0)},n.setStencilCompareMask=function(e,t,n){this._curStencilCompareMask?this._curStencilCompareMask.face===e&&this._curStencilCompareMask.reference===t&&this._curStencilCompareMask.compareMask===n||(this._curStencilCompareMask.face=e,this._curStencilCompareMask.reference=t,this._curStencilCompareMask.compareMask=n,this._isStateInvalied=!0):(this._curStencilCompareMask={face:e,reference:t,compareMask:n},this._isStateInvalied=!0)},n.draw=function(e){if(this._type===Za.PRIMARY&&this._isInRenderPass||this._type===Za.SECONDARY){this._isStateInvalied&&this.bindStates();var t=this._webGLAllocator.drawCmdPool.alloc(cF);t.drawInfo.vertexCount=e.vertexCount,t.drawInfo.firstVertex=e.firstVertex,t.drawInfo.indexCount=e.indexCount,t.drawInfo.firstIndex=e.firstIndex,t.drawInfo.vertexOffset=e.vertexOffset,t.drawInfo.instanceCount=e.instanceCount,t.drawInfo.firstInstance=e.firstInstance,this.cmdPackage.drawCmds.push(t),this.cmdPackage.cmds.push(eF.DRAW),++this._numDrawCalls,this._numInstances+=e.instanceCount;var n=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=n/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(n-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.updateBuffer=function(e,t,n){if(this._type===Za.PRIMARY&&!this._isInRenderPass||this._type===Za.SECONDARY){var i=e.gpuBuffer;if(i){var r,o=this._webGLAllocator.updateBufferCmdPool.alloc(lF),a=0;e.usage&Ta.INDIRECT||(a=void 0!==n?n:t.byteLength),r=t,o.gpuBuffer=i,o.buffer=r,o.offset=0,o.size=a,this.cmdPackage.updateBufferCmds.push(o),this.cmdPackage.cmds.push(eF.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},n.copyBuffersToTexture=function(e,t,n){if(this._type===Za.PRIMARY&&!this._isInRenderPass||this._type===Za.SECONDARY){var i=t.gpuTexture;if(i){var r=this._webGLAllocator.copyBufferToTextureCmdPool.alloc(uF);r&&(r.gpuTexture=i,r.regions=n,r.buffers=e,this.cmdPackage.copyBufferToTextureCmds.push(r),this.cmdPackage.cmds.push(eF.COPY_BUFFER_TO_TEXTURE))}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},n.execute=function(e,t){for(var n=0;n<t;++n){for(var i=e[n],r=0;r<i.cmdPackage.beginRenderPassCmds.length;++r){var o=i.cmdPackage.beginRenderPassCmds.array[r];++o.refCount,this.cmdPackage.beginRenderPassCmds.push(o)}for(var a=0;a<i.cmdPackage.bindStatesCmds.length;++a){var s=i.cmdPackage.bindStatesCmds.array[a];++s.refCount,this.cmdPackage.bindStatesCmds.push(s)}for(var c=0;c<i.cmdPackage.drawCmds.length;++c){var l=i.cmdPackage.drawCmds.array[c];++l.refCount,this.cmdPackage.drawCmds.push(l)}for(var u=0;u<i.cmdPackage.updateBufferCmds.length;++u){var h=i.cmdPackage.updateBufferCmds.array[u];++h.refCount,this.cmdPackage.updateBufferCmds.push(h)}for(var _=0;_<i.cmdPackage.copyBufferToTextureCmds.length;++_){var f=i.cmdPackage.copyBufferToTextureCmds.array[_];++f.refCount,this.cmdPackage.copyBufferToTextureCmds.push(f)}this.cmdPackage.cmds.concat(i.cmdPackage.cmds.array),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.pipelineBarrier=function(){},n.bindStates=function(){var e=this._webGLAllocator.bindStatesCmdPool.alloc(sF);if(e){e.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(e.gpuDescriptorSets,this._curGPUDescriptorSets);for(var t=0;t<this._curDynamicOffsets.length;t++)Array.prototype.push.apply(e.dynamicOffsets,this._curDynamicOffsets[t]);e.gpuInputAssembler=this._curGPUInputAssembler,e.viewport=this._curViewport,e.scissor=this._curScissor,e.lineWidth=this._curLineWidth,e.depthBias=this._curDepthBias,Array.prototype.push.apply(e.blendConstants,this._curBlendConstants),e.depthBounds=this._curDepthBounds,e.stencilWriteMask=this._curStencilWriteMask,e.stencilCompareMask=this._curStencilCompareMask,this.cmdPackage.bindStatesCmds.push(e),this.cmdPackage.cmds.push(eF.BIND_STATES),this._isStateInvalied=!1}},X(t,[{key:"webGLDevice",get:function(){return this._device}}]),t}(hc),wF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gpuFramebuffer=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){this._renderPass=e.renderPass,this._colorTextures=e.colorTextures||[],this._depthStencilTexture=e.depthStencilTexture||null,0!==e.depthStencilMipmapLevel&&console.warn("The mipmap level of th texture image to be attached of depth stencil attachment should be 0. Convert to 0.");for(var t=0;t<e.colorMipmapLevels.length;++t)0!==e.colorMipmapLevels[t]&&console.warn("The mipmap level of th texture image to be attached of color attachment "+t+" should be 0. Convert to 0.");for(var n=[],i=0;i<e.colorTextures.length;++i){var r=e.colorTextures[i];r&&n.push(r.gpuTexture)}var o=null;return e.depthStencilTexture&&(o=e.depthStencilTexture.gpuTexture),this._gpuFramebuffer={gpuRenderPass:e.renderPass.gpuRenderPass,gpuColorTextures:n,gpuDepthStencilTexture:o,glFramebuffer:null},function(e,t){if(t.gpuColorTextures.length||t.gpuDepthStencilTexture){var n=e.gl,i=[],r=n.createFramebuffer();if(r){t.glFramebuffer=r,e.stateCache.glFramebuffer!==t.glFramebuffer&&n.bindFramebuffer(n.FRAMEBUFFER,t.glFramebuffer);for(var o=0;o<t.gpuColorTextures.length;++o){var a=t.gpuColorTextures[o];a&&(a.glTexture?n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+o,a.glTarget,a.glTexture,0):n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+o,n.RENDERBUFFER,a.glRenderbuffer),i.push(n.COLOR_ATTACHMENT0+o))}var s=t.gpuDepthStencilTexture;if(s){var c=$s[s.format].hasStencil?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;s.glTexture?n.framebufferTexture2D(n.FRAMEBUFFER,c,s.glTarget,s.glTexture,0):n.framebufferRenderbuffer(n.FRAMEBUFFER,c,n.RENDERBUFFER,s.glRenderbuffer)}e.WEBGL_draw_buffers&&e.WEBGL_draw_buffers.drawBuffersWEBGL(i);var l=n.checkFramebufferStatus(n.FRAMEBUFFER);if(l!==n.FRAMEBUFFER_COMPLETE)switch(l){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case n.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}e.stateCache.glFramebuffer!==t.glFramebuffer&&n.bindFramebuffer(n.FRAMEBUFFER,e.stateCache.glFramebuffer)}}}(this._device,this._gpuFramebuffer),!0},n.destroy=function(){var e,t;this._gpuFramebuffer&&(e=this._device,(t=this._gpuFramebuffer).glFramebuffer&&(e.gl.deleteFramebuffer(t.glFramebuffer),t.glFramebuffer=null),this._gpuFramebuffer=null)},X(t,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),t}(fc),RF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gpuInputAssembler=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){if(0===e.vertexBuffers.length)return console.error("InputAssemblerInfo.vertexBuffers is null."),!1;if(this._attributes=e.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=e.vertexBuffers,e.indexBuffer)this._indexBuffer=e.indexBuffer,this._indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._firstIndex=0;else{var t=this._vertexBuffers[0];this._vertexCount=t.size/t.stride,this._firstVertex=0,this._vertexOffset=0}this._instanceCount=0,this._firstInstance=0,this._indirectBuffer=e.indirectBuffer||null;for(var n=new Array(e.vertexBuffers.length),i=0;i<e.vertexBuffers.length;++i){var r=e.vertexBuffers[i];r.gpuBuffer&&(n[i]=r.gpuBuffer)}var o=null,a=0;if(e.indexBuffer&&(o=e.indexBuffer.gpuBuffer))switch(o.stride){case 1:a=5121;break;case 2:a=5123;break;case 4:a=5125;break;default:console.error("Error index buffer stride.")}var s=null;return e.indirectBuffer&&(s=e.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:e.attributes,gpuVertexBuffers:n,gpuIndexBuffer:o,gpuIndirectBuffer:s,glAttribs:[],glIndexType:a,glVAOs:new Map},function(e,t){var n=e.gl;t.glAttribs=new Array(t.attributes.length);for(var i=[0,0,0,0,0,0,0,0],r=0;r<t.attributes.length;++r){var o=t.attributes[r],a=void 0!==o.stream?o.stream:0,s=t.gpuVertexBuffers[a],c=qB(o.format,n),l=$s[o.format].size;t.glAttribs[r]={name:o.name,glBuffer:s.glBuffer,glType:c,size:l,count:$s[o.format].count,stride:s.stride,componentCount:$B(c,n),isNormalized:void 0!==o.isNormalized&&o.isNormalized,isInstanced:void 0!==o.isInstanced&&o.isInstanced,offset:i[a]},i[a]+=l}}(this._device,this._gpuInputAssembler),!0},n.destroy=function(){var e=this._device;this._gpuInputAssembler&&e.useVAO&&function(e,t){for(var n=t.glVAOs.values(),i=n.next();!i.done;)e.OES_vertex_array_object.deleteVertexArrayOES(i.value),i=n.next();t.glVAOs.clear()}(e,this._gpuInputAssembler),this._gpuInputAssembler=null},X(t,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),t}(gc),IF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gpuDescriptorSetLayout=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){Array.prototype.push.apply(this._bindings,e.bindings);for(var t=0,n=-1,i=[],r=0;r<this._bindings.length;r++){var o=this._bindings[r];i.push(t),t+=o.count,o.binding>n&&(n=o.binding)}this._bindingIndices=Array(n+1).fill(-1);for(var a=this._descriptorIndices=Array(n+1).fill(-1),s=0;s<this._bindings.length;s++){var c=this._bindings[s];this._bindingIndices[c.binding]=s,a[c.binding]=i[s]}for(var l=[],u=0;u<this._bindings.length;u++){var h=this._bindings[u];if(h.descriptorType&nc)for(var _=0;_<h.count;_++)l.push(h.binding)}return this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:l,descriptorIndices:a,descriptorCount:t},!0},n.destroy=function(){this._bindings.length=0},X(t,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),t}(yc),PF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gpuPipelineLayout=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){Array.prototype.push.apply(this._setLayouts,e.setLayouts);for(var t=[],n=[],i=0,r=0;r<this._setLayouts.length;r++){for(var o=this._setLayouts[r],a=o.gpuDescriptorSetLayout.dynamicBindings,s=Array(o.bindingIndices.length).fill(-1),c=0;c<a.length;c++){var l=a[c];s[l]<0&&(s[l]=i+c)}n.push(o.gpuDescriptorSetLayout),t.push(s),i+=a.length}return this._gpuPipelineLayout={gpuSetLayouts:n,dynamicOffsetIndices:t,dynamicOffsetCount:i},!0},n.destroy=function(){this._setLayouts.length=0},X(t,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),t}(Sc),OF=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],DF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gpuPipelineState=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){this._primitive=e.primitive,this._shader=e.shader,this._pipelineLayout=e.pipelineLayout;var t=this._bs;if(e.blendState){var n=e.blendState,i=n.targets;i&&i.forEach((function(e,n){t.setTarget(n,e)})),void 0!==n.isA2C&&(t.isA2C=n.isA2C),void 0!==n.isIndepend&&(t.isIndepend=n.isIndepend),void 0!==n.blendColor&&(t.blendColor=n.blendColor)}Object.assign(this._rs,e.rasterizerState),Object.assign(this._dss,e.depthStencilState),this._is=e.inputState,this._renderPass=e.renderPass,this._dynamicStates=e.dynamicStates;for(var r=[],o=0;o<31;o++)this._dynamicStates&1<<o&&r.push(1<<o);return this._gpuPipelineState={glPrimitive:OF[e.primitive],gpuShader:e.shader.gpuShader,gpuPipelineLayout:e.pipelineLayout.gpuPipelineLayout,rs:e.rasterizerState,dss:e.depthStencilState,bs:e.blendState,gpuRenderPass:e.renderPass.gpuRenderPass,dynamicStates:r},!0},n.destroy=function(){this._gpuPipelineState=null},X(t,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),t}(bc),NF=[],MF=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.beginRenderPass=function(e,t,n,i,r,o){dF(this._device,e.gpuRenderPass,t.gpuFramebuffer,n,i,r,o),this._isInRenderPass=!0},n.draw=function(e){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates(),mF(this._device,e),++this._numDrawCalls,this._numInstances+=e.instanceCount;var t=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=t/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(t-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.updateBuffer=function(e,t,n){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var i,r=e.gpuBuffer;r&&(i=void 0!==n?n:e.usage&Ta.INDIRECT?0:t.byteLength,_F(this._device,r,t,0,i))}},n.copyBuffersToTexture=function(e,t,n){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var i=t.gpuTexture;i&&yF(this._device,e,i,n)}},n.execute=function(e,t){for(var n=0;n<t;++n){var i=e[n];vF(this._device,i.cmdPackage),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.bindStates=function(){NF.length=0;for(var e=0;e<this._curDynamicOffsets.length;e++)Array.prototype.push.apply(NF,this._curDynamicOffsets[e]);pF(this._device,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,NF,this._curViewport,this._curScissor,this._curLineWidth,this._curDepthBias,this._curBlendConstants,this._curDepthBounds,this._curStencilWriteMask,this._curStencilCompareMask),this._isStateInvalied=!1},t}(bF),LF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).numDrawCalls=0,t.numInstances=0,t.numTris=0,t}K(t,e);var n=t.prototype;return n.initialize=function(e){return this._type=e.type,!0},n.destroy=function(){},n.submit=function(e){if(!this._isAsync)for(var t=e.length,n=0;n<t;n++){var i=e[n];this.numDrawCalls+=i.numDrawCalls,this.numInstances+=i.numInstances,this.numTris+=i.numTris}},n.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},t}(wc),BF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gpuRenderPass=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){return this._colorInfos=e.colorAttachments,this._depthStencilInfo=e.depthStencilAttachment,e.subpasses&&(this._subpasses=e.subpasses),this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash(),!0},n.destroy=function(){this._gpuRenderPass=null},X(t,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),t}(Rc),FF=[10497,33648,33071,33071],zF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gpuSampler=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){this._minFilter=e.minFilter,this._magFilter=e.magFilter,this._mipFilter=e.mipFilter,this._addressU=e.addressU,this._addressV=e.addressV,this._addressW=e.addressW,this._maxAnisotropy=e.maxAnisotropy,this._cmpFunc=e.cmpFunc,this._borderColor=e.borderColor,this._mipLODBias=e.mipLODBias;var t,n,i=this._minFilter,r=this._magFilter,o=this._mipFilter;t=i===Pa.LINEAR||i===Pa.ANISOTROPIC?o===Pa.LINEAR||o===Pa.ANISOTROPIC?9987:o===Pa.POINT?9985:9729:o===Pa.LINEAR||o===Pa.ANISOTROPIC?9986:o===Pa.POINT?9984:9728,n=r===Pa.LINEAR||r===Pa.ANISOTROPIC?9729:9728;var a=FF[this._addressU],s=FF[this._addressV],c=FF[this._addressW];return this._gpuSampler={glMinFilter:t,glMagFilter:n,glWrapS:a,glWrapT:s,glWrapR:c},!0},n.destroy=function(){this._gpuSampler=null},X(t,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),t}(Ic),UF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gpuShader=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){this._name=e.name,this._stages=e.stages,this._attributes=e.attributes,this._blocks=e.blocks,this._samplers=e.samplers,this._gpuShader={name:e.name,blocks:e.blocks,samplerTextures:e.samplerTextures,gpuStages:new Array(e.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var t=0;t<e.stages.length;++t){var n=e.stages[t];this._gpuShader.gpuStages[t]={type:n.stage,source:n.source,glShader:null}}return function(e,t){for(var n=e.gl,i=function(e){var i=t.gpuStages[e],r=0,o="",a=1;switch(i.type){case Fa.VERTEX:o="VertexShader",r=n.VERTEX_SHADER;break;case Fa.FRAGMENT:o="FragmentShader",r=n.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var s=n.createShader(r);if(s&&(i.glShader=s,n.shaderSource(i.glShader,i.source),n.compileShader(i.glShader),!n.getShaderParameter(i.glShader,n.COMPILE_STATUS))){console.error(o+" in '"+t.name+"' compilation failed."),console.error("Shader source dump:",i.source.replace(/^|\n/g,(function(){return"\n"+a+++" "}))),console.error(n.getShaderInfoLog(i.glShader));for(var c=0;c<t.gpuStages.length;c++){var l=t.gpuStages[e];l.glShader&&(n.deleteShader(l.glShader),l.glShader=null)}return{v:void 0}}},r=0;r<t.gpuStages.length;r++){var o=i(r);if("object"==typeof o)return o.v}var a=n.createProgram();if(a){t.glProgram=a;for(var s=0;s<t.gpuStages.length;s++){var c=t.gpuStages[s];n.attachShader(t.glProgram,c.glShader)}if(n.linkProgram(t.glProgram),e.destroyShadersImmediately)for(var l=0;l<t.gpuStages.length;l++){var u=t.gpuStages[l];u.glShader&&(n.detachShader(t.glProgram,u.glShader),n.deleteShader(u.glShader),u.glShader=null)}if(!n.getProgramParameter(t.glProgram,n.LINK_STATUS))return console.error("Failed to link shader '"+t.name+"'."),void console.error(n.getProgramInfoLog(t.glProgram));console.info("Shader '"+t.name+"' compilation succeeded.");var h=n.getProgramParameter(t.glProgram,n.ACTIVE_ATTRIBUTES);t.glInputs=new Array(h);for(var _=0;_<h;++_){var f=n.getActiveAttrib(t.glProgram,_);if(f){var d,p=f.name.indexOf("[");d=-1!==p?f.name.substr(0,p):f.name;var m=n.getAttribLocation(t.glProgram,d),g=QB(f.type,n),v=JB(f.type,n);t.glInputs[_]={binding:m,name:d,type:g,stride:v,count:f.size,size:v*f.size,glType:f.type,glLoc:m}}}if(t.blocks.length>0){t.glBlocks=new Array(t.blocks.length);for(var y=0;y<t.blocks.length;++y){var S=t.blocks[y],E={set:S.set,binding:S.binding,name:S.name,size:0,glUniforms:new Array(S.members.length),glActiveUniforms:[]};t.glBlocks[y]=E;for(var T=0;T<S.members.length;++T){var x=S.members[T],A=KB(x.type,n),C=ZB(x.type),b=JB(A,n),w=b*x.count,R=E.size/4,I=new C(w/4);E.glUniforms[T]={binding:-1,name:x.name,type:x.type,stride:b,count:x.count,size:w,offset:E.size,glType:A,glLoc:-1,array:I,begin:R},E.size+=w}}}if(t.samplerTextures.length>0){t.glSamplerTextures=new Array(t.samplerTextures.length);for(var P=0;P<t.samplerTextures.length;++P){var O=t.samplerTextures[P];t.glSamplerTextures[P]={set:O.set,binding:O.binding,name:O.name,type:O.type,count:O.count,units:[],glUnits:null,glType:KB(O.type,n),glLoc:null}}}for(var D=n.getProgramParameter(t.glProgram,n.ACTIVE_UNIFORMS),N=0;N<D;++N){var M=n.getActiveUniform(t.glProgram,N);if(M&&M.type!==n.SAMPLER_2D&&M.type!==n.SAMPLER_CUBE){var L=n.getUniformLocation(t.glProgram,M.name);if(null!==L&&("number"==typeof L||-1!==L.id)){var B,F=M.name.indexOf("[");B=-1!==F?M.name.substr(0,F):M.name;for(var z=0;z<t.glBlocks.length;z++)for(var U=t.glBlocks[z],H=0;H<U.glUniforms.length;H++){var G=U.glUniforms[H];if(G.name===B){G.glLoc=L,U.glActiveUniforms.push(G);break}}}}}for(var k=[],V=[],W=e.bindingMappingInfo,j=e.stateCache.texUnitCacheMap,q=0,X=0;X<t.blocks.length;++X)t.blocks[X].set===W.flexibleSet&&q++;for(var Y=0,K=0;K<t.samplerTextures.length;++K){var Z=t.samplerTextures[K],Q=n.getUniformLocation(t.glProgram,Z.name);if(null===Q||"number"!=typeof Q&&-1===Q.id||(k.push(t.glSamplerTextures[K]),V.push(Q)),void 0===j[Z.name]){var J=Z.binding+W.samplerOffsets[Z.set]+Y;Z.set===W.flexibleSet&&(J-=q),j[Z.name]=J%e.capabilities.maxTextureUnits,Y+=Z.count-1}}if(k.length){for(var $=[],ee=0;ee<k.length;++ee){var te=k[ee],ne=j[te.name];if(void 0!==ne){te.glLoc=V[ee];for(var ie=0;ie<te.count;++ie){for(;$[ne];)ne=(ne+1)%e.capabilities.maxTextureUnits;te.units.push(ne),$[ne]=!0}}}for(var re=0,oe=0;oe<k.length;++oe){var ae=k[oe];if(!ae.glLoc){ae.glLoc=V[oe];for(var se=0;se<ae.count;++se){for(;$[re];)re=(re+1)%e.capabilities.maxTextureUnits;void 0===j[ae.name]&&(j[ae.name]=re),ae.units.push(re),$[re]=!0}}}e.stateCache.glProgram!==t.glProgram&&n.useProgram(t.glProgram);for(var ce=0;ce<k.length;ce++){var le=k[ce];le.glUnits=new Int32Array(le.units),n.uniform1iv(le.glLoc,le.glUnits)}e.stateCache.glProgram!==t.glProgram&&n.useProgram(e.stateCache.glProgram)}for(var ue=0;ue<t.glBlocks.length;)t.glBlocks[ue].glActiveUniforms.length?ue++:(t.glBlocks[ue]=t.glBlocks[t.glBlocks.length-1],t.glBlocks.length--);t.glSamplerTextures=k}}(this._device,this._gpuShader),!0},n.destroy=function(){this._gpuShader&&(function(e,t){if(t.glProgram){var n=e.gl;if(!e.destroyShadersImmediately)for(var i=0;i<t.gpuStages.length;i++){var r=t.gpuStages[i];r.glShader&&(n.detachShader(t.glProgram,r.glShader),n.deleteShader(r.glShader),r.glShader=null)}n.deleteProgram(t.glProgram),t.glProgram=null}}(this._device,this._gpuShader),this._gpuShader=null)},X(t,[{key:"gpuShader",get:function(){return this._gpuShader}}]),t}(Pc),HF=function(){function e(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.viewport=new _s,this.scissorRect=new os(0,0,0,0),this.rs=new Ec,this.dss=new Tc,this.bs=new Ac,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return e.prototype.initialize=function(e,t){for(var n=0;n<e;++n)this.glTexUnits.push({glTexture:null});this.glEnabledAttribLocs.length=t,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=t,this.glCurrentAttribLocs.fill(!1)},e}(),GF=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gpuTexture=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){return"texture"in e?(console.log("WebGL does not support texture view."),!1):(this._type=e.type,this._usage=e.usage,this._format=e.format,this._width=e.width,this._height=e.height,this._depth=e.depth,this._layerCount=e.layerCount,this._levelCount=e.levelCount,this._samples=e.samples,this._flags=e.flags,this._isPowerOf2=ic(this._width)&&ic(this._height),this._size=oc(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture={type:this._type,format:this._format,usage:this._usage,width:this._width,height:this._height,depth:this._depth,size:this._size,arrayLayer:this._layerCount,mipLevel:this._levelCount,samples:this._samples,flags:this._flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0},function(e,t){var n=e.gl;t.glInternalFmt=XB(t.format,n),t.glFormat=YB(t.format,n),t.glType=qB(t.format,n);var i=t.width,r=t.height;switch(t.type){case ba.TEX2D:t.glTarget=n.TEXTURE_2D;var o=Math.max(i,r);if(o>e.capabilities.maxTextureSize&&b(9100,o,e.capabilities.maxTextureSize),!e.WEBGL_depth_texture&&$s[t.format].hasDepth){var a=n.createRenderbuffer();a&&t.size>0&&(t.glRenderbuffer=a,e.stateCache.glRenderbuffer!==t.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,t.glRenderbuffer),e.stateCache.glRenderbuffer=t.glRenderbuffer),t.glInternalFmt===n.DEPTH_COMPONENT&&(t.glInternalFmt=n.DEPTH_COMPONENT16),n.renderbufferStorage(n.RENDERBUFFER,t.glInternalFmt,i,r))}else if(t.samples===Ia.X1){var s=n.createTexture();if(s&&t.size>0){t.glTexture=s;var c=e.stateCache.glTexUnits[e.stateCache.texUnit];if(c.glTexture!==t.glTexture&&(n.bindTexture(n.TEXTURE_2D,t.glTexture),c.glTexture=t.glTexture),$s[t.format].isCompressed)if(t.glInternalFmt!==WB.COMPRESSED_RGB_ETC1_WEBGL)for(var l=0;l<t.mipLevel;++l){var u=rc(t.format,i,r,1),h=new Uint8Array(u);n.compressedTexImage2D(n.TEXTURE_2D,l,t.glInternalFmt,i,r,0,h),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else{var _=rc(t.format,2,2,1),f=new Uint8Array(_);n.compressedTexImage2D(n.TEXTURE_2D,0,t.glInternalFmt,2,2,0,f)}else for(var d=0;d<t.mipLevel;++d)n.texImage2D(n.TEXTURE_2D,d,t.glInternalFmt,i,r,0,t.glFormat,t.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1);t.isPowerOf2?(t.glWrapS=n.REPEAT,t.glWrapT=n.REPEAT):(t.glWrapS=n.CLAMP_TO_EDGE,t.glWrapT=n.CLAMP_TO_EDGE),t.glMinFilter=n.LINEAR,t.glMagFilter=n.LINEAR,n.texParameteri(t.glTarget,n.TEXTURE_WRAP_S,t.glWrapS),n.texParameteri(t.glTarget,n.TEXTURE_WRAP_T,t.glWrapT),n.texParameteri(t.glTarget,n.TEXTURE_MIN_FILTER,t.glMinFilter),n.texParameteri(t.glTarget,n.TEXTURE_MAG_FILTER,t.glMagFilter)}else n.deleteTexture(s)}break;case ba.CUBE:t.glTarget=n.TEXTURE_CUBE_MAP;var p=Math.max(i,r);p>e.capabilities.maxCubeMapTextureSize&&b(9100,p,e.capabilities.maxTextureSize);var m=n.createTexture();if(m&&t.size>0){t.glTexture=m;var g=e.stateCache.glTexUnits[e.stateCache.texUnit];if(g.glTexture!==t.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,t.glTexture),g.glTexture=t.glTexture),$s[t.format].isCompressed)if(t.glInternalFmt!==WB.COMPRESSED_RGB_ETC1_WEBGL)for(var v=0;v<6;++v){i=t.width,r=t.height;for(var y=0;y<t.mipLevel;++y){var S=rc(t.format,i,r,1),E=new Uint8Array(S);n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+v,y,t.glInternalFmt,i,r,0,E),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}}else for(var T=0;T<6;++T){var x=rc(t.format,2,2,1),A=new Uint8Array(x);n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+T,0,t.glInternalFmt,2,2,0,A)}else for(var C=0;C<6;++C){i=t.width,r=t.height;for(var w=0;w<t.mipLevel;++w)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+C,w,t.glInternalFmt,i,r,0,t.glFormat,t.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}t.isPowerOf2?(t.glWrapS=n.REPEAT,t.glWrapT=n.REPEAT):(t.glWrapS=n.CLAMP_TO_EDGE,t.glWrapT=n.CLAMP_TO_EDGE),t.glMinFilter=n.LINEAR,t.glMagFilter=n.LINEAR,n.texParameteri(t.glTarget,n.TEXTURE_WRAP_S,t.glWrapS),n.texParameteri(t.glTarget,n.TEXTURE_WRAP_T,t.glWrapT),n.texParameteri(t.glTarget,n.TEXTURE_MIN_FILTER,t.glMinFilter),n.texParameteri(t.glTarget,n.TEXTURE_MAG_FILTER,t.glMagFilter)}break;default:console.error("Unsupported TextureType, create texture failed."),t.type=ba.TEX2D,t.glTarget=n.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize+=this._size,!0)},n.destroy=function(){var e,t;this._gpuTexture&&(e=this._device,(t=this._gpuTexture).glTexture&&(e.gl.deleteTexture(t.glTexture),t.glTexture=null),t.glRenderbuffer&&(e.gl.deleteRenderbuffer(t.glRenderbuffer),t.glRenderbuffer=null),this._device.memoryStatus.textureSize-=this._size,this._gpuTexture=null)},n.resize=function(e,t){var n=this._size;this._width=e,this._height=t,this._size=oc(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture&&(this._gpuTexture.width=e,this._gpuTexture.height=t,this._gpuTexture.size=this._size,function(e,t){var n=e.gl;t.glInternalFmt=XB(t.format,n),t.glFormat=YB(t.format,n),t.glType=qB(t.format,n);var i=t.width,r=t.height;switch(t.type){case ba.TEX2D:t.glTarget=n.TEXTURE_2D;var o=Math.max(i,r);if(o>e.capabilities.maxTextureSize&&b(9100,o,e.capabilities.maxTextureSize),t.glRenderbuffer)e.stateCache.glRenderbuffer!==t.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,t.glRenderbuffer),e.stateCache.glRenderbuffer=t.glRenderbuffer),n.renderbufferStorage(n.RENDERBUFFER,t.glInternalFmt,i,r);else if(t.glTexture){var a=e.stateCache.glTexUnits[e.stateCache.texUnit];if(a.glTexture!==t.glTexture&&(n.bindTexture(n.TEXTURE_2D,t.glTexture),a.glTexture=t.glTexture),$s[t.format].isCompressed){if(t.glInternalFmt!==WB.COMPRESSED_RGB_ETC1_WEBGL)for(var s=0;s<t.mipLevel;++s){var c=rc(t.format,i,r,1),l=new Uint8Array(c);n.compressedTexImage2D(n.TEXTURE_2D,s,t.glInternalFmt,i,r,0,l),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}}else for(var u=0;u<t.mipLevel;++u)n.texImage2D(n.TEXTURE_2D,u,t.glInternalFmt,i,r,0,t.glFormat,t.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}break;case ba.CUBE:t.glTarget=n.TEXTURE_CUBE_MAP;var h=Math.max(i,r);h>e.capabilities.maxCubeMapTextureSize&&b(9100,h,e.capabilities.maxTextureSize);var _=e.stateCache.glTexUnits[e.stateCache.texUnit];if(_.glTexture!==t.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,t.glTexture),_.glTexture=t.glTexture),$s[t.format].isCompressed){if(t.glInternalFmt!==WB.COMPRESSED_RGB_ETC1_WEBGL)for(var f=0;f<6;++f){i=t.width,r=t.height;for(var d=0;d<t.mipLevel;++d){var p=rc(t.format,i,r,1),m=new Uint8Array(p);n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+f,d,t.glInternalFmt,i,r,0,m),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}}}else for(var g=0;g<6;++g){i=t.width,r=t.height;for(var v=0;v<t.mipLevel;++v)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+g,v,t.glInternalFmt,i,r,0,t.glFormat,t.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}break;default:console.error("Unsupported TextureType, create texture failed."),t.type=ba.TEX2D,t.glTarget=n.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize-=n,this._device.memoryStatus.textureSize+=this._size)},X(t,[{key:"gpuTexture",get:function(){return this._gpuTexture}}]),t}(Oc),kF="webglcontextlost",VF=e("WebGLDevice",function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).stateCache=new HF,t.cmdAllocator=new CF,t.nullTex2D=null,t.nullTexCube=null,t._webGLRC=null,t._isAntialias=!0,t._isPremultipliedAlpha=!0,t._useVAO=!1,t._destroyShadersImmediately=!0,t._noCompressedTexSubImage2D=!1,t._bindingMappingInfo=new ds,t._webGLContextLostHandler=null,t._extensions=null,t._EXT_texture_filter_anisotropic=null,t._EXT_blend_minmax=null,t._EXT_frag_depth=null,t._EXT_shader_texture_lod=null,t._EXT_sRGB=null,t._OES_vertex_array_object=null,t._EXT_color_buffer_half_float=null,t._WEBGL_color_buffer_float=null,t._WEBGL_compressed_texture_etc1=null,t._WEBGL_compressed_texture_etc=null,t._WEBGL_compressed_texture_pvrtc=null,t._WEBGL_compressed_texture_astc=null,t._WEBGL_compressed_texture_s3tc=null,t._WEBGL_compressed_texture_s3tc_srgb=null,t._WEBGL_debug_shaders=null,t._WEBGL_draw_buffers=null,t._WEBGL_lose_context=null,t._WEBGL_depth_texture=null,t._WEBGL_debug_renderer_info=null,t._OES_texture_half_float=null,t._OES_texture_half_float_linear=null,t._OES_texture_float=null,t._OES_texture_float_linear=null,t._OES_standard_derivatives=null,t._OES_element_index_uint=null,t._ANGLE_instanced_arrays=null,t}K(t,e);var n=t.prototype;return n.initialize=function(e){this._canvas=e.canvasElm,this._isAntialias=e.isAntialias,this._isPremultipliedAlpha=e.isPremultipliedAlpha,this._bindingMappingInfo=e.bindingMappingInfo,this._bindingMappingInfo.bufferOffsets.length||this._bindingMappingInfo.bufferOffsets.push(0),this._bindingMappingInfo.samplerOffsets.length||this._bindingMappingInfo.samplerOffsets.push(0);try{var t={alpha:nt.ENABLE_TRANSPARENT_CANVAS,antialias:this._isAntialias,depth:!0,stencil:!0,premultipliedAlpha:this._isPremultipliedAlpha,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};this._webGLRC=this._canvas.getContext("webgl",t)}catch(e){return console.error(e),!1}if(!this._webGLRC)return console.error("This device does not support WebGL."),!1;this._webGLContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener(kF,this._onWebGLContextLost),this._canvas2D=document.createElement("canvas"),console.info("WebGL device initialized."),this._gfxAPI=ma.WEBGL,this._deviceName="WebGL";var n=this._webGLRC;this._WEBGL_debug_renderer_info=this.getExtension("WEBGL_debug_renderer_info"),this._WEBGL_debug_renderer_info?(this._renderer=n.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=n.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=n.getParameter(n.RENDERER),this._vendor=n.getParameter(n.VENDOR)),this._version=n.getParameter(n.VERSION),this._caps.maxVertexAttributes=n.getParameter(n.MAX_VERTEX_ATTRIBS),this._caps.maxVertexUniformVectors=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),this._caps.maxFragmentUniformVectors=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureUnits=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this._caps.maxCubeMapTextureSize=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.depthBits=n.getParameter(n.DEPTH_BITS),this._caps.stencilBits=n.getParameter(n.STENCIL_BITS),this.stateCache.initialize(this._caps.maxTextureUnits,this._caps.maxVertexAttributes),this._devicePixelRatio=e.devicePixelRatio||1,this._width=this._canvas.width,this._height=this._canvas.height,this._nativeWidth=Math.max(e.nativeWidth||this._width,0),this._nativeHeight=Math.max(e.nativeHeight||this._height,0),this._colorFmt=ya.RGBA8,24===this._caps.depthBits?8===this._caps.stencilBits?this._depthStencilFmt=ya.D24S8:this._depthStencilFmt=ya.D24:8===this._caps.stencilBits?this._depthStencilFmt=ya.D16S8:this._depthStencilFmt=ya.D16,this._extensions=n.getSupportedExtensions();var i="";if(this._extensions){for(var r,o=$(this._extensions);!(r=o()).done;)i+=r.value+" ";console.debug("EXTENSIONS: "+i)}this._EXT_texture_filter_anisotropic=this.getExtension("EXT_texture_filter_anisotropic"),this._EXT_blend_minmax=this.getExtension("EXT_blend_minmax"),this._EXT_frag_depth=this.getExtension("EXT_frag_depth"),this._EXT_shader_texture_lod=this.getExtension("EXT_shader_texture_lod"),this._EXT_sRGB=this.getExtension("EXT_sRGB"),this._OES_vertex_array_object=this.getExtension("OES_vertex_array_object"),this._EXT_color_buffer_half_float=this.getExtension("EXT_color_buffer_half_float"),this._WEBGL_color_buffer_float=this.getExtension("WEBGL_color_buffer_float"),this._WEBGL_compressed_texture_etc1=this.getExtension("WEBGL_compressed_texture_etc1"),this._WEBGL_compressed_texture_etc=this.getExtension("WEBGL_compressed_texture_etc"),this._WEBGL_compressed_texture_pvrtc=this.getExtension("WEBGL_compressed_texture_pvrtc"),this._WEBGL_compressed_texture_s3tc=this.getExtension("WEBGL_compressed_texture_s3tc"),this._WEBGL_compressed_texture_s3tc_srgb=this.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this._WEBGL_debug_shaders=this.getExtension("WEBGL_debug_shaders"),this._WEBGL_draw_buffers=this.getExtension("WEBGL_draw_buffers"),this._WEBGL_lose_context=this.getExtension("WEBGL_lose_context"),this._WEBGL_depth_texture=this.getExtension("WEBGL_depth_texture"),this._OES_texture_half_float=this.getExtension("OES_texture_half_float"),this._OES_texture_half_float_linear=this.getExtension("OES_texture_half_float_linear"),this._OES_texture_float=this.getExtension("OES_texture_float"),this._OES_texture_float_linear=this.getExtension("OES_texture_float_linear"),this._OES_standard_derivatives=this.getExtension("OES_standard_derivatives"),this._OES_element_index_uint=this.getExtension("OES_element_index_uint"),this._ANGLE_instanced_arrays=this.getExtension("ANGLE_instanced_arrays"),yi.os===pi.IOS&&14===eS.osMainVersion&&eS.isBrowser||(this._WEBGL_compressed_texture_astc=this.getExtension("WEBGL_compressed_texture_astc")),yi.browserType===hi.UC&&(this._ANGLE_instanced_arrays=null),yi.os===pi.IOS&&eS.osMainVersion<=10&&(this._destroyShadersImmediately=!1),this._features.fill(!1),this._EXT_blend_minmax&&(this._features[va.BLEND_MINMAX]=!0),this._WEBGL_color_buffer_float&&(this._features[va.COLOR_FLOAT]=!0),this._EXT_color_buffer_half_float&&(this._features[va.COLOR_HALF_FLOAT]=!0),this._OES_texture_float&&(this._features[va.TEXTURE_FLOAT]=!0),this._OES_texture_half_float&&(this._features[va.TEXTURE_HALF_FLOAT]=!0),this._OES_texture_float_linear&&(this._features[va.TEXTURE_FLOAT_LINEAR]=!0),this._OES_texture_half_float_linear&&(this._features[va.TEXTURE_HALF_FLOAT_LINEAR]=!0),this._features[va.FORMAT_RGB8]=!0,this._WEBGL_depth_texture&&(this._features[va.FORMAT_D16]=!0,this._features[va.FORMAT_D24]=!0,this._features[va.FORMAT_D24S8]=!0),this._OES_element_index_uint&&(this._features[va.ELEMENT_INDEX_UINT]=!0),this._ANGLE_instanced_arrays&&(this._features[va.INSTANCED_ARRAYS]=!0),this._WEBGL_draw_buffers&&(this._features[va.MULTIPLE_RENDER_TARGETS]=!0);var a="";this._WEBGL_compressed_texture_etc1&&(this._features[va.FORMAT_ETC1]=!0,a+="etc1 "),this._WEBGL_compressed_texture_etc&&(this._features[va.FORMAT_ETC2]=!0,a+="etc2 "),this._WEBGL_compressed_texture_s3tc&&(this._features[va.FORMAT_DXT]=!0,a+="dxt "),this._WEBGL_compressed_texture_pvrtc&&(this._features[va.FORMAT_PVRTC]=!0,a+="pvrtc "),this._WEBGL_compressed_texture_astc&&(this._features[va.FORMAT_ASTC]=!0,a+="astc "),this._OES_vertex_array_object&&(this._useVAO=!0),console.info("RENDERER: "+this._renderer),console.info("VENDOR: "+this._vendor),console.info("VERSION: "+this._version),console.info("DPR: "+this._devicePixelRatio),console.info("SCREEN_SIZE: "+this._width+" x "+this._height),console.info("NATIVE_SIZE: "+this._nativeWidth+" x "+this._nativeHeight),console.info("MAX_VERTEX_UNIFORM_VECTORS: "+this._caps.maxVertexUniformVectors),console.info("DEPTH_BITS: "+this._caps.depthBits),console.info("STENCIL_BITS: "+this._caps.stencilBits),this._EXT_texture_filter_anisotropic&&console.info("MAX_TEXTURE_MAX_ANISOTROPY_EXT: "+this._EXT_texture_filter_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT),console.info("USE_VAO: "+this._useVAO),console.info("COMPRESSED_FORMAT: "+a),this.initStates(n),this._queue=this.createQueue(new Ys(Ka.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new Xs(this._queue)),this.nullTex2D=this.createTexture(new Ss(ba.TEX2D,wa.SAMPLED,ya.RGBA8,2,2,Ra.GEN_MIPMAP)),this.nullTexCube=this.createTexture(new Ss(ba.CUBE,wa.SAMPLED,ya.RGBA8,2,2,Ra.GEN_MIPMAP,6));var s=new hs;s.texExtent.width=2,s.texExtent.height=2;var c=new Uint8Array(this.nullTex2D.size);return c.fill(0),this.copyBuffersToTexture([c],this.nullTex2D,[s]),s.texSubres.layerCount=6,this.copyBuffersToTexture([c,c,c,c,c,c],this.nullTexCube,[s]),!0},n.destroy=function(){this._canvas&&this._webGLContextLostHandler&&(this._canvas.removeEventListener(kF,this._webGLContextLostHandler),this._webGLContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null),this._extensions=null,this._webGLRC=null},n.resize=function(e,t){this._width===e&&this._height===t||(console.info("Resizing device: "+e+"x"+t),this._canvas.width=e,this._canvas.height=t,this._width=e,this._height=t)},n.flushCommands=function(){},n.acquire=function(){this.cmdAllocator.releaseCmds()},n.present=function(){var e=this._queue;this._numDrawCalls=e.numDrawCalls,this._numInstances=e.numInstances,this._numTris=e.numTris,e.clear()},n.createCommandBuffer=function(e){var t=new(e.type===Za.PRIMARY?MF:bF)(this);return t.initialize(e),t},n.createBuffer=function(e){var t=new xF(this);return t.initialize(e)?t:null},n.createTexture=function(e){var t=new GF(this);return t.initialize(e)?t:null},n.createSampler=function(e){var t=new zF(this);return t.initialize(e)?t:null},n.createDescriptorSet=function(e){var t=new jB(this);return t.initialize(e)?t:null},n.createShader=function(e){var t=new UF(this);return t.initialize(e)?t:null},n.createInputAssembler=function(e){var t=new RF(this);return t.initialize(e)?t:null},n.createRenderPass=function(e){var t=new BF(this);return t.initialize(e)?t:null},n.createFramebuffer=function(e){var t=new wF(this);return t.initialize(e)?t:null},n.createDescriptorSetLayout=function(e){var t=new IF(this);return t.initialize(e)?t:null},n.createPipelineLayout=function(e){var t=new PF(this);return t.initialize(e)?t:null},n.createPipelineState=function(e){var t=new DF(this);return t.initialize(e)?t:null},n.createQueue=function(e){var t=new LF(this);return t.initialize(e)?t:null},n.createGlobalBarrier=function(e){var t=new Dc(this);return t.initialize(e)?t:null},n.createTextureBarrier=function(e){var t=new Nc(this);return t.initialize(e)?t:null},n.copyBuffersToTexture=function(e,t,n){yF(this,e,t.gpuTexture,n)},n.copyTexImagesToTexture=function(e,t,n){!function(e,t,n,i){var r=e.gl,o=e.stateCache.glTexUnits[e.stateCache.texUnit];o.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),o.glTexture=n.glTexture);var a=0,s=0;switch(n.glTarget){case r.TEXTURE_2D:for(var c=0;c<i.length;c++){var l=i[c];r.texSubImage2D(r.TEXTURE_2D,l.texSubres.mipLevel,l.texOffset.x,l.texOffset.y,n.glFormat,n.glType,t[a++])}break;case r.TEXTURE_CUBE_MAP:for(var u=0;u<i.length;u++){var h=i[u],_=h.texSubres.baseArrayLayer+h.texSubres.layerCount;for(s=h.texSubres.baseArrayLayer;s<_;++s)r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+s,h.texSubres.mipLevel,h.texOffset.x,h.texOffset.y,n.glFormat,n.glType,t[a++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Ra.GEN_MIPMAP&&n.isPowerOf2&&r.generateMipmap(n.glTarget)}(this,e,t.gpuTexture,n)},n.copyFramebufferToBuffer=function(e,t,n){var i=this._webGLRC,r=e.gpuFramebuffer,o=r.gpuColorTextures[0].format,a=YB(o,i),s=qB(o,i),c=cc($s[o]),l=this.stateCache.glFramebuffer;this.stateCache.glFramebuffer!==r.glFramebuffer&&(i.bindFramebuffer(i.FRAMEBUFFER,r.glFramebuffer),this.stateCache.glFramebuffer=r.glFramebuffer);for(var u,h=new c(t),_=$(n);!(u=_()).done;){var f=u.value,d=f.texExtent.width,p=f.texExtent.height;i.readPixels(f.texOffset.x,f.texOffset.y,d,p,a,s,h)}this.stateCache.glFramebuffer!==l&&(i.bindFramebuffer(i.FRAMEBUFFER,l),this.stateCache.glFramebuffer=l)},n.blitFramebuffer=function(){},n.getExtension=function(e){for(var t=["","WEBKIT_","MOZ_"],n=0;n<t.length;++n){var i=this.gl.getExtension(t[n]+e);if(i)return i}return null},n.initStates=function(e){e.activeTexture(e.TEXTURE0),e.pixelStorei(e.PACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindFramebuffer(e.FRAMEBUFFER,null),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.frontFace(e.CCW),e.disable(e.POLYGON_OFFSET_FILL),e.polygonOffset(0,0),e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.LESS),e.depthRange(0,1),e.stencilFuncSeparate(e.FRONT,e.ALWAYS,1,65535),e.stencilOpSeparate(e.FRONT,e.KEEP,e.KEEP,e.KEEP),e.stencilMaskSeparate(e.FRONT,65535),e.stencilFuncSeparate(e.BACK,e.ALWAYS,1,65535),e.stencilOpSeparate(e.BACK,e.KEEP,e.KEEP,e.KEEP),e.stencilMaskSeparate(e.BACK,65535),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.disable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.blendColor(0,0,0,0)},n._onWebGLContextLost=function(e){A(11e3),d(e)},X(t,[{key:"gl",get:function(){return this._webGLRC}},{key:"webGLQueue",get:function(){return this._queue}},{key:"isAntialias",get:function(){return this._isAntialias}},{key:"isPremultipliedAlpha",get:function(){return this._isPremultipliedAlpha}},{key:"useVAO",get:function(){return this._useVAO}},{key:"destroyShadersImmediately",get:function(){return this._destroyShadersImmediately}},{key:"noCompressedTexSubImage2D",get:function(){return this._noCompressedTexSubImage2D}},{key:"bindingMappingInfo",get:function(){return this._bindingMappingInfo}},{key:"EXT_texture_filter_anisotropic",get:function(){return this._EXT_texture_filter_anisotropic}},{key:"EXT_blend_minmax",get:function(){return this._EXT_blend_minmax}},{key:"EXT_frag_depth",get:function(){return this._EXT_frag_depth}},{key:"EXT_shader_texture_lod",get:function(){return this._EXT_shader_texture_lod}},{key:"EXT_sRGB",get:function(){return this._EXT_sRGB}},{key:"OES_vertex_array_object",get:function(){return this._OES_vertex_array_object}},{key:"WEBGL_color_buffer_float",get:function(){return this._WEBGL_color_buffer_float}},{key:"WEBGL_compressed_texture_etc1",get:function(){return this._WEBGL_compressed_texture_etc1}},{key:"WEBGL_compressed_texture_pvrtc",get:function(){return this._WEBGL_compressed_texture_pvrtc}},{key:"WEBGL_compressed_texture_astc",get:function(){return this._WEBGL_compressed_texture_astc}},{key:"WEBGL_compressed_texture_s3tc",get:function(){return this._WEBGL_compressed_texture_s3tc}},{key:"WEBGL_compressed_texture_s3tc_srgb",get:function(){return this._WEBGL_compressed_texture_s3tc_srgb}},{key:"WEBGL_debug_shaders",get:function(){return this._WEBGL_debug_shaders}},{key:"WEBGL_draw_buffers",get:function(){return this._WEBGL_draw_buffers}},{key:"WEBGL_lose_context",get:function(){return this._WEBGL_lose_context}},{key:"WEBGL_depth_texture",get:function(){return this._WEBGL_depth_texture}},{key:"WEBGL_debug_renderer_info",get:function(){return this._WEBGL_debug_renderer_info}},{key:"OES_texture_half_float",get:function(){return this._OES_texture_half_float}},{key:"OES_texture_half_float_linear",get:function(){return this._OES_texture_half_float_linear}},{key:"OES_texture_float",get:function(){return this._OES_texture_float}},{key:"OES_standard_derivatives",get:function(){return this._OES_standard_derivatives}},{key:"OES_element_index_uint",get:function(){return this._OES_element_index_uint}},{key:"ANGLE_instanced_arrays",get:function(){return this._ANGLE_instanced_arrays}}]),t}(_c));i.WebGLDevice=VF,function(e){e.PLAYED="play",e.PAUSED="pause",e.STOPPED="stop",e.SEEKED="seeked",e.ENDED="ended",e.INTERRUPTION_BEGIN="interruptionBegin",e.INTERRUPTION_END="interruptionEnd",e.USER_GESTURE="on_gesture"}(SF||(SF={})),function(e){e[e.DOM_AUDIO=0]="DOM_AUDIO",e[e.WEB_AUDIO=1]="WEB_AUDIO",e[e.MINIGAME_AUDIO=2]="MINIGAME_AUDIO",e[e.NATIVE_AUDIO=3]="NATIVE_AUDIO",e[e.UNKNOWN_AUDIO=4]="UNKNOWN_AUDIO"}(EF||(EF={})),function(e){e[e.INIT=0]="INIT",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.STOPPED=3]="STOPPED",e[e.INTERRUPTED=4]="INTERRUPTED"}(TF||(TF={}));var WF,jF=0;function qF(e,t){var n;t.invoking||(t.invoking=!0,(n=t.func).call.apply(n,[e].concat(t.args)).then((function(){t.invoking=!1,e._operationQueue.shift(),e._eventTarget.emit(t.id.toString());var n=e._operationQueue[0];n&&qF(e,n)})).catch((function(){})))}function XF(e,t,n){var i=n.value;n.value=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return new Promise((function(t){var r=jF++,o=e;o._operationQueue.push({id:r,func:i,args:n,invoking:!1}),o._eventTarget.once(r.toString(),t),qF(o,o._operationQueue[0])}))}}function YF(e){return new Promise((function(t){var n=e.play();return void 0===n?t():(n.then(t).catch((function(){var n=function(){e.play().catch((function(){})),t()},i=document.getElementById("GameCanvas");null==i||i.addEventListener("touchend",n,{once:!0}),null==i||i.addEventListener("mousedown",n,{once:!0})})),null)}))}var KF,ZF,QF=function(){function e(e,t){this._domAudio=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._domAudio=e,e.volume=t}var t=e.prototype;return t.play=function(){var e=this;YF(this._domAudio).then((function(){var t;null===(t=e.onPlay)||void 0===t||t.call(e)})).catch((function(){}))},t.stop=function(){this._domAudio.pause()},X(e,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(e){this._onPlayCb=e}},{key:"onEnd",get:function(){return this._onEndCb},set:function(e){this._onEndCb&&this._domAudio.removeEventListener("ended",this._onEndCb),this._onEndCb=e,e&&this._domAudio.addEventListener("ended",e)}}]),e}(),JF=(te((WF=function(){function e(e){var t=this;this._domAudio=void 0,this._state=TF.INIT,this._onHide=void 0,this._onShow=void 0,this._onEnded=void 0,this._eventTarget=new vi,this._operationQueue=[],this._domAudio=e,this._onHide=function(){t._state===TF.PLAYING&&t.pause().then((function(){t._state=TF.INTERRUPTED,t._eventTarget.emit(SF.INTERRUPTION_BEGIN)})).catch((function(){}))},i.game.on(i.Game.EVENT_HIDE,this._onHide),this._onShow=function(){t._state===TF.INTERRUPTED&&t.play().then((function(){t._eventTarget.emit(SF.INTERRUPTION_END)})).catch((function(){}))},i.game.on(i.Game.EVENT_SHOW,this._onShow),this._onEnded=function(){t.seek(0).catch((function(){})),t._state=TF.INIT,t._eventTarget.emit(SF.ENDED)},this._domAudio.addEventListener("ended",this._onEnded)}var t=e.prototype;return t.destroy=function(){this._onShow&&(i.game.off(i.Game.EVENT_SHOW,this._onShow),this._onShow=void 0),this._onHide&&(i.game.off(i.Game.EVENT_HIDE,this._onHide),this._onHide=void 0),this._onEnded&&(this._domAudio.removeEventListener("ended",this._onEnded),this._onEnded=void 0),this._domAudio=void 0},e.load=function(t){return new Promise((function(n){e.loadNative(t).then((function(t){n(new e(t))})).catch((function(){}))}))},e.loadNative=function(e){return new Promise((function(t,n){var i=document.createElement("audio"),r="canplaythrough";yi.os===pi.IOS?r="loadedmetadata":yi.browserType===hi.FIREFOX&&(r="canplay");var o=setTimeout((function(){0===i.readyState?c():s()}),8e3),a=function(){clearTimeout(o),i.removeEventListener(r,s,!1),i.removeEventListener("error",c,!1)},s=function(){a(),t(i)},c=function(){a(),n("load audio failure - "+e)};i.addEventListener(r,s,!1),i.addEventListener("error",c,!1),i.src=e}))},e.loadOneShotAudio=function(t,n){return new Promise((function(i,r){e.loadNative(t).then((function(e){var t=new QF(e,n);i(t)})).catch(r)}))},t.seek=function(e){return e=Jt(e,0,this.duration),this._domAudio.currentTime=e,Promise.resolve()},t.play=function(){var e=this;return new Promise((function(t){YF(e._domAudio).then((function(){e._state=TF.PLAYING,t()})).catch((function(){}))}))},t.pause=function(){return this._domAudio.pause(),this._state=TF.PAUSED,Promise.resolve()},t.stop=function(){var e=this;return new Promise((function(t){e._domAudio.pause(),e._domAudio.currentTime=0,e._state=TF.STOPPED,t()}))},t.onInterruptionBegin=function(e){this._eventTarget.on(SF.INTERRUPTION_BEGIN,e)},t.offInterruptionBegin=function(e){this._eventTarget.off(SF.INTERRUPTION_BEGIN,e)},t.onInterruptionEnd=function(e){this._eventTarget.on(SF.INTERRUPTION_END,e)},t.offInterruptionEnd=function(e){this._eventTarget.off(SF.INTERRUPTION_END,e)},t.onEnded=function(e){this._eventTarget.on(SF.ENDED,e)},t.offEnded=function(e){this._eventTarget.off(SF.ENDED,e)},X(e,[{key:"src",get:function(){return this._domAudio?this._domAudio.src:""}},{key:"type",get:function(){return EF.DOM_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._domAudio.loop},set:function(e){this._domAudio.loop=e}},{key:"volume",get:function(){return this._domAudio.volume},set:function(e){e=$t(e),this._domAudio.volume=e}},{key:"duration",get:function(){return this._domAudio.duration}},{key:"currentTime",get:function(){return this._domAudio.currentTime}}]),e}()).prototype,"seek",[XF],Object.getOwnPropertyDescriptor(WF.prototype,"seek"),WF.prototype),te(WF.prototype,"play",[XF],Object.getOwnPropertyDescriptor(WF.prototype,"play"),WF.prototype),te(WF.prototype,"pause",[XF],Object.getOwnPropertyDescriptor(WF.prototype,"pause"),WF.prototype),te(WF.prototype,"stop",[XF],Object.getOwnPropertyDescriptor(WF.prototype,"stop"),WF.prototype),WF),$F=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,ez=function(){function e(){this._context=void 0,this._context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}var t=e.prototype;return t.decodeAudioData=function(e){var t=this;return new Promise((function(n){var i=t._context.decodeAudioData(e,(function(e){n(e)}),(function(e){console.error("failed to load Web Audio",e)}));null==i||i.catch((function(){}))}))},t.runContext=function(){var e=this;return new Promise((function(t){var n=e._context;if(!n.resume)return t();if("running"===n.state)return t();if(n.resume().catch((function(){})),"running"!==n.state){var i=document.getElementById("GameCanvas"),r=function(){n.resume().then(t).catch((function(){}))};null==i||i.addEventListener("touchend",r,{once:!0}),null==i||i.addEventListener("mousedown",r,{once:!0})}return null}))},t.createBufferSource=function(e,t){var n=this._context.createBufferSource();return void 0!==e&&(n.buffer=e),void 0!==t&&(n.loop=t),n},t.createGain=function(e){var t=this._context.createGain();return void 0!==e&&this.setGainValue(t,e),t},t.setGainValue=function(e,t){if(e.gain.setTargetAtTime)try{e.gain.setTargetAtTime(t,this._context.currentTime,0)}catch(n){e.gain.setTargetAtTime(t,this._context.currentTime,.01)}else e.gain.value=t},t.connectContext=function(e){this._context&&e.connect(this._context.destination)},X(e,[{key:"currentTime",get:function(){return this._context.currentTime}}]),e}();ez.support=!!$F,ez.support&&(ZF=new ez);var tz,nz,iz,rz,oz,az=function(){function e(e,t){this._duration=void 0,this._bufferSourceNode=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._duration=e.duration,this._bufferSourceNode=ZF.createBufferSource(e,!1);var n=ZF.createGain(t);this._bufferSourceNode.connect(n),ZF.connectContext(n)}var t=e.prototype;return t.play=function(){var e=this;ZF.runContext().then((function(){var t;e._bufferSourceNode.start(),null===(t=e.onPlay)||void 0===t||t.call(e),window.setTimeout((function(){var t;null===(t=e.onEnd)||void 0===t||t.call(e)}),1e3*e._duration)})).catch((function(){}))},t.stop=function(){this._bufferSourceNode.stop()},X(e,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(e){this._onPlayCb=e}},{key:"onEnd",get:function(){return this._onEndCb},set:function(e){this._onEndCb=e}}]),e}(),sz=(te((KF=function(){function e(e,t){var n=this;this._src=void 0,this._audioBuffer=void 0,this._sourceNode=void 0,this._gainNode=void 0,this._currentTimer=0,this._volume=1,this._loop=!1,this._startTime=0,this._playTimeOffset=0,this._state=TF.INIT,this._eventTarget=new vi,this._operationQueue=[],this._onHide=void 0,this._onShow=void 0,this._audioBuffer=e,this._gainNode=ZF.createGain(),ZF.connectContext(this._gainNode),this._src=t,this._onHide=function(){n._state===TF.PLAYING&&n.pause().then((function(){n._state=TF.INTERRUPTED,n._eventTarget.emit(SF.INTERRUPTION_BEGIN)})).catch((function(){}))},i.game.on(i.Game.EVENT_HIDE,this._onHide),this._onShow=function(){n._state===TF.INTERRUPTED&&n.play().then((function(){n._eventTarget.emit(SF.INTERRUPTION_END)})).catch((function(){}))},i.game.on(i.Game.EVENT_SHOW,this._onShow)}var t=e.prototype;return t.destroy=function(){this._audioBuffer&&(this._audioBuffer=void 0),this._onShow&&(i.game.off(i.Game.EVENT_SHOW,this._onShow),this._onShow=void 0),this._onHide&&(i.game.off(i.Game.EVENT_HIDE,this._onHide),this._onHide=void 0)},e.load=function(t){return new Promise((function(n){e.loadNative(t).then((function(i){n(new e(i,t))})).catch((function(){}))}))},e.loadNative=function(e){return new Promise((function(t,n){var i=new XMLHttpRequest,r="load audio failed: "+e+", status: ";i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){200===i.status||0===i.status?ZF.decodeAudioData(i.response).then((function(e){t(e)})).catch((function(){})):n(new Error(""+r+i.status+"(no response)"))},i.onerror=function(){n(new Error(""+r+i.status+"(error)"))},i.ontimeout=function(){n(new Error(""+r+i.status+"(time out)"))},i.onabort=function(){n(new Error(""+r+i.status+"(abort)"))},i.send(null)}))},e.loadOneShotAudio=function(t,n){return new Promise((function(i,r){e.loadNative(t).then((function(e){var t=new az(e,n);i(t)})).catch(r)}))},t.seek=function(e){var t=this;return new Promise((function(n){t._playTimeOffset=Jt(e,0,t._audioBuffer.duration),t._state===TF.PLAYING?t._doPlay().then(n).catch((function(){})):n()}))},t.play=function(){return this._doPlay()},t._doPlay=function(){var e=this;return new Promise((function(t){ZF.runContext().then((function(){e._stopSourceNode(),e._sourceNode=ZF.createBufferSource(e._audioBuffer,e.loop),e._sourceNode.connect(e._gainNode),e._sourceNode.start(0,e._playTimeOffset),e._state=TF.PLAYING,e._startTime=ZF.currentTime,window.clearTimeout(e._currentTimer),e._currentTimer=window.setTimeout((function t(){e._playTimeOffset=0,e._startTime=ZF.currentTime,e.loop?e._currentTimer=window.setTimeout(t,1e3*e._audioBuffer.duration):(e._eventTarget.emit(SF.ENDED),e._state=TF.INIT)}),1e3*(e._audioBuffer.duration-e._playTimeOffset)),t()})).catch((function(){}))}))},t._stopSourceNode=function(){try{var e;null===(e=this._sourceNode)||void 0===e||e.stop()}catch(e){}},t.pause=function(){return this._state===TF.PLAYING&&this._sourceNode?(this._playTimeOffset=(ZF.currentTime-this._startTime+this._playTimeOffset)%this._audioBuffer.duration,this._state=TF.PAUSED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):Promise.resolve()},t.stop=function(){return this._sourceNode?(this._playTimeOffset=0,this._state=TF.STOPPED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):Promise.resolve()},t.onInterruptionBegin=function(e){this._eventTarget.on(SF.INTERRUPTION_BEGIN,e)},t.offInterruptionBegin=function(e){this._eventTarget.off(SF.INTERRUPTION_BEGIN,e)},t.onInterruptionEnd=function(e){this._eventTarget.on(SF.INTERRUPTION_END,e)},t.offInterruptionEnd=function(e){this._eventTarget.off(SF.INTERRUPTION_END,e)},t.onEnded=function(e){this._eventTarget.on(SF.ENDED,e)},t.offEnded=function(e){this._eventTarget.off(SF.ENDED,e)},X(e,[{key:"src",get:function(){return this._src}},{key:"type",get:function(){return EF.WEB_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._loop},set:function(e){this._loop=e,this._sourceNode&&(this._sourceNode.loop=e)}},{key:"volume",get:function(){return this._volume},set:function(e){e=$t(e),this._volume=e,ZF.setGainValue(this._gainNode,e)}},{key:"duration",get:function(){return this._audioBuffer.duration}},{key:"currentTime",get:function(){return this._state!==TF.PLAYING?this._playTimeOffset:(ZF.currentTime-this._startTime+this._playTimeOffset)%this._audioBuffer.duration}}]),e}()).prototype,"seek",[XF],Object.getOwnPropertyDescriptor(KF.prototype,"seek"),KF.prototype),te(KF.prototype,"play",[XF],Object.getOwnPropertyDescriptor(KF.prototype,"play"),KF.prototype),te(KF.prototype,"pause",[XF],Object.getOwnPropertyDescriptor(KF.prototype,"pause"),KF.prototype),te(KF.prototype,"stop",[XF],Object.getOwnPropertyDescriptor(KF.prototype,"stop"),KF.prototype),KF),cz=function(){function e(e){this._audio=void 0,this._audio=e}var t=e.prototype;return t.play=function(){this._audio.play()},t.stop=function(){this._audio.stop()},X(e,[{key:"onPlay",get:function(){return this._audio.onPlay},set:function(e){this._audio.onPlay=e}},{key:"onEnd",get:function(){return this._audio.onEnd},set:function(e){this._audio.onEnd=e}}]),e}(),lz=function(){function e(e){this._player=void 0,this._player=e}e.load=function(t,n){return new Promise((function(i){(null==n?void 0:n.audioLoadMode)!==EF.DOM_AUDIO&&ez.support?sz.load(t).then((function(t){i(new e(t))})).catch((function(){})):(ez.support||A(5201),JF.load(t).then((function(t){i(new e(t))})).catch((function(){})))}))};var t=e.prototype;return t.destroy=function(){this._player.destroy()},e.loadNative=function(e,t){return(null==t?void 0:t.audioLoadMode)!==EF.DOM_AUDIO&&ez.support?sz.loadNative(e):(ez.support||A(5201),JF.loadNative(e))},e.loadOneShotAudio=function(e,t,n){return new Promise((function(i,r){(null==n?void 0:n.audioLoadMode)!==EF.DOM_AUDIO&&ez.support?sz.loadOneShotAudio(e,t).then((function(e){i(new cz(e))})).catch(r):(ez.support||A(5201),JF.loadOneShotAudio(e,t).then((function(e){i(new cz(e))})).catch(r))}))},t.seek=function(e){return this._player.seek(e)},t.play=function(){return this._player.play()},t.pause=function(){return this._player.pause()},t.stop=function(){return this._player.stop()},t.onInterruptionBegin=function(e){this._player.onInterruptionBegin(e)},t.offInterruptionBegin=function(e){this._player.offInterruptionBegin(e)},t.onInterruptionEnd=function(e){this._player.onInterruptionEnd(e)},t.offInterruptionEnd=function(e){this._player.offInterruptionEnd(e)},t.onEnded=function(e){this._player.onEnded(e)},t.offEnded=function(e){this._player.offEnded(e)},X(e,[{key:"src",get:function(){return this._player.src}},{key:"type",get:function(){return this._player.type}},{key:"state",get:function(){return this._player.state}},{key:"loop",get:function(){return this._player.loop},set:function(e){this._player.loop=e}},{key:"volume",get:function(){return this._player.volume},set:function(e){this._player.volume=e}},{key:"duration",get:function(){return this._player.duration}},{key:"currentTime",get:function(){return this._player.currentTime}}]),e}();lz.maxAudioChannel=24;var uz=e("AudioClip",S_("cc.AudioClip")((oz=rz=function(e){function t(){var t;return ee(t=e.call(this)||this,"_duration",iz,Q(t)),t._loadMode=EF.UNKNOWN_AUDIO,t._meta=null,t.loaded=!1,t}K(t,e);var n=t.prototype;return n.validate=function(){return!!this._meta},n.getDuration=function(){return this._duration?this._duration:this._meta?this._meta.duration:0},X(t,[{key:"_nativeAsset",get:function(){return this._meta},set:function(e){this._meta=e,e?(this.loaded=!0,this._loadMode=e.type,this.emit("load")):(this._meta=null,this._loadMode=EF.UNKNOWN_AUDIO,this._duration=0,this.loaded=!1)}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}},{key:"loadMode",get:function(){return this._loadMode}}]),t}(Rf),rz.AudioType=EF,iz=te((nz=oz).prototype,"_duration",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),te(nz.prototype,"_nativeDep",[Z_],Object.getOwnPropertyDescriptor(nz.prototype,"_nativeDep"),nz.prototype),tz=nz))||tz);function hz(e,t,n){lz.load(e,{audioLoadMode:t.audioLoadMode}).then((function(t){var i={url:e,duration:t.duration,type:t.type};t.destroy(),n(null,i)})).catch((function(e){n(e)}))}function _z(e,t,n,i){var r=new uz;r._nativeUrl=e,r._nativeAsset=t,r._duration=t.duration,i(null,r)}i.AudioClip=uz,JO.register({".mp3":hz,".ogg":hz,".wav":hz,".m4a":hz}),oD.register({".mp3":_z,".ogg":_z,".wav":_z,".m4a":_z});var fz,dz,pz,mz,gz,vz,yz,Sz,Ez,Tz,xz,Az,Cz,bz,wz,Rz,Iz,Pz,Oz=new(function(){function e(){this._oneShotAudioInfoList=[],this._audioPlayerInfoList=[]}var t=e.prototype;return t._findIndex=function(e,t){return e.findIndex((function(e){return e.audio===t}))},t._tryAddPlaying=function(e,t){var n=this._findIndex(e,t);return n>-1?(e[n].playTime=performance.now(),!1):(e.push({audio:t,playTime:performance.now()}),!0)},t.addPlaying=function(e){if(e instanceof lz){if(this._tryAddPlaying(this._audioPlayerInfoList,e))return}else this._tryAddPlaying(this._oneShotAudioInfoList,e)},t._tryRemovePlaying=function(e,t){var n=this._findIndex(e,t);return-1!==n&&(re(e,n),!0)},t.removePlaying=function(e){if(e instanceof lz){if(this._tryRemovePlaying(this._audioPlayerInfoList,e))return}else this._tryRemovePlaying(this._oneShotAudioInfoList,e)},t.discardOnePlayingIfNeeded=function(){var e;this._audioPlayerInfoList.length+this._oneShotAudioInfoList.length<lz.maxAudioChannel||(this._oneShotAudioInfoList.length>0?this._oneShotAudioInfoList.forEach((function(t){(!e||t.playTime<e.playTime)&&(e=t)})):this._audioPlayerInfoList.forEach((function(t){(!e||t.playTime<e.playTime)&&(e=t)})),e&&(e.audio.stop(),this.removePlaying(e.audio)))},e}()),Dz=function(t){return e({AudioSource:t,AudioSourceComponent:t}),t}((fz=S_("cc.AudioSource"),dz=D_(),pz=R_(),mz=K_(uz),gz=K_(uz),vz=B_(),yz=B_(),Sz=B_(),Ez=F_(),Tz=B_(),fz(xz=dz(xz=pz((Pz=Iz=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_clip",Cz,Q(t)),t._player=null,ee(t,"_loop",bz,Q(t)),ee(t,"_playOnAwake",wz,Q(t)),ee(t,"_volume",Rz,Q(t)),t._cachedCurrentTime=0,t._operationsBeforeLoading=[],t._isLoaded=!1,t._lastSetClip=void 0,t}K(t,e);var n=t.prototype;return n._syncPlayer=function(){var e=this,t=this._clip;this._isLoaded=!1,t&&this._lastSetClip!==t&&(t._nativeAsset?(this._lastSetClip=t,lz.load(t._nativeAsset.url,{audioLoadMode:t.loadMode}).then((function(n){e._lastSetClip===t&&(e._isLoaded=!0,e._player&&(e._player.offEnded(),e._player.offInterruptionBegin(),e._player.offInterruptionEnd(),e._player.destroy()),e._player=n,n.onEnded((function(){Oz.removePlaying(n)})),n.onInterruptionBegin((function(){Oz.removePlaying(n)})),n.onInterruptionEnd((function(){Oz.addPlaying(n)})),e._syncStates())})).catch((function(){}))):console.error("Invalid audio clip"))},n.onLoad=function(){this._syncPlayer()},n.onEnable=function(){this._playOnAwake&&!this.playing&&this.play()},n.onDisable=function(){this.pause()},n.onDestroy=function(){this.stop()},n.play=function(){var e,t,n=this;this._isLoaded?(Oz.discardOnePlayingIfNeeded(),this.state===TF.PLAYING&&(null===(t=this._player)||void 0===t||t.stop().catch((function(){}))),null===(e=this._player)||void 0===e||e.play().then((function(){Oz.addPlaying(n._player)})).catch((function(){}))):this._operationsBeforeLoading.push("play")},n.pause=function(){var e,t=this;this._isLoaded?null===(e=this._player)||void 0===e||e.pause().then((function(){Oz.removePlaying(t._player)})).catch((function(){})):this._operationsBeforeLoading.push("pause")},n.stop=function(){var e,t=this;this._isLoaded?null===(e=this._player)||void 0===e||e.stop().then((function(){Oz.removePlaying(t._player)})).catch((function(){})):this._operationsBeforeLoading.push("stop")},n.playOneShot=function(e,t){void 0===t&&(t=1),e._nativeAsset?lz.loadOneShotAudio(e._nativeAsset.url,this._volume*t,{audioLoadMode:e.loadMode}).then((function(e){Oz.discardOnePlayingIfNeeded(),e.onPlay=function(){Oz.addPlaying(e)},e.onEnd=function(){Oz.removePlaying(e)},e.play()})).catch((function(){})):console.error("Invalid audio clip")},n._syncStates=function(){var e=this;this._player&&this._player.seek(this._cachedCurrentTime).then((function(){e._player&&(e._player.loop=e._loop,e._player.volume=e._volume,e._operationsBeforeLoading.forEach((function(t){var n;null===(n=e[t])||void 0===n||n.call(e)})),e._operationsBeforeLoading.length=0)})).catch((function(){}))},X(t,[{key:"clip",get:function(){return this._clip},set:function(e){e!==this._clip&&(this._clip=e,this._syncPlayer())}},{key:"loop",get:function(){return this._loop},set:function(e){this._loop=e,this._player&&(this._player.loop=e)}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(e){this._playOnAwake=e}},{key:"volume",get:function(){return this._volume},set:function(e){Number.isNaN(e)?console.warn("illegal audio volume!"):(e=Jt(e,0,1),this._player?(this._player.volume=e,this._volume=this._player.volume):this._volume=e)}},{key:"currentTime",get:function(){return this._player?this._player.currentTime:this._cachedCurrentTime},set:function(e){var t;Number.isNaN(e)?console.warn("illegal audio time!"):(e=Jt(e,0,this.duration),this._cachedCurrentTime=e,null===(t=this._player)||void 0===t||t.seek(this._cachedCurrentTime).catch((function(){})))}},{key:"duration",get:function(){var e,t;return null!==(e=null===(t=this._clip)||void 0===t?void 0:t.getDuration())&&void 0!==e?e:this._player?this._player.currentTime:0}},{key:"state",get:function(){return this._player?this._player.state:TF.INIT}},{key:"playing",get:function(){return this.state===t.AudioState.PLAYING}}],[{key:"maxAudioChannel",get:function(){return lz.maxAudioChannel}}]),t}(Xd),Iz.AudioState=TF,Cz=te((Az=Pz).prototype,"_clip",[mz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bz=te(Az.prototype,"_loop",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wz=te(Az.prototype,"_playOnAwake",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Rz=te(Az.prototype,"_volume",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),te(Az.prototype,"clip",[gz,vz],Object.getOwnPropertyDescriptor(Az.prototype,"clip"),Az.prototype),te(Az.prototype,"loop",[yz],Object.getOwnPropertyDescriptor(Az.prototype,"loop"),Az.prototype),te(Az.prototype,"playOnAwake",[Sz],Object.getOwnPropertyDescriptor(Az.prototype,"playOnAwake"),Az.prototype),te(Az.prototype,"volume",[Ez,Tz],Object.getOwnPropertyDescriptor(Az.prototype,"volume"),Az.prototype),xz=Az))||xz)||xz)||xz));F(uz,"AudioClip",[{name:"PlayingState",newName:"AudioState",target:Dz,targetName:"AudioSource"}]),F(uz.prototype,"AudioClip.prototype",[{name:"state",targetName:"AudioSource.prototype",customGetter:function(){return TF.INIT}}]),F(uz.prototype,"AudioClip.prototype",[{name:"getCurrentTime",targetName:"AudioSource.prototype",customFunction:function(){return 0}},{name:"getVolume",targetName:"AudioSource.prototype",customFunction:function(){return 0}},{name:"getLoop",targetName:"AudioSource.prototype",customFunction:function(){return!1}}]),F(uz.prototype,"AudioClip.prototype",["play","pause","stop","playOneShot","setCurrentTime","setVolume","setLoop"].map((function(e){return{name:e,targetName:"AudioSource.prototype",customFunction:function(){}}}))),i.AudioSourceComponent=Dz,Ke.setClassAlias(Dz,"cc.AudioSourceComponent");var Nz=function(){function e(){this.originalTarget=null,this.target=null,this.tag=e.TAG_INVALID}var t=e.prototype;return t.clone=function(){var t=new e;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},t.isDone=function(){return!0},t.startWithTarget=function(e){this.originalTarget=e,this.target=e},t.stop=function(){this.target=null},t.step=function(){T(1006)},t.update=function(){T(1007)},t.getTarget=function(){return this.target},t.setTarget=function(e){this.target=e},t.getOriginalTarget=function(){return this.originalTarget},t.setOriginalTarget=function(e){this.originalTarget=e},t.getTag=function(){return this.tag},t.setTag=function(e){this.tag=e},t.reverse=function(){return T(1008),null},t.retain=function(){},t.release=function(){},e}();Nz.TAG_INVALID=-1;var Mz=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._duration=0,t._timesForRepeat=1,t}K(t,e);var n=t.prototype;return n.getDuration=function(){return this._duration*(this._timesForRepeat||1)},n.setDuration=function(e){this._duration=e},n.clone=function(){return new t},t}(Nz),Lz=(function(e){function t(t,n){var i;return void 0===n&&(n=1),(i=e.call(this)||this)._speed=0,i._innerAction=null,t&&i.initWithAction(t,n),i}K(t,e);var n=t.prototype;n.getSpeed=function(){return this._speed},n.setSpeed=function(e){this._speed=e},n.initWithAction=function(e,t){return e?(this._innerAction=e,this._speed=t,!0):(b(1021),!1)},n.clone=function(){var e=new t;return e.initWithAction(this._innerAction.clone(),this._speed),e},n.startWithTarget=function(e){Nz.prototype.startWithTarget.call(this,e),this._innerAction.startWithTarget(e)},n.stop=function(){this._innerAction.stop(),Nz.prototype.stop.call(this)},n.step=function(e){this._innerAction.step(e*this._speed)},n.isDone=function(){return this._innerAction.isDone()},n.reverse=function(){return new t(this._innerAction.reverse(),this._speed)},n.setInnerAction=function(e){this._innerAction!==e&&(this._innerAction=e)},n.getInnerAction=function(){return this._innerAction}}(Nz),0),Bz=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},Fz=function(){function e(){this._hashTargets=new Map,this._arrayTargets=[],this._elementPool=[]}var t=e.prototype;return t._searchElementByTarget=function(e,t){for(var n=0;n<e.length;n++)if(t===e[n].target)return e[n];return null},t._getElement=function(e,t){var n=this._elementPool.pop();return n||(n=new Bz),n.target=e,n.paused=!!t,n},t._putElement=function(e){e.actions.length=0,e.actionIndex=0,e.currentAction=null,e.paused=!1,e.target=null,e.lock=!1,this._elementPool.push(e)},t.addAction=function(e,t,n){if(e&&t){null==t.uuid&&(t.uuid="_TWEEN_UUID_"+Lz++);var i=this._hashTargets.get(t);i?i.actions||(i.actions=[]):(i=this._getElement(t,n),this._hashTargets.set(t,i),this._arrayTargets.push(i)),i.target=t,i.actions.push(e),e.startWithTarget(t)}else b(1e3)},t.removeAllActions=function(){for(var e=this._arrayTargets,t=0;t<e.length;t++){var n=e[t];n&&this._putElement(n)}this._arrayTargets.length=0,this._hashTargets=new Map},t.removeAllActionsFromTarget=function(e){if(null!=e){var t=this._hashTargets.get(e);t&&(t.actions.length=0,this._deleteHashElement(t))}},t.removeAction=function(e){if(null!=e){var t=e.getOriginalTarget(),n=this._hashTargets.get(t);if(n)for(var i=0;i<n.actions.length;i++)if(n.actions[i]===e){n.actions.splice(i,1),n.actionIndex>=i&&n.actionIndex--;break}}},t._removeActionByTag=function(e,t,n){for(var i=0,r=t.actions.length;i<r;++i){var o=t.actions[i];if(o&&o.getTag()===e){if(n&&o.getOriginalTarget()!==n)continue;this._removeActionAtIndex(i,t);break}}},t.removeActionByTag=function(e,t){var n=this;e===Nz.TAG_INVALID&&T(1002);var i=this._hashTargets;if(t){var r=i.get(t);r&&this._removeActionByTag(e,r,t)}else i.forEach((function(t){n._removeActionByTag(e,t)}))},t.getActionByTag=function(e,t){e===Nz.TAG_INVALID&&T(1004);var n=this._hashTargets.get(t);if(n){if(null!=n.actions)for(var i=0;i<n.actions.length;++i){var r=n.actions[i];if(r&&r.getTag()===e)return r}T(1005,e)}return null},t.getNumberOfRunningActionsInTarget=function(e){var t=this._hashTargets.get(e);return t&&t.actions?t.actions.length:0},t.pauseTarget=function(e){var t=this._hashTargets.get(e);t&&(t.paused=!0)},t.resumeTarget=function(e){var t=this._hashTargets.get(e);t&&(t.paused=!1)},t.pauseAllRunningActions=function(){for(var e=[],t=this._arrayTargets,n=0;n<t.length;n++){var i=t[n];i&&!i.paused&&(i.paused=!0,e.push(i.target))}return e},t.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)e[t]&&this.resumeTarget(e[t])},t.pauseTargets=function(e){if(e)for(var t=0;t<e.length;t++)e[t]&&this.pauseTarget(e[t])},t.purgeSharedManager=function(){i.director.getScheduler().unscheduleUpdate(this)},t._removeActionAtIndex=function(e,t){t.actions[e],t.actions.splice(e,1),t.actionIndex>=e&&t.actionIndex--,0===t.actions.length&&this._deleteHashElement(t)},t._deleteHashElement=function(e){var t=!1;if(e&&!e.lock&&this._hashTargets.get(e.target)){this._hashTargets.delete(e.target);for(var n=this._arrayTargets,i=0,r=n.length;i<r;i++)if(n[i]===e){n.splice(i,1);break}this._putElement(e),t=!0}return t},t.update=function(e){for(var t,n=this._arrayTargets,i=0;i<n.length;i++){this._currentTarget=n[i];var r=(t=this._currentTarget).target;if(r instanceof ei&&!r.isValid)this.removeAllActionsFromTarget(r),i--;else{if(!t.paused&&t.actions){for(t.lock=!0,t.actionIndex=0;t.actionIndex<t.actions.length;t.actionIndex++)if(t.currentAction=t.actions[t.actionIndex],t.currentAction){if(t.currentAction.step(e*(t.currentAction._speedMethod?t.currentAction._speed:1)),t.currentAction&&t.currentAction.isDone()){t.currentAction.stop();var o=t.currentAction;t.currentAction=null,this.removeAction(o)}t.currentAction=null}t.lock=!1}0===t.actions.length&&this._deleteHashElement(t)&&i--}}},e}(),zz=e("TweenSystem",function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).actionMgr=new Fz,t}return K(t,e),t.prototype.update=function(e){this.actionMgr.update(e)},X(t,[{key:"ActionManager",get:function(){return this.actionMgr}}]),t}(ew));zz.ID="TWEEN",zz.instance=void 0,SO.on(yO.EVENT_INIT,(function(){var e=new zz;zz.instance=e,SO.registerSystem(zz.ID,e,100)}));var Uz=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.isDone=function(){return!0},n.step=function(){this.update(1)},n.update=function(){},n.reverse=function(){return this.clone()},n.clone=function(){return new t},t}(Mz),Hz=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.update=function(){for(var e=this.target.getComponentsInChildren(DM),t=0;t<e.length;++t)e[t].enabled=!0},n.reverse=function(){return new Gz},n.clone=function(){return new t},t}(Uz),Gz=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.update=function(){for(var e=this.target.getComponentsInChildren(DM),t=0;t<e.length;++t)e[t].enabled=!1},n.reverse=function(){return new Hz},n.clone=function(){return new t},t}(Uz);!function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;n.update=function(){for(var e=this.target.getComponentsInChildren(DM),t=0;t<e.length;++t){var n=e[t];n.enabled=!n.enabled}},n.reverse=function(){return new t},n.clone=function(){return new t}}(Uz);var kz=function(e){function t(t){var n;return(n=e.call(this)||this)._isNeedCleanUp=!0,void 0!==t&&n.init(t),n}K(t,e);var n=t.prototype;return n.update=function(){this.target.removeFromParent(),this._isNeedCleanUp&&this.target.destroy()},n.init=function(e){return this._isNeedCleanUp=e,!0},n.reverse=function(){return new t(this._isNeedCleanUp)},n.clone=function(){return new t(this._isNeedCleanUp)},t}(Uz),Vz=function(e){function t(t,n,i){var r;return(r=e.call(this)||this)._selectorTarget=null,r._function=null,r._data=null,r.initWithFunction(t,n,i),r}K(t,e);var n=t.prototype;return n.initWithFunction=function(e,t,n){return e&&(this._function=e),t&&(this._selectorTarget=t),void 0!==n&&(this._data=n),!0},n.execute=function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},n.update=function(){this.execute()},n.getTargetCallback=function(){return this._selectorTarget},n.setTargetCallback=function(e){e!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=e)},n.clone=function(){var e=new t;return e.initWithFunction(this._function,this._selectorTarget,this._data),e},t}(Uz),Wz=function(e){function t(t){var n;return(n=e.call(this)||this).MAX_VALUE=2,n._elapsed=0,n._firstTick=!1,n._easeList=[],n._speed=1,n._repeatForever=!1,n._repeatMethod=!1,n._speedMethod=!1,void 0===t||isNaN(t)||n.initWithDuration(t),n}K(t,e);var n=t.prototype;return n.getElapsed=function(){return this._elapsed},n.initWithDuration=function(e){return this._duration=0===e?nt.FLT_EPSILON:e,this._elapsed=0,this._firstTick=!0,!0},n.isDone=function(){return this._elapsed>=this._duration},n._cloneDecoration=function(e){e._repeatForever=this._repeatForever,e._speed=this._speed,e._timesForRepeat=this._timesForRepeat,e._easeList=this._easeList,e._speedMethod=this._speedMethod,e._repeatMethod=this._repeatMethod},n._reverseEaseList=function(e){if(this._easeList){e._easeList=[];for(var t=0;t<this._easeList.length;t++)e._easeList.push(this._easeList[t])}},n.clone=function(){var e=new t(this._duration);return this._cloneDecoration(e),e},n.easing=function(e){this._easeList?this._easeList.length=0:this._easeList=[];for(var t=0;t<arguments.length;t++)this._easeList.push(arguments[t]);return this},n._computeEaseTime=function(e){return e},n.step=function(e){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=e;var t=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);t=t<1?t:1,this.update(t>0?t:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},n.startWithTarget=function(e){Nz.prototype.startWithTarget.call(this,e),this._elapsed=0,this._firstTick=!0},n.reverse=function(){return T(1010),this},n.setAmplitudeRate=function(){T(1011)},n.getAmplitudeRate=function(){return T(1012),0},n.speed=function(e){return e<=0?(T(1013),this):(this._speedMethod=!0,this._speed*=e,this)},n.getSpeed=function(){return this._speed},n.setSpeed=function(e){return this._speed=e,this},n.repeat=function(e){return e=Math.round(e),isNaN(e)||e<1?(T(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=e,this)},n.repeatForever=function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this},t}(Mz),jz=function(e){function t(n){var i;(i=e.call(this)||this)._actions=[],i._split=0,i._last=0,i._reversed=!1;var r=n instanceof Array?n:arguments;if(1===r.length)return b(1019),Q(i);var o=r.length-1;if(o>=0&&null==r[o]&&T(1015),o>=0){for(var a,s=r[0],c=1;c<o;c++)r[c]&&(a=s,s=t._actionOneTwo(a,r[c]));i.initWithTwoActions(s,r[o])}return i}K(t,e);var n=t.prototype;return n.initWithTwoActions=function(e,t){if(!e||!t)return b(1025),!1;var n=e._duration,i=t._duration,r=(n*=e._repeatMethod?e._timesForRepeat:1)+(i*=t._repeatMethod?t._timesForRepeat:1);return this.initWithDuration(r),this._actions[0]=e,this._actions[1]=t,!0},n.clone=function(){var e=new t;return this._cloneDecoration(e),e.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),e},n.startWithTarget=function(e){Wz.prototype.startWithTarget.call(this,e),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},n.stop=function(){-1!==this._last&&this._actions[this._last].stop(),Nz.prototype.stop.call(this)},n.update=function(e){var t,n,i=0,r=this._split,o=this._actions,a=this._last;(e=this._computeEaseTime(e))<r?(t=0!==r?e/r:1,0===i&&1===a&&this._reversed&&(o[1].update(0),o[1].stop())):(i=1,t=1===r?1:(e-r)/(1-r),-1===a&&(o[0].startWithTarget(this.target),o[0].update(1),o[0].stop()),0===a&&(o[0].update(1),o[0].stop())),n=o[i],a===i&&n.isDone()||(a!==i&&n.startWithTarget(this.target),t*=n._timesForRepeat,n.update(t>1?t%1:t),this._last=i)},n.reverse=function(){var e=t._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(e),this._reverseEaseList(e),e._reversed=!0,e},t}(Wz);function qz(e){var t=e instanceof Array?e:arguments;if(1===t.length)return b(1019),null;var n=t.length-1;n>=0&&null==t[n]&&T(1015);var i=null;if(n>=0){i=t[0];for(var r=1;r<=n;r++)t[r]&&(i=jz._actionOneTwo(i,t[r]))}return i}jz._actionOneTwo=function(e,t){var n=new jz;return n.initWithTwoActions(e,t),n};var Xz=function(e){function t(t,n){var i;return(i=e.call(this)||this)._times=0,i._total=0,i._nextDt=0,i._actionInstant=!1,i._innerAction=null,void 0!==n&&i.initWithAction(t,n),i}K(t,e);var n=t.prototype;return n.initWithAction=function(e,t){var n=e._duration*t;return!!this.initWithDuration(n)&&(this._times=t,this._innerAction=e,e instanceof Uz&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},n.clone=function(){var e=new t;return this._cloneDecoration(e),e.initWithAction(this._innerAction.clone(),this._times),e},n.startWithTarget=function(e){this._total=0,this._nextDt=this._innerAction._duration/this._duration,Wz.prototype.startWithTarget.call(this,e),this._innerAction.startWithTarget(e)},n.stop=function(){this._innerAction.stop(),Nz.prototype.stop.call(this)},n.update=function(e){e=this._computeEaseTime(e);var t=this._innerAction,n=this._duration,i=this._times,r=this._nextDt;if(e>=r){for(;e>r&&this._total<i;)t.update(1),this._total++,t.stop(),t.startWithTarget(this.target),r+=t._duration/n,this._nextDt=r>1?1:r;e>=1&&this._total<i&&(t.update(1),this._total++),this._actionInstant||(this._total===i?t.stop():t.update(e-(r-t._duration/n)))}else t.update(e*i%1)},n.isDone=function(){return this._total===this._times},n.reverse=function(){var e=new t(this._innerAction.reverse(),this._times);return this._cloneDecoration(e),this._reverseEaseList(e),e},n.setInnerAction=function(e){this._innerAction!==e&&(this._innerAction=e)},n.getInnerAction=function(){return this._innerAction},t}(Wz),Yz=function(e){function t(t){var n;return(n=e.call(this)||this)._innerAction=null,t&&n.initWithAction(t),n}K(t,e);var n=t.prototype;return n.initWithAction=function(e){return e?(this._innerAction=e,!0):(b(1026),!1)},n.clone=function(){var e=new t;return this._cloneDecoration(e),e.initWithAction(this._innerAction.clone()),e},n.startWithTarget=function(e){Wz.prototype.startWithTarget.call(this,e),this._innerAction.startWithTarget(e)},n.step=function(e){var t=this._innerAction;t.step(e),t.isDone()&&(t.startWithTarget(this.target),t.step(t.getElapsed()-t._duration))},n.isDone=function(){return!1},n.reverse=function(){var e=new t(this._innerAction.reverse());return this._cloneDecoration(e),this._reverseEaseList(e),e},n.setInnerAction=function(e){this._innerAction!==e&&(this._innerAction=e)},n.getInnerAction=function(){return this._innerAction},t}(Wz),Kz=function(e){function t(n){var i;(i=e.call(this)||this)._one=null,i._two=null;var r=n instanceof Array?n:arguments;if(1===r.length)return b(1020),Q(i);var o=r.length-1;if(o>=0&&null==r[o]&&T(1015),o>=0){for(var a,s=r[0],c=1;c<o;c++)r[c]&&(a=s,s=t._actionOneTwo(a,r[c]));i.initWithTwoActions(s,r[o])}return i}K(t,e);var n=t.prototype;return n.initWithTwoActions=function(e,t){if(!e||!t)return b(1027),!1;var n=!1,i=e._duration,r=t._duration;return this.initWithDuration(Math.max(i,r))&&(this._one=e,this._two=t,i>r?this._two=jz._actionOneTwo(t,Jz(i-r)):i<r&&(this._one=jz._actionOneTwo(e,Jz(r-i))),n=!0),n},n.clone=function(){var e=new t;return this._cloneDecoration(e),e.initWithTwoActions(this._one.clone(),this._two.clone()),e},n.startWithTarget=function(e){Wz.prototype.startWithTarget.call(this,e),this._one.startWithTarget(e),this._two.startWithTarget(e)},n.stop=function(){this._one.stop(),this._two.stop(),Nz.prototype.stop.call(this)},n.update=function(e){e=this._computeEaseTime(e),this._one&&this._one.update(e),this._two&&this._two.update(e)},n.reverse=function(){var e=t._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(e),this._reverseEaseList(e),e},t}(Wz);function Zz(e){var t=e instanceof Array?e:arguments;if(1===t.length)return b(1020),null;t.length>0&&null==t[t.length-1]&&T(1015);for(var n=t[0],i=1;i<t.length;i++)null!=t[i]&&(n=Kz._actionOneTwo(n,t[i]));return n}Kz._actionOneTwo=function(e,t){var n=new Kz;return n.initWithTwoActions(e,t),n};var Qz=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.update=function(){},n.reverse=function(){var e=new t(this._duration);return this._cloneDecoration(e),this._reverseEaseList(e),e},n.clone=function(){var e=new t;return this._cloneDecoration(e),e.initWithDuration(this._duration),e},t}(Wz);function Jz(e){return new Qz(e)}var $z=function(e){function t(t){var n;return(n=e.call(this)||this)._other=null,t&&n.initWithAction(t),n}K(t,e);var n=t.prototype;return n.initWithAction=function(e){return e?e===this._other?(b(1029),!1):!!Wz.prototype.initWithDuration.call(this,e._duration)&&(this._other=e,!0):(b(1028),!1)},n.clone=function(){var e=new t;return this._cloneDecoration(e),e.initWithAction(this._other.clone()),e},n.startWithTarget=function(e){Wz.prototype.startWithTarget.call(this,e),this._other.startWithTarget(e)},n.update=function(e){e=this._computeEaseTime(e),this._other&&this._other.update(1-e)},n.reverse=function(){return this._other.clone()},n.stop=function(){this._other.stop(),Nz.prototype.stop.call(this)},t}(Wz),eU=function(e){function t(t,n,i){var o;if((o=e.call(this)||this)._opts=void 0,o._props=void 0,o._originProps=void 0,null==i)i=Object.create(null);else if(function(e){var t=" [Tween:] ",n=" option is not support in v + "+r,i=e;i.delay&&d(t+"delay"+n),i.repeat&&d(t+"repeat"+n),i.repeatDelay&&d(t+"repeatDelay"+n),i.interpolation&&d(t+"interpolation"+n),i.onStop&&d(t+"onStop"+n)}(i),i.easing&&"string"==typeof i.easing&&(i.easing=function(e){var t=e.charAt(0);if(/[A-Z]/.test(t)){var n=(e=e.replace(t,t.toLowerCase())).split("-");if(2===n.length){var i=n[0];if("linear"===i)e="linear";else{var r=n[1];switch(i){case"quadratic":e="quad"+r;break;case"quartic":e="quart"+r;break;case"quintic":e="quint"+r;break;case"sinusoidal":e="sine"+r;break;case"exponential":e="expo"+r;break;case"circular":e="circ"+r;break;default:e=i+r}}}}return e}(i.easing)),i.progress||(i.progress=o.progress),i.easing&&"string"==typeof i.easing){var a=i.easing;i.easing=Qb[a],i.easing||A(1031,a)}for(var s in o._opts=i,o._props=Object.create(null),n)if(n.hasOwnProperty(s)){var c=n[s];if(null!=c&&"string"!=typeof c&&"function"!=typeof c){var l=void 0,u=void 0;void 0!==c.value&&(c.easing||c.progress)&&("string"==typeof c.easing?(l=Qb[c.easing])||A(1031,c.easing):l=c.easing,u=c.progress,c=c.value);var h=Object.create(null);h.value=c,h.easing=l,h.progress=u,o._props[s]=h}}return o._originProps=n,o.initWithDuration(t),o}K(t,e);var n=t.prototype;return n.clone=function(){var e=new t(this._duration,this._originProps,this._opts);return this._cloneDecoration(e),e},n.startWithTarget=function(e){Wz.prototype.startWithTarget.call(this,e);var t=!!this._opts.relative,n=this._props;for(var i in n){var r=e[i];if(void 0!==r){var o=n[i],a=o.value;if("number"==typeof r)o.start=r,o.current=r,o.end=t?r+a:a;else if("object"==typeof r)for(var s in null==o.start&&(o.start={},o.current={},o.end={}),a)isNaN(r[s])||(o.start[s]=r[s],o.current[s]=r[s],o.end[s]=t?r[s]+a[s]:a[s])}}this._opts.onStart&&this._opts.onStart(this.target)},n.update=function(e){var t=this.target;if(t){var n=this._props,i=this._opts,r=e;i.easing&&(r=i.easing(e));var o=i.progress;for(var a in n){var s=n[a],c=s.easing?s.easing(e):r,l=s.progress?s.progress:o,u=s.start,h=s.end;if("number"==typeof u)s.current=l(u,h,s.current,c);else if("object"==typeof u)for(var _ in u)s.current[_]=l(u[_],h[_],s.current[_],c);t[a]=s.current}i.onUpdate&&i.onUpdate(this.target,e),1===e&&i.onComplete&&i.onComplete(this.target)}},n.progress=function(e,t,n,i){return e+(t-e)*i},t}(Wz),tU=function(e){function t(t){var n;return(n=e.call(this)||this)._props=void 0,n._props={},void 0!==t&&n.init(t),n}K(t,e);var n=t.prototype;return n.init=function(e){for(var t in e)this._props[t]=e[t];return!0},n.update=function(){var e=this._props,t=this.target;for(var n in e)t[n]=e[n]},n.clone=function(){var e=new t;return e.init(this._props),e},t}(Uz),nU=e("Tween",function(){function e(e){this._actions=[],this._finalAction=null,this._target=null,this._tag=Nz.TAG_INVALID,this._target=void 0===e?null:e}var t=e.prototype;return t.tag=function(e){return this._tag=e,this},t.then=function(e){return e instanceof Nz?this._actions.push(e.clone()):this._actions.push(e._union()),this},t.target=function(e){return this._target=e,this},t.start=function(){return this._target?(this._finalAction&&zz.instance.ActionManager.removeAction(this._finalAction),this._finalAction=this._union(),this._finalAction.setTag(this._tag),zz.instance.ActionManager.addAction(this._finalAction,this._target,!1),this):(d("Please set target to tween first"),this)},t.stop=function(){return this._finalAction&&zz.instance.ActionManager.removeAction(this._finalAction),this},t.clone=function(e){var t=this._union();return iU(e).then(t.clone())},t.union=function(){var e=this._union();return this._actions.length=0,this._actions.push(e),this},t.to=function(e,t,n){(n=n||Object.create(null)).relative=!1;var i=new eU(e,t,n);return this._actions.push(i),this},t.by=function(e,t,n){(n=n||Object.create(null)).relative=!0;var i=new eU(e,t,n);return this._actions.push(i),this},t.set=function(e){var t=new tU(e);return this._actions.push(t),this},t.delay=function(e){var t=Jz(e);return this._actions.push(t),this},t.call=function(e){var t=new Vz(e,undefined,undefined);return this._actions.push(t),this},t.sequence=function(){var t=e._wrappedSequence.apply(e,arguments);return this._actions.push(t),this},t.parallel=function(){var t=e._wrappedParallel.apply(e,arguments);return this._actions.push(t),this},t.repeat=function(t,n){if(t==1/0)return this.repeatForever(n);var i,r=this._actions;return i=n instanceof e?n._union():r.pop(),r.push(function(e,t){return new Xz(e,t)}(i,t)),this},t.repeatForever=function(t){var n,i=this._actions;return n=t instanceof e?t._union():i.pop(),i.push(function(e){return new Yz(e)}(n)),this},t.reverseTime=function(t){var n,i=this._actions;return n=t instanceof e?t._union():i.pop(),i.push(function(e){return new $z(e)}(n)),this},t.hide=function(){var e=new Gz;return this._actions.push(e),this},t.show=function(){var e=new Hz;return this._actions.push(e),this},t.removeSelf=function(){var e=new kz(!1);return this._actions.push(e),this},e.stopAll=function(){zz.instance.ActionManager.removeAllActions()},e.stopAllByTag=function(e,t){zz.instance.ActionManager.removeActionByTag(e,t)},e.stopAllByTarget=function(e){zz.instance.ActionManager.removeAllActionsFromTarget(e)},t._union=function(){var e=this._actions;return 1===e.length?e[0]:qz(e)},t._destroy=function(){this.stop()},e._wrappedSequence=function(){var t=e._tmp_args;t.length=0;for(var n=arguments.length,i=0;i<n;i++){var r=t[i]=i<0||arguments.length<=i?void 0:arguments[i];r instanceof e&&(t[i]=r._union())}return qz.apply(qz,t)},e._wrappedParallel=function(){var t=e._tmp_args;t.length=0;for(var n=arguments.length,i=0;i<n;i++){var r=t[i]=i<0||arguments.length<=i?void 0:arguments[i];r instanceof e&&(t[i]=r._union())}return Zz.apply(Zz,t)},e}());function iU(e){return new nU(e)}function rU(e){return d("tweenUtil' is deprecated, please use 'tween' instead "),new nU(e)}nU._tmp_args=[],i.Tween=nU,i.tween=iU,i.tweenUtil=rU;var oU=new yn,aU=new Mn;function sU(e,t,n,i){var r=n.data,o=t.acquireBufferBatch(),a=o.byteOffset>>2,s=n.vertexCount,c=o.indicesOffset,l=o.vertexOffset;o.request(s,n.indicesCount)||(o=t.currBufferBatch,s=0,c=0,l=0);var u=o.vData,h=o.iData;e.getWorldMatrix(aU);for(var _=0;_<s;_++){var f=r[_];yn.set(oU,f.x,f.y,0),yn.transformMat4(oU,oU,aU),u[a++]=oU.x,u[a++]=oU.y,u[a++]=oU.z,u[a++]=f.u,u[a++]=f.v,gn.toArray(u,i,a),a+=4}for(var d=0,p=s/4;d<p;d++){var m=l+4*d;h[c++]=m,h[c++]=m+1,h[c++]=m+2,h[c++]=m+1,h[c++]=m+3,h[c++]=m+2}}var cU=function(){function e(e,t){this._texture=void 0,this._width=void 0,this._height=void 0,this._x=void 0,this._y=void 0,this._nexty=void 0,this._innerTextureInfos={},this._innerSpriteFrames=void 0,this._count=void 0;var n=new lU;n.initWithSize(e,t),this._texture=n,this._width=e,this._height=t,this._x=2,this._y=2,this._nexty=2,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}var t=e.prototype;return t.insertSpriteFrame=function(e){var t=e.rect,n=e.texture,r=this._innerTextureInfos[n.getId()],o=t.x,a=t.y;if(r)o+=r.x,a+=r.y;else{var s=n.width,c=n.height;if(this._x+s+2>this._width&&(this._x=2,this._y=this._nexty),this._y+c+2>this._nexty&&(this._nexty=this._y+c+2),this._nexty>this._height)return null;i.internal.dynamicAtlasManager.textureBleeding&&((s<=8||c<=8)&&(this._texture.drawTextureAt(n.image,this._x-1,this._y-1),this._texture.drawTextureAt(n.image,this._x-1,this._y+1),this._texture.drawTextureAt(n.image,this._x+1,this._y-1),this._texture.drawTextureAt(n.image,this._x+1,this._y+1)),this._texture.drawTextureAt(n.image,this._x-1,this._y),this._texture.drawTextureAt(n.image,this._x+1,this._y),this._texture.drawTextureAt(n.image,this._x,this._y-1),this._texture.drawTextureAt(n.image,this._x,this._y+1)),this._texture.drawTextureAt(n.image,this._x,this._y),this._innerTextureInfos[n.getId()]={x:this._x,y:this._y,texture:n},this._count++,o+=this._x,a+=this._y,this._x+=s+2}var l={x:o,y:a,texture:this._texture};return this._innerSpriteFrames.push(e),l},t.deleteInnerTexture=function(e){e&&this._innerTextureInfos[e.getId()]&&(delete this._innerTextureInfos[e.getId()],this._count--)},t.isEmpty=function(){return this._count<=0},t.reset=function(){this._x=2,this._y=2,this._nexty=2;for(var e=this._innerSpriteFrames,t=0,n=e.length;t<n;t++){var i=e[t];i.isValid&&i._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},t.destroy=function(){this.reset(),this._texture.destroy()},e}(),lU=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.initWithSize=function(e,t,n){void 0===n&&(n=If.RGBA8888),this.reset({width:e,height:t,format:n}),this.loaded=!0,this.emit("load")},n.drawTextureAt=function(e,t,n){var i=this.getGFXTexture();if(e&&i){var r=this._getGFXDevice();if(r){var o=new hs;o.texOffset.x=t,o.texOffset.y=n,o.texExtent.width=e.width,o.texExtent.height=e.height,r.copyTexImagesToTexture([e.data],i,[o])}else console.warn("Unable to get device")}},t}(dp),uU=function(){function e(){this._atlases=[],this._atlasIndex=-1,this._maxAtlasCount=5,this._textureSize=2048,this._maxFrameSize=512,this._textureBleeding=!0,this._enabled=!1}var t=e.prototype;return t.newAtlas=function(){var e=this._atlases[++this._atlasIndex];return e||(e=new cU(this._textureSize,this._textureSize),this._atlases.push(e)),e},t.beforeSceneLoad=function(){this.reset()},t.insertSpriteFrame=function(e){if(!this._enabled||this._atlasIndex===this._maxAtlasCount||!e||e._original)return null;if(!e.packable)return null;var t=this._atlases[this._atlasIndex];t||(t=this.newAtlas());var n=t.insertSpriteFrame(e);return n||this._atlasIndex===this._maxAtlasCount?n:(t=this.newAtlas()).insertSpriteFrame(e)},t.reset=function(){for(var e=0,t=this._atlases.length;e<t;e++)this._atlases[e].destroy();this._atlases.length=0,this._atlasIndex=-1},t.deleteAtlasSpriteFrame=function(e){if(e._original){var t=e._original._texture;this.deleteAtlasTexture(t)}},t.deleteAtlasTexture=function(e){if(e)for(var t=this._atlases.length-1;t>=0;t--)this._atlases[t].deleteInnerTexture(e),this._atlases[t].isEmpty()&&(this._atlases[t].destroy(),this._atlases.splice(t,1),this._atlasIndex--)},t.packToDynamicAtlas=function(e,t){if(!t._original&&t.packable){var n=this.insertSpriteFrame(t);n&&t._setDynamicAtlasFrame(n)}},X(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(e?(this.reset(),i.director.on(i.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)):(this.reset(),i.director.off(i.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)),this._enabled=e)}},{key:"maxAtlasCount",get:function(){return this._maxAtlasCount},set:function(e){this._maxAtlasCount=e}},{key:"atlasCount",get:function(){return this._atlases.length}},{key:"textureBleeding",get:function(){return this._textureBleeding},set:function(e){this._textureBleeding=e}},{key:"textureSize",get:function(){return this._textureSize},set:function(e){this._textureSize=e}},{key:"maxFrameSize",get:function(){return this._maxFrameSize},set:function(e){this._maxFrameSize=e}}]),e}();uU.instance=void 0;var hU,_U=e("dynamicAtlasManager",uU.instance=new uU);i.internal.dynamicAtlasManager=_U;var fU,dU,pU,mU,gU=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],vU=e("SpriteFrame",S_("cc.SpriteFrame")(hU=function(e){function t(){var t;return(t=e.call(this)||this).vertices=null,t.uv=[],t.uvHash=0,t.unbiasUV=[],t.uvSliced=[],t._rect=new Xn,t._offset=new zn,t._originalSize=new jn,t._rotated=!1,t._capInsets=[0,0,0,0],t._atlasUuid="",t._texture=void 0,t._isFlipUVY=!1,t._isFlipUVX=!1,t._original=null,t._packable=!0,t}K(t,e),t.createWithImage=function(e){var n=e instanceof Uf?e:new Uf(e),i=new dp;i.image=n;var r=new t;return r.texture=i,r};var n=t.prototype;return n.textureLoaded=function(){return this.texture&&this.texture.loaded},n.isRotated=function(){return this._rotated},n.setRotated=function(e){this.rotated=e},n.getRect=function(e){return e?(e.set(this._rect),e):this._rect.clone()},n.setRect=function(e){this.rect=e},n.getOriginalSize=function(e){return e?(e.set(this._originalSize),e):this._originalSize.clone()},n.setOriginalSize=function(e){this.originalSize=e},n.getOffset=function(e){return e?(e.set(this._offset),e):this._offset.clone()},n.setOffset=function(e){this.offset=e},n.getGFXTexture=function(){return this._texture.getGFXTexture()},n.getGFXSampler=function(){return this._texture.getGFXSampler()},n.getHash=function(){return this._texture.getHash()},n.getSamplerHash=function(){return this._texture.getSamplerHash()},n.reset=function(e,t){void 0===t&&(t=!1);var n=!1;t&&(this._originalSize.set(0,0),this._rect.set(0,0,0,0),this._offset.set(0,0),this._capInsets=[0,0,0,0],this._rotated=!1,n=!0),e&&(e.texture&&(this.loaded=!1,this._rect.x=this._rect.y=0,this._rect.width=e.texture.width,this._rect.height=e.texture.height,this._refreshTexture(e.texture),this.checkRect(this._texture)),e.originalSize&&this._originalSize.set(e.originalSize),e.rect&&this._rect.set(e.rect),e.offset&&this._offset.set(e.offset),void 0!==e.borderTop&&(this._capInsets[1]=e.borderTop),void 0!==e.borderBottom&&(this._capInsets[3]=e.borderBottom),void 0!==e.borderLeft&&(this._capInsets[0]=e.borderLeft),void 0!==e.borderRight&&(this._capInsets[2]=e.borderRight),void 0!==e.isRotate&&(this._rotated=!!e.isRotate),void 0!==e.isFlipUv&&(this._isFlipUVY=!!e.isFlipUv),n=!0),n&&this.texture&&this._calculateUV()},n.checkRect=function(e){var t=this._rect,n=t.x,i=t.y;return this._rotated?(n+=t.height,i+=t.width):(n+=t.width,i+=t.height),n>e.width?(b(3300,this.name+"/"+e.name,n,e.width),!1):!(i>e.height&&(b(3301,this.name+"/"+e.name,i,e.height),1))},n.onLoaded=function(){this.loaded=!0,this.emit("load")},n.destroy=function(){return this._packable&&_U&&_U.deleteAtlasSpriteFrame(this),e.prototype.destroy.call(this)},n._calculateSlicedUV=function(){var e=this._rect,t=this.texture,n=t.width,i=t.height,r=this._capInsets[0],o=this._capInsets[2],a=e.width-r-o,s=this._capInsets[1],c=this._capInsets[3],l=e.height-s-c,u=this.uvSliced;if(u.length=0,this._rotated){gU[0].u=e.x/n,gU[1].u=(e.x+c)/n,gU[2].u=(e.x+c+l)/n,gU[3].u=(e.x+e.height)/n,gU[3].v=e.y/i,gU[2].v=(e.y+r)/i,gU[1].v=(e.y+r+a)/i,gU[0].v=(e.y+e.width)/i;for(var h=0;h<4;++h)for(var _=gU[h],f=0;f<4;++f){var d=gU[3-f];u.push({u:_.u,v:d.v})}}else{gU[0].u=e.x/n,gU[1].u=(e.x+r)/n,gU[2].u=(e.x+r+a)/n,gU[3].u=(e.x+e.width)/n,gU[3].v=e.y/i,gU[2].v=(e.y+s)/i,gU[1].v=(e.y+s+l)/i,gU[0].v=(e.y+e.height)/i;for(var p=0;p<4;++p)for(var m=gU[p],g=0;g<4;++g){var v=gU[g];u.push({u:v.u,v:m.v})}}},n._calculateUV=function(){var e=this._rect,t=this.uv,n=this.unbiasUV,i=this.texture,r=i.width,o=i.height;if(this._rotated){var a=0===r?0:e.x/r,s=0===r?1:(e.x+e.height)/r,c=0===o?0:e.y/o,l=0===o?1:(e.y+e.width)/o;this._isFlipUVX&&this._isFlipUVY?(t[0]=s,t[1]=l,t[2]=s,t[3]=c,t[4]=a,t[5]=l,t[6]=a,t[7]=c):this._isFlipUVX?(t[0]=s,t[1]=c,t[2]=s,t[3]=l,t[4]=a,t[5]=c,t[6]=a,t[7]=l):this._isFlipUVY?(t[0]=a,t[1]=l,t[2]=a,t[3]=c,t[4]=s,t[5]=l,t[6]=s,t[7]=c):(t[0]=a,t[1]=c,t[2]=a,t[3]=l,t[4]=s,t[5]=c,t[6]=s,t[7]=l);var u=0===r?0:e.x/r,h=0===r?1:(e.x+e.height)/r,_=0===o?0:e.y/o,f=0===o?1:(e.y+e.width)/o;this._isFlipUVX&&this._isFlipUVY?(n[0]=h,n[1]=f,n[2]=h,n[3]=_,n[4]=u,n[5]=f,n[6]=u,n[7]=_):this._isFlipUVX?(n[0]=h,n[1]=_,n[2]=h,n[3]=f,n[4]=u,n[5]=_,n[6]=u,n[7]=f):this._isFlipUVY?(n[0]=u,n[1]=f,n[2]=u,n[3]=_,n[4]=h,n[5]=f,n[6]=h,n[7]=_):(n[0]=u,n[1]=_,n[2]=u,n[3]=f,n[4]=h,n[5]=_,n[6]=h,n[7]=f)}else{var d=0===r?0:e.x/r,p=0===r?1:(e.x+e.width)/r,m=0===o?1:(e.y+e.height)/o,g=0===o?0:e.y/o;this._isFlipUVX&&this._isFlipUVY?(t[0]=p,t[1]=g,t[2]=d,t[3]=g,t[4]=p,t[5]=m,t[6]=d,t[7]=m):this._isFlipUVX?(t[0]=p,t[1]=m,t[2]=d,t[3]=m,t[4]=p,t[5]=g,t[6]=d,t[7]=g):this._isFlipUVY?(t[0]=d,t[1]=g,t[2]=p,t[3]=g,t[4]=d,t[5]=m,t[6]=p,t[7]=m):(t[0]=d,t[1]=m,t[2]=p,t[3]=m,t[4]=d,t[5]=g,t[6]=p,t[7]=g);var v=0===r?0:e.x/r,y=0===r?1:(e.x+e.width)/r,S=0===o?1:(e.y+e.height)/o,E=0===o?0:e.y/o;this._isFlipUVX&&this._isFlipUVY?(n[0]=y,n[1]=E,n[2]=v,n[3]=E,n[4]=y,n[5]=S,n[6]=v,n[7]=S):this._isFlipUVX?(n[0]=y,n[1]=S,n[2]=v,n[3]=S,n[4]=y,n[5]=E,n[6]=v,n[7]=E):this._isFlipUVY?(n[0]=v,n[1]=E,n[2]=y,n[3]=E,n[4]=v,n[5]=S,n[6]=y,n[7]=S):(n[0]=v,n[1]=S,n[2]=y,n[3]=S,n[4]=v,n[5]=E,n[6]=y,n[7]=E)}for(var T="",x=0;x<t.length;x++)T+=t[x];this.uvHash=mc(T,666);var A=this.vertices;if(A){A.nu.length=0,A.nv.length=0;for(var C=0;C<A.u.length;C++)A.nu[C]=A.u[C]/r,A.nv[C]=A.v[C]/o}this._calculateSlicedUV()},n._setDynamicAtlasFrame=function(e){e&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=e.texture,this._rect.x=e.x,this._rect.y=e.y,this._calculateUV())},n._resetDynamicAtlasFrame=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},n._checkPackable=function(){var e=_U;if(e){var t=this._texture;if(t instanceof dp&&!t.isCompressed){var n=this.width,i=this.height;!t.image||n>e.maxFrameSize||i>e.maxFrameSize?this._packable=!1:t.image&&t.image instanceof HTMLCanvasElement&&(this._packable=!0)}else this._packable=!1}},n._serialize=function(){return null},n._deserialize=function(e){var t=e,n=t.rect;n&&(this._rect=new Xn(n.x,n.y,n.width,n.height));var i=t.offset;t.offset&&(this._offset=new zn(i.x,i.y));var r=t.originalSize;t.originalSize&&(this._originalSize=new jn(r.width,r.height)),this._rotated=!!t.rotated,this._name=t.name,this._packable=!!t.packable;var o=t.capInsets;o&&(this._capInsets[0]=o[0],this._capInsets[1]=o[1],this._capInsets[2]=o[2],this._capInsets[3]=o[3]),this.vertices=t.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[])},n.clone=function(){var e,n,i,r,o,a,s,c,l=new t,u=this.vertices;return l.vertices=u?{x:u.x,y:u.y,triangles:u.triangles,nu:null===(e=u.nu)||void 0===e?void 0:e.slice(0),u:null===(n=u.u)||void 0===n?void 0:n.slice(0),nv:null===(i=u.nv)||void 0===i?void 0:i.slice(0),v:null===(r=u.v)||void 0===r?void 0:r.slice(0)}:null,(o=l.uv).splice.apply(o,[0,l.uv.length].concat(this.uv)),l.uvHash=this.uvHash,(a=l.unbiasUV).splice.apply(a,[0,l.unbiasUV.length].concat(this.unbiasUV)),(s=l.uvSliced).splice.apply(s,[0,l.uvSliced.length].concat(this.uvSliced)),l._rect.set(this._rect),l._offset.set(this._offset),l._originalSize.set(this._originalSize),l._rotated=this._rotated,(c=l._capInsets).splice.apply(c,[0,l._capInsets.length].concat(this._capInsets)),l._atlasUuid=this._atlasUuid,l._texture=this._texture,l._isFlipUVX=this._isFlipUVX,l._isFlipUVY=this._isFlipUVY,l},n._textureLoaded=function(){var e=this._texture,t={},n=!1;0!==this._rect.width&&0!==this._rect.height&&this.checkRect(e)||(t.rect=new Xn(0,0,e.width,e.height),n=!0),(0===this._originalSize.width||0===this._originalSize.height||n)&&(t.originalSize=new jn(e.width,e.height),n=!0),n&&(this.reset(t),this.onLoaded()),this._checkPackable()},n._refreshTexture=function(e){this._texture=e,e.loaded?this._textureLoaded():e.once("load",this._textureLoaded,this)},n.initDefault=function(t){e.prototype.initDefault.call(this,t);var n=new dp;n.initDefault(),this._refreshTexture(n),this._calculateUV()},n.validate=function(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height},X(t,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(e){this._capInsets[1]!==e&&(this._capInsets[1]=e,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(e){this._capInsets[3]!==e&&(this._capInsets[3]=e,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(e){this._capInsets[0]!==e&&(this._capInsets[0]=e,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(e){this._capInsets[2]!==e&&(this._capInsets[2]=e,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(e){this._rect.equals(e)||(this._rect.set(e),this._texture&&this._calculateUV())}},{key:"originalSize",get:function(){return this._originalSize},set:function(e){this._originalSize.equals(e)||(this._originalSize.set(e),this._texture&&this._calculateUV())}},{key:"offset",get:function(){return this._offset},set:function(e){this._offset.set(e)}},{key:"rotated",get:function(){return this._rotated},set:function(e){this._rotated!==e&&(this._rotated=e,this._texture&&this._calculateUV())}},{key:"texture",get:function(){return this._texture},set:function(e){e?this.reset({texture:e},!0):console.warn("Error Texture in "+this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(e){this._atlasUuid=e}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(e){window.Build?this._texture=e:e&&(this._refreshTexture(e),this._calculateUV())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(e){this._isFlipUVX=e,this._calculateUV()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(e){this._isFlipUVY=e,this._calculateUV()}},{key:"packable",get:function(){return this._packable},set:function(e){this._packable=e}},{key:"original",get:function(){return this._original}}]),t}(Rf))||hU);i.SpriteFrame=vU;var yU,SU=e("SpriteAtlas",S_("cc.SpriteAtlas")((mU=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"spriteFrames",pU,Q(t)),t}K(t,e);var n=t.prototype;return n.getTexture=function(){var e=Object.keys(this.spriteFrames);if(e.length>0){var t=this.spriteFrames[e[0]];return t&&t.texture}return null},n.getSpriteFrame=function(e){var t=this.spriteFrames[e];return t?(t.name||(t.name=e),t):null},n.getSpriteFrames=function(){for(var e=[],t=this.spriteFrames,n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];e.push(t[r])}return e},n._serialize=function(){},n._deserialize=function(e,t){var n=e;this._name=n.name;var i=n.spriteFrames;this.spriteFrames=Se();for(var r=0;r<i.length;r+=2)t.result.push(this.spriteFrames,i[r],i[r+1],qe(vU))},t}(Rf),pU=te((dU=mU).prototype,"spriteFrames",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Se()}}),fU=dU))||fU);i.SpriteAtlas=SU;var EU,TU,xU,AU,CU=e("Font",S_("cc.Font")(yU=function(e){function t(){return e.apply(this,arguments)||this}return K(t,e),t}(Rf))||yU);i.Font=CU;var bU,wU,RU,IU,PU,OU,DU,NU,MU,LU=e("TTFFont",S_("cc.TTFFont")((AU=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_fontFamily",xU,Q(t)),t}return K(t,e),X(t,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(e){this._fontFamily=e||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:Ai(this._native),__isNative__:!0}}}]),t}(CU),xU=te((TU=AU).prototype,"_fontFamily",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te(TU.prototype,"_nativeAsset",[Z_,Y_],Object.getOwnPropertyDescriptor(TU.prototype,"_nativeAsset"),TU.prototype),te(TU.prototype,"_nativeDep",[Z_],Object.getOwnPropertyDescriptor(TU.prototype,"_nativeDep"),TU.prototype),EU=TU))||EU);i.TTFFont=LU;var BU,FU=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},zU=function(){function e(e){this.letterDefinitions={},this.texture=e}var t=e.prototype;return t.addLetterDefinitions=function(e,t){this.letterDefinitions[e]=t},t.cloneLetterDefinition=function(){for(var e={},t=0,n=Object.keys(this.letterDefinitions);t<n.length;t++){var i=n[t],r=new FU;Oe(r,this.letterDefinitions[i]),e[i]=r}return e},t.getTexture=function(){return this.texture},t.getLetter=function(e){return this.letterDefinitions[e]},t.getLetterDefinitionForChar=function(e){var t=e.charCodeAt(0);return this.letterDefinitions.hasOwnProperty(t)?this.letterDefinitions[t]:null},t.clear=function(){this.letterDefinitions={}},e}(),UU=e("BitmapFont",(bU=S_("cc.BitmapFont"),wU=K_(vU),bU((MU=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"fntDataStr",PU,Q(t)),ee(t,"spriteFrame",OU,Q(t)),ee(t,"fontSize",DU,Q(t)),ee(t,"fntConfig",NU,Q(t)),t}return K(t,e),t.prototype.onLoaded=function(){var e=this.spriteFrame;!this.fontDefDictionary&&e&&(this.fontDefDictionary=new zU(e.texture));var t=this.fntConfig;if(t){var n=t.fontDefDictionary;for(var i in n){var r=new FU,o=n[i].rect;r.offsetX=n[i].xOffset,r.offsetY=n[i].yOffset,r.w=o.width,r.h=o.height,r.u=o.x,r.v=o.y,r.textureID=0,r.valid=!0,r.xAdvance=n[i].xAdvance,this.fontDefDictionary.addLetterDefinitions(i,r)}}else d("The fnt config is not exists!")},t}(CU),PU=te((IU=MU).prototype,"fntDataStr",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),OU=te(IU.prototype,"spriteFrame",[wU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),DU=te(IU.prototype,"fontSize",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),NU=te(IU.prototype,"fntConfig",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RU=IU))||RU));i.BitmapFont=UU;var HU=e("LabelAtlas",S_("cc.LabelAtlas")(BU=function(e){function t(){return e.apply(this,arguments)||this}return K(t,e),t}(UU))||BU);i.LabelAtlas=HU;var GU=e("BASELINE_RATIO",.26),kU=e("MIDDLE_RATIO",(GU+1)/2-GU);var VU=new Xe(2);VU.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var WU,jU=new(function(){function e(e){this.count=0,this.limit=0,this.datas={},this.limit=e}var t=e.prototype;return t.moveToHead=function(e){e.next=this.head,e.prev=null,this.head&&(this.head.prev=e),this.head=e,this.tail||(this.tail=e),this.count++,this.datas[e.key]=e},t.put=function(e,t){var n=VU.get();if(n.key=e,n.value=t,this.count>=this.limit){var i=this.tail;delete this.datas[i.key],this.count--,this.tail=i.prev,this.tail.next=null,i.prev=null,i.next=null,VU.put(i)}this.moveToHead(n)},t.remove=function(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,delete this.datas[e.key],this.count--},t.get=function(e){var t=this.datas[e];return t?(this.remove(t),this.moveToHead(t),t.value):null},t.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},t.has=function(e){return!!this.datas[e]},t.delete=function(e){var t=this.datas[e];this.remove(t)},e}())(100),qU=/([a-zA-Z0-9--]+|\S)/,XU=/^[!,.:;'}\]%\?>]/,YU=/([a-zA-Z0-9--]+|\S)$/,KU=/[a-zA-Z0-9--]+$/,ZU=/^[a-zA-Z0-9--]/;function QU(e){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(e)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(e)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(e)}function JU(e){var t=e.charCodeAt(0);return t>=9&&t<=13||32===t||133===t||160===t||5760===t||t>=8192&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t}function $U(e,t,n){var i=(n||e.font)+""+t,r=jU.get(i);if(null!==r)return r;var o=e.measureText(t),a=o&&o.width||0;return jU.put(i,a),a}function eH(e,t,n){var i=t,r=n,o=e[t];if(o>="\udc00"&&o<="\udfff"&&i--,void 0!==n)if(n-1!==t){var a=e[n-1];a>="\ud800"&&a<="\udbff"&&r--}else o>="\ud800"&&o<="\udbff"&&r++;return e.substring(i,r)}function tH(e,t,n,i){var r=[];if(0===e.length||n<0)return r.push(""),r;for(var o=e;t>n&&o.length>1;){for(var a=o.length*(n/t)|0,s=eH(o,a),c=t-i(s),l=s,u=0,h=0;c>n&&h++<10;)a*=n/c,c=t-i(s=eH(o,a|=0));for(h=0;c<=n&&h++<10;){if(s){var _=qU.exec(s);u=_?_[0].length:1,l=s}c=t-i(s=eH(o,a+=u))}0==(a-=u)?(a=1,l=eH(o,1)):1===a&&o[0]>="\ud800"&&o[0]<="\udbff"&&(a=2,l=eH(o,2));var f=eH(o,0,a),d=void 0;XU.test(l||s)&&(0==(a-=(d=YU.exec(f))?d[0].length:0)&&(a=1),l=eH(o,a),f=eH(o,0,a)),ZU.test(l)&&(d=KU.exec(f))&&f!==d[0]&&(l=eH(o,a-=d[0].length),f=eH(o,0,a)),(0===r.length||(f=f.trim()).length>0)&&r.push(f),t=i(o=l||s)}return(0===r.length||(o=o.trim()).length>0)&&r.push(o),r}var nH,iH,rH,oH,aH,sH,cH,lH,uH,hH,_H,fH,dH,pH,mH,gH=e("CanvasPool",function(){function e(){this.pool=[]}e.getInstance=function(){return WU||(WU=new e),WU};var t=e.prototype;return t.get=function(){var e=this.pool.pop();if(!e){var t=document.createElement("canvas"),n=t.getContext("2d");e={canvas:t,context:n}}return e},t.put=function(e){this.pool.length>=nt.MAX_LABEL_CANVAS_POOL_SIZE||this.pool.push(e)},e}()),vH=gn.WHITE.clone(),yH=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.texture=null,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0},SH="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",EH=function(){function e(e,t){this.image=null,this.labelInfo=void 0,this.char=void 0,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.hash=void 0,this.char=e,this.labelInfo=t,this.hash=e.charCodeAt(0)+t.hash}var t=e.prototype;return t.updateRenderData=function(){this._updateProperties(),this._updateTexture()},t.destroy=function(){this.image=null},t._updateProperties=function(){if(this.data=gH.getInstance().get(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){this.context.font=this.labelInfo.fontDesc;var e=$U(this.context,this.char,this.labelInfo.fontDesc),t=2*this.labelInfo.margin+2;this.width=parseFloat(e.toFixed(2))+t,this.height=(1+GU)*this.labelInfo.fontSize+t,this.offsetY=-this.labelInfo.fontSize*GU/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new Uf),this.image.reset(this.canvas)},t._updateTexture=function(){if(this.context&&this.canvas){var e=this.context,t=this.labelInfo,n=this.canvas.width,i=this.canvas.height;e.textAlign="center",e.textBaseline="alphabetic",e.clearRect(0,0,n,i),e.fillStyle=SH,e.fillRect(0,0,n,i),e.font=t.fontDesc;var r=t.fontSize,o=n/2,a=i/2+r*kU+0*r,s=t.color;if(e.lineJoin="round",e.fillStyle="rgba("+s.r+", "+s.g+", "+s.b+", 1)",t.isOutlined){var c=t.out||vH;e.strokeStyle="rgba("+c.r+", "+c.g+", "+c.b+", "+c.a/255+")",e.lineWidth=2*t.margin,e.strokeText(this.char,o,a)}e.fillText(this.char,o,a)}},e}(),TH=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.initWithSize=function(e,t,n){void 0===n&&(n=If.RGBA8888),this.reset({width:e,height:t,format:n}),this.loaded=!0,this.emit("load")},n.drawTextureAt=function(e,t,n){var i=this.getGFXTexture();if(e&&i){var r=this._getGFXDevice();if(r){var o=new hs;o.texOffset.x=t,o.texOffset.y=n,o.texExtent.width=e.width,o.texExtent.height=e.height,r.copyTexImagesToTexture([e.data],i,[o])}else console.warn("Unable to get device")}},t}(dp),xH=function(){function e(e,t){this._x=0,this._y=0,this._nextY=0,this._width=0,this._height=0,this._halfBleed=0,this._dirty=!1;var n=new TH;n.initWithSize(e,t),this.fontDefDictionary=new zU(n),this._halfBleed=1,this._width=e,this._height=t,SO.on(yO.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}var t=e.prototype;return t.insertLetterTexture=function(e){var t=e.image,n=SO.root.device;if(!t||!this.fontDefDictionary||!n)return null;var i=t.width,r=t.height;if(this._x+i+0>this._width&&(this._x=0,this._y=this._nextY),this._y+r>this._nextY&&(this._nextY=this._y+r+0),this._nextY>this._height)return A(12100),null;this.fontDefDictionary.texture.drawTextureAt(t,this._x,this._y),this._dirty=!0;var o=new yH;return o.u=this._x+this._halfBleed,o.v=this._y+this._halfBleed,o.texture=this.fontDefDictionary.texture,o.valid=!0,o.w=e.width-2,o.h=e.height-2,o.xAdvance=o.w,o.offsetY=e.offsetY,this._x+=i+0,this.fontDefDictionary.addLetterDefinitions(e.hash,o),o},t.update=function(){this._dirty&&(this._dirty=!1)},t.reset=function(){this._x=0,this._y=0,this._nextY=0,this.fontDefDictionary.clear()},t.destroy=function(){this.reset(),this.fontDefDictionary&&(this.fontDefDictionary.texture.destroy(),this.fontDefDictionary.texture=null)},t.getTexture=function(){return this.fontDefDictionary.getTexture()},t.beforeSceneLoad=function(){this.clearAllCache()},t.clearAllCache=function(){this.destroy();var e=new TH;e.initWithSize(this._width,this._height),this.fontDefDictionary.texture=e},t.getLetter=function(e){return this.fontDefDictionary.letterDefinitions[e]},t.getLetterDefinitionForChar=function(e,t){var n=e.charCodeAt(0)+t.hash,i=this.fontDefDictionary.letterDefinitions[n];if(!i){var r=new EH(e,t);r.updateRenderData(),i=this.insertLetterTexture(r),r.destroy()}return i},X(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),e}(),AH={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:gn.WHITE.clone(),isOutlined:!1,out:gn.WHITE.clone(),margin:0},CH=function(){this.material=null,this.vertexCount=0,this.indicesCount=0},bH=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).vData=null,t.uvDirty=!0,t.vertDirty=!0,t._data=[],t._indices=[],t._pivotX=0,t._pivotY=0,t._width=0,t._height=0,t}K(t,e),t.add=function(){return IH.add()},t.remove=function(e){var t=IH.data.indexOf(e);-1!==t&&(IH.data[t].clear(),IH.removeAt(t))};var n=t.prototype;return n.updateSizeNPivot=function(e,t,n,i){e===this._width&&t===this._height&&n===this._pivotX&&i===this._pivotY||(this._width=e,this._height=t,this._pivotX=n,this._pivotY=i,this.vertDirty=!0)},n.clear=function(){this._data.length=0,this._indices.length=0,this._pivotX=0,this._pivotY=0,this._width=0,this._height=0,this.uvDirty=!0,this.vertDirty=!0,this.material=null,this.vertexCount=0,this.indicesCount=0},X(t,[{key:"dataLength",get:function(){return this._data.length},set:function(e){var t=this._data;if(t.length!==e){var n=t.length,i=0;for(i=e;i<n;i++)RH.free(t[i]);for(i=n;i<e;i++)t[i]=RH.alloc();t.length=e}}},{key:"data",get:function(){return this._data}}]),t}(CH),wH=function(e){function t(t){var n;return void 0===t&&(t=9),(n=e.call(this)||this).vData=void 0,n.iData=void 0,n.vertexStart=0,n.indicesStart=0,n.byteStart=0,n.byteCount=0,n.lastFilledIndices=0,n.lastFilledVertex=0,n._formatByte=void 0,n._formatByte=t*Float32Array.BYTES_PER_ELEMENT,n.vData=new Float32Array(256*t*Float32Array.BYTES_PER_ELEMENT),n.iData=new Uint16Array(1536),n}K(t,e),t.add=function(){return PH.add()},t.remove=function(e){var t=PH.data.indexOf(e);-1!==t&&(PH.data[t].reset(),PH.removeAt(t))};var n=t.prototype;return n.request=function(e,t){var n=this.byteCount+e*this._formatByte;return this.reserve(e,t),this.vertexCount+=e,this.indicesCount+=t,this.byteCount=n,!0},n.reserve=function(e,t){var n=this.byteCount+e*this._formatByte,i=this.indicesCount+t;if(e+this.vertexCount>65535)return!1;var r=this.vData.byteLength,o=this.iData.length,a=this.vData.length,s=this.iData.length;if(n>r||i>o){for(;r<n||o<i;)r=4*(a*=2),o=s*=2;this._reallocBuffer(a,s)}return!0},n.advance=function(e,t){this.vertexCount+=e,this.indicesCount+=t,this.byteCount+=e*this._formatByte},n.reset=function(){this.vertexCount=0,this.indicesCount=0,this.byteCount=0,this.vertexStart=0,this.indicesStart=0,this.byteStart=0,this.lastFilledIndices=0,this.lastFilledVertex=0},n._reallocBuffer=function(e,t){var n=this.vData;this.vData=new Float32Array(e),this.vData.set(n,0);var i=this.iData;this.iData=new Uint16Array(t),this.iData.set(i,0)},X(t,[{key:"formatByte",get:function(){return this._formatByte},set:function(e){this._formatByte=e}},{key:"floatStride",get:function(){return this._formatByte>>2}},{key:"vDataOffset",get:function(){return this.byteCount>>>2}}]),t}(CH),RH=(function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;n._fillQuadBuffer=function(){for(var e=this.iData.length/6,t=this.iData,n=0,i=0;n<e;n++){var r=4*n;t[i++]=r,t[i++]=r+1,t[i++]=r+2,t[i++]=r+1,t[i++]=r+3,t[i++]=r+2}},n._reallocBuffer=function(t,n){e.prototype._reallocBuffer.call(this,t,n),this._fillQuadBuffer()}}(wH),new Zn((function(){return{x:0,y:0,z:0,u:0,v:0,color:gn.WHITE.clone()}}),128)),IH=new Qn((function(){return new bH}),32),PH=new Qn((function(){return new wH}),32),OH=new zn,DH=new zn,NH=new Mn,MH=new Mn,LH=new Mn,BH=new Mn(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),FH=new Xn,zH=function(t){return e({UITransform:t,UITransformComponent:t}),t}((nH=S_("cc.UITransform"),iH=D_(),rH=T_(110),oH=R_(),aH=k_(),sH=B_(),cH=k_(),lH=B_(),nH(uH=iH(uH=rH(uH=oH(uH=x_(uH=w_((pH=dH=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._priority=0,ee(t,"_contentSize",_H,Q(t)),ee(t,"_anchorPoint",fH,Q(t)),t}K(t,e);var n=t.prototype;return n.__preload=function(){this.node._uiProps.uiTransformComp=this},n.onLoad=function(){this.node.parent&&t.insertChangeMap(this.node.parent)},n.onEnable=function(){this.node.on(bm.PARENT_CHANGED,this._parentChanged,this)},n.onDisable=function(){this.node.off(bm.PARENT_CHANGED,this._parentChanged,this)},n.onDestroy=function(){this.node._uiProps.uiTransformComp=null},n.setContentSize=function(e,t){var n=this._contentSize;if(void 0===t){if((e=e).width===n.width&&e.height===n.height)return;n.width=e.width,n.height=e.height}else{if(e===n.width&&t===n.height)return;n.width=e,n.height=t}this.node.emit(bm.SIZE_CHANGED)},n.setAnchorPoint=function(e,t){var n=this._anchorPoint;if(void 0===t){if((e=e).x===n.x&&e.y===n.y)return;n.x=e.x,n.y=e.y}else{if(e===n.x&&t===n.y)return;n.x=e,n.y=t}this.node.emit(bm.ANCHOR_CHANGED,this._anchorPoint)},n.isHit=function(e,t){for(var n=this._contentSize.width,r=this._contentSize.height,o=OH,a=DH,s=this._getRenderScene().cameras,c=0;c<s.length;c++){var l=s[c];if(l.visibility&this.node.layer){l.node.getWorldRT(NH);var u=NH.m12,h=NH.m13,_=i.visibleRect.center;if(NH.m12=_.x-(NH.m00*u+NH.m04*h),NH.m13=_.y-(NH.m01*u+NH.m05*h),Mn.invert(NH,NH),zn.transformMat4(o,e,NH),this.node.getWorldMatrix(LH),Mn.invert(NH,LH),!Mn.strictEquals(NH,BH)){zn.transformMat4(a,o,NH),a.x+=this._anchorPoint.x*n,a.y+=this._anchorPoint.y*r;var f=!1;if(a.x>=0&&a.y>=0&&a.x<=n&&a.y<=r&&(f=!0,t&&t.mask))for(var d=t.mask,p=this.node,m=d?d.length:0,g=0,v=0;p&&v<m;++g,p=p.parent){var y=d[v];if(g===y.index){if(p!==y.comp.node){d.length=v;break}var S=y.comp;if(S&&S._enabled&&!S.isHit(o)){f=!1;break}v++}else if(g>y.index){d.length=v;break}}if(f)return!0}}}return!1},n.convertToNodeSpaceAR=function(e,t){return this.node.getWorldMatrix(LH),Mn.invert(NH,LH),t||(t=new yn),yn.transformMat4(t,e,NH)},n.convertToWorldSpaceAR=function(e,t){return this.node.getWorldMatrix(LH),t||(t=new yn),yn.transformMat4(t,e,LH)},n.getBoundingBox=function(){Mn.fromRTS(MH,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var e=this._contentSize.width,t=this._contentSize.height,n=new Xn(-this._anchorPoint.x*e,-this._anchorPoint.y*t,e,t);return n.transformMat4(MH),n},n.getBoundingBoxToWorld=function(){return this.node.parent?(this.node.parent.getWorldMatrix(LH),this.getBoundingBoxTo(LH)):this.getBoundingBox()},n.getBoundingBoxTo=function(e){Mn.fromRTS(MH,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var n=this._contentSize.width,i=this._contentSize.height,r=new Xn(-this._anchorPoint.x*n,-this._anchorPoint.y*i,n,i);if(Mn.multiply(LH,e,MH),r.transformMat4(LH),!this.node.children)return r;for(var o,a=$(this.node.children);!(o=a()).done;){var s=o.value;if(s&&s.active){var c=s.getComponent(t);if(c){var l=c.getBoundingBoxTo(e);l&&Xn.union(r,r,l)}}}return r},n.getComputeAABB=function(e){var t=this._contentSize.width,n=this._contentSize.height;FH.set(-this._anchorPoint.x*t,-this._anchorPoint.y*n,t,n),FH.transformMat4(this.node.worldMatrix);var i=FH.x+.5*FH.width,r=FH.y+.5*FH.height,o=this.node.worldPosition.z,a=FH.width/2,s=FH.height/2;return null!=e?($l.set(e,i,r,o,a,s,.001),e):new $l(i,r,o,a,s,.001)},n._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&t.insertChangeMap(this.node.parent)},t.insertChangeMap=function(e){var n=e.uuid;t.priorityChangeNodeMap.has(n)||t.priorityChangeNodeMap.set(n,e)},t._sortChildrenSibling=function(e){var t=e.children;t&&t.sort((function(e,t){var n=e._uiProps.uiTransformComp,i=t._uiProps.uiTransformComp,r=(n?n._priority:0)-(i?i._priority:0);return 0===r?e.getSiblingIndex()-t.getSiblingIndex():r}))},t._sortSiblings=function(){t.priorityChangeNodeMap.forEach((function(e){t._sortChildrenSibling(e),e._updateSiblingIndex(),e.emit("childrenSiblingOrderChanged")})),t.priorityChangeNodeMap.clear()},t._cleanChangeMap=function(){t.priorityChangeNodeMap.clear()},X(t,[{key:"contentSize",get:function(){return this._contentSize},set:function(e){this._contentSize.equals(e)||(this._contentSize.set(e),this.node.emit(bm.SIZE_CHANGED))}},{key:"width",get:function(){return this._contentSize.width},set:function(e){this._contentSize.width!==e&&(this._contentSize.width=e,this.node.emit(bm.SIZE_CHANGED))}},{key:"height",get:function(){return this._contentSize.height},set:function(e){this.contentSize.height!==e&&(this._contentSize.height=e,this.node.emit(bm.SIZE_CHANGED))}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(e){this._anchorPoint.equals(e)||(this._anchorPoint.set(e),this.node.emit(bm.ANCHOR_CHANGED,this._anchorPoint))}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(e){this._anchorPoint.x!==e&&(this._anchorPoint.x=e,this.node.emit(bm.ANCHOR_CHANGED,this._anchorPoint))}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(e){this._anchorPoint.y!==e&&(this._anchorPoint.y=e,this.node.emit(bm.ANCHOR_CHANGED,this._anchorPoint))}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority!==e&&(this.node.getComponent("cc.RenderRoot2D")?A(6706):(this._priority=e,this.node.parent&&t.insertChangeMap(this.node.parent)))}},{key:"visibility",get:function(){var e=SO.root.batcher2D.getFirstRenderCamera(this.node);return e?e.visibility:0}},{key:"cameraPriority",get:function(){var e=SO.root.batcher2D.getFirstRenderCamera(this.node);return e?e.priority:0}}]),t}(Xd),dH.EventType=bm,dH.priorityChangeNodeMap=new Map,te((hH=pH).prototype,"contentSize",[aH,sH],Object.getOwnPropertyDescriptor(hH.prototype,"contentSize"),hH.prototype),te(hH.prototype,"anchorPoint",[cH,lH],Object.getOwnPropertyDescriptor(hH.prototype,"anchorPoint"),hH.prototype),_H=te(hH.prototype,"_contentSize",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new jn(100,100)}}),fH=te(hH.prototype,"_anchorPoint",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn(.5,.5)}}),uH=hH))||uH)||uH)||uH)||uH)||uH)||uH));SO.on(yO.EVENT_AFTER_UPDATE,zH._sortSiblings),SO.on(yO.EVENT_BEFORE_SCENE_LAUNCH,zH._cleanChangeMap),function(e){e[e.DISABLED=0]="DISABLED",e[e.CLEAR=1]="CLEAR",e[e.ENTER_LEVEL=2]="ENTER_LEVEL",e[e.ENABLED=3]="ENABLED",e[e.EXIT_LEVEL=4]="EXIT_LEVEL",e[e.CLEAR_INVERTED=5]="CLEAR_INVERTED",e[e.ENTER_LEVEL_INVERTED=6]="ENTER_LEVEL_INVERTED"}(mH||(mH={}));var UH,HH,GH,kH,VH,WH,jH,qH,XH,YH,KH,ZH,QH,JH,$H,eG,tG,nG,iG,rG=e("StencilManager",function(){function e(){this.stage=mH.DISABLED,this._maskStack=[],this._stencilPattern={stencilTest:!0,func:Da.ALWAYS,stencilMask:65535,writeMask:65535,failOp:Na.KEEP,zFailOp:Na.KEEP,passOp:Na.KEEP,ref:1},this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}var t=e.prototype;return t.pushMask=function(e){this._maskStack.push(e)},t.clear=function(e){e.stencilStage=e.inverted?mH.CLEAR_INVERTED:mH.CLEAR},t.enterLevel=function(e){e.graphics.stencilStage=e.inverted?mH.ENTER_LEVEL_INVERTED:mH.ENTER_LEVEL},t.enableMask=function(){this.stage=mH.ENABLED},t.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=mH.DISABLED:this.stage=mH.ENABLED)},t.getWriteMask=function(){return 1<<this._maskStack.length-1},t.getExitWriteMask=function(){return 1<<this._maskStack.length},t.getStencilRef=function(){for(var e=0,t=0;t<this._maskStack.length;++t)e+=1<<t;return e},t.reset=function(){this._maskStack.length=0,this.stage=mH.DISABLED},t.destroy=function(){this.stencilStateMap.forEach((function(e){e.destroy()})),this.stencilStateMap.clear()},t.getStencilStage=function(e,t){var n=0,i=!1,r=!1,o=Da.LESS,a=this.stencilStateMap;if(t&&t.passes[0]){var s=t.passes[0].depthStencilState,c=0,l=0;s.depthTest&&(c=1),s.depthWrite&&(l=1),n=c|l<<1|s.depthFunc<<2|e<<6|this._maskStack.length<<9,i=s.depthTest,r=s.depthWrite,o=s.depthFunc,a=this.stencilStateMapWithDepth}else n=e<<16|this._maskStack.length;if(a&&a.has(n))return a.get(n);this.setStateFromStage(e);var u=new Tc(i,r,o,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref);return a.set(n,u),u},t.getStencilHash=function(e){return e<<8|this._maskStack.length},t.setStateFromStage=function(e){var t=this._stencilPattern;e===mH.DISABLED?(t.stencilTest=!1,t.func=Da.ALWAYS,t.failOp=Na.KEEP,t.stencilMask=t.writeMask=65535,t.ref=1):(t.stencilTest=!0,e===mH.ENABLED?(t.func=Da.EQUAL,t.failOp=Na.KEEP,t.stencilMask=t.ref=this.getStencilRef(),t.writeMask=this.getWriteMask()):e===mH.CLEAR?(t.func=Da.NEVER,t.failOp=Na.ZERO,t.writeMask=t.stencilMask=t.ref=this.getWriteMask()):e===mH.CLEAR_INVERTED||e===mH.ENTER_LEVEL?(t.func=Da.NEVER,t.failOp=Na.REPLACE,t.writeMask=t.stencilMask=t.ref=this.getWriteMask()):e===mH.ENTER_LEVEL_INVERTED&&(t.func=Da.NEVER,t.failOp=Na.ZERO,t.writeMask=t.stencilMask=t.ref=this.getWriteMask()))},X(e,[{key:"pattern",get:function(){return this._stencilPattern}}]),e}());rG.sharedManager=null,rG.sharedManager=new rG,et(Ma),function(e){e[e.ADD_COLOR=0]="ADD_COLOR",e[e.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",e[e.GRAYSCALE=2]="GRAYSCALE",e[e.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",e[e.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(iG||(iG=e("InstanceMaterialType",{})));var oG,aG,sG,cG,lG,uG,hG,_G,fG,dG,pG,mG,gG,vG,yG,SG,EG,TG,xG,AG,CG,bG,wG,RG,IG,PG,OG,DG,NG,MG,LG,BG,FG,zG,UG,HG,GG,kG,VG,WG,jG,qG,XG,YG,KG,ZG,QG,JG,$G,ek,tk,nk,ik,rk,ok,ak,sk,ck,lk,uk,hk,_k,fk,dk,pk=function(t){return e({Renderable2D:t,RenderComponent:t,UIRenderable:t}),t}((UH=S_("cc.Renderable2D"),HH=E_(zH),GH=M_(),kH=K_(QS),VH=K_(QS),WH=k_(),jH=L_(),qH=k_(),XH=B_(),UH(YH=HH(YH=x_(YH=w_((nG=tG=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_materials",ZH,Q(t)),ee(t,"_customMaterial",QH,Q(t)),t.stencilStage=mH.DISABLED,ee(t,"_srcBlendFactor",JH,Q(t)),ee(t,"_dstBlendFactor",$H,Q(t)),ee(t,"_color",eG,Q(t)),t._assembler=null,t._postAssembler=null,t._renderData=null,t._renderDataFlag=!0,t._renderFlag=!0,t._delegateSrc=null,t._instanceMaterialType=iG.ADD_COLOR_AND_TEXTURE,t._blendState=new Ac,t._blendHash=0,t._colorDirty=!0,t._cacheAlpha=1,t._lastParent=null,t}K(t,e);var n=t.prototype;return n.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),void(this._blendHash=-1);var e=this._updateBuiltinMaterial();this.setMaterial(e,0),this._updateBlendFunc()},n.updateBlendHash=function(){var e=this._blendState.targets[0].blendDst<<4;this._blendHash=e|this._blendState.targets[0].blendSrc},n.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},n.onEnable=function(){this.node.on(bm.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(bm.SIZE_CHANGED,this._nodeStateChange,this),this.updateMaterial(),this._renderFlag=this._canRender()},n.onRestore=function(){this.updateMaterial(),this._renderFlag=this._canRender()},n.onDisable=function(){this.node.off(bm.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(bm.SIZE_CHANGED,this._nodeStateChange,this),this._renderFlag=!1},n.onDestroy=function(){if(this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var e=0;e<this._materialInstances.length;e++)this._materialInstances[e]&&this._materialInstances[e].destroy();this._renderData=null,this._blendState&&this._blendState.destroy()},n.markForUpdateRenderData=function(e){if(void 0===e&&(e=!0),this._renderFlag=this._canRender(),e&&this._renderFlag){var t=this._renderData;t&&(t.vertDirty=!0),this._renderDataFlag=e}else e||(this._renderDataFlag=e)},n.requestRenderData=function(){var e=bH.add();return this._renderData=e,e},n.destroyRenderData=function(){this._renderData&&(bH.remove(this._renderData),this._renderData=null)},n.updateAssembler=function(e){this._updateColor(),this._renderFlag&&(this._checkAndUpdateRenderData(),this._render(e))},n.postUpdateAssembler=function(e){this._renderFlag&&this._postRender(e)},n._render=function(){},n._postRender=function(){},n._checkAndUpdateRenderData=function(){this._renderDataFlag&&(this._assembler.updateRenderData(this),this._renderDataFlag=!1)},n._canRender=function(){return this.isValid&&null!==this.getMaterial(0)&&this.enabled&&(this._delegateSrc?this._delegateSrc.activeInHierarchy:this.enabledInHierarchy)&&this.node._uiProps.opacity>0},n._postCanRender=function(){},n._updateColor=function(){this._updateWorldAlpha(),(this._colorDirty||this._cacheAlpha!==this.node._uiProps.opacity)&&this._renderFlag&&this._assembler&&this._assembler.updateColor&&(this._assembler.updateColor(this),this._cacheAlpha=this.node._uiProps.opacity,this._colorDirty=!1)},n._updateWorldAlpha=function(){var e=this.color.a/255;1===e&&(e=this.node._uiProps.localOpacity),this.node._uiProps.opacity=this.node.parent&&this.node.parent._uiProps?this.node.parent._uiProps.opacity*e:e,this._renderFlag=this._canRender()},n._updateBlendFunc=function(){var e=this._blendState.targets[0];e||(e=new xc,this._blendState.setTarget(0,e)),e.blendDst===this._dstBlendFactor&&e.blendSrc===this._srcBlendFactor||(e.blend=!0,e.blendDstAlpha=Ma.ONE_MINUS_SRC_ALPHA,e.blendDst=this._dstBlendFactor,e.blendSrc=this._srcBlendFactor),this.updateBlendHash()},n.getBlendState=function(){return this._blendState},n._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var e=0;e<this.node.children.length;++e){var n=this.node.children[e].getComponent(t);n&&n.markForUpdateRenderData()}},n._updateBuiltinMaterial=function(){var e;switch(this._instanceMaterialType){case iG.ADD_COLOR:e=Kp.get("ui-base-material");break;case iG.GRAYSCALE:e=Kp.get("ui-sprite-gray-material");break;case iG.USE_ALPHA_SEPARATED:e=Kp.get("ui-sprite-alpha-sep-material");break;case iG.USE_ALPHA_SEPARATED_AND_GRAY:e=Kp.get("ui-sprite-gray-alpha-sep-material");break;default:e=Kp.get("ui-sprite-material")}return e},n._setCacheAlpha=function(e){this._cacheAlpha=e},X(t,[{key:"sharedMaterials",get:function(){return this._materials},set:function(e){for(var t=0;t<e.length;t++)e[t]!==this._materials[t]&&this.setMaterial(e[t],t);if(e.length<this._materials.length){for(var n=e.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(e.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(e){this._customMaterial=e,this.updateMaterial()}},{key:"srcBlendFactor",get:function(){return this._customMaterial&&A(12001),this._srcBlendFactor},set:function(e){this._customMaterial?A(12001):this._srcBlendFactor!==e&&(this._srcBlendFactor=e,this._updateBlendFunc())}},{key:"dstBlendFactor",get:function(){return this._customMaterial&&A(12001),this._dstBlendFactor},set:function(e){this._customMaterial?A(12001):this._dstBlendFactor!==e&&(this._dstBlendFactor=e,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(e){this._color.equals(e)||(this._color.set(e),this._colorDirty=!0)}},{key:"renderData",get:function(){return this._renderData}},{key:"delegateSrc",set:function(e){this._delegateSrc=e}},{key:"blendHash",get:function(){return this._blendHash}}]),t}(DM),tG.BlendState=Ma,tG.Assembler=null,tG.PostAssembler=null,ZH=te((KH=nG).prototype,"_materials",[Z_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),te(KH.prototype,"sharedMaterials",[Z_,GH],Object.getOwnPropertyDescriptor(KH.prototype,"sharedMaterials"),KH.prototype),QH=te(KH.prototype,"_customMaterial",[kH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te(KH.prototype,"customMaterial",[VH,WH,jH],Object.getOwnPropertyDescriptor(KH.prototype,"customMaterial"),KH.prototype),te(KH.prototype,"color",[qH,XH],Object.getOwnPropertyDescriptor(KH.prototype,"color"),KH.prototype),JH=te(KH.prototype,"_srcBlendFactor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ma.SRC_ALPHA}}),$H=te(KH.prototype,"_dstBlendFactor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ma.ONE_MINUS_SRC_ALPHA}}),eG=te(KH.prototype,"_color",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gn.WHITE.clone()}}),YH=KH))||YH)||YH)||YH)||YH));i.internal.Renderable2D=pk,function(e){e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT"}(hk||(hk=e("HorizontalTextAlignment",{}))),et(hk),function(e){e[e.TOP=0]="TOP",e[e.CENTER=1]="CENTER",e[e.BOTTOM=2]="BOTTOM"}(_k||(_k=e("VerticalTextAlignment",{}))),et(_k),function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.SHRINK=2]="SHRINK",e[e.RESIZE_HEIGHT=3]="RESIZE_HEIGHT"}(fk||(fk=e("Overflow",{}))),et(fk),function(e){e[e.NONE=0]="NONE",e[e.BITMAP=1]="BITMAP",e[e.CHAR=2]="CHAR"}(dk||(dk=e("CacheMode",{}))),et(dk);var mk,gk,vk,yk=function(t){return e({Label:t,LabelComponent:t}),t}((oG=S_("cc.Label"),aG=D_(),sG=T_(110),cG=R_(),lG=k_(),uG=B_(),hG=K_(hk),_G=k_(),fG=B_(),dG=K_(_k),pG=k_(),mG=B_(),gG=k_(),vG=B_(),yG=k_(),SG=M_(),EG=B_(),TG=k_(),xG=B_(),AG=K_(fk),CG=k_(),bG=B_(),wG=k_(),RG=B_(),IG=K_(CU),PG=k_(),OG=M_(),DG=B_(),NG=k_(),MG=B_(),LG=K_(dk),BG=k_(),FG=B_(),zG=k_(),UG=B_(),HG=k_(),GG=B_(),kG=k_(),VG=B_(),WG=M_(),oG(jG=aG(jG=sG(jG=cG((uk=lk=function(e){function t(){var t;return ee(t=e.call(this)||this,"_string",XG,Q(t)),ee(t,"_horizontalAlign",YG,Q(t)),ee(t,"_verticalAlign",KG,Q(t)),ee(t,"_actualFontSize",ZG,Q(t)),ee(t,"_fontSize",QG,Q(t)),ee(t,"_fontFamily",JG,Q(t)),ee(t,"_lineHeight",$G,Q(t)),ee(t,"_overflow",ek,Q(t)),ee(t,"_enableWrapText",tk,Q(t)),ee(t,"_font",nk,Q(t)),ee(t,"_isSystemFontUsed",ik,Q(t)),t._spacingX=0,ee(t,"_isItalic",rk,Q(t)),ee(t,"_isBold",ok,Q(t)),ee(t,"_isUnderline",ak,Q(t)),ee(t,"_underlineHeight",sk,Q(t)),ee(t,"_cacheMode",ck,Q(t)),t._N$file=null,t._texture=null,t._ttfSpriteFrame=null,t._userDefinedFont=null,t._assemblerData=null,t._fontAtlas=null,t._letterTexture=null,t._ttfSpriteFrame=null,t}K(t,e);var n=t.prototype;return n.onEnable=function(){e.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this.updateRenderData(!0)},n.onDisable=function(){e.prototype.onDisable.call(this)},n.onDestroy=function(){if(this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this._ttfSpriteFrame){var t=this._ttfSpriteFrame.texture;if(t&&null===this._ttfSpriteFrame.original){var n=t;n.image&&n.image.destroy(),t.destroy()}this._ttfSpriteFrame=null}this._letterTexture=null,e.prototype.onDestroy.call(this)},n.updateRenderData=function(e){void 0===e&&(e=!1),this.markForUpdateRenderData(),e&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture())},n._render=function(e){e.commitComp(this,this._texture,this._assembler,null)},n._updateColor=function(){this._font instanceof UU?(this._updateWorldAlpha(),this._colorDirty=!1):(this._updateWorldAlpha(),this._colorDirty?(this.updateRenderData(!1),this._colorDirty=!1):this._cacheAlpha!==this.node._uiProps.opacity&&this._renderFlag&&this._assembler&&this._assembler.updateOpacity&&(this._assembler.updateOpacity(this),this._cacheAlpha=this.node._uiProps.opacity))},n._canRender=function(){if(!e.prototype._canRender.call(this)||!this._string)return!1;var t=this._font;if(t&&t instanceof UU){var n=t.spriteFrame;if(!n||!n.textureLoaded())return!1}return!0},n._flushAssembler=function(){var e=t.Assembler.getAssembler(this);this._assembler!==e&&(this.destroyRenderData(),this._assembler=e),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},n._applyFontTexture=function(){var e=this,t=this._font;if(t instanceof UU){var n=t.spriteFrame,i=function(){e._texture=n,e.changeMaterialForDefine(),e._assembler&&e._assembler.updateRenderData(e)};n&&(n.loaded||n.textureLoaded?i():n.once("load",i,this))}else{if(this.cacheMode===dk.CHAR)this._letterTexture=this._assembler.getAssemblerData(),this._texture=this._letterTexture;else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new vU,this._assemblerData=this._assembler.getAssemblerData();var r=new Uf(this._assemblerData.canvas)._texture;this._ttfSpriteFrame.texture=r}this.cacheMode!==dk.CHAR&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this)}},n.changeMaterialForDefine=function(){if(this._texture){var e=!1;if(this.cacheMode!==dk.CHAR){var t=this._texture.texture;if(t instanceof od){var n=t.getPixelFormat();e=n===If.RGBA_ETC1||n===If.RGB_A_PVRTC_4BPPV1||n===If.RGB_A_PVRTC_2BPPV1}}this._instanceMaterialType=e?iG.USE_ALPHA_SEPARATED:iG.ADD_COLOR_AND_TEXTURE,this.updateMaterial()}},X(t,[{key:"string",get:function(){return this._string},set:function(e){e+="",this._string!==e&&(this._string=e,this.updateRenderData())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(e){this._horizontalAlign!==e&&(this._horizontalAlign=e,this.updateRenderData())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(e){this._verticalAlign!==e&&(this._verticalAlign=e,this.updateRenderData())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(e){this._actualFontSize=e}},{key:"fontSize",get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this.updateRenderData())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(e){this._fontFamily!==e&&(this._fontFamily=e,this.updateRenderData())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(e){this._lineHeight!==e&&(this._lineHeight=e,this.updateRenderData())}},{key:"overflow",get:function(){return this._overflow},set:function(e){this._overflow!==e&&(this._overflow=e,this.updateRenderData())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(e){this._enableWrapText!==e&&(this._enableWrapText=e,this.updateRenderData())}},{key:"font",get:function(){return this._font},set:function(e){this._font!==e&&(this._isSystemFontUsed=!e,this._font=e,this._renderData&&(this.destroyRenderData(),this._renderData=null),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(e){this._isSystemFontUsed!==e&&(this.destroyRenderData(),this._renderData=null,this._isSystemFontUsed=!!e,e&&(this.font=null),this._flushAssembler(),this.updateRenderData())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(e){this._cacheMode!==e&&(this._cacheMode!==dk.BITMAP||this._font instanceof UU||!this._ttfSpriteFrame||this._ttfSpriteFrame._resetDynamicAtlasFrame(),this._cacheMode===dk.CHAR&&(this._ttfSpriteFrame=null),this._cacheMode=e,this.updateRenderData(!0))}},{key:"spriteFrame",get:function(){return this._texture}},{key:"ttfSpriteFrame",get:function(){return this._ttfSpriteFrame}},{key:"isBold",get:function(){return this._isBold},set:function(e){this._isBold!==e&&(this._isBold=e,this.updateRenderData())}},{key:"isItalic",get:function(){return this._isItalic},set:function(e){this._isItalic!==e&&(this._isItalic=e,this.updateRenderData())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(e){this._isUnderline!==e&&(this._isUnderline=e,this.updateRenderData())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(e){this._underlineHeight!==e&&(this._underlineHeight=e,this.updateRenderData())}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(e){this._fontAtlas=e}},{key:"spacingX",get:function(){return this._spacingX},set:function(e){this._spacingX!==e&&(this._spacingX=e,this.updateRenderData())}},{key:"_bmFontOriginalSize",get:function(){return this._font instanceof UU?this._font.fontSize:-1}}]),t}(pk),lk.HorizontalAlign=hk,lk.VerticalAlign=_k,lk.Overflow=fk,lk.CacheMode=dk,lk._canvasPool=gH.getInstance(),te((qG=uk).prototype,"string",[lG,uG,V_],Object.getOwnPropertyDescriptor(qG.prototype,"string"),qG.prototype),te(qG.prototype,"horizontalAlign",[hG,_G,fG],Object.getOwnPropertyDescriptor(qG.prototype,"horizontalAlign"),qG.prototype),te(qG.prototype,"verticalAlign",[dG,pG,mG],Object.getOwnPropertyDescriptor(qG.prototype,"verticalAlign"),qG.prototype),te(qG.prototype,"fontSize",[gG,vG],Object.getOwnPropertyDescriptor(qG.prototype,"fontSize"),qG.prototype),te(qG.prototype,"fontFamily",[yG,SG,EG],Object.getOwnPropertyDescriptor(qG.prototype,"fontFamily"),qG.prototype),te(qG.prototype,"lineHeight",[TG,xG],Object.getOwnPropertyDescriptor(qG.prototype,"lineHeight"),qG.prototype),te(qG.prototype,"overflow",[AG,CG,bG],Object.getOwnPropertyDescriptor(qG.prototype,"overflow"),qG.prototype),te(qG.prototype,"enableWrapText",[wG,RG],Object.getOwnPropertyDescriptor(qG.prototype,"enableWrapText"),qG.prototype),te(qG.prototype,"font",[IG,PG,OG,DG],Object.getOwnPropertyDescriptor(qG.prototype,"font"),qG.prototype),te(qG.prototype,"useSystemFont",[NG,MG],Object.getOwnPropertyDescriptor(qG.prototype,"useSystemFont"),qG.prototype),te(qG.prototype,"cacheMode",[LG,BG,FG],Object.getOwnPropertyDescriptor(qG.prototype,"cacheMode"),qG.prototype),te(qG.prototype,"isBold",[zG,UG],Object.getOwnPropertyDescriptor(qG.prototype,"isBold"),qG.prototype),te(qG.prototype,"isItalic",[HG,GG],Object.getOwnPropertyDescriptor(qG.prototype,"isItalic"),qG.prototype),te(qG.prototype,"isUnderline",[kG,VG],Object.getOwnPropertyDescriptor(qG.prototype,"isUnderline"),qG.prototype),te(qG.prototype,"underlineHeight",[WG,N_],Object.getOwnPropertyDescriptor(qG.prototype,"underlineHeight"),qG.prototype),XG=te(qG.prototype,"_string",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"label"}}),YG=te(qG.prototype,"_horizontalAlign",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hk.CENTER}}),KG=te(qG.prototype,"_verticalAlign",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _k.CENTER}}),ZG=te(qG.prototype,"_actualFontSize",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),QG=te(qG.prototype,"_fontSize",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),JG=te(qG.prototype,"_fontFamily",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),$G=te(qG.prototype,"_lineHeight",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),ek=te(qG.prototype,"_overflow",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fk.NONE}}),tk=te(qG.prototype,"_enableWrapText",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),nk=te(qG.prototype,"_font",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ik=te(qG.prototype,"_isSystemFontUsed",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rk=te(qG.prototype,"_isItalic",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ok=te(qG.prototype,"_isBold",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ak=te(qG.prototype,"_isUnderline",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sk=te(qG.prototype,"_underlineHeight",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),ck=te(qG.prototype,"_cacheMode",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dk.NONE}}),jG=qG))||jG)||jG)||jG)||jG));!function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE"}(mk||(mk={})),et(mk),function(e){e[e.BEVEL=0]="BEVEL",e[e.ROUND=1]="ROUND",e[e.MITER=2]="MITER"}(gk||(gk={})),et(gk),function(e){e[e.PT_CORNER=1]="PT_CORNER",e[e.PT_LEFT=2]="PT_LEFT",e[e.PT_BEVEL=4]="PT_BEVEL",e[e.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(vk||(vk={})),et(vk);var Sk=Math.PI,Ek=Math.min,Tk=Math.max,xk=Math.cos,Ak=Math.sin,Ck=Math.abs,bk=Math.sign,wk=.5522847493;function Rk(e,t,n,i,r){e.moveTo(t-i,n),e.bezierCurveTo(t-i,n+r*wk,t-i*wk,n+r,t,n+r),e.bezierCurveTo(t+i*wk,n+r,t+i,n+r*wk,t+i,n),e.bezierCurveTo(t+i,n-r*wk,t+i*wk,n-r,t,n-r),e.bezierCurveTo(t-i*wk,n-r,t-i,n-r*wk,t-i,n),e.close()}function Ik(e,t,n,i,r,o,a,s,c,l,u){var h,_,f,d,p,m,g,v,y,S,E,T,x,A,C,b;l>10||(p=.5*(o+s),m=.5*(a+c),g=.5*((h=.5*(t+i))+(f=.5*(i+o))),v=.5*((_=.5*(n+r))+(d=.5*(r+a))),((C=Ck((i-s)*(A=c-n)-(r-c)*(x=s-t)))+(b=Ck((o-s)*A-(a-c)*x)))*(C+b)<e.tessTol*(x*x+A*A)?e.addPoint(s,c,0===u?u|vk.PT_BEVEL:u):(Ik(e,t,n,h,_,g,v,E=.5*(g+(y=.5*(f+p))),T=.5*(v+(S=.5*(d+m))),l+1,0),Ik(e,E,T,y,S,p,m,s,c,l+1,u)))}var Pk,Ok,Dk,Nk,Mk,Lk,Bk,Fk,zk,Uk,Hk,Gk,kk,Vk,Wk,jk,qk,Xk,Yk,Kk,Zk,Qk,Jk=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).dx=0,i.dy=0,i.dmx=0,i.dmy=0,i.flags=0,i.len=0,i.reset(),i}return K(t,e),t.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},t}(zn),$k=function(){function e(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[],this.reset()}return e.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},e}(),eV=function(){function e(){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=gn.WHITE.clone(),this.lineCap=mk.BUTT,this.strokeColor=gn.BLACK.clone(),this.lineJoin=gk.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null}var t=e.prototype;return t.moveTo=function(e,t){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(e,t,vk.PT_CORNER),this._commandX=e,this._commandY=t},t.lineTo=function(e,t){this.addPoint(e,t,vk.PT_CORNER),this._commandX=e,this._commandY=t},t.bezierCurveTo=function(e,t,n,i,r,o){var a=this._curPath,s=a.points[a.points.length-1];s&&(s.x!==e||s.y!==t||n!==r||i!==o?(Ik(this,s.x,s.y,e,t,n,i,r,o,0,vk.PT_CORNER),this._commandX=r,this._commandY=o):this.lineTo(r,o))},t.quadraticCurveTo=function(e,t,n,i){var r=this._commandX,o=this._commandY;this.bezierCurveTo(r+2/3*(e-r),o+2/3*(t-o),n+2/3*(e-n),i+2/3*(t-i),n,i)},t.arc=function(e,t,n,i,r,o){!function(e,t,n,i,r,o,a){var s,c,l=0,u=0,h=0,_=0,f=0,d=0,p=0,m=0,g=0,v=0,y=0,S=0,E=0,T=0;if(u=o-r,a=a||!1)if(Ck(u)>=2*Sk)u=2*Sk;else for(;u<0;)u+=2*Sk;else if(Ck(u)>=2*Sk)u=2*-Sk;else for(;u>0;)u-=2*Sk;for(c=0|Tk(1,Ek(Ck(u)/(.5*Sk)+.5,5)),h=Ck(4/3*(1-xk(s=u/c/2))/Ak(s)),a||(h=-h),T=0;T<=c;T++)d=t+(_=xk(l=r+u*(T/c)))*i,p=n+(f=Ak(l))*i,m=-f*i*h,g=_*i*h,0===T?e.moveTo(d,p):e.bezierCurveTo(v+S,y+E,d-m,p-g,d,p),v=d,y=p,S=m,E=g}(this,e,t,n,i,r,o)},t.ellipse=function(e,t,n,i){Rk(this,e,t,n,i),this._curPath.complex=!1},t.circle=function(e,t,n){Rk(this,e,t,n,n),this._curPath.complex=!1},t.rect=function(e,t,n,i){this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+i),this.lineTo(e,t+i),this.close(),this._curPath.complex=!1},t.roundRect=function(e,t,n,i,r){!function(e,t,n,i,r,o){if(o<.1)e.rect(t,n,i,r);else{var a=Ek(o,.5*Ck(i))*bk(i),s=Ek(o,.5*Ck(r))*bk(r);e.moveTo(t,n+s),e.lineTo(t,n+r-s),e.bezierCurveTo(t,n+r-s*(1-wk),t+a*(1-wk),n+r,t+a,n+r),e.lineTo(t+i-a,n+r),e.bezierCurveTo(t+i-a*(1-wk),n+r,t+i,n+r-s*(1-wk),t+i,n+r-s),e.lineTo(t+i,n+s),e.bezierCurveTo(t+i,n+s*(1-wk),t+i-a*(1-wk),n,t+i-a,n),e.lineTo(t+a,n),e.bezierCurveTo(t+a*(1-wk),n,t,n+s*(1-wk),t,n+s),e.close()}}(this,e,t,n,i,r),this._curPath.complex=!1},t.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var e=this._renderDataList,t=0,n=e.length;t<n;t++){var i=e[t];i&&wH.remove(i)}this._renderDataList.length=0},t.close=function(){this._curPath.closed=!0},t.requestRenderData=function(){var e=wH.add();return this._renderDataList.push(e),e},t.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},t.addPoint=function(e,t,n){var i=this._curPath;if(i){var r=this._points,o=i.points,a=r[this.pointsOffset++];a?(a.x=e,a.y=t):(a=new Jk(e,t),r.push(a)),a.flags=n,o.push(a)}},t._addPath=function(){var e=this.pathLength,t=this.paths[e];return t?t.reset():(t=new $k,this.paths.push(t)),this.pathLength++,this._curPath=t,t},e}(),tV=[new Ds(ts.ATTR_POSITION,ya.RGB32F)],nV=[new Ds(ts.ATTR_POSITION,ya.RGB32F),new Ds(ts.ATTR_COLOR,ya.RGBA32F)],iV=[new Ds(ts.ATTR_POSITION,ya.RGB32F),new Ds(ts.ATTR_TEX_COORD,ya.RG32F),new Ds(ts.ATTR_COLOR,ya.RGBA32F)],rV=[new Ds(ts.ATTR_POSITION,ya.RGB32F),new Ds(ts.ATTR_TEX_COORD,ya.RG32F),new Ds(ts.ATTR_COLOR,ya.RGBA32F),new Ds(ts.ATTR_COLOR2,ya.RGBA32F)];function oV(e){for(var t=0,n=0;n<e.length;n++){var i=e[n];t+=$s[i.format].count}return t}function aV(e){for(var t=0,n=0;n<e.length;n++){var i=e[n];t+=$s[i.format].size}return t}i.internal.vfmtPosUvColor=iV,i.internal.vfmtPosUvTwoColor=rV,e("UIVertexFormat",Object.freeze({__proto__:null,vfmt:tV,vfmtPosColor:nV,vfmtPosUvColor:iV,vfmtPosUvTwoColor:rV,getComponentPerVertex:oV,getAttributeStride:aV}));var sV,cV,lV,uV,hV,_V,fV,dV,pV,mV,gV,vV,yV,SV,EV,TV,xV,AV,CV,bV,wV,RV,IV,PV,OV,DV,NV=nV.concat([new Ds("a_dist",ya.R32F)]),MV=oV(NV),LV=aV(NV),BV=function(t){return e({Graphics:t,GraphicsComponent:t}),t}((Pk=S_("cc.Graphics"),Ok=D_(),Dk=T_(110),Nk=R_(),Mk=K_(gk),Lk=B_(),Bk=K_(mk),Fk=B_(),zk=B_(),Uk=B_(),Hk=B_(),Gk=M_(),Pk(kk=Ok(kk=Dk(kk=Nk((Qk=Zk=function(e){function t(){var t;return(t=e.call(this)||this).impl=null,t.model=null,ee(t,"_lineWidth",Wk,Q(t)),ee(t,"_strokeColor",jk,Q(t)),ee(t,"_lineJoin",qk,Q(t)),ee(t,"_lineCap",Xk,Q(t)),ee(t,"_fillColor",Yk,Q(t)),ee(t,"_miterLimit",Kk,Q(t)),t._isDrawing=!1,t._isNeedUploadData=!0,t._instanceMaterialType=iG.ADD_COLOR,t.impl=new eV,t}K(t,e);var n=t.prototype;return n.onRestore=function(){this.impl||this._flushAssembler()},n.onLoad=function(){this.model=SO.root.createModel(ob),this.model.node=this.model.transform=this.node,this._flushAssembler()},n.onEnable=function(){e.prototype.onEnable.call(this),this._updateMtlForGraphics()},n.onDisable=function(){e.prototype.onDisable.call(this)},n.onDestroy=function(){e.prototype.onDestroy.call(this),this._sceneGetter=null,this.model&&(SO.root.destroyModel(this.model),this.model=null),this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null)},n.moveTo=function(e,t){this.impl&&this.impl.moveTo(e,t)},n.lineTo=function(e,t){this.impl&&this.impl.lineTo(e,t)},n.bezierCurveTo=function(e,t,n,i,r,o){this.impl&&this.impl.bezierCurveTo(e,t,n,i,r,o)},n.quadraticCurveTo=function(e,t,n,i){this.impl&&this.impl.quadraticCurveTo(e,t,n,i)},n.arc=function(e,t,n,i,r,o){this.impl&&this.impl.arc(e,t,n,i,r,o)},n.ellipse=function(e,t,n,i){this.impl&&this.impl.ellipse(e,t,n,i)},n.circle=function(e,t,n){this.impl&&this.impl.circle(e,t,n)},n.rect=function(e,t,n,i){this.impl&&this.impl.rect(e,t,n,i)},n.roundRect=function(e,t,n,i,r){this.impl&&this.impl.roundRect(e,t,n,i,r)},n.fillRect=function(e,t,n,i){this.rect(e,t,n,i),this.fill()},n.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var e=0;e<this.model.subModels.length;e++)this.model.subModels[e].inputAssembler.indexCount=0;this.markForUpdateRenderData()}},n.close=function(){this.impl&&this.impl.close()},n.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},n.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},n._updateMtlForGraphics=function(){var e;this._customMaterial?e=this.getMaterialInstance(0):(e=Kp.get("ui-graphics-material"),this.setMaterial(e,0),(e=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},n.activeSubModel=function(e){if(this.model){if(this.model.subModels.length<=e){var t=i.director.root.device,n=t.createBuffer(new ps(Ta.VERTEX|Ta.TRANSFER_DST,Ca.DEVICE,65535*LV,LV)),r=t.createBuffer(new ps(Ta.INDEX|Ta.TRANSFER_DST,Ca.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),o=new Gw([n],NV,ka.TRIANGLE_LIST,r);o.subMeshIdx=0,this.model.initSubModel(e,o,this.getMaterialInstance(0))}}else A(4500,this.node.name)},n._uploadData=function(e){var t=this.impl;if(t){var n=t&&t.getRenderDataList();if(!(n.length<=0)&&this.model){for(var i=this.model.subModels,r=0;r<n.length;r++){var o=n[r],a=i[r].inputAssembler;if(o.lastFilledVertex!==o.vertexStart){var s=new Float32Array(o.vData.buffer,0,o.vertexStart*MV);a.vertexBuffers[0].update(s),a.vertexCount=o.vertexStart;var c=new Uint16Array(o.iData.buffer,0,o.indicesStart);a.indexBuffer.update(c),a.indexCount=o.indicesStart,o.lastFilledVertex=o.vertexStart,o.lastFilledIndices=o.indicesStart}}e.removeUploadBuffersFunc(this),this._isNeedUploadData=!1}}},n._render=function(e){if(this._isNeedUploadData){if(this.impl){var t=this.impl.getRenderDataList(),n=this.model.subModels.length;if(t.length>n)for(var i=n;i<t.length;i++)this.activeSubModel(i)}e.addUploadBuffersFunc(this,this._uploadData)}e.commitModel(this,this.model,this.getMaterialInstance(0))},n._flushAssembler=function(){var e=t.Assembler.getAssembler(this);this._assembler!==e&&(this._assembler=e)},n._canRender=function(){return!!e.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},X(t,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(e){this._lineWidth=e,this.impl&&(this.impl.lineWidth=e)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(e){this._lineJoin=e,this.impl&&(this.impl.lineJoin=e)}},{key:"lineCap",get:function(){return this._lineCap},set:function(e){this._lineCap=e,this.impl&&(this.impl.lineCap=e)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(e){this.impl&&(this._strokeColor.set(e),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(e){this.impl&&(this._fillColor.set(e),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(e){this._miterLimit=e}},{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.set(e)}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(){}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(){}}]),t}(pk),Zk.LineJoin=gk,Zk.LineCap=mk,te((Vk=Qk).prototype,"lineWidth",[N_],Object.getOwnPropertyDescriptor(Vk.prototype,"lineWidth"),Vk.prototype),te(Vk.prototype,"lineJoin",[Mk,Lk],Object.getOwnPropertyDescriptor(Vk.prototype,"lineJoin"),Vk.prototype),te(Vk.prototype,"lineCap",[Bk,Fk],Object.getOwnPropertyDescriptor(Vk.prototype,"lineCap"),Vk.prototype),te(Vk.prototype,"strokeColor",[zk],Object.getOwnPropertyDescriptor(Vk.prototype,"strokeColor"),Vk.prototype),te(Vk.prototype,"fillColor",[Uk],Object.getOwnPropertyDescriptor(Vk.prototype,"fillColor"),Vk.prototype),te(Vk.prototype,"miterLimit",[Hk],Object.getOwnPropertyDescriptor(Vk.prototype,"miterLimit"),Vk.prototype),te(Vk.prototype,"color",[Z_,Gk],Object.getOwnPropertyDescriptor(Vk.prototype,"color"),Vk.prototype),Wk=te(Vk.prototype,"_lineWidth",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),jk=te(Vk.prototype,"_strokeColor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gn.BLACK.clone()}}),qk=te(Vk.prototype,"_lineJoin",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gk.MITER}}),Xk=te(Vk.prototype,"_lineCap",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mk.BUTT}}),Yk=te(Vk.prototype,"_fillColor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gn.WHITE.clone()}}),Kk=te(Vk.prototype,"_miterLimit",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),kk=Vk))||kk)||kk)||kk)||kk)),FV=new Mn,zV=new zn,UV=new Mn,HV=[];!function(e){e[e.RECT=0]="RECT",e[e.ELLIPSE=1]="ELLIPSE",e[e.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",e[e.IMAGE_STENCIL=3]="IMAGE_STENCIL"}(DV||(DV={})),et(DV);var GV=function(t){return e({Mask:t,MaskComponent:t}),t}((sV=S_("cc.Mask"),cV=D_(),lV=T_(110),uV=R_(),hV=K_(DV),_V=k_(),fV=B_(),dV=k_(),pV=B_(),mV=M_(),gV=K_(vU),vV=M_(),yV=M_(),SV=F_(),EV=M_(),TV=M_(),sV(xV=cV(xV=lV(xV=uV((OV=PV=function(e){function t(){var t;return(t=e.call(this)||this)._clearStencilMtl=null,t._clearModel=null,ee(t,"_type",CV,Q(t)),ee(t,"_inverted",bV,Q(t)),ee(t,"_segments",wV,Q(t)),ee(t,"_spriteFrame",RV,Q(t)),ee(t,"_alphaThreshold",IV,Q(t)),t._graphics=null,t._instanceMaterialType=iG.ADD_COLOR,t}K(t,e);var n=t.prototype;return n.onLoad=function(){this._createClearModel(),this._createGraphics(),this._graphics&&this._graphics.onLoad()},n.onEnable=function(){e.prototype.onEnable.call(this),this._updateGraphics()},n.onRestore=function(){this._createGraphics(),e.prototype.updateMaterial.call(this),this._updateGraphics(),this._renderFlag=this._canRender()},n.onDisable=function(){e.prototype.onDisable.call(this),this._disableGraphics()},n.onDestroy=function(){e.prototype.onDestroy.call(this),this._clearModel&&SO.root.destroyModel(this._clearModel),this._clearStencilMtl&&this._clearStencilMtl.destroy(),this._removeGraphics()},n.isHit=function(e){var t=this.node._uiProps.uiTransformComp,n=t.contentSize,i=n.width,r=n.height,o=zV;this.node.getWorldMatrix(FV),Mn.invert(UV,FV),zn.transformMat4(o,e,UV);var a=t.anchorPoint;o.x+=a.x*i,o.y+=a.y*r;var s=!1;if(this.type===DV.RECT||this.type===DV.GRAPHICS_STENCIL)s=o.x>=0&&o.y>=0&&o.x<=i&&o.y<=r;else if(this.type===DV.ELLIPSE){var c=i/2,l=r/2,u=o.x-.5*i,h=o.y-.5*r;s=u*u/(c*c)+h*h/(l*l)<1}return this._inverted&&(s=!s),s},n._render=function(e){e.commitComp(this,null,this._assembler,null)},n._postRender=function(e){this._postAssembler&&e.commitComp(this,null,this._postAssembler,null)},n._nodeStateChange=function(t){e.prototype._nodeStateChange.call(this,t),this._updateGraphics()},n._canRender=function(){return!!e.prototype._canRender.call(this)&&null!==this._graphics&&(this._type!==DV.IMAGE_STENCIL||null!==this._spriteFrame)},n._flushAssembler=function(){var e=t.Assembler.getAssembler(this),n=t.PostAssembler.getAssembler(this);this._assembler!==e&&(this.destroyRenderData(),this._assembler=e),this._postAssembler!==n&&(this._postAssembler=n),this._useRenderData()},n._createGraphics=function(){if(!this._graphics){var e=this._graphics=new BV;e._objFlags|=ei.Flags.IsOnLoadCalled,e.node=this.node,e.node.getWorldMatrix(),e.lineWidth=0;var t=gn.WHITE.clone();t.a=0,e.fillColor=t}this._updateMaterial()},n._updateGraphics=function(){if(this._graphics&&(this._type===DV.RECT||this._type===DV.ELLIPSE)){var e=this.node._uiProps.uiTransformComp,t=this._graphics;t.clear();var n=e.contentSize,i=n.width,r=n.height,o=e.anchorPoint,a=-i*o.x,s=-r*o.y;if(this._type===DV.RECT)t.rect(a,s,i,r);else if(this._type===DV.ELLIPSE){for(var c=function(e,t,n){HV.length=0;for(var i=2*Math.PI/n,r=0;r<n;++r)HV.push(new yn(t.x*Math.cos(i*r)+e.x,t.y*Math.sin(i*r)+e.y,0));return HV}(new yn(a+i/2,s+r/2,0),new yn(i/2,r/2,0),this._segments),l=0;l<c.length;++l){var u=c[l];0===l?t.moveTo(u.x,u.y):t.lineTo(u.x,u.y)}t.close()}t.fill()}},n._createClearModel=function(){if(!this._clearModel){var e=Kp.get("default-clear-stencil");this._clearStencilMtl=new bE({parent:e,owner:this,subModelIdx:0}),this._clearModel=SO.root.createModel(ob),this._clearModel.node=this._clearModel.transform=this.node;var t=aV(tV),n=i.director.root.device,r=n.createBuffer(new ps(Ta.VERTEX|Ta.TRANSFER_DST,Ca.DEVICE,4*t,t)),o=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);r.update(o);var a=n.createBuffer(new ps(Ta.INDEX|Ta.TRANSFER_DST,Ca.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),s=new Uint16Array([0,1,2,2,1,3]);a.update(s);var c=new Gw([r],tV,ka.TRIANGLE_LIST,a);c.subMeshIdx=0,this._clearModel.initSubModel(0,c,this._clearStencilMtl)}},n._updateMaterial=function(){if(this._graphics){var e,t=this._graphics;t.stencilStage=mH.DISABLED,this._type===DV.IMAGE_STENCIL?(e=Kp.get("ui-alpha-test-material"),t.setMaterial(e,0),(e=t.getMaterialInstance(0)).setProperty("alphaThreshold",this._alphaThreshold)):(e=Kp.get("ui-graphics-material"),t.setMaterial(e,0),t.getMaterialInstance(0))}},n._disableGraphics=function(){this._graphics&&this._graphics.onDisable()},n._removeGraphics=function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},n._useRenderData=function(){this._type!==DV.IMAGE_STENCIL||this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},X(t,[{key:"type",get:function(){return this._type},set:function(e){this._type!==e&&(this._type=e,this.markForUpdateRenderData(!1),this._updateMaterial(),this._type!==DV.IMAGE_STENCIL?(this._spriteFrame=null,this._updateGraphics(),this._renderData&&(this.destroyRenderData(),this._renderData=null)):(this._useRenderData(),this._graphics&&this._graphics.clear()))}},{key:"inverted",get:function(){return this._inverted},set:function(e){i.game.renderType!==zC.RENDER_TYPE_CANVAS?(this._inverted=e,this.stencilStage=mH.DISABLED,this._graphics&&(this._graphics.stencilStage=mH.DISABLED)):A(4202)}},{key:"segments",get:function(){return this._segments},set:function(e){this._segments!==e&&(this._segments=Jt(e,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(e){if(this._spriteFrame!==e){var t=this._spriteFrame;this._spriteFrame=e,this._type===DV.IMAGE_STENCIL&&!t&&e&&this.markForUpdateRenderData()}}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(e){this._alphaThreshold!==e&&(this._alphaThreshold=e,this.type===DV.IMAGE_STENCIL&&this._graphics&&this._graphics.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"graphics",get:function(){return this._graphics}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(e){this._dstBlendFactor!==e&&(this._dstBlendFactor=e,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(e){this._srcBlendFactor!==e&&(this._srcBlendFactor=e,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&(this._color.set(e),this.markForUpdateRenderData())}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(){}}]),t}(pk),PV.Type=DV,te((AV=OV).prototype,"type",[hV,_V,fV],Object.getOwnPropertyDescriptor(AV.prototype,"type"),AV.prototype),te(AV.prototype,"inverted",[dV,pV],Object.getOwnPropertyDescriptor(AV.prototype,"inverted"),AV.prototype),te(AV.prototype,"segments",[mV],Object.getOwnPropertyDescriptor(AV.prototype,"segments"),AV.prototype),te(AV.prototype,"spriteFrame",[gV,vV],Object.getOwnPropertyDescriptor(AV.prototype,"spriteFrame"),AV.prototype),te(AV.prototype,"alphaThreshold",[yV,SV,G_],Object.getOwnPropertyDescriptor(AV.prototype,"alphaThreshold"),AV.prototype),te(AV.prototype,"color",[Z_,EV],Object.getOwnPropertyDescriptor(AV.prototype,"color"),AV.prototype),te(AV.prototype,"customMaterial",[Z_,TV],Object.getOwnPropertyDescriptor(AV.prototype,"customMaterial"),AV.prototype),CV=te(AV.prototype,"_type",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return DV.RECT}}),bV=te(AV.prototype,"_inverted",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wV=te(AV.prototype,"_segments",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),RV=te(AV.prototype,"_spriteFrame",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),IV=te(AV.prototype,"_alphaThreshold",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),xV=AV))||xV)||xV)||xV)||xV));rR._comp=GV,i.Mask=GV;var kV,VV,WV,jV,qV,XV,YV,KV,ZV,QV,JV,$V,eW,tW,nW,iW,rW,oW,aW,sW,cW,lW,uW,hW,_W,fW,dW,pW,mW,gW,vW,yW,SW,EW,TW,xW,AW,CW,bW,wW,RW,IW,PW,OW,DW,NW,MW,LW,BW,FW,zW,UW,HW,GW,kW,VW=/^(click)(\s)*=|(param)(\s)*=/,WW=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,jW=e("HtmlTextParser",function(){function e(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var t=e.prototype;return t.parse=function(e){this._resultObjectArray.length=0,this._stack.length=0;for(var t=0,n=e.length;t<n;){var i=e.indexOf(">",t),r=-1;if(i>=0&&(r=e.lastIndexOf("<",i))<t-1&&(r=e.indexOf("<",i+1),i=e.indexOf(">",r+1)),r<0)this._stack.pop(),this._processResult(e.substring(t)),t=n;else{var o=e.substring(t,r),a=e.substring(r+1,i);""===a&&(o=e.substring(t,i+1)),this._processResult(o),-1===i?i=r:"/"===e.charAt(r+1)?this._stack.pop():this._addToStack(a),t=i+1}}return this._resultObjectArray},t._attributeToObject=function(e){e=e.trim();var t={},n=/^(color|size)(\s)*=/.exec(e),i="",r=0,o="";if(n){if(i=n[0],""===(e=e.substring(i.length).trim()))return t;switch(r=e.indexOf(" "),i[0]){case"c":t.color=r>-1?e.substring(0,r).trim():e;break;case"s":t.size=parseInt(e)}return r>-1&&(o=e.substring(r+1).trim(),t.event=this._processEventHandler(o)),t}if((n=/^(br(\s)*\/)/.exec(e))&&n[0].length>0&&(i=n[0].trim()).startsWith("br")&&"/"===i[i.length-1])return t.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),t;var a="";if((n=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(e))&&n[0].length>0&&(i=n[0].trim()).startsWith("img")&&"/"===i[i.length-1]){var s;n=WW.exec(e);for(var c=!1;n;){if(i=(e=e.substring(e.indexOf(n[0]))).substr(0,n[0].length),s=(r=(a=e.substring(i.length).trim()).indexOf(" "))>-1?a.substr(0,r):a,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),e=a.substring(r).trim(),s.endsWith("/")&&(s=s.slice(0,-1)),"src"===i){switch(s.charCodeAt(0)){case 34:case 39:c=!0,s=s.slice(1,-1)}t.isImage=!0,t.src=s}else if("height"===i)t.imageHeight=parseInt(s);else if("width"===i)t.imageWidth=parseInt(s);else if("align"===i){switch(s.charCodeAt(0)){case 34:case 39:s=s.slice(1,-1)}t.imageAlign=s.toLowerCase()}else"offset"===i?t.imageOffset=s:"click"===i&&(t.event=this._processEventHandler(i+"="+s));t.event&&"param"===i&&(t.event[i]=s.replace(/^"|"$/g,"")),n=WW.exec(e)}return c&&t.isImage&&this._resultObjectArray.push({text:"",style:t}),{}}if(n=/^(outline(\s)*[^>]*)/.exec(e)){var l={color:"#ffffff",width:1};if(e=n[0].substring("outline".length).trim()){var u,h=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(n=h.exec(e);n;)i=(e=e.substring(e.indexOf(n[0]))).substr(0,n[0].length),u=(r=(a=e.substring(i.length).trim()).indexOf(" "))>-1?a.substr(0,r):a,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),e=a.substring(r).trim(),"click"===i?t.event=this._processEventHandler(i+"="+u):"color"===i?l.color=u:"width"===i&&(l.width=parseInt(u)),t.event&&"param"===i&&(t.event[i]=u.replace(/^"|"$/g,"")),n=h.exec(e)}t.outline=l}if((n=/^(on|u|b|i)(\s)*/.exec(e))&&n[0].length>0){switch(i=n[0],e=e.substring(i.length).trim(),i[0]){case"u":t.underline=!0;break;case"i":t.italic=!0;break;case"b":t.bold=!0}if(""===e)return t;t.event=this._processEventHandler(e)}return t},t._processEventHandler=function(e){for(var t={},n=0,i=!1,r=VW.exec(e);r;){var o=r[0],a="";if(i=!1,'"'===(e=e.substring(o.length).trim()).charAt(0))(n=e.indexOf('"',1))>-1&&(a=e.substring(1,n).trim(),i=!0),n++;else if("'"===e.charAt(0))(n=e.indexOf("'",1))>-1&&(a=e.substring(1,n).trim(),i=!0),n++;else{var s=/(\S)+/.exec(e);n=(a=s?s[0]:"").length}i&&(t[o=o.substring(0,o.length-1).trim()]=a),e=e.substring(n).trim(),r=VW.exec(e)}return t},t._addToStack=function(e){var t=this._attributeToObject(e);if(0===this._stack.length)this._stack.push(t);else{if(t.isNewLine||t.isImage)return;var n=this._stack[this._stack.length-1];for(var i in n)t[i]||(t[i]=n[i]);this._stack.push(t)}},t._processResult=function(e){0!==e.length&&(e=this._escapeSpecialSymbol(e),this._stack.length>0?this._resultObjectArray.push({text:e,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:e}))},t._escapeSpecialSymbol=function(e){for(var t,n=$(this._specialSymbolArray);!(t=n()).done;){var i=t.value,r=i[0],o=i[1];e=e.replace(r,o)}return e},e}()),qW=function(t){return e({LabelOutline:t,LabelOutlineComponent:t}),t}((kV=S_("cc.LabelOutline"),VV=D_(),WV=T_(110),jV=R_(),qV=E_(yk),XV=B_(),YV=B_(),kV(KV=VV(KV=WV(KV=jV(KV=qV(KV=w_(($V=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_color",QV,Q(t)),ee(t,"_width",JV,Q(t)),t}K(t,e);var n=t.prototype;return n.onEnable=function(){this._updateRenderData()},n.onDisable=function(){this._updateRenderData()},n._updateRenderData=function(){var e=this.node.getComponent(yk);e&&e.updateRenderData(!0)},X(t,[{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&(this._color.set(e),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(e){this._width!==e&&(this._width=e,this._updateRenderData())}}]),t}(Xd),QV=te((ZV=$V).prototype,"_color",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn(0,0,0,255)}}),JV=te(ZV.prototype,"_width",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),te(ZV.prototype,"color",[XV],Object.getOwnPropertyDescriptor(ZV.prototype,"color"),ZV.prototype),te(ZV.prototype,"width",[YV],Object.getOwnPropertyDescriptor(ZV.prototype,"width"),ZV.prototype),KV=ZV))||KV)||KV)||KV)||KV)||KV)||KV));!function(e){e[e.SIMPLE=0]="SIMPLE",e[e.SLICED=1]="SLICED",e[e.TILED=2]="TILED",e[e.FILLED=3]="FILLED"}(UW||(UW={})),et(UW),function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL",e[e.RADIAL=2]="RADIAL"}(HW||(HW={})),et(HW),function(e){e[e.CUSTOM=0]="CUSTOM",e[e.TRIMMED=1]="TRIMMED",e[e.RAW=2]="RAW"}(GW||(GW={})),et(GW),function(e){e.SPRITE_FRAME_CHANGED="spriteframe-changed"}(kW||(kW={}));var XW,YW,KW,ZW,QW,JW,$W,ej,tj,nj,ij,rj,oj,aj,sj=function(t){return e({Sprite:t,SpriteComponent:t}),t}((eW=S_("cc.Sprite"),tW=D_(),nW=T_(110),iW=R_(),rW=K_(SU),oW=k_(),aW=B_(),sW=K_(vU),cW=k_(),lW=B_(),uW=K_(UW),hW=k_(),_W=B_(),fW=K_(HW),dW=B_(),pW=B_(),mW=F_(),gW=B_(),vW=F_(),yW=B_(),SW=k_(),EW=B_(),TW=K_(GW),xW=k_(),AW=B_(),eW(CW=tW(CW=nW(CW=iW((zW=FW=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_spriteFrame",wW,Q(t)),ee(t,"_type",RW,Q(t)),ee(t,"_fillType",IW,Q(t)),ee(t,"_sizeMode",PW,Q(t)),ee(t,"_fillCenter",OW,Q(t)),ee(t,"_fillStart",DW,Q(t)),ee(t,"_fillRange",NW,Q(t)),ee(t,"_isTrimmedMode",MW,Q(t)),ee(t,"_useGrayscale",LW,Q(t)),ee(t,"_atlas",BW,Q(t)),t}K(t,e);var n=t.prototype;return n.__preload=function(){this.changeMaterialForDefine(),e.prototype.__preload.call(this),this._spriteFrame&&this._spriteFrame.once("load",this._onTextureLoaded,this)},n.onEnable=function(){e.prototype.onEnable.call(this),this._activateMaterial(),this._markForUpdateUvDirty()},n.onDestroy=function(){this.destroyRenderData(),this._spriteFrame&&!this._spriteFrame.loaded&&this._spriteFrame.off("load",this._onTextureLoaded,this),e.prototype.onDestroy.call(this)},n.changeSpriteFrameFromAtlas=function(e){if(this._atlas){var t=this._atlas.getSpriteFrame(e);this.spriteFrame=t}else console.warn("SpriteAtlas is null.")},n.changeMaterialForDefine=function(){var e,t=this._instanceMaterialType;this._spriteFrame&&(e=this._spriteFrame.texture);var n=!1;if(e instanceof od){var i=e.getPixelFormat();n=i===If.RGBA_ETC1||i===If.RGB_A_PVRTC_4BPPV1||i===If.RGB_A_PVRTC_2BPPV1}n&&this.grayscale?this._instanceMaterialType=iG.USE_ALPHA_SEPARATED_AND_GRAY:n?this._instanceMaterialType=iG.USE_ALPHA_SEPARATED:this.grayscale?this._instanceMaterialType=iG.GRAYSCALE:this._instanceMaterialType=iG.ADD_COLOR_AND_TEXTURE,t!==this._instanceMaterialType&&this.updateMaterial()},n._updateBuiltinMaterial=function(){var t=e.prototype._updateBuiltinMaterial.call(this);if(this.spriteFrame&&this.spriteFrame.texture instanceof ZS){var n=Y({SAMPLE_FROM_RT:!0},t.passes[0].defines),i=new QS;i.initialize({effectAsset:t.effectAsset,defines:n}),t=i}return t},n._render=function(e){e.commitComp(this,this._spriteFrame,this._assembler,null)},n._canRender=function(){if(!e.prototype._canRender.call(this))return!1;var t=this._spriteFrame;return!(!t||!t.textureLoaded())},n._flushAssembler=function(){var e=t.Assembler.getAssembler(this);this._assembler!==e&&(this.destroyRenderData(),this._assembler=e),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this._colorDirty=!0,this._updateColor())},n._applySpriteSize=function(){if(this._spriteFrame){if(!this._spriteFrame.isDefault)if(GW.RAW===this._sizeMode){var e=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(e)}else if(GW.TRIMMED===this._sizeMode){var t=this._spriteFrame.getRect();this.node._uiProps.uiTransformComp.setContentSize(t.width,t.height)}this._activateMaterial()}},n._resized=function(){},n._activateMaterial=function(){var e=this._spriteFrame,t=this.getRenderMaterial(0);i.game.renderType!==i.game.RENDER_TYPE_CANVAS?(e&&t&&this.markForUpdateRenderData(),this._renderData&&(this._renderData.material=t)):this.markForUpdateRenderData()},n._onTextureLoaded=function(){this.isValid&&(this.changeMaterialForDefine(),this._applySpriteSize())},n._applySpriteFrame=function(e){var t=this._spriteFrame;this._renderData&&(e&&!e.loaded&&e.off("load",this._onTextureLoaded,this),this._renderData.uvDirty||(this._renderData.uvDirty=!e||!t||e.uvHash!==t.uvHash),this._renderDataFlag=this._renderData.uvDirty),t&&(e&&t===e||(t.loaded?this._onTextureLoaded():t.once("load",this._onTextureLoaded,this)))},n._markForUpdateUvDirty=function(){this._renderData&&(this._renderData.uvDirty=!0,this._renderDataFlag=!0)},X(t,[{key:"spriteAtlas",get:function(){return this._atlas},set:function(e){this._atlas!==e&&(this._atlas=e)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(e){if(this._spriteFrame!==e){var t=this._spriteFrame;this._spriteFrame=e,this.markForUpdateRenderData(!1),this._applySpriteFrame(t)}}},{key:"type",get:function(){return this._type},set:function(e){this._type!==e&&(this._type=e,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(e){this._fillType!==e&&(e===HW.RADIAL||this._fillType===HW.RADIAL?(this.destroyRenderData(),this._renderData=null):this._renderData&&this.markForUpdateRenderData(!0)),this._fillType=e,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(e){this._fillCenter.x=e.x,this._fillCenter.y=e.y,this._type===UW.FILLED&&this._renderData&&this.markForUpdateRenderData()}},{key:"fillStart",get:function(){return this._fillStart},set:function(e){this._fillStart=Jt(e,-1,1),this._type===UW.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"fillRange",get:function(){return this._fillRange},set:function(e){this._fillRange=Jt(e,-1,1),this._type===UW.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(e){this._isTrimmedMode!==e&&(this._isTrimmedMode=e,this._type===UW.SIMPLE&&this._renderData&&this.markForUpdateRenderData(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(e){this._useGrayscale!==e&&(this._useGrayscale=e,this._instanceMaterialType=!0===e?iG.GRAYSCALE:iG.ADD_COLOR_AND_TEXTURE,this.updateMaterial())}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(e){this._sizeMode!==e&&(this._sizeMode=e,e!==GW.CUSTOM&&this._applySpriteSize())}}]),t}(pk),FW.FillType=HW,FW.Type=UW,FW.SizeMode=GW,FW.EventType=kW,te((bW=zW).prototype,"spriteAtlas",[rW,oW,aW],Object.getOwnPropertyDescriptor(bW.prototype,"spriteAtlas"),bW.prototype),te(bW.prototype,"spriteFrame",[sW,cW,lW],Object.getOwnPropertyDescriptor(bW.prototype,"spriteFrame"),bW.prototype),te(bW.prototype,"type",[uW,hW,_W],Object.getOwnPropertyDescriptor(bW.prototype,"type"),bW.prototype),te(bW.prototype,"fillType",[fW,dW],Object.getOwnPropertyDescriptor(bW.prototype,"fillType"),bW.prototype),te(bW.prototype,"fillCenter",[pW],Object.getOwnPropertyDescriptor(bW.prototype,"fillCenter"),bW.prototype),te(bW.prototype,"fillStart",[mW,gW],Object.getOwnPropertyDescriptor(bW.prototype,"fillStart"),bW.prototype),te(bW.prototype,"fillRange",[vW,yW],Object.getOwnPropertyDescriptor(bW.prototype,"fillRange"),bW.prototype),te(bW.prototype,"trim",[SW,EW],Object.getOwnPropertyDescriptor(bW.prototype,"trim"),bW.prototype),te(bW.prototype,"grayscale",[N_],Object.getOwnPropertyDescriptor(bW.prototype,"grayscale"),bW.prototype),te(bW.prototype,"sizeMode",[TW,xW,AW],Object.getOwnPropertyDescriptor(bW.prototype,"sizeMode"),bW.prototype),wW=te(bW.prototype,"_spriteFrame",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RW=te(bW.prototype,"_type",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return UW.SIMPLE}}),IW=te(bW.prototype,"_fillType",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return HW.HORIZONTAL}}),PW=te(bW.prototype,"_sizeMode",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return GW.TRIMMED}}),OW=te(bW.prototype,"_fillCenter",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn(0,0)}}),DW=te(bW.prototype,"_fillStart",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),NW=te(bW.prototype,"_fillRange",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),MW=te(bW.prototype,"_isTrimmedMode",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),LW=te(bW.prototype,"_useGrayscale",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),BW=te(bW.prototype,"_atlas",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),CW=bW))||CW)||CW)||CW)||CW)),cj=e("RenderRoot2D",S_("cc.RenderRoot2D")(XW=T_(100)(XW=R_()(XW=E_(zH)(XW=x_(XW=w_(XW=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.onEnable=function(){i.director.root.batcher2D.addScreen(this)},n.onDisable=function(){i.director.root.batcher2D.removeScreen(this)},n.onDestroy=function(){i.director.root.batcher2D.removeScreen(this)},t}(Xd))||XW)||XW)||XW)||XW)||XW)||XW),lj=new yn,uj=Qe({OVERLAY:0,INTERSPERSE:1}),hj=function(t){return e({Canvas:t,CanvasComponent:t}),t}((YW=S_("cc.Canvas"),KW=D_(),ZW=T_(100),QW=R_(),JW=K_(TM),$W=B_(),ej=B_(),tj=K_(TM),YW(nj=KW(nj=ZW(nj=QW(nj=w_(nj=x_((te((ij=function(e){function t(){var t;return ee(t=e.call(this)||this,"_cameraComponent",rj,Q(t)),ee(t,"_alignCanvasWithScreen",oj,Q(t)),t._thisOnCameraResized=void 0,t._fitDesignResolution=void 0,t._pos=new yn,t._renderMode=uj.OVERLAY,t._thisOnCameraResized=t._onResizeCamera.bind(Q(t)),t}K(t,e);var n=t.prototype;return n.__preload=function(){var e=this.getComponent("cc.Widget");e&&e.updateAlignment(),this._cameraComponent&&this._cameraComponent._createCamera(),this._onResizeCamera(),this.node.on(bm.TRANSFORM_CHANGED,this._thisOnCameraResized)},n.onDestroy=function(){e.prototype.onDestroy.call(this),this.node.off(bm.TRANSFORM_CHANGED,this._thisOnCameraResized)},n._onResizeCamera=function(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture){var e=this._cameraComponent.targetTexture.window;this._cameraComponent.camera&&this._cameraComponent.camera.setFixedSize(e.width,e.height),this._cameraComponent.orthoHeight=HC.height/2}else if(UC.canvas){var t=UC.canvas;this._cameraComponent.camera&&this._cameraComponent.camera.resize(t.width,t.height),this._cameraComponent.orthoHeight=UC.canvas.height/qC.getScaleY()/2}this.node.getWorldPosition(lj),this._cameraComponent.node.setWorldPosition(lj.x,lj.y,1e3)}},n._getViewPriority=function(){if(this._cameraComponent){var e,t=null===(e=this.cameraComponent)||void 0===e?void 0:e.priority;return this._renderMode===uj.OVERLAY?t|1<<30:t&~(1<<30)}return 0},X(t,[{key:"renderMode",get:function(){return this._renderMode},set:function(e){this._renderMode=e,this._cameraComponent&&(this._cameraComponent.priority=this._getViewPriority())}},{key:"cameraComponent",get:function(){return this._cameraComponent},set:function(e){this._cameraComponent!==e&&(this._cameraComponent=e,this._onResizeCamera())}},{key:"alignCanvasWithScreen",get:function(){return this._alignCanvasWithScreen},set:function(e){this._alignCanvasWithScreen=e,this._onResizeCamera()}}]),t}(cj)).prototype,"cameraComponent",[JW,$W],Object.getOwnPropertyDescriptor(ij.prototype,"cameraComponent"),ij.prototype),te(ij.prototype,"alignCanvasWithScreen",[ej],Object.getOwnPropertyDescriptor(ij.prototype,"alignCanvasWithScreen"),ij.prototype),rj=te(ij.prototype,"_cameraComponent",[tj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oj=te(ij.prototype,"_alignCanvasWithScreen",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),nj=ij))||nj)||nj)||nj)||nj)||nj)||nj));i.Canvas=hj;var _j,fj,dj,pj,mj,gj,vj,yj,Sj,Ej,Tj,xj,Aj,Cj,bj,wj,Rj,Ij,Pj,Oj,Dj,Nj,Mj,Lj,Bj,Fj,zj,Uj,Hj,Gj,kj,Vj,Wj,jj,qj,Xj=e("UIComponent",S_("cc.UIComponent")(aj=E_(zH)(aj=T_(110)(aj=x_(aj=w_(aj=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._lastParent=null,t.stencilStage=mH.DISABLED,t}K(t,e);var n=t.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){},n.onDisable=function(){},n.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},n.updateAssembler=function(){},n.postUpdateAssembler=function(){},t}(Xd))||aj)||aj)||aj)||aj)||aj);z(Xj.prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),F(hj.prototype,"Canvas.prototype",[{name:"camera",newName:"cameraComponent.camera",customGetter:function(){return this._cameraComponent.camera}},{name:"clearFlag",newName:"cameraComponent.clearFlags",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearFlags:0},customSetter:function(e){this._cameraComponent&&(this._cameraComponent.clearFlags=e)}},{name:"color",newName:"cameraComponent.clearColor",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearColor:gn.BLACK},customSetter:function(e){this._cameraComponent&&(this._cameraComponent.clearColor=e)}},{name:"priority",newName:"cameraComponent.priority",customGetter:function(){return this._cameraComponent?this._cameraComponent.priority:0},customSetter:function(e){this._cameraComponent&&(this._cameraComponent.priority=e)}},{name:"targetTexture",newName:"cameraComponent.targetTexture",customGetter:function(){return this._cameraComponent?this._cameraComponent.targetTexture:null},customSetter:function(e){this._cameraComponent&&(this._cameraComponent.targetTexture=e)}},{name:"visibility",newName:"cameraComponent.visibility",customGetter:function(){return this._cameraComponent?this._cameraComponent.visibility:0}}]),U(pk.prototype,"Renderable2D.prototype",[{name:"srcBlendFactor",suggest:"Please use a custom material to specify blending options instead."},{name:"dstBlendFactor",suggest:"Please use a custom material to specify blending options instead."}]),U(zH.prototype,"UITransform.prototype",[{name:"priority",suggest:"Please use setSiblingIndex to change index of the current node in its parent's children array."}]),i.UITransformComponent=zH,Ke.setClassAlias(zH,"cc.UITransformComponent"),Ke.setClassAlias(pk,"cc.RenderComponent"),i.CanvasComponent=hj,Ke.setClassAlias(hj,"cc.CanvasComponent");var Yj=new jW,Kj="RICHTEXT_CHILD",Zj="RICHTEXT_Image_CHILD",Qj=new Xe((function(e){if(!i.isValid(e.node))return!1;var t=e.node.getComponent(qW);return t&&(t.width=0),!0}),20),Jj=new Xe((function(e){return i.isValid(e.node)}),10);function $j(e){return{node:new Vv(e),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:e}}function eq(e,t){var n;e===Kj?n=Qj._get():e===Zj&&(n=Jj._get());var i=(n=n||$j(e)).node;return i||(i=new Vv(e)),i.hideFlags|=ei.Flags.DontSave|ei.Flags.HideInHierarchy,e===Zj?(n.comp=i.getComponent(sj)||i.addComponent(sj),n.comp.spriteFrame=t,n.comp.type=sj.Type.SLICED,n.comp.sizeMode=sj.SizeMode.CUSTOM):(n.comp=i.getComponent(yk)||i.addComponent(yk),n.comp.string=t,n.comp.horizontalAlign=hk.LEFT,n.comp.verticalAlign=_k.TOP),i.setPosition(0,0,0),i._uiProps.uiTransformComp.setAnchorPoint(.5,.5),n.node=i,n.lineCount=0,n.styleIndex=0,n.imageOffset="",n.clickParam="",n.clickHandler="",n}var tq,nq=function(t){return e({RichText:t,RichTextComponent:t}),t}((_j=S_("cc.RichText"),fj=D_(),dj=T_(110),pj=R_(),mj=B_(),gj=K_(hk),vj=B_(),yj=B_(),Sj=B_(),Ej=K_(CU),Tj=B_(),xj=B_(),Aj=K_(dk),Cj=B_(),bj=B_(),wj=B_(),Rj=K_(SU),Ij=B_(),Pj=B_(),_j(Oj=fj(Oj=dj(Oj=pj(Oj=w_((qj=jj=function(e){function t(){var t;return ee(t=e.call(this)||this,"_lineHeight",Nj,Q(t)),ee(t,"_string",Mj,Q(t)),ee(t,"_horizontalAlign",Lj,Q(t)),ee(t,"_fontSize",Bj,Q(t)),ee(t,"_maxWidth",Fj,Q(t)),ee(t,"_fontFamily",zj,Q(t)),ee(t,"_font",Uj,Q(t)),ee(t,"_isSystemFontUsed",Hj,Q(t)),ee(t,"_userDefinedFont",Gj,Q(t)),ee(t,"_cacheMode",kj,Q(t)),ee(t,"_imageAtlas",Vj,Q(t)),ee(t,"_handleTouchEvent",Wj,Q(t)),t._textArray=[],t._segments=[],t._labelSegmentsCache=[],t._linesWidth=[],t._lineCount=1,t._labelWidth=0,t._labelHeight=0,t._layoutDirty=!0,t._lineOffsetX=0,t._updateRichTextStatus=void 0,t._updateRichTextStatus=t._updateRichText,t}K(t,e);var n=t.prototype;return n.onLoad=function(){this.node.on(bm.LAYER_CHANGED,this._applyLayer,this)},n.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},n.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},n.start=function(){this._onTTFLoaded(),this.node.on(Vv.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this)},n.onRestore=function(){},n.onDestroy=function(){for(var e,t=$(this._segments);!(e=t()).done;){var n=e.value;n.node.removeFromParent(),n.type===Kj?Qj.put(n):n.type===Zj&&Jj.put(n)}this.node.off(Vv.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(bm.LAYER_CHANGED,this._applyLayer,this)},n._addEventListeners=function(){this.node.on(Vv.EventType.TOUCH_END,this._onTouchEnded,this)},n._removeEventListeners=function(){this.node.off(Vv.EventType.TOUCH_END,this._onTouchEnded,this)},n._updateLabelSegmentTextAttributes=function(){var e=this;this._segments.forEach((function(t){e._applyTextAttribute(t)}))},n._createFontLabel=function(e){return eq(Kj,e)},n._createImage=function(e){return eq(Zj,e)},n._onTTFLoaded=function(){var e=this;this._font instanceof LU?this._font._nativeAsset?(this._layoutDirty=!0,this._updateRichText()):SD.postLoadNative(this._font,(function(){e.isValid&&(e._layoutDirty=!0,e._updateRichText())})):(this._layoutDirty=!0,this._updateRichText())},n._measureText=function(e,t){var n=this,i=function(t){var i;return 0===n._labelSegmentsCache.length?(i=n._createFontLabel(t),n._labelSegmentsCache.push(i)):(i=n._labelSegmentsCache[0]).node.getComponent(yk).string=t,i.styleIndex=e,n._applyTextAttribute(i),i.node._uiProps.uiTransformComp.contentSize.width};return t?i(t):i},n._onTouchEnded=function(e){for(var t,n=this,i=this.node.getComponents(Xd),r=function(){var r=t.value,o=r.clickHandler,a=r.clickParam;o&&n._containsTouchLocation(r,e.touch.getUILocation())&&(i.forEach((function(t){var n=t[o];t.enabledInHierarchy&&n&&n.call(t,e,a)})),e.propagationStopped=!0)},o=$(this._segments);!(t=o()).done;)r()},n._containsTouchLocation=function(e,t){var n=e.node.getComponent(zH);return!!n&&n.getBoundingBoxToWorld().contains(t)},n._resetState=function(){for(var e=this.node.children,t=e.length-1;t>=0;t--){var n=e[t];if(n.name===Kj||n.name===Zj){n.parent===this.node?n.parent=null:e.splice(t,1);var i=$j(n.name);i.node=n,n.name===Kj?(i.comp=n.getComponent(yk),Qj.put(i)):(i.comp=n.getComponent(sj),Jj.put(i))}}e.length=0,this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},n._activateChildren=function(e){for(var t=this.node.children.length-1;t>=0;t--){var n=this.node.children[t];n.name!==Kj&&n.name!==Zj||(n.active=e)}},n._addLabelSegment=function(e,t){var n;if(0===this._labelSegmentsCache.length)n=this._createFontLabel(e);else{var i=(n=this._labelSegmentsCache.pop()).node.getComponent(yk);i&&(i.string=e)}return n.styleIndex=t,n.lineCount=this._lineCount,n.node._uiProps.uiTransformComp.setAnchorPoint(0,0),n.node.layer=this.node.layer,this._applyTextAttribute(n),this.node.addChild(n.node),this._segments.push(n),n},n._updateRichTextWithMaxWidth=function(e,t,n){var i=t;if(this._lineOffsetX>0&&i+this._lineOffsetX>this._maxWidth)for(var r=0;this._lineOffsetX<=this._maxWidth;){var o=this._getFirstWordLen(e,r,e.length),a=e.substr(r,o),s=this._measureText(n,a);if(!(this._lineOffsetX+s<=this._maxWidth)){if(r>0){var c=e.substr(0,r);this._addLabelSegment(c,n),e=e.substr(r,e.length),i=this._measureText(n,e)}this._updateLineInfo();break}this._lineOffsetX+=s,r+=o}if(i>this._maxWidth)for(var l=tH(e,i,this._maxWidth,this._measureText(n)),u=0;u<l.length;++u){var h=l[u],_=this._addLabelSegment(h,n).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=_.width,l.length>1&&u<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=i,this._addLabelSegment(e,n)},n._isLastComponentCR=function(e){return e.length-1===e.lastIndexOf("\n")},n._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},n._needsUpdateTextLayout=function(e){if(this._layoutDirty||!this._textArray||!e)return!0;if(this._textArray.length!==e.length)return!0;for(var t=0;t<this._textArray.length;t++){var n=this._textArray[t],i=e[t];if(n.text!==i.text)return!0;var r=n.style,o=i.style;if(r){if(o){if(!!o.outline!=!!r.outline)return!0;if(r.size!==o.size||r.italic!==o.italic||r.isImage!==o.isImage)return!0;if(r.src!==o.src||r.imageAlign!==o.imageAlign||r.imageHeight!==o.imageHeight||r.imageWidth!==o.imageWidth||r.imageOffset!==o.imageOffset)return!0}else if(r.size||r.italic||r.isImage||r.outline)return!0}else if(o&&(o.size||o.italic||o.isImage||o.outline))return!0}return!1},n._addRichTextImageElement=function(e){if(e.style){var t=e.style,n=t.src,i=this._imageAtlas&&n&&this._imageAtlas.getSpriteFrame(n);if(i){var r=this._createImage(i);switch(r.comp,t.imageAlign){case"top":r.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":r.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:r.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}r.node.layer=this.node.layer,this.node.addChild(r.node),this._segments.push(r);var o=i.rect.clone(),a=1,s=o.width,c=o.height,l=t.imageWidth||0,u=t.imageHeight||0;u>0?(s*=a=u/c,c*=a):(s*=a=this._lineHeight/c,c*=a),l>0&&(s=l),this._maxWidth>0?(this._lineOffsetX+s>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=s):(this._lineOffsetX+=s,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),r.node._uiProps.uiTransformComp.setContentSize(s,c),r.lineCount=this._lineCount,r.clickHandler="",r.clickParam="";var h=t.event;h&&(r.clickHandler=h.click,r.clickParam=h.param)}else A(4400)}},n._updateRichText=function(){if(this.enabledInHierarchy){var e=Yj.parse(this._string);if(!this._needsUpdateTextLayout(e))return this._textArray=e.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=e.slice(),this._resetState();for(var t,n=!1,i=0;i<this._textArray.length;++i){var r=this._textArray[i],o=r.text;if(void 0!==o){if(""===o){if(r.style&&r.style.isNewLine){this._updateLineInfo();continue}if(r.style&&r.style.isImage&&this._imageAtlas){this._addRichTextImageElement(r);continue}}for(var a=o.split("\n"),s=0;s<a.length;++s){var c=a[s];if(""!==c)if(n=!1,this._maxWidth>0){var l=this._measureText(i,c);this._updateRichTextWithMaxWidth(c,l,i),a.length>1&&s<a.length-1&&this._updateLineInfo()}else t=this._addLabelSegment(c,i),this._lineOffsetX+=t.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),a.length>1&&s<a.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(o)&&s===a.length-1)continue;this._updateLineInfo(),n=!0}}}}n||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+GU)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},n._getFirstWordLen=function(e,t,n){var i=e.charAt(t);if(QU(i)||JU(i))return 1;for(var r=1,o=t+1;o<n&&!JU(i=e.charAt(o))&&!QU(i);++o)r++;return r},n._updateRichTextPosition=function(){for(var e=0,t=1,n=this._lineCount,i=this.node._uiProps.uiTransformComp,r=i.anchorX,o=i.anchorY,a=0;a<this._segments.length;++a){var s=this._segments[a],c=s.lineCount;c>t&&(e=0,t=c);var l=this._labelWidth*(.5*this._horizontalAlign-r);switch(this._horizontalAlign){case hk.LEFT:break;case hk.CENTER:l-=this._linesWidth[c-1]/2;break;case hk.RIGHT:l-=this._linesWidth[c-1]}var u=s.node.position;if(s.node.setPosition(e+l,this._lineHeight*(n-c)-this._labelHeight*o,u.z),c===t&&(e+=s.node._uiProps.uiTransformComp.width),s.node.getComponent(sj)){var h=s.node.position.clone(),_=this._lineHeight,f=this._lineHeight*(1+GU);switch(s.node._uiProps.uiTransformComp.anchorY){case 1:h.y+=_+(f-_)/2;break;case.5:h.y+=f/2;break;default:h.y+=(f-_)/2}if(s.imageOffset){var d=s.imageOffset.split(",");if(1===d.length&&d[0]){var p=parseFloat(d[0]);Number.isInteger(p)&&(h.y+=p)}else if(2===d.length){var m=parseFloat(d[0]),g=parseFloat(d[1]);Number.isInteger(m)&&(h.x+=m),Number.isInteger(g)&&(h.y+=g)}}s.node.position=h}var v=s.node.getComponent(qW);if(v){var y=s.node.position.clone();y.y-=v.width,s.node.position=y}}},n._convertLiteralColorValue=function(e){var t=e.toUpperCase();return gn[t]?gn[t]:(new gn).fromHEX(e)},n._applyTextAttribute=function(e){var t=e.node.getComponent(yk);if(t){var n,i=e.styleIndex;if(this._textArray[i]&&(n=this._textArray[i].style),n){if(t.color=this._convertLiteralColorValue(n.color||"white"),t.isBold=!!n.bold,t.isItalic=!!n.italic,t.isUnderline=!!n.underline,n.outline){var r=e.node.getComponent(qW);r||(r=e.node.addComponent(qW)),r.color=this._convertLiteralColorValue(n.outline.color),r.width=n.outline.width}t.fontSize=n.size||this._fontSize,e.clickHandler="",e.clickParam="";var o=n.event;o&&(e.clickHandler=o.click||"",e.clickParam=o.param||"")}else t.fontSize=this._fontSize;t.cacheMode=this._cacheMode,this._font instanceof CU&&!this._isSystemFontUsed?t.font=this._font:t.fontFamily=this._fontFamily,t.useSystemFont=this._isSystemFontUsed,t.lineHeight=this._lineHeight,t.updateRenderData(!0);var a=t._assembler;a&&a.updateRenderData(t)}},n._applyLayer=function(){for(var e,t=$(this._segments);!(e=t()).done;)e.value.node.layer=this.node.layer},X(t,[{key:"string",get:function(){return this._string},set:function(e){this._string!==e&&(this._string=e,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(e){this.horizontalAlign!==e&&(this._horizontalAlign=e,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(e){this._fontFamily!==e&&(this._fontFamily=e,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(e){this._font!==e&&(this._font=e,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(e){this._isSystemFontUsed!==e&&(this._isSystemFontUsed=e,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(e){this._cacheMode!==e&&(this._cacheMode=e,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(e){this._maxWidth!==e&&(this._maxWidth=e,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(e){this._lineHeight!==e&&(this._lineHeight=e,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(e){this._imageAtlas!==e&&(this._imageAtlas=e,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(e){this._handleTouchEvent!==e&&(this._handleTouchEvent=e,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),t}(Xj),jj.HorizontalAlign=hk,jj.VerticalAlign=_k,te((Dj=qj).prototype,"string",[V_,mj],Object.getOwnPropertyDescriptor(Dj.prototype,"string"),Dj.prototype),te(Dj.prototype,"horizontalAlign",[gj,vj],Object.getOwnPropertyDescriptor(Dj.prototype,"horizontalAlign"),Dj.prototype),te(Dj.prototype,"fontSize",[yj],Object.getOwnPropertyDescriptor(Dj.prototype,"fontSize"),Dj.prototype),te(Dj.prototype,"fontFamily",[Sj],Object.getOwnPropertyDescriptor(Dj.prototype,"fontFamily"),Dj.prototype),te(Dj.prototype,"font",[Ej,Tj],Object.getOwnPropertyDescriptor(Dj.prototype,"font"),Dj.prototype),te(Dj.prototype,"useSystemFont",[xj],Object.getOwnPropertyDescriptor(Dj.prototype,"useSystemFont"),Dj.prototype),te(Dj.prototype,"cacheMode",[Aj,Cj],Object.getOwnPropertyDescriptor(Dj.prototype,"cacheMode"),Dj.prototype),te(Dj.prototype,"maxWidth",[bj],Object.getOwnPropertyDescriptor(Dj.prototype,"maxWidth"),Dj.prototype),te(Dj.prototype,"lineHeight",[wj],Object.getOwnPropertyDescriptor(Dj.prototype,"lineHeight"),Dj.prototype),te(Dj.prototype,"imageAtlas",[Rj,Ij],Object.getOwnPropertyDescriptor(Dj.prototype,"imageAtlas"),Dj.prototype),te(Dj.prototype,"handleTouchEvent",[Pj],Object.getOwnPropertyDescriptor(Dj.prototype,"handleTouchEvent"),Dj.prototype),Nj=te(Dj.prototype,"_lineHeight",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),Mj=te(Dj.prototype,"_string",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}}),Lj=te(Dj.prototype,"_horizontalAlign",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hk.LEFT}}),Bj=te(Dj.prototype,"_fontSize",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),Fj=te(Dj.prototype,"_maxWidth",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zj=te(Dj.prototype,"_fontFamily",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),Uj=te(Dj.prototype,"_font",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hj=te(Dj.prototype,"_isSystemFontUsed",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Gj=te(Dj.prototype,"_userDefinedFont",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kj=te(Dj.prototype,"_cacheMode",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dk.NONE}}),Vj=te(Dj.prototype,"_imageAtlas",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wj=te(Dj.prototype,"_handleTouchEvent",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Oj=Dj))||Oj)||Oj)||Oj)||Oj)||Oj)),iq=function(t){return e({UIMeshRenderer:t,UIModelComponent:t}),t}(S_("cc.UIMeshRenderer")(tq=D_()(tq=T_(110)(tq=R_()(tq=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._models=null,t._modelComponent=null,t}K(t,e);var n=t.prototype;return n.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent?this._models=this._modelComponent._collectModels():console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},n.onEnable=function(){e.prototype.onEnable.call(this)},n.onDisable=function(){e.prototype.onDisable.call(this)},n.onDestroy=function(){e.prototype.onDestroy.call(this),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent&&(this._modelComponent._sceneGetter=null,this._models=null)},n.updateAssembler=function(e){if(this._models){this._modelComponent._detachFromScene();for(var t,n=$(this._models);!(t=n()).done;){var i=t.value;e.commitModel.call(e,this,i,this._modelComponent.material)}return!0}return!1},n.update=function(){this._fitUIRenderQueue()},n._fitUIRenderQueue=function(){if(this._modelComponent)for(var e=this._modelComponent.sharedMaterials.length,t=0;t<e;t++){var n=this._modelComponent.getMaterialInstance(t);if(null!=n)for(var i=n.passes,r=i.length,o=0;o<r;o++){var a=i[o];a._priority=Pu.MAX-11,a.blendState.targets[0].blend||n.overridePipelineStates({blendState:{targets:[{blend:!0}]}},o)}}},X(t,[{key:"modelComponent",get:function(){return this._modelComponent}}]),t}(Xj))||tq)||tq)||tq)||tq),rq=e("MeshBuffer",function(){function e(e){this.vData=null,this.iData=null,this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=1,this._attributes=null,this._vertexBuffers=[],this._indexBuffer=null,this._iaInfo=null,this._batcher=void 0,this._dirty=!1,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=1536,this._outOfCallback=null,this._hInputAssemblers=[],this._nextFreeIAHandle=0,this._batcher=e}var t=e.prototype;return t.initialize=function(e,t){this._outOfCallback=t;var n=oV(e);this._vertexFormatBytes=n*Float32Array.BYTES_PER_ELEMENT,this._initVDataCount=256*this._vertexFormatBytes;var i=Float32Array.BYTES_PER_ELEMENT*n;this.vertexBuffers.length||this.vertexBuffers.push(this._batcher.device.createBuffer(new ps(Ta.VERTEX|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,i,i)));var r=Uint16Array.BYTES_PER_ELEMENT;this.indexBuffer||(this._indexBuffer=this._batcher.device.createBuffer(new ps(Ta.INDEX|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,r,r))),this._attributes=e,this._iaInfo=new Ms(this.attributes,this.vertexBuffers,this.indexBuffer),this._reallocBuffer()},t.request=function(e,t){void 0===e&&(e=4),void 0===t&&(t=6),this.lastByteOffset=this.byteOffset;var n=this.byteOffset+e*this._vertexFormatBytes,i=this.indicesOffset+t;if(e+this.vertexOffset>65535)return this._outOfCallback&&this._outOfCallback.call(this._batcher,e,t),!1;var r=this.vData.byteLength,o=this.iData.length;if(n>r||i>o){for(;r<n||o<i;)this._initVDataCount*=2,this._initIDataCount*=2,r=4*this._initVDataCount,o=this._initIDataCount;this._reallocBuffer()}return this.vertexOffset+=e,this.indicesOffset+=t,this.byteOffset=n,this._dirty=!0,!0},t.reset=function(){this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=0,this._nextFreeIAHandle=0,this._dirty=!1},t.destroy=function(){this._attributes=null,this.vertexBuffers[0].destroy(),this.vertexBuffers.length=0,this.indexBuffer.destroy(),this._indexBuffer=null;for(var e=0;e<this._hInputAssemblers.length;e++)vr.free(this._hInputAssemblers[e]);this._hInputAssemblers.length=0},t.recordBatch=function(){var e=this.indicesOffset-this.indicesStart;if(!e)return 0;this._hInputAssemblers.length<=this._nextFreeIAHandle&&this._hInputAssemblers.push(vr.alloc(this._batcher.device,this._iaInfo));var t=this._hInputAssemblers[this._nextFreeIAHandle++],n=vr.get(t);return n.firstIndex=this.indicesStart,n.indexCount=e,t},t.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var e=new Float32Array(this.vData.buffer,0,this.byteOffset>>2),t=new Uint16Array(this.iData.buffer,0,this.indicesOffset);this.byteOffset>this.vertexBuffers[0].size&&this.vertexBuffers[0].resize(this.byteOffset),this.vertexBuffers[0].update(e),2*this.indicesOffset>this.indexBuffer.size&&this.indexBuffer.resize(2*this.indicesOffset),this.indexBuffer.update(t),this._dirty=!1}},t._reallocBuffer=function(){this._reallocVData(!0),this._reallocIData(!0)},t._reallocVData=function(e){var t;if(this.vData&&(t=new Uint8Array(this.vData.buffer)),this.vData=new Float32Array(this._initVDataCount),t&&e)for(var n=new Uint8Array(this.vData.buffer),i=0,r=t.length;i<r;i++)n[i]=t[i]},t._reallocIData=function(e){var t=this.iData;if(this.iData=new Uint16Array(this._initIDataCount),t&&e)for(var n=this.iData,i=0,r=t.length;i<r;i++)n[i]=t[i]},X(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),e}());rq.OPACITY_OFFSET=8;var oq,aq,sq,cq,lq,uq,hq,_q,fq,dq,pq,mq,gq,vq,yq,Sq,Eq,Tq,xq,Aq,Cq,bq,wq,Rq,Iq=Ru.Enum.NONE|Ru.Enum.UI_3D,Pq=e("UIDrawBatch",function(){function e(){this.bufferBatch=null,this.camera=null,this.renderScene=null,this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._handle=0,this._passes=[],this._handle=Gr.alloc(),Gr.set(this._handle,Br.VIS_FLAGS,Iq),Gr.set(this._handle,Br.INPUT_ASSEMBLER,0),Gr.set(this._handle,Br.DESCRIPTOR_SET,0)}var t=e.prototype;return t.destroy=function(){if(this._handle){for(var e=this.passes.length,t=0;t<e;t++)this.passes[t]._destroyHandle();this._passes=[],Gr.free(this._handle),this._handle=0}},t.clear=function(){this.bufferBatch=null,this.hInputAssembler=0,this.hDescriptorSet=0,this.camera=null,this.texture=null,this.sampler=null,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=Iq},t.fillPasses=function(e,t,n,r,o,a){if(e){var s=e.passes;if(!s)return;Gr.set(this._handle,Br.PASS_COUNT,s.length);for(var c=Br.PASS_0,l=Br.SHADER_0,u=0,h=0;h<s.length;h++,c++,l++){this._passes[h]||(this._passes[h]=new em(i.director.root),this._passes[h]._handle=Dr.alloc());var _=s[h],f=this._passes[h];t||(t=_.depthStencilState,n=0),r||(r=_.blendState,o=0),-1===o&&(o=0),u=n<<16|o,_.update(),f._initPassFromTarget(_,t,r,u),Gr.set(this._handle,c,f.handle),Gr.set(this._handle,l,f.getShaderVariant(a))}}},X(e,[{key:"handle",get:function(){return this._handle}},{key:"hInputAssembler",get:function(){return Gr.get(this._handle,Br.INPUT_ASSEMBLER)},set:function(e){Gr.set(this._handle,Br.INPUT_ASSEMBLER,e)}},{key:"hDescriptorSet",get:function(){return Gr.get(this._handle,Br.DESCRIPTOR_SET)},set:function(e){Gr.set(this._handle,Br.DESCRIPTOR_SET,e)}},{key:"visFlags",get:function(){return Gr.get(this._handle,Br.VIS_FLAGS)},set:function(e){Gr.set(this._handle,Br.VIS_FLAGS,e)}},{key:"passes",get:function(){return this._passes}}]),e}()),Oq=function(t){return e({UIStaticBatch:t,UIStaticBatchComponent:t}),t}((oq=S_("cc.UIStaticBatch"),aq=D_(),sq=R_(),cq=T_(110),lq=M_(),oq(uq=aq(uq=sq(uq=cq((te((hq=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._init=!1,t._meshBuffer=null,t._dirty=!0,t._lastMeshBuffer=null,t._uiDrawBatchList=[],t}K(t,e);var n=t.prototype;return n.onLoad=function(){var e=this._getBatcher();if(e){var t=iV,n=new rq(e);n.initialize(t,this._arrivalMaxBuffer.bind(this)),this._meshBuffer=n}},n.onDestroy=function(){e.prototype.onDestroy.call(this),this._clearData(),this._meshBuffer&&(this._meshBuffer.destroy(),this._meshBuffer=null)},n.updateAssembler=function(e){e.currIsStatic=!0,this._dirty&&(e.finishMergeBatches(),this._lastMeshBuffer=e.currBufferBatch,e.currBufferBatch=this._meshBuffer,e.currStaticRoot=this),this._init&&(e.finishMergeBatches(),e.commitStaticBatch(this))},n.postUpdateAssembler=function(e){this._dirty&&(e.finishMergeBatches(),e.currBufferBatch=this._lastMeshBuffer,e.currStaticRoot=null,this._dirty=!1,this._init=!0,this.node._static=!0,this._meshBuffer.uploadBuffers()),e.currIsStatic=!1},n.markAsDirty=function(){this._getBatcher()&&(this.node._static=!1,this._dirty=!0,this._init=!1,this._clearData())},n._requireDrawBatch=function(){var e=new Pq;return e.isStatic=!0,this._uiDrawBatchList.push(e),e},n._clearData=function(){if(this._meshBuffer){this._meshBuffer.reset();for(var e=this._getBatcher(),t=0;t<this._uiDrawBatchList.length;t++)this._uiDrawBatchList[t].destroy(e)}this._uiDrawBatchList.length=0,this._init=!1},n._getBatcher=function(){return SO.root&&SO.root.batcher2D?SO.root.batcher2D:(A(9301),null)},n._arrivalMaxBuffer=function(){var e=this._getBatcher();e&&e.autoMergeBatches(),A(9300)},X(t,[{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.set(e)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),t}(pk)).prototype,"color",[Z_,lq],Object.getOwnPropertyDescriptor(hq.prototype,"color"),hq.prototype),uq=hq))||uq)||uq)||uq)||uq)),Dq=e("LabelShadow",(_q=S_("cc.LabelShadow"),fq=D_(),dq=T_(110),pq=R_(),mq=E_(yk),gq=B_(),vq=B_(),yq=B_(),_q(Sq=fq(Sq=dq(Sq=pq(Sq=mq(Sq=w_((Cq=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_color",Tq,Q(t)),ee(t,"_offset",xq,Q(t)),ee(t,"_blur",Aq,Q(t)),t}K(t,e);var n=t.prototype;return n.onEnable=function(){this._updateRenderData()},n.onDisable=function(){this._updateRenderData()},n._updateRenderData=function(){var e=this.node.getComponent(yk);e&&e.updateRenderData(!0)},X(t,[{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&(this._color.set(e),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(e){this._offset=e,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(e){this._blur=e,this._updateRenderData()}}]),t}(Xd),Tq=te((Eq=Cq).prototype,"_color",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn(0,0,0,255)}}),xq=te(Eq.prototype,"_offset",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn(2,2)}}),Aq=te(Eq.prototype,"_blur",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),te(Eq.prototype,"color",[gq],Object.getOwnPropertyDescriptor(Eq.prototype,"color"),Eq.prototype),te(Eq.prototype,"offset",[vq],Object.getOwnPropertyDescriptor(Eq.prototype,"offset"),Eq.prototype),te(Eq.prototype,"blur",[yq],Object.getOwnPropertyDescriptor(Eq.prototype,"blur"),Eq.prototype),Sq=Eq))||Sq)||Sq)||Sq)||Sq)||Sq)||Sq)),Nq=function(t){return e({UIOpacity:t,UIOpacityComponent:t}),t}(S_("cc.UIOpacity")(bq=D_()(bq=T_(110)(bq=R_()(bq=w_((te((wq=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_opacity",Rq,Q(t)),t}K(t,e);var n=t.prototype;return n.onEnable=function(){this.node._uiProps.localOpacity=this._opacity/255},n.onDisable=function(){this.node._uiProps.localOpacity=1},X(t,[{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity!==e&&(e=dt(e,0,255),this._opacity=e,this.node._uiProps.localOpacity=e/255)}}]),t}(Xd)).prototype,"opacity",[N_],Object.getOwnPropertyDescriptor(wq.prototype,"opacity"),wq.prototype),Rq=te(wq.prototype,"_opacity",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),bq=wq))||bq)||bq)||bq)||bq)||bq);i.MaskComponent=GV,Ke.setClassAlias(GV,"cc.MaskComponent"),i.LabelComponent=yk,Ke.setClassAlias(yk,"cc.LabelComponent"),i.LabelOutlineComponent=qW,Ke.setClassAlias(qW,"cc.LabelOutlineComponent"),i.RichTextComponent=nq,Ke.setClassAlias(nq,"cc.RichTextComponent"),i.SpriteComponent=sj,Ke.setClassAlias(sj,"cc.SpriteComponent"),i.UIModelComponent=iq,Ke.setClassAlias(iq,"cc.UIModelComponent"),i.GraphicsComponent=BV,Ke.setClassAlias(BV,"cc.GraphicsComponent"),Ke.setClassAlias(Oq,"cc.UIStaticBatchComponent"),Ke.setClassAlias(Nq,"cc.UIOpacityComponent");var Mq=function(e,t,n){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=e,this.x=t,this.y=n};function Lq(e,t,n,i,r){var o=0,a=null;if(r===function(e,t,n,i){for(var r=0,o=t,a=n-i;o<n;o+=i)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}(e,t,n,i)>0)for(o=t;o<n;o+=i)a=$q(o,e[o],e[o+1],a);else for(o=n-i;o>=t;o-=i)a=$q(o,e[o],e[o+1],a);return a&&Kq(a,a.next)&&(eX(a),a=a.next),a}function Bq(e,t){if(void 0===t&&(t=null),!e)return e;t||(t=e);var n=e,i=!1;do{if(i=!1,n.steiner||!Kq(n,n.next)&&0!==Yq(n.prev,n,n.next))n=n.next;else{if(eX(n),(n=t=n.prev)===n.next)return null;i=!0}}while(i||n!==t);return t}function Fq(e,t,n,i,r,o,a){if(void 0===a&&(a=0),e){!a&&o&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=Wq(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t=0,n=null,i=null,r=null,o=null,a=0,s=0,c=0,l=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,i=n,s=0,t=0;t<l&&(s++,i=i.nextZ);t++);for(c=l;s>0||c>0&&i;)0===s?(r=i,i=i.nextZ,c--):0!==c&&i?n.z<=i.z?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,c--):(r=n,n=n.nextZ,s--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,l*=2}while(a>1)}(r)}(e,i,r,o);for(var s=e,c=null,l=null;e.prev!==e.next;)if(c=e.prev,l=e.next,o?Uq(e,i,r,o):zq(e))t.push(c.i/n),t.push(e.i/n),t.push(l.i/n),eX(e),e=l.next,s=l.next;else if((e=l)===s){a?1===a?Fq(e=Hq(e,t,n),t,n,i,r,o,2):2===a&&Gq(e,t,n,i,r,o):Fq(Bq(e),t,n,i,r,o,1);break}}}function zq(e){var t=e.prev,n=e,i=e.next;if(Yq(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(qq(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Yq(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Uq(e,t,n,i){var r=e.prev,o=e,a=e.next;if(Yq(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,c=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,l=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,u=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=Wq(s,c,t,n,i),_=Wq(l,u,t,n,i),f=e.nextZ;f&&f.z<=_;){if(f!==e.prev&&f!==e.next&&qq(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Yq(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=e.prevZ;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&qq(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Yq(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function Hq(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!Kq(r,o)&&Zq(r,i,i.next,o)&&Qq(r,o)&&Qq(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),eX(i),eX(i.next),i=e=o),i=i.next}while(i!==e);return i}function Gq(e,t,n,i,r,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Xq(a,s)){var c=Jq(a,s);return a=Bq(a,a.next),c=Bq(c,c.next),Fq(a,t,n,i,r,o),void Fq(c,t,n,i,r,o)}s=s.next}a=a.next}while(a!==e)}function kq(e,t){return e.x-t.x}function Vq(e,t){if(t=function(e,t){var n=t,i=e.x,r=e.y,o=-1/0,a=null;do{if(r<=n.y&&r>=n.next.y){var s=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(r===n.y)return n;if(r===n.next.y)return n.next}a=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!a)return null;if(i===o)return a.prev;var c,l=a,u=a.x,h=a.y,_=1/0;for(n=a.next;n!==l;)i>=n.x&&n.x>=u&&qq(r<h?i:o,r,u,h,r<h?o:i,r,n.x,n.y)&&((c=Math.abs(r-n.y)/(i-n.x))<_||c===_&&n.x>a.x)&&Qq(n,e)&&(a=n,_=c),n=n.next;return a}(e,t)){var n=Jq(t,e);Bq(n,n.next)}}function Wq(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function jq(e){var t=e,n=e;do{t.x<n.x&&(n=t),t=t.next}while(t!==e);return n}function qq(e,t,n,i,r,o,a,s){return(r-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(i-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function Xq(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Zq(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&Qq(e,t)&&Qq(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)}function Yq(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Kq(e,t){return e.x===t.x&&e.y===t.y}function Zq(e,t,n,i){return!!(Kq(e,t)&&Kq(n,i)||Kq(e,i)&&Kq(n,t))||Yq(e,t,n)>0!=Yq(e,t,i)>0&&Yq(n,i,e)>0!=Yq(n,i,t)>0}function Qq(e,t){return Yq(e.prev,e,e.next)<0?Yq(e,t,e.next)>=0&&Yq(e,e.prev,t)>=0:Yq(e,t,e.prev)<0||Yq(e,e.next,t)<0}function Jq(e,t){var n=new Mq(e.i,e.x,e.y),i=new Mq(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function $q(e,t,n,i){var r=new Mq(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function eX(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function tX(e,t,n){n=n||3;var i=t?t.length:0,r=i?t[0]*n:e.length,o=Lq(e,0,r,n,!0),a=[];if(!o)return a;var s=0,c=0,l=0,u=0,h=0,_=0,f=0;if(i&&(o=function(e,t,n,i){var r,o=[],a=0,s=null;for(a=0,r=t.length;a<r;a++)(s=Lq(e,t[a]*i,a<r-1?t[a+1]*i:e.length,i,!1))&&(s===s.next&&(s.steiner=!0),o.push(jq(s)));if(o.sort(kq),!n)return n;for(a=0;a<o.length;a++)Vq(o[a],n),n=Bq(n,n.next);return n}(e,t,o,n)),e.length>80*n){s=l=e[0],c=u=e[1];for(var d=n;d<r;d+=n)(h=e[d])<s&&(s=h),(_=e[d+1])<c&&(c=_),h>l&&(l=h),_>u&&(u=_);f=Math.max(l-s,u-c)}return Fq(o,a,n,s,c,f),a}for(var nX=Math.PI,iX=Math.min,rX=Math.max,oX=Math.ceil,aX=Math.acos,sX=Math.cos,cX=Math.sin,lX=Math.atan2,uX=null,hX=null,_X=new gn,fX=[],dX=0;dX<4;dX++)fX.push(new yn);function pX(e,t,n){return e<t?t:e>n?n:e}var mX={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(e,t){if(!hX)return null;var n=hX.getRenderDataList(),i=n[hX.dataOffset];if(!i)return null;var r=i,o=r?r.vertexStart+t:0;return(o>65535||3*o>131070)&&(++hX.dataOffset,hX.dataOffset<n.length?i=n[hX.dataOffset]:(i=hX.requestRenderData(),n[hX.dataOffset]=i),r=i),r&&r.vertexCount<o&&r.request(t,3*t),i},stroke:function(e){gn.copy(_X,e.strokeColor),e.impl&&(this._flattenPaths(e.impl),this._expandStroke(e),e.impl.updatePathOffset=!0,this.end(e))},fill:function(e){gn.copy(_X,e.fillColor),this._expandFill(e),e.impl&&(e.impl.updatePathOffset=!0),this.end(e)},end:function(e){e.markForUpdateRenderData()},_expandStroke:function(e){var t,n,i,r,o=.5*e.lineWidth,a=e.lineCap,s=e.lineJoin,c=e.miterLimit;if(hX=e.impl){var l=(t=o,n=nX,i=hX.tessTol,r=2*aX(t/(t+i)),rX(2,oX(n/r)));this._calculateJoins(hX,o,s,c);for(var u=hX.paths,h=0,_=hX.pathOffset,f=hX.pathLength;_<f;_++){var d=u[_],p=d.points.length;s===gk.ROUND?h+=2*(p+d.bevel*(l+2)+1):h+=2*(p+5*d.bevel+1),d.closed||(a===mk.ROUND?h+=2*(2*l+2):h+=12)}var m=uX=this.getRenderData(e,h);if(m){for(var g=m.vData,v=m.iData,y=hX.pathOffset,S=hX.pathLength;y<S;y++){var E=u[y],T=E.points,x=T.length,A=m.vertexStart,C=void 0,b=void 0,w=0,R=0,I=E.closed;if(I?(C=T[x-1],b=T[0],w=0,R=x):(C=T[0],b=T[1],w=1,R=x-1),b=b||C,!I){var P=new Jk(b.x,b.y);P.subtract(C),P.normalize();var O=P.x,D=P.y;a===mk.BUTT?this._buttCapStart(C,O,D,o,0):a===mk.SQUARE?this._buttCapStart(C,O,D,o,o):a===mk.ROUND&&this._roundCapStart(C,O,D,o,l)}for(var N=w;N<R;++N)s===gk.ROUND?this._roundJoin(C,b,o,o,l):0!=(b.flags&(vk.PT_BEVEL|vk.PT_INNERBEVEL))?this._bevelJoin(C,b,o,o):(this._vSet(b.x+b.dmx*o,b.y+b.dmy*o,1),this._vSet(b.x-b.dmx*o,b.y-b.dmy*o,-1)),C=b,b=T[N+1];if(I){var M=8*A;this._vSet(g[M],g[M+1],1),this._vSet(g[M+8],g[M+8+1],-1)}else{var L=new Jk(b.x,b.y);L.subtract(C),L.normalize();var B=L.x,F=L.y;a===mk.BUTT?this._buttCapEnd(b,B,F,o,0):a===mk.SQUARE?this._buttCapEnd(b,B,F,o,o):a===mk.ROUND&&this._roundCapEnd(b,B,F,o,l)}for(var z=m.indicesStart,U=A+2,H=m.vertexStart;U<H;U++)v[z++]=U-2,v[z++]=U-1,v[z++]=U;m.indicesStart=z}uX=null,hX=null}}},_expandFill:function(e){if(hX=e.impl){for(var t=hX.paths,n=0,i=hX.pathOffset,r=hX.pathLength;i<r;i++)n+=t[i].points.length;var o=uX=this.getRenderData(e,n);if(o){for(var a=o,s=a.vData,c=a.iData,l=hX.pathOffset,u=hX.pathLength;l<u;l++){var h=t[l],_=h.points,f=_.length;if(0!==f){for(var d=o.vertexStart,p=0;p<f;++p)this._vSet(_[p].x,_[p].y);var m=o.indicesStart;if(h.complex){for(var g=[],v=d,y=o.vertexStart;v<y;v++){var S=8*v;g.push(s[S++]),g.push(s[S++]),g.push(s[S++])}var E=tX(g,null,3);if(!E||0===E.length)continue;for(var T=0,x=E.length;T<x;T++)c[m++]=E[T]+d}else for(var A=d,C=d+2,b=a.vertexStart;C<b;C++)c[m++]=A,c[m++]=C-1,c[m++]=C;a.indicesStart=m}}uX=null,hX=null}}},_calculateJoins:function(e,t,n,i){var r=0;t>0&&(r=1/t);for(var o=e.paths,a=e.pathOffset,s=e.pathLength;a<s;a++){var c=o[a],l=c.points,u=l.length,h=l[u-1],_=l[0];c.bevel=0;for(var f=0;f<u;f++){var d,p,m=h.dy,g=-h.dx,v=_.dy,y=-_.dx;if(_.dmx=.5*(m+v),_.dmy=.5*(g+y),(d=_.dmx*_.dmx+_.dmy*_.dmy)>1e-6){var S=1/d;S>600&&(S=600),_.dmx*=S,_.dmy*=S}_.dx*h.dy-h.dx*_.dy>0&&(_.flags|=vk.PT_LEFT),d*(p=rX(11,iX(h.len,_.len)*r))*p<1&&(_.flags|=vk.PT_INNERBEVEL),_.flags&vk.PT_CORNER&&(d*i*i<1||n===gk.BEVEL||n===gk.ROUND)&&(_.flags|=vk.PT_BEVEL),0!=(_.flags&(vk.PT_BEVEL|vk.PT_INNERBEVEL))&&c.bevel++,h=_,_=l[f+1]}}},_flattenPaths:function(e){for(var t=e.paths,n=e.pathOffset,i=e.pathLength;n<i;n++){var r=t[n],o=r.points,a=o[o.length-1],s=o[0];o.length>2&&a.equals(s)&&(r.closed=!0,o.pop(),a=o[o.length-1]);for(var c=0,l=o.length;c<l;c++){var u=new Jk(s.x,s.y);u.subtract(a),a.len=u.length(),(u.x||u.y)&&u.normalize(),a.dx=u.x,a.dy=u.y,a=s,s=o[c+1]}}},_chooseBevel:function(e,t,n,i){var r=n.x,o=n.y,a=0,s=0,c=0,l=0;return 0!==e?(a=r+t.dy*i,s=o-t.dx*i,c=r+n.dy*i,l=o-n.dx*i):(a=c=r+n.dmx*i,s=l=o+n.dmy*i),[a,s,c,l]},_buttCapStart:function(e,t,n,i,r){var o=e.x-t*r,a=e.y-n*r,s=n,c=-t;this._vSet(o+s*i,a+c*i,1),this._vSet(o-s*i,a-c*i,-1)},_buttCapEnd:function(e,t,n,i,r){var o=e.x+t*r,a=e.y+n*r,s=n,c=-t;this._vSet(o+s*i,a+c*i,1),this._vSet(o-s*i,a-c*i,-1)},_roundCapStart:function(e,t,n,i,r){for(var o=e.x,a=e.y,s=n,c=-t,l=0;l<r;l++){var u=l/(r-1)*nX,h=sX(u)*i,_=cX(u)*i;this._vSet(o-s*h-t*_,a-c*h-n*_,1),this._vSet(o,a,0)}this._vSet(o+s*i,a+c*i,1),this._vSet(o-s*i,a-c*i,-1)},_roundCapEnd:function(e,t,n,i,r){var o=e.x,a=e.y,s=n,c=-t;this._vSet(o+s*i,a+c*i,1),this._vSet(o-s*i,a-c*i,-1);for(var l=0;l<r;l++){var u=l/(r-1)*nX,h=sX(u)*i,_=cX(u)*i;this._vSet(o,a,0),this._vSet(o-s*h+t*_,a-c*h+n*_,1)}},_roundJoin:function(e,t,n,i,r){var o=e.dy,a=-e.dx,s=t.dy,c=-t.dx,l=t.x,u=t.y;if(0!=(t.flags&vk.PT_LEFT)){var h=this._chooseBevel(t.flags&vk.PT_INNERBEVEL,e,t,n),_=h[0],f=h[1],d=h[2],p=h[3],m=lX(-a,-o),g=lX(-c,-s);g>m&&(g-=2*nX),this._vSet(_,f,1),this._vSet(l-o*i,t.y-a*i,-1);for(var v=pX(oX((m-g)/nX)*r,2,r),y=0;y<v;y++){var S=m+y/(v-1)*(g-m),E=l+sX(S)*i,T=u+cX(S)*i;this._vSet(l,u,0),this._vSet(E,T,-1)}this._vSet(d,p,1),this._vSet(l-s*i,u-c*i,-1)}else{var x=this._chooseBevel(t.flags&vk.PT_INNERBEVEL,e,t,-i),A=x[0],C=x[1],b=x[2],w=x[3],R=lX(a,o),I=lX(c,s);I<R&&(I+=2*nX),this._vSet(l+o*i,u+a*i,1),this._vSet(A,C,-1);for(var P=pX(oX((I-R)/nX)*r,2,r),O=0;O<P;O++){var D=R+O/(P-1)*(I-R),N=l+sX(D)*n,M=u+cX(D)*n;this._vSet(N,M,1),this._vSet(l,u,0)}this._vSet(l+s*i,u+c*i,1),this._vSet(b,w,-1)}},_bevelJoin:function(e,t,n,i){var r=0,o=0,a=0,s=0,c=0,l=0,u=0,h=0,_=e.dy,f=-e.dx,d=t.dy,p=-t.dx;if(t.flags&vk.PT_LEFT){var m=this._chooseBevel(t.flags&vk.PT_INNERBEVEL,e,t,n);c=m[0],l=m[1],u=m[2],h=m[3],this._vSet(c,l,1),this._vSet(t.x-_*i,t.y-f*i,-1),this._vSet(u,h,1),this._vSet(t.x-d*i,t.y-p*i,-1)}else{var g=this._chooseBevel(t.flags&vk.PT_INNERBEVEL,e,t,-i);r=g[0],o=g[1],a=g[2],s=g[3],this._vSet(t.x+_*n,t.y+f*n,1),this._vSet(r,o,-1),this._vSet(t.x+d*n,t.y+p*n,1),this._vSet(a,s,-1)}},_vSet:function(e,t,n){if(void 0===n&&(n=0),uX){var i=uX,r=8*i.vertexStart,o=i.vData;o[r++]=e,o[r++]=t,o[r++]=0,gn.toArray(o,_X,r),r+=4,o[r++]=n,i.vertexStart++}}},gX=e("graphicsAssembler",{getAssembler:function(){return mX}});BV.Assembler=gX;var vX=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},yX=new Xn,SX=null,EX=null,TX=[],xX=[],AX=[],CX=[],bX=new jn,wX=new jn,RX=new zn,IX=null,PX=0,OX=0,DX=0,NX=0,MX=0,LX=1,BX=null,FX="",zX=0,UX=0,HX=0,GX=0,kX=0,VX=0,WX=0,jX=!1,qX=0,XX=0,YX=0,KX={updateRenderData:function(e){e.renderData&&e.renderData.vertDirty&&SX!==e&&(EX=(SX=e).node._uiProps.uiTransformComp,this._updateFontFamily(e),this._updateProperties(e),this._updateLabelInfo(e),this._updateContent(),SX.actualFontSize=zX,EX.setContentSize(wX),SX.renderData.vertDirty=SX.renderData.uvDirty=!1,SX.markForUpdateRenderData(!1),SX=null,this._resetProperties())},_updateFontScale:function(){LX=zX/UX},_updateFontFamily:function(e){var t=e.font;BX=t.spriteFrame,IX=t.fntConfig,AH.fontAtlas=t.fontDefDictionary,_U.packToDynamicAtlas(e,BX)},_updateLabelInfo:function(){AH.hash="",AH.margin=0},_updateProperties:function(e){FX=e.string.toString(),zX=e.fontSize,UX=IX?IX.fontSize:e.fontSize,HX=e.horizontalAlign,GX=e.verticalAlign,kX=e.spacingX,WX=e.overflow,VX=e._lineHeight;var t=EX.contentSize;wX.width=t.width,wX.height=t.height,WX===fk.NONE?(jX=!1,wX.width+=2*AH.margin,wX.height+=2*AH.margin):WX===fk.RESIZE_HEIGHT?(jX=!0,wX.height+=2*AH.margin):jX=e.enableWrapText,AH.lineHeight=VX,AH.fontSize=zX,this._setupBMFontOverflowMetrics()},_resetProperties:function(){IX=null,BX=null,AH.hash="",AH.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var e=FX,t=e.length,n=IX.kerningDict,i=TX,r=-1,o=0;o<t;++o){var a=e.charCodeAt(o),s=n[r<<16|65535&a]||0;i[o]=o<t-1?s:0,r=a}},_multilineTextWrap:function(e){for(var t=FX.length,n=0,i=0,r=0,o=0,a=0,s=0,c=0,l=null,u=0;u<t;){var h=FX.charAt(u);if("\n"!==h){for(var _=e(FX,u,t),f=s,d=c,p=a,m=i,g=!1,v=0;v<_;++v){var y=u+v;if("\r"!==(h=FX.charAt(y)))if(l=AH.fontAtlas.getLetterDefinitionForChar(h,AH)){var S=m+l.offsetX*LX-AH.margin;if(jX&&YX>0&&i>0&&S+l.w*LX>YX&&!JU(h)){AX.push(a),a=0,n++,i=0,r-=VX*this._getFontScale()+0,g=!0;break}RX.x=S,RX.y=r-l.offsetY*LX,this._recordLetterInfo(RX,h,y,n),y+1<TX.length&&y<t-1&&(m+=TX[y+1]),m+=l.xAdvance*LX+kX,p=RX.x+l.w*LX,f<RX.y&&(f=RX.y),d>RX.y-l.h*LX&&(d=RX.y-l.h*LX)}else this._recordPlaceholderInfo(y,h),console.log("Can't find letter definition in texture atlas "+IX.atlasName+" for letter:"+h);else this._recordPlaceholderInfo(y,h)}g||(i=m,s<f&&(s=f),c>d&&(c=d),o<(a=p)&&(o=a),u+=_)}else AX.push(a),a=0,n++,i=0,r-=VX*this._getFontScale()+0,this._recordPlaceholderInfo(u,h),u++}return AX.push(a),OX=(PX=n+1)*VX*this._getFontScale(),PX>1&&(OX+=0*(PX-1)),wX.width=qX,wX.height=XX,qX<=0&&(wX.width=parseFloat(o.toFixed(2))+2*AH.margin),XX<=0&&(wX.height=parseFloat(OX.toFixed(2))+2*AH.margin),NX=wX.height,MX=0,s>0&&(NX=wX.height+s),c<-OX&&(MX=OX+c),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return WX===fk.SHRINK?LX:1},_getFirstWordLen:function(e,t,n){var i=e.charAt(t);if(QU(i)||"\n"===i||JU(i))return 1;var r=1,o=AH.fontAtlas.getLetterDefinitionForChar(i,AH);if(!o)return r;for(var a=o.xAdvance*LX+kX,s=t+1;s<n&&(i=e.charAt(s),o=AH.fontAtlas.getLetterDefinitionForChar(i,AH));++s){if(a+o.offsetX*LX+o.w*LX>YX&&!JU(i)&&YX>0)return r;if(a+=o.xAdvance*LX+kX,"\n"===i||JU(i)||QU(i))break;r++}return r},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(e,t){if(e>=xX.length){var n=new vX;xX.push(n)}xX[e].char=t,xX[e].hash=t.charCodeAt(0)+AH.hash,xX[e].valid=!1},_recordLetterInfo:function(e,t,n,i){if(n>=xX.length){var r=new vX;xX.push(r)}var o=t.charCodeAt(0)+AH.hash;xX[n].line=i,xX[n].char=t,xX[n].hash=o,xX[n].valid=AH.fontAtlas.getLetter(o).valid,xX[n].x=e.x,xX[n].y=e.y},_alignText:function(){OX=0,AX.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),WX===fk.SHRINK&&zX>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||WX===fk.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(e){var t=!0;e||(e=.1,t=!1),zX=e,t&&this._updateContent()},_shrinkLabelToContentSize:function(e){for(var t=0,n=0|zX,i=0;t<n;){var r=i=t+n+1>>1;if(r<=0)break;LX=r/UX,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),e()?n=i-1:t=i}t>=0&&this._scaleFontSizeDown(t)},_isVerticalClamp:function(){return OX>wX.height},_isHorizontalClamp:function(){for(var e=!1,t=0,n=FX.length;t<n;++t){var i=xX[t];if(i.valid){var r=AH.fontAtlas.getLetterDefinitionForChar(i.char,AH);if(!r)continue;var o=i.x+r.w/2*LX,a=i.line;if(qX>0)if(jX){if(AX[a]>wX.width&&(o>wX.width||o<0)){e=!0;break}}else if(o>wX.width){e=!0;break}}}return e},_isHorizontalClamped:function(e,t){var n=AX[t],i=e>wX.width||e<0;return jX?n>wX.width&&i:i},_updateQuads:function(){if(!SX)return!1;var e=BX?BX.texture:AH.fontAtlas.getTexture(),t=SX.renderData;t.dataLength=t.vertexCount=t.indicesCount=0;for(var n=EX.anchorPoint,i=wX,r=n.x*i.width,o=n.y*i.height,a=!0,s=0,c=FX.length;s<c;++s){var l=xX[s];if(l.valid){var u=AH.fontAtlas.getLetter(l.hash);if(u){yX.height=u.h,yX.width=u.w,yX.x=u.u,yX.y=u.v;var h=l.y+DX;if(XX>0){if(h>NX){var _=h-NX;yX.y+=_,yX.height-=_,h-=_}h-u.h*LX<MX&&WX===fk.CLAMP&&(yX.height=h<MX?0:(h-MX)/LX)}var f=l.line,d=l.x+u.w/2*LX+CX[f];if(qX>0&&this._isHorizontalClamped(d,f))if(WX===fk.CLAMP)yX.width=0;else if(WX===fk.SHRINK){if(wX.width>u.w){a=!1;break}yX.width=0}if(yX.height>0&&yX.width>0){var p=this._determineRect(),m=l.x+CX[l.line];this.appendQuad(SX,e,yX,p,m-r,h-o,LX)}}else console.warn("Can't find letter in this bitmap-font")}}return a},appendQuad:function(){},_determineRect:function(){var e=BX.isRotated(),t=BX.getOriginalSize(),n=BX.getRect(),i=BX.getOffset(),r=i.x+(t.width-n.width)/2,o=i.y-(t.height-n.height)/2;if(e){var a=yX.x;yX.x=n.x+n.height-yX.y-yX.height-o,yX.y=a+n.y-r,yX.y<0&&(yX.height+=o)}else yX.x+=n.x-r,yX.y+=n.y+o;return e},_computeAlignmentOffset:function(){switch(CX.length=0,HX){case hk.LEFT:for(var e=0;e<PX;++e)CX.push(0);break;case hk.CENTER:for(var t=0,n=AX.length;t<n;t++)CX.push((wX.width-AX[t])/2);break;case hk.RIGHT:for(var i=0,r=AX.length;i<r;i++)CX.push(wX.width-AX[i])}if(DX=wX.height,GX!==_k.TOP){var o=wX.height-OX+VX*this._getFontScale()-UX*LX;GX===_k.BOTTOM?DX-=o:DX-=o/2}},_setupBMFontOverflowMetrics:function(){var e=wX.width,t=wX.height;WX===fk.RESIZE_HEIGHT&&(t=0),WX===fk.NONE&&(e=0,t=0),qX=e,XX=t,bX.width=e,bX.height=t,YX=e}},ZX=new gn(255,255,255,255),QX={createData:function(e){return e.requestRenderData()},fillBuffers:function(e,t){var n=e.node;e._setCacheAlpha(n._uiProps.opacity),ZX.set(e.color),ZX.a=255*n._uiProps.opacity,sU(n,t,e.renderData,ZX)},appendQuad:function(e,t,n,i,r,o,a){var s=e.renderData;if(s){var c=s.dataLength;s.dataLength+=4,s.vertexCount=s.dataLength,s.indicesCount=s.dataLength/2*3;var l=s.data,u=t.width,h=t.height,_=n.width,f=n.height,d=0,p=0,m=0,g=0;i?(d=n.x/u,g=(n.x+f)/u,p=(n.y+_)/h,m=n.y/h,l[c].u=d,l[c].v=m,l[c+1].u=d,l[c+1].v=p,l[c+2].u=g,l[c+2].v=m,l[c+3].u=g,l[c+3].v=p):(d=n.x/u,g=(n.x+_)/u,p=(n.y+f)/h,m=n.y/h,l[c].u=d,l[c].v=p,l[c+1].u=g,l[c+1].v=p,l[c+2].u=d,l[c+2].v=m,l[c+3].u=g,l[c+3].v=m),l[c].x=r,l[c].y=o-f*a,l[c+1].x=r+_*a,l[c+1].y=o-f*a,l[c+2].x=r,l[c+2].y=o,l[c+3].x=r+_*a,l[c+3].y=o}}};Pe(QX,KX);var JX=null,$X=Oe(KX,{getAssemblerData:function(){return JX||(JX=new xH(1024,1024)),JX.getTexture()},_updateFontFamily:function(e){AH.fontAtlas=JX,AH.fontFamily=this._getFontFamily(e);var t=e.getComponent(qW);t&&t.enabled?(AH.isOutlined=!0,AH.margin=t.width,AH.out=t.color.clone(),AH.out.a=t.color.a*e.color.a/255):(AH.isOutlined=!1,AH.margin=0)},_getFontFamily:function(e){var t="Arial";return e.useSystemFont?t=e.fontFamily||"Arial":e.font&&(e.font._nativeAsset?t=e.font._nativeAsset:SD.postLoadNative(e.font,(function(){e.isValid&&(t=e.font._nativeAsset||"Arial",e.updateRenderData(!0))}))),t},_updateLabelInfo:function(e){AH.fontDesc=this._getFontDesc(),AH.color=e.color,AH.hash=function(e){var t=e.color.toHEX(),n="";return e.isOutlined&&e.margin>0&&(n=n+e.margin+e.out.toHEX()),""+e.fontSize+e.fontFamily+t+n}(AH)},_getFontDesc:function(){return AH.fontSize.toString()+"px "+AH.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),eY=new gn(255,255,255,255),tY={createData:function(e){return e.requestRenderData()},fillBuffers:function(e,t){if(e.renderData){var n=e.node;e._setCacheAlpha(n._uiProps.opacity),eY.a=255*n._uiProps.opacity,sU(n,t,e.renderData,eY)}},appendQuad:QX.appendQuad};Pe(tY,$X);var nY=yk.Overflow,iY=(1/255).toFixed(3),rY=null,oY=null,aY=null,sY="",cY="",lY=0,uY=0,hY=[],_Y=new jn,fY=0,dY=0,pY=0,mY=new gn,gY=1,vY="",yY=nY.NONE,SY=!1,EY=null,TY=gn.BLACK.clone(),xY=null,AY=gn.BLACK.clone(),CY=new Xn,bY=jn.ZERO.clone(),wY=jn.ZERO.clone(),RY=zn.ZERO.clone(),IY=zn.ZERO.clone(),PY=0,OY=0,DY=!1,NY=!1,MY=!1,LY=["left","center","right"],BY={getAssemblerData:function(){return yk._canvasPool.get()},resetAssemblerData:function(e){e&&yk._canvasPool.put(e)},updateRenderData:function(e){if(e.renderData&&e.renderData.vertDirty){var t=e.node._uiProps.uiTransformComp;this._updateFontFamily(e),this._updateProperties(e,t),this._calculateLabelFont(),this._updateLabelDimensions(),this._resetDynamicAtlas(e),this._updateTexture(e),this.updateOpacity(e),e._setCacheAlpha(gY),this._calDynamicAtlas(e),e.actualFontSize=lY,t.setContentSize(_Y),this.updateVertexData(e),this.updateUvs(e),e.markForUpdateRenderData(!1),rY=null,oY=null,aY=null}},updateVertexData:function(){},updateUvs:function(){},updateOpacity:function(e){for(var t=e.renderData.vData,n=5,i=e.node._uiProps.opacity,r=0;r<4;r++)t[n+3]=i,n+=9},_updateFontFamily:function(e){e.useSystemFont?vY=e.fontFamily||"Arial":e.font?e.font._nativeAsset?vY=e.font._nativeAsset:(SD.postLoadNative(e.font,(function(){e.isValid&&(vY=e.font._nativeAsset||"Arial",e.updateRenderData(!0))})),vY="Arial"):vY="Arial"},_updateProperties:function(e,t){var n=e.assemblerData;n&&(rY=n.context,oY=n.canvas,aY=e.spriteFrame,cY=e.string.toString(),lY=e.fontSize,uY=lY,yY=e.overflow,wY.width=_Y.width=t.width,wY.height=_Y.height=t.height,OY=e.underlineHeight,fY=e.lineHeight,dY=e.horizontalAlign,pY=e.verticalAlign,mY=e.color,gY=e.node._uiProps.opacity,DY=e.isBold,NY=e.isItalic,MY=e.isUnderline,SY=yY!==nY.NONE&&(yY===nY.RESIZE_HEIGHT||e.enableWrapText),(EY=(EY=qW&&e.getComponent(qW))&&EY.enabled&&EY.width>0?EY:null)&&TY.set(EY.color),(xY=(xY=Dq&&e.getComponent(Dq))&&xY.enabled?xY:null)&&AY.set(xY.color),this._updatePaddingRect())},_updatePaddingRect:function(){var e=0,t=0,n=0,i=0,r=0;if(bY.width=bY.height=0,EY&&(e=t=n=i=r=EY.width,bY.width=bY.height=2*r),xY){var o=xY.blur+r,a=xY.offset.x,s=xY.offset.y;n=Math.max(n,-a+o),i=Math.max(i,a+o),e=Math.max(e,s+o),t=Math.max(t,-s+o)}if(NY){var c=uY*Math.tan(.20943951);i+=c,bY.width+=c}CY.x=n,CY.y=e,CY.width=n+i,CY.height=e+t},_calculateFillTextStartPosition:function(){var e=0;dY===hk.RIGHT?e=_Y.width-CY.width:dY===hk.CENTER&&(e=(_Y.width-CY.width)/2);var t=this._getLineHeight()*(hY.length-1),n=lY*(1-GU/2);if(pY!==_k.TOP){var i=t+CY.height+lY-_Y.height;pY===_k.BOTTOM?n-=i+=GU/2*lY:n-=i/2}n+=0*lY,RY.set(e+CY.x,n+CY.y)},_updateTexture:function(e){if(rY&&oY){rY.clearRect(0,0,oY.width,oY.height),rY.font=sY,this._calculateFillTextStartPosition();var t=this._getLineHeight();rY.lineJoin="round",e._srcBlendFactor===Ma.SRC_ALPHA&&(rY.fillStyle="rgba("+mY.r+", "+mY.g+", "+mY.b+", "+iY+")",rY.fillRect(0,0,oY.width,oY.height)),rY.fillStyle="rgb("+mY.r+", "+mY.g+", "+mY.b+")";var n,r=RY.x,o=0;this._drawTextEffect(RY,t);for(var a=0;a<hY.length;++a)o=RY.y+a*t,EY&&rY.strokeText(hY[a],r,o),rY.fillText(hY[a],r,o);xY&&(rY.shadowColor="transparent"),aY&&(n=aY instanceof vU?aY.texture:aY,0!==oY.width&&0!==oY.height&&(n.reset({width:oY.width,height:oY.height,mipmapLevel:1}),n.uploadData(oY),aY instanceof vU&&(aY.rect=new Xn(0,0,oY.width,oY.height),aY._calculateUV()),i.director.root&&i.director.root.batcher2D&&i.director.root.batcher2D._releaseDescriptorSetCache(n.getHash())))}},_resetDynamicAtlas:function(e){if(e.cacheMode===yk.CacheMode.BITMAP){var t=e.ttfSpriteFrame;_U.deleteAtlasSpriteFrame(t),t._resetDynamicAtlasFrame()}},_calDynamicAtlas:function(e){if(e.cacheMode===yk.CacheMode.BITMAP){var t=e.ttfSpriteFrame;_U.packToDynamicAtlas(e,t),e.renderData.uvDirty=!0}},_setupOutline:function(){rY.strokeStyle="rgba("+TY.r+", "+TY.g+", "+TY.b+", "+TY.a/255+")",rY.lineWidth=2*EY.width},_setupShadow:function(){rY.shadowColor="rgba("+AY.r+", "+AY.g+", "+AY.b+", "+AY.a/255+")",rY.shadowBlur=xY.blur,rY.shadowOffsetX=xY.offset.x,rY.shadowOffsetY=-xY.offset.y},_drawTextEffect:function(e,t){if(xY||EY||MY){var n=hY.length>1&&xY,i=this._measureText(rY,sY),r=0,o=0;xY&&this._setupShadow(),EY&&this._setupOutline();for(var a=0;a<hY.length;++a)r=e.x,o=e.y+a*t,n&&(EY&&rY.strokeText(hY[a],r,o),rY.fillText(hY[a],r,o)),MY&&(PY=i(hY[a]),dY===hk.RIGHT?IY.x=e.x-PY:dY===hk.CENTER?IY.x=e.x-PY/2:IY.x=e.x,IY.y=o+uY/8,rY.fillRect(IY.x,IY.y,PY,OY));n&&(rY.shadowColor="transparent")}},_updateLabelDimensions:function(){_Y.width=Math.min(_Y.width,2048),_Y.height=Math.min(_Y.height,2048);var e=!1;oY.width!==_Y.width&&(oY.width=_Y.width,e=!0),oY.height!==_Y.height&&(oY.height=_Y.height,e=!0),e&&(rY.font=sY),rY.textAlign=LY[dY],rY.textBaseline="alphabetic"},_getFontDesc:function(){var e=lY.toString()+"px ";return e+=vY,DY&&(e="bold "+e),NY&&(e="italic "+e),e},_getLineHeight:function(){return 0|(0===fY?lY:fY*lY/uY)},_calculateParagraphLength:function(e,t){for(var n,i=[],r=$(e);!(n=r()).done;){var o=$U(t,n.value,sY);i.push(o)}return i},_measureText:function(e,t){return function(n){return $U(e,n,t)}},_calculateShrinkFont:function(e){if(rY){var t=this._calculateParagraphLength(e,rY),n=0,i=0,r=0;if(SY){var o=wY.width,a=wY.height;if(o<0||a<0)return;i=a+1;for(var s=0,c=0|lY+1,l=0;s<c;){if((l=s+c+1>>1)<=0){T(4003);break}lY=l,sY=this._getFontDesc(),rY.font=sY;var u=this._getLineHeight();for(i=0,n=0;n<e.length;++n){var h=$U(rY,e[n],sY);i+=tH(e[n],h,o,this._measureText(rY,sY)).length*u}i>a?c=l-1:s=l}0===s?T(4003):(lY=s,sY=this._getFontDesc(),rY.font=sY)}else{for(i=e.length*this._getLineHeight(),n=0;n<e.length;++n)r<t[n]&&(r=t[n]);var _=(_Y.width-CY.width)/r,f=_Y.height/i;lY=uY*Math.min(1,_,f)|0,sY=this._getFontDesc(),rY.font=sY}}},_calculateWrapText:function(e){if(SY&&rY){hY=[];for(var t=wY.width,n=0;n<e.length;++n){var i=$U(rY,e[n],sY),r=tH(e[n],i,t,this._measureText(rY,sY));hY=hY.concat(r)}}},_calculateLabelFont:function(){if(rY){var e=cY.split("\n");switch(hY=e,sY=this._getFontDesc(),rY.font=sY,yY){case nY.NONE:for(var t=0,n=0,i=0;i<e.length;++i){var r=$U(rY,e[i],sY);t=t>r?t:r}n=(hY.length+GU)*this._getLineHeight();var o=parseFloat(t.toFixed(2)),a=parseFloat(n.toFixed(2));_Y.width=o+CY.width,_Y.height=a+CY.height,wY.width=o+bY.width,wY.height=a+bY.height;break;case nY.SHRINK:this._calculateShrinkFont(e),this._calculateWrapText(e);break;case nY.CLAMP:this._calculateWrapText(e);break;case nY.RESIZE_HEIGHT:this._calculateWrapText(e);var s=(hY.length+GU)*this._getLineHeight();_Y.height=s+CY.height,wY.height=s+bY.height}}}},FY=gn.WHITE.clone(),zY={createData:function(e){var t=e.requestRenderData();t.dataLength=4,t.vertexCount=4,t.indicesCount=6;var n=t.vData=new Float32Array(36);n[3]=n[21]=n[22]=n[31]=0,n[4]=n[12]=n[13]=n[30]=1;for(var i=5,r=0;r<4;r++)gn.toArray(n,FY,i),i+=9;return t},fillBuffers:function(e,t){var n=e.renderData,i=n.data,r=e.node,o=t.acquireBufferBatch(),a=o.byteOffset>>2,s=o.indicesOffset,c=o.vertexOffset;o.request()||(o=t.currBufferBatch,s=0,c=0,a=0);var l=o.vData,u=o.iData,h=n.vData,_=i[0],f=i[3];r.updateWorldTransform();var d=r._pos,p=r._rot,m=r._scale,g=_.x*m.x,v=f.x*m.x,y=_.y*m.y,S=f.y*m.y,E=p.x,T=p.y,x=p.z,A=p.w,C=E*T,b=x*A,w=E*E-T*T,R=A*A-x*x,I=R+w,P=2*(C-b),O=R-w,D=2*(C+b),N=d.x,M=d.y;h[0]=I*g+P*y+N,h[1]=O*y+D*g+M,h[9]=I*v+P*y+N,h[10]=O*y+D*v+M,h[18]=I*g+P*S+N,h[19]=O*S+D*g+M,h[27]=I*v+P*S+N,h[28]=O*S+D*v+M,l.set(h,a),u[s++]=c,u[s++]=c+1,u[s++]=c+2,u[s++]=c+2,u[s++]=c+1,u[s++]=c+3},updateVertexData:function(e){var t=e.renderData;if(t){var n=e.node._uiProps.uiTransformComp,i=n.width,r=n.height,o=n.anchorX*i,a=n.anchorY*r,s=t.data;s[0].x=-o,s[0].y=-a,s[3].x=i-o,s[3].y=r-a}},updateUvs:function(e){var t=e.renderData;if(t){var n=t.vData;if(n&&t.uvDirty){var i=e.ttfSpriteFrame.uv;n[3]=i[0],n[4]=i[1],n[12]=i[2],n[13]=i[3],n[21]=i[4],n[22]=i[5],n[30]=i[6],n[31]=i[7],t.uvDirty=!1}}}};Pe(zY,BY);var UY=e("labelAssembler",{getAssembler:function(e){var t=zY;return e.font instanceof UU?t=QX:e.cacheMode===yk.CacheMode.CHAR&&(t=tY),t}});yk.Assembler=UY;var HY=sj.FillType,GY=new Mn,kY=new gn(255,255,255,255),VY={useModel:!1,updateRenderData:function(e){var t=e.spriteFrame;_U.packToDynamicAtlas(e,t);var n=e.renderData;if(n&&t){var i=n.uvDirty,r=n.vertDirty;if(!i&&!r)return;var o=e.fillStart,a=e.fillRange;a<0&&(o+=a,a=-a),a=(a=(a=o+a)>1?1:a)<0?0:a;var s=(o=(o=o>1?1:o)<0?0:o)+(a=(a-=o)<0?0:a);s=s>1?1:s,i&&this.updateUVs(e,o,s),r&&(this.updateVertexData&&this.updateVertexData(e,o,s),this.updateWorldVertexData(e))}},updateUVs:function(e,t,n){var i=e.spriteFrame,r=e.renderData,o=r.data,a=i.width,s=i.height,c=i.getRect(),l=0,u=0,h=0,_=0,f=0,d=0,p=0,m=0,g=0,v=0;switch(i.isRotated()?(l=c.x/a,u=(c.y+c.width)/s,h=f=l,p=g=(c.x+c.height)/a,d=v=u,_=m=c.y/s):(l=c.x/a,u=(c.y+c.height)/s,h=p=l,f=g=(c.x+c.width)/a,_=d=u,m=v=c.y/s),e.fillType){case HY.HORIZONTAL:o[0].u=h+(f-h)*t,o[0].v=_+(d-_)*t,o[1].u=h+(f-h)*n,o[1].v=_+(d-_)*n,o[2].u=p+(g-p)*t,o[2].v=m+(v-m)*t,o[3].u=p+(g-p)*n,o[3].v=m+(v-m)*n;break;case HY.VERTICAL:o[0].u=h+(p-h)*t,o[0].v=_+(m-_)*t,o[1].u=f+(g-f)*t,o[1].v=d+(v-d)*t,o[2].u=h+(p-h)*n,o[2].v=_+(m-_)*n,o[3].u=f+(g-f)*n,o[3].v=d+(v-d)*n;break;default:b(2626)}r.uvDirty=!1},updateVertexData:function(e,t,n){var i=e.renderData,r=i.data,o=e.node._uiProps.uiTransformComp,a=o.width,s=o.height,c=o.anchorX*a,l=o.anchorY*s,u=-c,h=-l,_=a-c,f=s-l,d=0;switch(e.fillType){case HY.HORIZONTAL:d=u+(_-u)*n,u+=(_-u)*t,_=d;break;case HY.VERTICAL:d=h+(f-h)*n,h+=(f-h)*t,f=d;break;default:b(2626)}r[4].x=u,r[4].y=h,r[5].x=_,r[5].y=h,r[6].x=u,r[6].y=f,r[7].x=_,r[7].y=f,i.vertDirty=!1},createData:function(e){var t=e.requestRenderData();t.dataLength=8,t.vertexCount=4,t.indicesCount=6;for(var n,i=$(t.data);!(n=i()).done;)n.value.z=0;return t},updateWorldVertexData:function(e){var t=e.node,n=e.renderData.data;t.getWorldMatrix(GY);for(var i=0;i<4;i++){var r=n[i+4],o=n[i];yn.transformMat4(o,r,GY)}},fillBuffers:function(e,t){e.node.hasChangedFlags&&this.updateWorldVertexData(e);var n=e.node;kY.set(e.color),kY.a=255*n._uiProps.opacity,function(e,t,n,i){var r=n.data,o=t.acquireBufferBatch(),a=o.byteOffset>>2,s=n.vertexCount,c=o.indicesOffset,l=o.vertexOffset;o.request(s,n.indicesCount)||(o=t.currBufferBatch,s=0,c=0,l=0);for(var u=o.vData,h=0;h<s;h++){var _=r[h];u[a++]=_.x,u[a++]=_.y,u[a++]=_.z,u[a++]=_.u,u[a++]=_.v,gn.toArray(u,i,a),a+=4}var f=o.iData;f[c++]=l,f[c++]=l+1,f[c++]=l+2,f[c++]=l+1,f[c++]=l+3,f[c++]=l+2}(0,t,e.renderData,kY)},updateColor:function(){}},WY=2*Math.PI,jY=1e-6,qY=new gn(255,255,255,255),XY=[new zn,new zn,new zn,new zn],YY=new Array(4),KY=new Array(8),ZY=[new zn,new zn,new zn,new zn],QY=[new zn,new zn,new zn,new zn],JY=new zn,$Y=[new zn,new zn,new zn,new zn];function eK(e,t,n,i,r,o,a){var s=Math.sin(o);s=Math.abs(s)>jY?s:0;var c=Math.cos(o),l=0,u=0;if(0!==(c=Math.abs(c)>jY?c:0)){if(l=s/c,(e-r.x)*c>0){var h=r.y+l*(e-r.x);a[0].x=e,a[0].y=h}if((t-r.x)*c>0){var _=r.y+l*(t-r.x);a[2].x=t,a[2].y=_}}if(0!==s){if(u=c/s,(i-r.y)*s>0){var f=r.x+u*(i-r.y);a[3].x=f,a[3].y=i}if((n-r.y)*s>0){var d=r.x+u*(n-r.y);a[1].x=d,a[1].y=n}}}function tK(e,t){var n=t.x-e.x,i=t.y-e.y;if(0===n&&0===i)return 0;if(0===n)return i>0?.5*Math.PI:1.5*Math.PI;var r=Math.atan(i/n);return n<0&&(r+=Math.PI),r}function nK(e,t,n,i,r){var o=YY,a=o[0],s=o[1],c=o[2],l=o[3];e[t].x=n.x,e[t].y=n.y,e[t+1].x=i.x,e[t+1].y=i.y,e[t+2].x=r.x,e[t+2].y=r.y,iK((n.x-a)/(c-a),(n.y-s)/(l-s),e,t),iK((i.x-a)/(c-a),(i.y-s)/(l-s),e,t+1),iK((r.x-a)/(c-a),(r.y-s)/(l-s),e,t+2)}function iK(e,t,n,i){var r=KY,o=r[0]+(r[2]-r[0])*e,a=r[4]+(r[6]-r[4])*e,s=r[1]+(r[3]-r[1])*e,c=r[5]+(r[7]-r[5])*e,l=n[i];l.u=o+(a-o)*t,l.v=s+(c-s)*t}for(var rK={useModel:!1,createData:function(e){return e.requestRenderData()},updateRenderData:function(e){var t=e.spriteFrame;_U.packToDynamicAtlas(e,t);var n=e.renderData;if(n&&t&&(n.vertDirty||n.uvDirty)){var i=n.data,r=e.fillStart,o=e.fillRange;for(o<0&&(r+=o,o=-o);r>=1;)r-=1;for(;r<0;)r+=1;var a=(r*=WY)+(o*=WY);!function(e){var t=e.node._uiProps.uiTransformComp,n=t.width,i=t.height,r=t.anchorX*n,o=t.anchorY*i,a=-r,s=-o,c=n-r,l=i-o,u=YY;u[0]=a,u[1]=s,u[2]=c,u[3]=l;var h=e.fillCenter,_=JY.x=Math.min(Math.max(0,h.x),1)*(c-a)+a,f=JY.y=Math.min(Math.max(0,h.y),1)*(l-s)+s;XY[0].x=XY[3].x=a,XY[1].x=XY[2].x=c,XY[0].y=XY[1].y=s,XY[2].y=XY[3].y=l;for(var d,p=$($Y);!(d=p()).done;){var m=d.value;zn.set(m,0,0)}_!==u[0]&&zn.set($Y[0],3,0),_!==u[2]&&zn.set($Y[2],1,2),f!==u[1]&&zn.set($Y[1],0,1),f!==u[3]&&zn.set($Y[3],2,3)}(e),function(e){var t=e.width,n=e.height,i=e.getRect(),r=0,o=0,a=0,s=0,c=KY;e.isRotated()?(r=i.x/t,o=(i.x+i.height)/t,a=i.y/n,s=(i.y+i.width)/n,c[0]=c[2]=r,c[4]=c[6]=o,c[3]=c[7]=s,c[1]=c[5]=a):(r=i.x/t,o=(i.x+i.width)/t,a=i.y/n,s=(i.y+i.height)/n,c[0]=c[4]=r,c[2]=c[6]=o,c[1]=c[3]=s,c[5]=c[7]=a)}(t),eK(YY[0],YY[2],YY[1],YY[3],JY,r,ZY),eK(YY[0],YY[2],YY[1],YY[3],JY,r+o,QY);for(var s=0,c=0;c<4;++c){var l=$Y[c];if(l)if(o>=WY)n.dataLength=s+3,nK(i,s,JY,XY[l.x],XY[l.y]),s+=3;else{var u=tK(JY,XY[l.x]),h=tK(JY,XY[l.y]);h<u&&(h+=WY),u-=WY,h-=WY;for(var _=0;_<3;++_)u>=a||(u>=r?(n.dataLength=s+3,nK(i,s,JY,XY[l.x],h>=a?QY[c]:XY[l.y]),s+=3):h>r&&(h<=a?(n.dataLength=s+3,nK(i,s,JY,ZY[c],XY[l.y]),s+=3):(n.dataLength=s+3,nK(i,s,JY,ZY[c],QY[c]),s+=3))),u+=WY,h+=WY}}n.indicesCount=n.vertexCount=s,n.vertDirty=n.uvDirty=!1}},fillBuffers:function(e,t){var n=e.node,i=e.renderData;qY.set(e.color),qY.a=255*n._uiProps.opacity,function(e,t,n,i){var r=n.data,o=t.acquireBufferBatch(),a=o.byteOffset>>2,s=n.vertexCount,c=o.indicesOffset,l=o.vertexOffset;o.request(s,n.indicesCount)||(o=t.currBufferBatch,s=0,c=0,l=0);var u=o.vData;e.getWorldMatrix(aU);for(var h=0;h<s;h++){var _=r[h];yn.set(oU,_.x,_.y,0),yn.transformMat4(oU,oU,aU),u[a++]=oU.x,u[a++]=oU.y,u[a++]=oU.z,u[a++]=_.u,u[a++]=_.v,gn.toArray(u,i,a),a+=4}for(var f=o.iData,d=0;d<n.dataLength;d++)f[c+d]=l+d}(n,t,i,qY)},updateColor:function(){}},oK=[],aK=0;aK<4;aK++)oK.push(new yn);for(var sK={createData:function(e){var t=e.requestRenderData();return t.dataLength=4,t.vertexCount=4,t.indicesCount=6,t.vData=new Float32Array(36),t},updateRenderData:function(e){var t=e.spriteFrame;_U.packToDynamicAtlas(e,t);var n=e.renderData;n&&t&&(n.vertDirty&&this.updateVertexData(e),n.uvDirty&&this.updateUvs(e))},fillBuffers:function(e,t){if(null!==e){var n=e.renderData.data,i=e.node,r=t.acquireBufferBatch(),o=r.byteOffset>>2,a=r.indicesOffset,s=r.vertexOffset;r.request()||(r=t.currBufferBatch,o=0,a=0,s=0);var c=r.vData,l=r.iData,u=e.renderData.vData,h=n[0],_=n[3],f=i.worldMatrix,d=f.m00,p=f.m01,m=f.m04,g=f.m05,v=f.m12,y=f.m13,S=h.x,E=_.x,T=h.y,x=_.y,A=d*S,C=d*E,b=p*S,w=p*E,R=m*T,I=m*x,P=g*T,O=g*x;u[0]=A+R+v,u[1]=b+P+y,u[9]=C+R+v,u[10]=w+P+y,u[18]=A+I+v,u[19]=b+O+y,u[27]=C+I+v,u[28]=w+O+y,c.set(u,o),l[a++]=s,l[a++]=s+1,l[a++]=s+2,l[a++]=s+2,l[a++]=s+1,l[a++]=s+3}},updateVertexData:function(e){var t=e.renderData;if(t){var n=e.node._uiProps.uiTransformComp,i=t.data,r=n.width,o=n.height,a=n.anchorX*r,s=n.anchorY*o,c=0,l=0,u=0,h=0;if(e.trim)c=-a,l=-s,u=r-a,h=o-s;else{var _=e.spriteFrame,f=_.getOriginalSize(),d=_.getRect(),p=f.width,m=f.height,g=d.width,v=d.height,y=_.getOffset(),S=r/p,E=o/m,T=y.x+(p-g)/2,x=y.x-(p-g)/2;c=T*S-a,l=(y.y+(m-v)/2)*E-s,u=r+x*S-a,h=o+(y.y-(m-v)/2)*E-s}i[0].x=c,i[0].y=l,i[0].z=0,i[3].x=u,i[3].y=h,i[3].z=0,t.vertDirty=!1}},updateUvs:function(e){var t=e.renderData,n=t.vData,i=e.spriteFrame.uv;n[3]=i[0],n[4]=i[1],n[12]=i[2],n[13]=i[3],n[21]=i[4],n[22]=i[5],n[30]=i[6],n[31]=i[7],t.uvDirty=!1},updateColor:function(e){for(var t=e.renderData.vData,n=5,i=e.color,r=i.r/255,o=i.g/255,a=i.b/255,s=e.node._uiProps.opacity,c=0;c<4;c++)t[n]=r,t[n+1]=o,t[n+2]=a,t[n+3]=s,n+=9}},cK=new yn,lK=new Mn,uK={useModel:!1,createData:function(e){var t=e.requestRenderData();return t.dataLength=20,t.vertexCount=16,t.indicesCount=54,t},updateRenderData:function(e){var t=e.spriteFrame;_U.packToDynamicAtlas(e,t);var n=e.renderData;n&&t&&n.vertDirty&&(this.updateVertexData(e),this.updateWorldVertexData(e))},updateVertexData:function(e){var t=e.renderData,n=t.data,i=e.node._uiProps.uiTransformComp,r=i.width,o=i.height,a=i.anchorX*r,s=i.anchorY*o,c=e.spriteFrame,l=c.insetLeft,u=c.insetRight,h=c.insetTop,_=c.insetBottom,f=r-l-u,d=o-h-_,p=r/(l+u),m=o/(h+_);p=Number.isNaN(p)||p>1?1:p,m=Number.isNaN(m)||m>1?1:m,f=f<0?0:f,d=d<0?0:d,n[0].x=-a,n[0].y=-s,n[1].x=l*p-a,n[1].y=_*m-s,n[2].x=n[1].x+f,n[2].y=n[1].y+d,n[3].x=r-a,n[3].y=o-s,t.vertDirty=!1},fillBuffers:function(e,t){e.node.hasChangedFlags&&this.updateWorldVertexData(e);var n=t.acquireBufferBatch(),i=e.renderData,r=i.data,o=n.byteOffset>>2,a=i.vertexCount,s=n.indicesOffset,c=n.vertexOffset,l=e.spriteFrame.uvSliced;n.request(a,i.indicesCount)||(n=t.currBufferBatch,o=0,s=0,c=0);for(var u=n.vData,h=n.iData,_=4;_<20;++_){var f=r[_],d=l[_-4];u[o++]=f.x,u[o++]=f.y,u[o++]=f.z,u[o++]=d.u,u[o++]=d.v,gn.toArray(u,r[_].color,o),o+=4}for(var p=0;p<3;++p)for(var m=0;m<3;++m){var g=c+4*p+m;h[s++]=g,h[s++]=g+1,h[s++]=g+4,h[s++]=g+1,h[s++]=g+5,h[s++]=g+4}},updateWorldVertexData:function(e){var t=e.node,n=e.renderData.data;t.getWorldMatrix(lK);for(var i=0;i<4;++i)for(var r=n[i],o=0;o<4;++o){var a=n[o],s=n[4+4*i+o];yn.set(cK,a.x,r.y,0),yn.transformMat4(s,cK,lK)}},updateColor:function(e){for(var t=e.renderData.data,n=e.color,i=n.r,r=n.g,o=n.b,a=255*e.node._uiProps.opacity,s=4;s<20;s++)t[s].color.r=i,t[s].color.g=r,t[s].color.b=o,t[s].color.a=a}},hK=[],_K=0;_K<4;_K++)hK.push(new yn);var fK={createData:function(e){return e.requestRenderData()},updateRenderData:function(e){var t=e.renderData,n=e.spriteFrame;if(n&&t&&(t.uvDirty||t.vertDirty)){var i=e.node._uiProps.uiTransformComp,r=Math.abs(i.width),o=Math.abs(i.height),a=n.getRect(),s=n.insetLeft,c=n.insetRight,l=a.width-s-c,u=n.insetTop,h=n.insetBottom,_=a.height-u-h,f=r-s-c,d=o-u-h;f=f>0?f:0,d=d>0?d:0;var p=0===l?f:f/l,m=0===_?d:d/_,g=Math.ceil(m+2),v=Math.ceil(p+2);t.dataLength=Math.max(8,g+1,v+1),this.updateVerts(e,f,d,g,v),t.vertexCount=g*v*4,t.indicesCount=g*v*6,t.uvDirty=!1,t.vertDirty=!1,this.updateColor(e)}},fillBuffers:function(e,t){var n=e.node,i=e.node._uiProps.uiTransformComp,r=Math.abs(i.width),o=Math.abs(i.height),a=e.renderData,s=t.acquireBufferBatch(),c=s.indicesOffset,l=s.byteOffset>>2,u=s.vertexOffset,h=a.vertexCount,_=a.indicesCount,f=s.vData,d=s.iData;s.request(h,_)||(s=t.currBufferBatch,l=0,c=0,u=0);var p=e.spriteFrame,m=p.isRotated(),g=p.uv,v=e.spriteFrame.uvSliced,y=p.getRect(),S=p.insetLeft,E=p.insetRight,T=y.width-S-E,x=p.insetTop,A=p.insetBottom,C=y.height-x-A,b=r-S-E,w=o-x-A;b=b>0?b:0,w=w>0?w:0;var R=0===T?b:b/T,I=0===C?w:w/C,P=Math.ceil(I+2),O=Math.ceil(R+2),D=n.worldMatrix,N=a.data;this.fillVertices(f,l,D,P,O,N);for(var M=0,L=0,B=[],F=[],z=0,U=P;z<U;++z){L=w>C?w>=z*C?1:I%1:I;for(var H=0,G=O;H<G;++H){M=b>T?b>=H*T?1:R%1:R;var k=l+3,V=k+1;m?(0===z?(B[0]=v[0].u,B[1]=v[0].u,B[2]=v[4].u+(v[8].u-v[4].u)*L):z<P-1?(B[0]=v[4].u,B[1]=v[4].u,B[2]=v[4].u+(v[8].u-v[4].u)*L):z===P-1&&(B[0]=v[8].u,B[1]=v[8].u,B[2]=v[12].u),0===H?(F[0]=v[0].v,F[1]=v[1].v+(v[2].v-v[1].v)*M,F[2]=v[0].v):H<O-1?(F[0]=v[1].v,F[1]=v[1].v+(v[2].v-v[1].v)*M,F[2]=v[1].v):H===O-1&&(F[0]=v[2].v,F[1]=v[3].v,F[2]=v[2].v),B[3]=B[2],F[3]=F[1]):(0===H?(B[0]=v[0].u,B[1]=v[1].u+(v[2].u-v[1].u)*M,B[2]=g[0]):H<O-1?(B[0]=v[1].u,B[1]=v[1].u+(v[2].u-v[1].u)*M,B[2]=v[1].u):H===O-1&&(B[0]=v[2].u,B[1]=v[3].u,B[2]=v[2].u),0===z?(F[0]=v[0].v,F[1]=v[0].v,F[2]=v[4].v+(v[8].v-v[4].v)*L):z<P-1?(F[0]=v[4].v,F[1]=v[4].v,F[2]=v[4].v+(v[8].v-v[4].v)*L):z===P-1&&(F[0]=v[8].v,F[1]=v[8].v,F[2]=v[12].v),B[3]=B[1],F[3]=F[2]),f[k]=B[0],f[V]=F[0],f[k+9]=B[1],f[V+9]=F[1],f[k+18]=B[2],f[V+18]=F[2],f[k+27]=B[3],f[V+27]=F[3],gn.toArray(f,N[0].color,V+1),gn.toArray(f,N[0].color,V+9+1),gn.toArray(f,N[0].color,V+18+1),gn.toArray(f,N[0].color,V+27+1),l+=36}}for(var W=0;W<_;W+=6)d[c++]=u,d[c++]=u+1,d[c++]=u+2,d[c++]=u+1,d[c++]=u+3,d[c++]=u+2,u+=4},fillVertices:function(e,t,n,i,r,o){for(var a=0,s=0,c=0,l=0,u=0,h=i;u<h;++u){c=o[u].y,l=o[u+1].y;for(var _=0,f=r;_<f;++_){a=o[_].x,s=o[_+1].x,yn.set(hK[0],a,c,0),yn.set(hK[1],s,c,0),yn.set(hK[2],a,l,0),yn.set(hK[3],s,l,0);for(var d=0;d<4;d++){var p=hK[d];yn.transformMat4(p,p,n);var m=9*d;e[t+m]=p.x,e[t+m+1]=p.y,e[t+m+2]=p.z}t+=36}}},updateVerts:function(e,t,n,i,r){var o,a,s=e.node._uiProps.uiTransformComp,c=e.renderData.data,l=e.spriteFrame,u=l.getRect(),h=Math.abs(s.width),_=Math.abs(s.height),f=s.anchorX*h,d=s.anchorY*_,p=l.insetLeft,m=l.insetRight,g=u.width-p-m,v=l.insetTop,y=l.insetBottom,S=u.height-v-y,E=s.width/(p+m)>1?1:s.width/(p+m),T=s.height/(v+y)>1?1:s.height/(v+y);o=g>0?Math.floor(1e3*t)/1e3%g==0?g:t%g:t,a=S>0?Math.floor(1e3*n)/1e3%S==0?S:n%S:n;for(var x=0;x<=r;x++)0===x?c[x].x=-f:x>0&&x<r?c[x].x=1===x?p*E+Math.min(g,t)-f:g>0?x===r-1?p+o+g*(x-2)-f:p+Math.min(g,t)+g*(x-2)-f:p+t-f:x===r&&(c[x].x=Math.min(p+t+m,h)-f);for(var A=0;A<=i;A++)0===A?c[A].y=-d:A>0&&A<i?c[A].y=1===A?y*T+Math.min(S,n)-d:S>0?A===i-1?y+a+(A-2)*S-d:y+Math.min(S,n)+(A-2)*S-d:y+n-d:A===i&&(c[A].y=Math.min(y+n+v,_)-d)},updateColor:function(e){var t=e.renderData.data,n=t.length;if(0!==n)for(var i=e.color,r=i.r,o=i.g,a=i.b,s=255*e.node._uiProps.opacity,c=0;c<n;c++)t[c].color.r=r,t[c].color.g=o,t[c].color.b=a,t[c].color.a=s}},dK=sj.Type,pK=sj.FillType,mK=e("spriteAssembler",{getAssembler:function(e){var t=sK,n=e;switch(n.type){case dK.SLICED:t=uK;break;case dK.TILED:t=fK;break;case dK.FILLED:t=n.fillType===pK.RADIAL?rK:VY}return t}});sj.Assembler=mK;var gK=rG.sharedManager,vK={createData:function(e){var t=e.requestRenderData();return t.dataLength=4,t.vertexCount=4,t.indicesCount=6,t.vData=new Float32Array(36),t},updateRenderData:function(e){e.type===DV.IMAGE_STENCIL&&(sK.updateRenderData(e),sK.updateColor(e))},fillBuffers:function(e,t){(e.type!==DV.IMAGE_STENCIL||e.spriteFrame)&&(gK.pushMask(e),t.finishMergeBatches(),function(e,t){gK.clear(e),t.commitModel(e,e._clearModel,e._clearStencilMtl)}(e,t),function(e,t){if(gK.enterLevel(e),e.type===DV.IMAGE_STENCIL){sK.fillBuffers(e,t);var n=e.graphics.getMaterialInstance(0);t.forceMergeBatches(n,e.spriteFrame,e.graphics)}else e.graphics.updateAssembler(t)}(e,t),gK.enableMask())}},yK={fillBuffers:function(){gK.exitMask()}},SK={getAssembler:function(){return vK}},EK={getAssembler:function(){return yK}};GV.Assembler=SK,GV.PostAssembler=EK;var TK=new Ws(null),xK=new Mn,AK=e("UI",function(){var e=t.prototype;function t(e){var t=this;this.device=void 0,this._screens=[],this._bufferBatchPool=new Qn((function(){return new rq(t)}),128),this._drawBatchPool=void 0,this._meshBuffers=new Map,this._customMeshBuffers=new Map,this._meshBufferUseCount=new Map,this._batches=void 0,this._doUploadBuffersCall=new Map,this._emptyMaterial=new QS,this._currScene=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currMeshBuffer=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currBlendTargetHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._descriptorSetCache=new bK,this._root=e,this.device=e.device,this._batches=new Jn(64),this._drawBatchPool=new Zn((function(){return new Pq}),128)}return e.acquireBufferBatch=function(e){void 0===e&&(e=iV);var t=e===iV?36:aV(e);return this._currMeshBuffer&&this._currMeshBuffer.vertexFormatBytes===t||this._requireBufferBatch(e),this._currMeshBuffer},e.registerCustomBuffer=function(e,t){var n;e instanceof rq?n=e:(n=this._bufferBatchPool.add()).initialize(e,t||this._recreateMeshBuffer.bind(this,e));var i=n.vertexFormatBytes,r=this._customMeshBuffers.get(i);return r||(r=[],this._customMeshBuffers.set(i,r)),r.push(n),n},e.unRegisterCustomBuffer=function(e){var t=this._customMeshBuffers.get(e.vertexFormatBytes);if(t)for(var n=0;n<t.length;n++)if(t[n]===e){t.splice(n,1);break}},e.initialize=function(){return!0},e.destroy=function(){for(var e=this,t=0;t<this._batches.length;t++)this._batches.array[t]&&this._batches.array[t].destroy(this);this._batches.destroy();for(var n,i=$(this._meshBuffers.keys());!(n=i()).done;){var r=n.value,o=this._meshBuffers.get(r);o&&o.forEach((function(e){return e.destroy()}))}this._drawBatchPool&&this._drawBatchPool.destroy((function(t){t.destroy(e)})),this._descriptorSetCache.destroy(),this._meshBuffers.clear(),rG.sharedManager.destroy()},e.addScreen=function(e){this._screens.push(e),this._screens.sort(this._screenSort)},e.getFirstRenderCamera=function(e){if(e.scene&&e.scene.renderScene)for(var t=e.scene.renderScene.cameras,n=0;n<t.length;n++){var i=t[n];if(i.visibility&e.layer)return i}return null},e.removeScreen=function(e){var t=this._screens.indexOf(e);-1!==t&&this._screens.splice(t,1)},e.sortScreens=function(){this._screens.sort(this._screenSort)},e.addUploadBuffersFunc=function(e,t){this._doUploadBuffersCall.set(e,t)},e.removeUploadBuffersFunc=function(e){this._doUploadBuffersCall.delete(e)},e.update=function(){for(var e=this._screens,t=0;t<e.length;++t){var n=e[t];n.enabledInHierarchy&&this._recursiveScreenNode(n.node)}var i=0;if(this._batches.length)for(var r=0;r<this._batches.length;++r){var o=this._batches.array[r];if(o.renderScene){if(o.model)for(var a=o.model.subModels,s=0;s<a.length;s++)a[s].priority=i++;else o.hDescriptorSet=this._descriptorSetCache.getDescriptorSet(o);o.renderScene.addBatch(o)}}},e.uploadBuffers=function(){var e=this;this._batches.length>0&&(this._doUploadBuffersCall.forEach((function(t,n){t.call(n,e)})),this._meshBuffers.forEach((function(e){e.forEach((function(e){e.uploadBuffers(),e.reset()}))})),this._customMeshBuffers.forEach((function(e){e.forEach((function(e){e.uploadBuffers(),e.reset()}))})),this._descriptorSetCache.update())},e.reset=function(){for(var e=0;e<this._batches.length;++e){var t=this._batches.array[e];t.isStatic||(t.clear(),this._drawBatchPool.free(t))}this._currLayer=0,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._currScene=null,this._currMeshBuffer=null,this._meshBufferUseCount.clear(),this._batches.clear(),rG.sharedManager.reset(),this._descriptorSetCache.reset()},e.commitComp=function(e,t,n,i){var r,o,a=e,s=0,c=0;t?(r=t.getGFXTexture(),o=t.getGFXSampler(),s=t.getHash(),c=t.getSamplerHash()):(r=null,o=null);var l=a._getRenderScene(),u=a.getRenderMaterial(0);a.stencilStage=rG.sharedManager.stage;var h=a.blendHash,_=a.stencilStage;this._currScene===l&&this._currLayer===e.node.layer&&this._currMaterial===u&&this._currBlendTargetHash===h&&this._currDepthStencilStateStage===_&&this._currTextureHash===s&&this._currSamplerHash===c&&this._currTransform===i||(this.autoMergeBatches(this._currComponent),this._currScene=l,this._currComponent=a,this._currTransform=i,this._currMaterial=u,this._currTexture=r,this._currSampler=o,this._currTextureHash=s,this._currSamplerHash=c,this._currBlendTargetHash=h,this._currDepthStencilStateStage=_,this._currLayer=e.node.layer),n&&n.fillBuffers(a,this)},e.commitModel=function(e,t,n){var r;this._currMaterial!==this._emptyMaterial&&this.autoMergeBatches(this._currComponent);var o=0;n&&(e.stencilStage!==mH.ENABLED&&e.stencilStage!==mH.DISABLED||(e.stencilStage=rG.sharedManager.stage),r=rG.sharedManager.getStencilStage(e.stencilStage,n),o=rG.sharedManager.getStencilHash(e.stencilStage));var a=i.director.getTotalFrames();t&&(t.updateTransform(a),t.updateUBOs(a));for(var s=0;s<t.subModels.length;s++){var c=this._drawBatchPool.alloc(),l=t.subModels[s];c.renderScene=e._getRenderScene(),c.visFlags=e.node.layer,c.model=t,c.bufferBatch=null,c.texture=null,c.sampler=null,c.useLocalData=null,r||(r=null),c.fillPasses(n,r,o,null,0,l.patches),c.hDescriptorSet=Lr.get(l.handle,Pr.DESCRIPTOR_SET),c.hInputAssembler=Lr.get(l.handle,Pr.INPUT_ASSEMBLER),c.model.visFlags=c.visFlags,this._batches.push(c)}this._currMaterial=this._emptyMaterial,this._currScene=null,this._currComponent=null,this._currTransform=null,this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},e.commitStaticBatch=function(e){this._batches.concat(e.drawBatchList),this.finishMergeBatches()},e.autoMergeBatches=function(e){var t=this.currBufferBatch,n=null==t?void 0:t.recordBatch(),i=this._currMaterial;if(n&&i&&t){var r,o,a=0,s=0;e&&(r=-1===e.blendHash?null:e.getBlendState(),s=e.blendHash,o=null!==e.customMaterial?rG.sharedManager.getStencilStage(e.stencilStage,i):rG.sharedManager.getStencilStage(e.stencilStage),a=rG.sharedManager.getStencilHash(e.stencilStage));var c=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();c.renderScene=this._currScene,c.visFlags=this._currLayer,c.bufferBatch=t,c.texture=this._currTexture,c.sampler=this._currSampler,c.hInputAssembler=n,c.useLocalData=this._currTransform,c.textureHash=this._currTextureHash,c.samplerHash=this._currSamplerHash,c.fillPasses(i,o,a,r,s,null),this._batches.push(c),t.vertexStart=t.vertexOffset,t.indicesStart=t.indicesOffset,t.byteStart=t.byteOffset,eS.__isWebIOS14OrIPadOS14Env&&!this._currIsStatic&&(this._currMeshBuffer=null)}},e.forceMergeBatches=function(e,t,n){this._currMaterial=e,t?(this._currTexture=t.getGFXTexture(),this._currSampler=t.getGFXSampler(),this._currTextureHash=t.getHash(),this._currSamplerHash=t.getSamplerHash()):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=n.node.layer,this._currScene=n._getRenderScene(),this.autoMergeBatches(n)},e.finishMergeBatches=function(){this.autoMergeBatches(),this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},e.flushMaterial=function(e){this._currMaterial=e},e.walk=function(e,t){void 0===t&&(t=0);var n=e.children.length;if(this._preProcess(e),n>0&&!e._static)for(var i=e.children,r=0;r<i.length;++r){var o=i[r];this.walk(o,t)}this._postProcess(e),t+=1},e._preProcess=function(e){var t=e._uiProps.uiComp;if(!t){var n=e._uiProps.localOpacity;e._uiProps.opacity=e.parent&&e.parent._uiProps?e.parent._uiProps.opacity*n:n}e._uiProps.uiTransformComp&&t&&t.enabledInHierarchy&&t.updateAssembler(this)},e._postProcess=function(e){var t=e._uiProps.uiComp;t&&t.enabledInHierarchy&&t.postUpdateAssembler(this)},e._recursiveScreenNode=function(e){this.walk(e),this.autoMergeBatches(this._currComponent)},e._createMeshBuffer=function(e){var t=this._bufferBatchPool.add();t.initialize(e,this._recreateMeshBuffer.bind(this,e));var n=aV(e),i=this._meshBuffers.get(n);return i||(i=[],this._meshBuffers.set(n,i)),i.push(t),t},e._recreateMeshBuffer=function(e,t,n){this.autoMergeBatches(),this._requireBufferBatch(e,t,n)},e._requireBufferBatch=function(e,t,n){var i=aV(e),r=this._meshBuffers.get(i);r||(r=[],this._meshBuffers.set(i,r));var o=this._meshBufferUseCount.get(i)||0;o>=r.length?this._currMeshBuffer=this._createMeshBuffer(e):this._currMeshBuffer=r[o],this._meshBufferUseCount.set(i,o+1),t&&n&&this._currMeshBuffer.request(t,n)},e._screenSort=function(e,t){return e.node.getSiblingIndex()-t.node.getSiblingIndex()},e._releaseDescriptorSetCache=function(e){this._descriptorSetCache.releaseDescriptorSetCache(e)},X(t,[{key:"currBufferBatch",get:function(){return this._currMeshBuffer||(this._currMeshBuffer=this.acquireBufferBatch()),this._currMeshBuffer},set:function(e){e&&(this._currMeshBuffer=e)}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(e){this._currStaticRoot=e}},{key:"currIsStatic",set:function(e){this._currIsStatic=e}}]),t}()),CK=function(){function e(){this._handle=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var e=i.director.root.device;this._localData=new Float32Array(vh.COUNT),this._localBuffer=e.createBuffer(new ps(Ta.UNIFORM|Ta.TRANSFER_DST,Ca.HOST|Ca.DEVICE,vh.SIZE,vh.SIZE))}var t=e.prototype;return t.initialize=function(e){var t=i.director.root.device;this._transform=e.useLocalData,this._textureHash=e.textureHash,this._samplerHash=e.samplerHash,TK.layout=e.passes[0].localSetLayout,this._handle&&(gr.free(this._handle),this._handle=null),this._handle=gr.alloc(t,TK),this._descriptorSet=gr.get(this._handle),this._descriptorSet.bindBuffer(vh.BINDING,this._localBuffer);var n=zu.SAMPLER_SPRITE;this._descriptorSet.bindTexture(n,e.texture),this._descriptorSet.bindSampler(n,e.sampler),this._descriptorSet.update(),this._transformUpdate=!0},t.updateTransform=function(e){e!==this._transform&&(this._transform=e,this._transformUpdate=!0,this.uploadLocalData())},t.updateLocal=function(){this._transform&&this.uploadLocalData()},t.equals=function(e,t,n){return this._transform===e&&this._textureHash===t&&this._samplerHash===n},t.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},t.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._handle&&(gr.free(this._handle),this._handle=null),this._localData=null},t.uploadLocalData=function(){var e=this._transform;if((e.hasChangedFlags||e._dirtyFlags)&&e.updateWorldTransform(),this._transformUpdate){var t=e._mat;Mn.toArray(this._localData,t,vh.MAT_WORLD_OFFSET),Mn.inverseTranspose(xK,t),Mn.toArray(this._localData,xK,vh.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},X(e,[{key:"handle",get:function(){return this._handle}}]),e}(),bK=function(){function e(){this._descriptorSetCache=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new Zn((function(){return new CK}),16)}var t=e.prototype;return t.getDescriptorSet=function(e){var t=i.director.root;if(e.useLocalData){for(var n=this._localDescriptorSetCache,r=0,o=n.length;r<o;r++){var a=n[r];if(a.equals(e.useLocalData,e.textureHash,e.samplerHash))return a.handle}var s=this._localCachePool.alloc();return s.initialize(e),this._localDescriptorSetCache.push(s),s.handle}var c=this._descriptorSetCache.get(e.textureHash);if(c&&c.has(e.samplerHash))return c.get(e.samplerHash);TK.layout=e.passes[0].localSetLayout;var l=gr.alloc(t.device,TK),u=gr.get(l),h=zu.SAMPLER_SPRITE;return u.bindTexture(h,e.texture),u.bindSampler(h,e.sampler),u.update(),c?this._descriptorSetCache.get(e.textureHash).set(e.samplerHash,l):this._descriptorSetCache.set(e.textureHash,new Map([[e.samplerHash,l]])),l},t.update=function(){this._localDescriptorSetCache.forEach((function(e){e.updateLocal()}))},t.reset=function(){var e=this;this._localDescriptorSetCache.forEach((function(t){e._localCachePool.free(t)})),this._localDescriptorSetCache.length=0},t.releaseDescriptorSetCache=function(e){this._descriptorSetCache.has(e)&&(this._descriptorSetCache.get(e).forEach((function(e){gr.free(e)})),this._descriptorSetCache.delete(e))},t.destroy=function(){this._descriptorSetCache.forEach((function(e){e.forEach((function(e){gr.free(e)}))})),this._descriptorSetCache.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy((function(e){e.destroy()}))},e}();i.internal.Batcher2D=AK;var wK,RK,IK,PK,OK,DK,NK,MK,LK,BK,FK,zK,UK,HK,GK,kK,VK,WK,jK,qK,XK,YK,KK,ZK,QK,JK,$K,eZ,tZ,nZ,iZ,rZ,oZ,aZ,sZ,cZ,lZ,uZ,hZ,_Z,fZ,dZ,pZ,mZ,gZ,vZ,yZ,SZ,EZ,TZ,xZ,AZ=null,CZ=-1,bZ="BES bswy:->@123",wZ=Object.create(null),RZ=[],IZ=3e3;function PZ(){for(var e=!0,t=Date.now(),n=RZ.length-1;n>=0;n--){var i=RZ[n],r=i.fontFamilyName;if(t-i.startTime>IZ)A(4933,r),i.onComplete(null,r),RZ.splice(n,1);else{var o=i.refWidth,a="40px "+r;AZ.font=a,o!==$U(AZ,bZ,a)?(RZ.splice(n,1),i.onComplete(null,r)):e=!1}}e&&(clearInterval(CZ),CZ=-1)}function OZ(e,t,n){var i=function(e){var t=e.lastIndexOf(".ttf");if(-1===t)return e;var n,i=e.lastIndexOf("/");return-1!==(n=-1===i?e.substring(0,t)+"_LABEL":e.substring(i+1,t)+"_LABEL").indexOf(" ")&&(n='"'+n+'"'),n}(e);if(wZ[i])n(null,i);else{if(!AZ){var r=document.createElement("canvas");r.width=100,r.height=100,AZ=r.getContext("2d")}var o=$U(AZ,bZ,"40px "+i),a=document.createElement("style");a.type="text/css";var s="";Number.isNaN(i)?s+="@font-face { font-family:"+i+"; src:":s+='@font-face { font-family:"'+i+'"; src:',s+='url("'+e+'");',a.textContent=s+"}",document.body.appendChild(a);var c=document.createElement("div"),l=c.style;if(l.fontFamily=i,c.innerHTML=".",l.position="absolute",l.left="-100px",l.top="-100px",document.body.appendChild(c),function(){if(void 0===wK)if("FontFace"in window){var e=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),t=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);wK=e?parseInt(e[1],10)>42:!t}else wK=!1;return wK}())!function(e,t,n){var i=new Promise((function(n,i){!function r(){Date.now()-e>=IZ?i():document.fonts.load("40px "+t).then((function(e){e.length>=1?n():setTimeout(r,100)}),(function(){i()}))}()})),r=null,o=new Promise((function(e,t){r=setTimeout(t,IZ)}));Promise.race([o,i]).then((function(){r&&(clearTimeout(r),r=null),n(null,t)}),(function(){A(4933,t),n(null,t)}))}(Date.now(),i,n);else{var u={fontFamilyName:i,refWidth:o,onComplete:n,startTime:Date.now()};RZ.push(u),-1===CZ&&(CZ=setInterval(PZ,100))}wZ[i]=a}}function DZ(e,t,n,i){var r=new LU;r._nativeUrl=e,r._nativeAsset=t,i(null,r)}JO.register({".font":OZ,".eot":OZ,".ttf":OZ,".woff":OZ,".svg":OZ,".ttc":OZ}),oD.register({".font":DZ,".eot":DZ,".ttf":DZ,".woff":DZ,".svg":DZ,".ttc":DZ}),i.UI={MeshBuffer:rq,spriteAssembler:mK,graphicsAssembler:gX,labelAssembler:UY};var NZ,MZ,LZ,BZ=new gn;!function(e){e[e.NONE=0]="NONE",e[e.COLOR=1]="COLOR",e[e.SPRITE=2]="SPRITE",e[e.SCALE=3]="SCALE"}(NZ||(NZ={})),et(NZ),function(e){e.NORMAL="normal",e.HOVER="hover",e.PRESSED="pressed",e.DISABLED="disabled"}(MZ||(MZ={})),function(e){e.CLICK="click"}(LZ||(LZ={}));var FZ,zZ,UZ,HZ=function(t){return e({Button:t,ButtonComponent:t}),t}((RK=S_("cc.Button"),IK=D_(),PK=T_(110),OK=R_(),DK=E_(zH),NK=K_(Vv),MK=k_(),LK=B_(),BK=k_(),FK=B_(),zK=K_(NZ),UK=k_(),HK=B_(),GK=B_(),kK=B_(),VK=B_(),WK=B_(),jK=z_(),qK=U_(),XK=B_(),YK=B_(),KK=K_(vU),ZK=B_(),QK=K_(vU),JK=B_(),$K=K_(vU),eZ=B_(),tZ=K_(vU),nZ=B_(),iZ=K_([iM]),rZ=k_(),oZ=B_(),RK(aZ=IK(aZ=PK(aZ=OK(aZ=DK(aZ=w_((xZ=TZ=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"clickEvents",cZ,Q(t)),ee(t,"_interactable",lZ,Q(t)),ee(t,"_transition",uZ,Q(t)),ee(t,"_normalColor",hZ,Q(t)),ee(t,"_hoverColor",_Z,Q(t)),ee(t,"_pressedColor",fZ,Q(t)),ee(t,"_disabledColor",dZ,Q(t)),ee(t,"_normalSprite",pZ,Q(t)),ee(t,"_hoverSprite",mZ,Q(t)),ee(t,"_pressedSprite",gZ,Q(t)),ee(t,"_disabledSprite",vZ,Q(t)),ee(t,"_duration",yZ,Q(t)),ee(t,"_zoomScale",SZ,Q(t)),ee(t,"_target",EZ,Q(t)),t._pressed=!1,t._hovered=!1,t._fromColor=new gn,t._toColor=new gn,t._time=0,t._transitionFinished=!0,t._fromScale=new yn,t._toScale=new yn,t._originalScale=null,t._sprite=null,t._targetScale=new yn,t}K(t,e);var n=t.prototype;return n.__preload=function(){this.target||(this.target=this.node);var e=this.node.getComponent(sj);e&&(this._normalSprite=e.spriteFrame),this._applyTarget(),this._resetState()},n.onEnable=function(){this._registerNodeEvent()},n.onDisable=function(){this._resetState(),this._unregisterNodeEvent()},n.update=function(e){var t=this.target;if(!this._transitionFinished&&t&&(this._transition===NZ.COLOR||this._transition===NZ.SCALE)){this._time+=e;var n=1;if(this._duration>0&&(n=this._time/this._duration),n>=1&&(n=1),this._transition===NZ.COLOR){var i=t._uiProps.uiComp;gn.lerp(BZ,this._fromColor,this._toColor,n),i&&(i.color=BZ)}else this.transition===NZ.SCALE&&(t.getScale(this._targetScale),this._targetScale.x=en(this._fromScale.x,this._toScale.x,n),this._targetScale.y=en(this._fromScale.y,this._toScale.y,n),t.setScale(this._targetScale));1===n&&(this._transitionFinished=!0)}},n._resizeNodeToTargetNode=function(){this.target&&this.target._uiProps.uiTransformComp},n._resetState=function(){this._pressed=!1,this._hovered=!1;var e=this.target;if(e){var t=e.getComponent(pk);if(t){var n=this._transition;n===NZ.COLOR&&this._interactable?t.color=this._normalColor:n===NZ.SCALE&&this._originalScale&&e.setScale(this._originalScale),this._transitionFinished=!0}}},n._registerNodeEvent=function(){this.node.on(bm.TOUCH_START,this._onTouchBegan,this),this.node.on(bm.TOUCH_MOVE,this._onTouchMove,this),this.node.on(bm.TOUCH_END,this._onTouchEnded,this),this.node.on(bm.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(bm.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(bm.MOUSE_LEAVE,this._onMouseMoveOut,this)},n._registerTargetEvent=function(e){e.on(bm.TRANSFORM_CHANGED,this._onTargetTransformChanged,this)},n._unregisterNodeEvent=function(){this.node.off(bm.TOUCH_START,this._onTouchBegan,this),this.node.off(bm.TOUCH_MOVE,this._onTouchMove,this),this.node.off(bm.TOUCH_END,this._onTouchEnded,this),this.node.off(bm.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(bm.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(bm.MOUSE_LEAVE,this._onMouseMoveOut,this)},n._unregisterTargetEvent=function(e){e.off(bm.TRANSFORM_CHANGED)},n._getTargetSprite=function(e){var t=null;return e&&(t=e.getComponent(sj)),t},n._applyTarget=function(){this.target&&(this._sprite=this._getTargetSprite(this.target),this._originalScale||(this._originalScale=new yn),yn.copy(this._originalScale,this.target.getScale()))},n._onTargetSpriteFrameChanged=function(e){this._transition===NZ.SPRITE&&this._setCurrentStateSpriteFrame(e.spriteFrame)},n._setCurrentStateSpriteFrame=function(e){if(e)switch(this._getButtonState()){case MZ.NORMAL:this._normalSprite=e;break;case MZ.HOVER:this._hoverSprite=e;break;case MZ.PRESSED:this._pressedSprite=e;break;case MZ.DISABLED:this._disabledSprite=e}},n._onTargetColorChanged=function(e){this._transition===NZ.COLOR&&this._setCurrentStateColor(e)},n._setCurrentStateColor=function(e){switch(this._getButtonState()){case MZ.NORMAL:this._normalColor=e;break;case MZ.HOVER:this._hoverColor=e;break;case MZ.PRESSED:this._pressedColor=e;break;case MZ.DISABLED:this._disabledColor=e}},n._onTargetTransformChanged=function(e){e|t_.SCALE&&this._originalScale&&this._transition===NZ.SCALE&&this._transitionFinished&&yn.copy(this._originalScale,this.target.getScale())},n._onTouchBegan=function(e){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),e&&(e.propagationStopped=!0))},n._onTouchMove=function(e){if(this._interactable&&this.enabledInHierarchy&&this._pressed&&e){var t=e.touch;if(t){var n,i=this.node._uiProps.uiTransformComp.isHit(t.getUILocation());this._transition===NZ.SCALE&&this.target&&this._originalScale?i?(yn.copy(this._fromScale,this._originalScale),yn.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._transitionFinished=!1):(this._time=0,this._transitionFinished=!0,this.target.setScale(this._originalScale)):(n=i?MZ.PRESSED:MZ.NORMAL,this._applyTransition(n)),e&&(e.propagationStopped=!0)}}},n._onTouchEnded=function(e){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(iM.emitEvents(this.clickEvents,e),this.node.emit(LZ.CLICK,this)),this._pressed=!1,this._updateState(),e&&(e.propagationStopped=!0))},n._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},n._onMouseMoveIn=function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this._transition!==NZ.SPRITE||this._hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},n._onMouseMoveOut=function(){this._hovered&&(this._hovered=!1,this._updateState())},n._updateState=function(){var e=this._getButtonState();this._applyTransition(e)},n._getButtonState=function(){var e=MZ.NORMAL;return this._interactable?this._pressed?e=MZ.PRESSED:this._hovered&&(e=MZ.HOVER):e=MZ.DISABLED,e.toString()},n._updateColorTransition=function(e){var t,n=this[e+"Color"],i=null===(t=this.target)||void 0===t?void 0:t.getComponent(pk);i&&(e===MZ.DISABLED?i.color=n:(this._fromColor=i.color.clone(),this._toColor=n,this._time=0,this._transitionFinished=!1))},n._updateSpriteTransition=function(e){var t=this[e+"Sprite"];this._sprite&&t&&(this._sprite.spriteFrame=t)},n._updateScaleTransition=function(e){this._interactable&&(e===MZ.PRESSED?this._zoomUp():this._zoomBack())},n._zoomUp=function(){this._originalScale&&(yn.copy(this._fromScale,this._originalScale),yn.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._time=0,this._transitionFinished=!1)},n._zoomBack=function(){this.target&&this._originalScale&&(yn.copy(this._fromScale,this.target.getScale()),yn.copy(this._toScale,this._originalScale),this._time=0,this._transitionFinished=!1)},n._applyTransition=function(e){var t=this._transition;t===NZ.COLOR?this._updateColorTransition(e):t===NZ.SPRITE?this._updateSpriteTransition(e):t===NZ.SCALE&&this._updateScaleTransition(e)},X(t,[{key:"target",get:function(){return this._target||this.node},set:function(e){this._target!==e&&(this._target&&this._unregisterTargetEvent(this._target),this._target=e,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(e){this._interactable=e,this._updateState(),this._interactable||this._resetState()}},{key:"_resizeToTarget",set:function(e){e&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(e){this._transition!==e&&(this._transition===NZ.COLOR?this._updateColorTransition(MZ.NORMAL):this._transition===NZ.SPRITE&&this._updateSpriteTransition(MZ.NORMAL),this._transition=e,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(e){this._normalColor!==e&&(this._normalColor.set(e),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(e){this._pressedColor!==e&&this._pressedColor.set(e)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(e){this._hoverColor!==e&&this._hoverColor.set(e)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(e){this._disabledColor!==e&&(this._disabledColor.set(e),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(e){this._duration!==e&&(this._duration=e)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(e){this._zoomScale!==e&&(this._zoomScale=e)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(e){if(this._normalSprite!==e){this._normalSprite=e;var t=this.node.getComponent(sj);t&&(t.spriteFrame=e),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(e){this._pressedSprite!==e&&(this._pressedSprite=e,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(e){this._hoverSprite!==e&&(this._hoverSprite=e,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(e){this._disabledSprite!==e&&(this._disabledSprite=e,this._updateState())}}]),t}(Xd),TZ.Transition=NZ,TZ.EventType=LZ,te((sZ=xZ).prototype,"target",[NK,MK,LK],Object.getOwnPropertyDescriptor(sZ.prototype,"target"),sZ.prototype),te(sZ.prototype,"interactable",[BK,FK],Object.getOwnPropertyDescriptor(sZ.prototype,"interactable"),sZ.prototype),te(sZ.prototype,"transition",[zK,UK,HK],Object.getOwnPropertyDescriptor(sZ.prototype,"transition"),sZ.prototype),te(sZ.prototype,"normalColor",[GK],Object.getOwnPropertyDescriptor(sZ.prototype,"normalColor"),sZ.prototype),te(sZ.prototype,"pressedColor",[kK],Object.getOwnPropertyDescriptor(sZ.prototype,"pressedColor"),sZ.prototype),te(sZ.prototype,"hoverColor",[VK],Object.getOwnPropertyDescriptor(sZ.prototype,"hoverColor"),sZ.prototype),te(sZ.prototype,"disabledColor",[WK],Object.getOwnPropertyDescriptor(sZ.prototype,"disabledColor"),sZ.prototype),te(sZ.prototype,"duration",[jK,qK,XK],Object.getOwnPropertyDescriptor(sZ.prototype,"duration"),sZ.prototype),te(sZ.prototype,"zoomScale",[YK],Object.getOwnPropertyDescriptor(sZ.prototype,"zoomScale"),sZ.prototype),te(sZ.prototype,"normalSprite",[KK,ZK],Object.getOwnPropertyDescriptor(sZ.prototype,"normalSprite"),sZ.prototype),te(sZ.prototype,"pressedSprite",[QK,JK],Object.getOwnPropertyDescriptor(sZ.prototype,"pressedSprite"),sZ.prototype),te(sZ.prototype,"hoverSprite",[$K,eZ],Object.getOwnPropertyDescriptor(sZ.prototype,"hoverSprite"),sZ.prototype),te(sZ.prototype,"disabledSprite",[tZ,nZ],Object.getOwnPropertyDescriptor(sZ.prototype,"disabledSprite"),sZ.prototype),cZ=te(sZ.prototype,"clickEvents",[iZ,C_,rZ,oZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lZ=te(sZ.prototype,"_interactable",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),uZ=te(sZ.prototype,"_transition",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return NZ.NONE}}),hZ=te(sZ.prototype,"_normalColor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gn.WHITE.clone()}}),_Z=te(sZ.prototype,"_hoverColor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn(211,211,211,255)}}),fZ=te(sZ.prototype,"_pressedColor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gn.WHITE.clone()}}),dZ=te(sZ.prototype,"_disabledColor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn(124,124,124,255)}}),pZ=te(sZ.prototype,"_normalSprite",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mZ=te(sZ.prototype,"_hoverSprite",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gZ=te(sZ.prototype,"_pressedSprite",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vZ=te(sZ.prototype,"_disabledSprite",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yZ=te(sZ.prototype,"_duration",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),SZ=te(sZ.prototype,"_zoomScale",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),EZ=te(sZ.prototype,"_target",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aZ=sZ))||aZ)||aZ)||aZ)||aZ)||aZ)||aZ)),GZ=function(){function e(){}return e.add=function(e){var t=this._tabIndexList;-1===t.indexOf(e)&&t.push(e)},e.remove=function(e){var t=this._tabIndexList,n=t.indexOf(e);-1!==n&&t.splice(n,1)},e.resort=function(){this._tabIndexList.sort((function(e,t){return e._delegate.tabIndex-t._delegate.tabIndex}))},e.next=function(e){var t=this._tabIndexList,n=t.indexOf(e);if(e.setFocus(!1),-1!==n){var i=t[n+1];i&&i._delegate.tabIndex>=0&&i.setFocus(!0)}},e}();GZ._tabIndexList=[],function(e){e[e.DEFAULT=0]="DEFAULT",e[e.DONE=1]="DONE",e[e.SEND=2]="SEND",e[e.SEARCH=3]="SEARCH",e[e.GO=4]="GO",e[e.NEXT=5]="NEXT"}(FZ||(FZ={})),Qe(FZ),function(e){e[e.ANY=0]="ANY",e[e.EMAIL_ADDR=1]="EMAIL_ADDR",e[e.NUMERIC=2]="NUMERIC",e[e.PHONE_NUMBER=3]="PHONE_NUMBER",e[e.URL=4]="URL",e[e.DECIMAL=5]="DECIMAL",e[e.SINGLE_LINE=6]="SINGLE_LINE"}(zZ||(zZ={})),Qe(zZ),function(e){e[e.PASSWORD=0]="PASSWORD",e[e.SENSITIVE=1]="SENSITIVE",e[e.INITIAL_CAPS_WORD=2]="INITIAL_CAPS_WORD",e[e.INITIAL_CAPS_SENTENCE=3]="INITIAL_CAPS_SENTENCE",e[e.INITIAL_CAPS_ALL_CHARACTERS=4]="INITIAL_CAPS_ALL_CHARACTERS",e[e.DEFAULT=5]="DEFAULT"}(UZ||(UZ={})),Qe(UZ);var kZ,VZ,WZ,jZ,qZ,XZ,YZ,KZ,ZZ,QZ,JZ,$Z,eQ,tQ,nQ,iQ,rQ,oQ,aQ,sQ,cQ,lQ,uQ,hQ,_Q,fQ,dQ,pQ,mQ,gQ,vQ,yQ,SQ,EQ,TQ,xQ,AQ,CQ,bQ,wQ,RQ,IQ,PQ,OQ,DQ,NQ,MQ,LQ,BQ,FQ,zQ,UQ,HQ,GQ,kQ,VQ,WQ,jQ,qQ,XQ,YQ,KQ=function(){function e(){this._editing=!1,this._delegate=null}var t=e.prototype;return t.init=function(){},t.onEnable=function(){},t.update=function(){},t.onDisable=function(){this._editing&&this.endEditing()},t.clear=function(){this._delegate=null},t.setTabIndex=function(){},t.setSize=function(){},t.setFocus=function(e){e?this.beginEditing():this.endEditing()},t.isFocused=function(){return this._editing},t.beginEditing=function(){},t.endEditing=function(){},e}(),ZQ=new Mn,QQ=new Mn,JQ=new yn,$Q=null,eJ=0,tJ=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._delegate=null,t._inputMode=-1,t._inputFlag=-1,t._returnType=-1,t.__eventListeners={},t.__fullscreen=!1,t.__autoResize=!1,t.__orientationChanged=void 0,t._edTxt=null,t._isTextArea=!1,t._textLabelFont=null,t._textLabelFontSize=null,t._textLabelFontColor=null,t._textLabelAlign=null,t._placeholderLabelFont=null,t._placeholderLabelFontSize=null,t._placeholderLabelFontColor=null,t._placeholderLabelAlign=null,t._placeholderLineHeight=null,t._placeholderStyleSheet=null,t._domId="EditBoxId_"+ ++eJ,t}K(t,e);var n=t.prototype;return n.init=function(e){e&&(this._delegate=e,e.inputMode===zZ.ANY?this._createTextArea():this._createInput(),GZ.add(this),this.setTabIndex(e.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),this.__fullscreen=qC.isAutoFullScreenEnabled(),this.__autoResize=qC._resizeWithBrowserSize)},n.clear=function(){this._removeEventListeners(),this._removeDomFromGameContainer(),GZ.remove(this),$Q===this&&($Q=null),this._delegate=null},n.update=function(){this._updateMatrix()},n.setTabIndex=function(e){this._edTxt.tabIndex=e,GZ.resort()},n.setSize=function(e,t){var n=this._edTxt;n&&(n.style.width=e+"px",n.style.height=t+"px")},n.beginEditing=function(){$Q&&$Q!==this&&$Q.setFocus(!1),this._editing=!0,$Q=this,this._delegate._editBoxEditingDidBegan(),this._showDom(),this._edTxt.focus()},n.endEditing=function(){this._edTxt.blur()},n._createInput=function(){this._isTextArea=!1,this._edTxt=document.createElement("input")},n._createTextArea=function(){this._isTextArea=!0,this._edTxt=document.createElement("textarea")},n._addDomToGameContainer=function(){i.GAME_VIEW&&this._edTxt?(i.gameView.container.appendChild(this._edTxt),i.gameView.head.appendChild(this._placeholderStyleSheet)):UC.container&&this._edTxt&&(UC.container.appendChild(this._edTxt),document.head.appendChild(this._placeholderStyleSheet))},n._removeDomFromGameContainer=function(){(i.GAME_VIEW?ut(i.gameView.container,this._edTxt):ut(UC.container,this._edTxt))&&this._edTxt&&(i.GAME_VIEW?i.gameView.container.removeChild(this._edTxt):UC.container.removeChild(this._edTxt)),(i.GAME_VIEW?ut(i.gameView.head,this._placeholderStyleSheet):ut(document.head,this._placeholderStyleSheet))&&(i.GAME_VIEW?i.gameView.head.removeChild(this._placeholderStyleSheet):document.head.removeChild(this._placeholderStyleSheet)),this._edTxt=null,this._placeholderStyleSheet=null},n._showDom=function(){this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),eS.isMobile&&this._showDomOnMobile()},n._hideDom=function(){var e=this._edTxt;e&&this._delegate&&(e.style.display="none",this._delegate._showLabels()),eS.isMobile&&this._hideDomOnMobile()},n._showDomOnMobile=function(){yi.os!==pi.ANDROID&&yi.os!==pi.OHOS||(this.__fullscreen&&(qC.enableAutoFullScreen(!1),XC.exitFullScreen()),this.__autoResize&&qC.resizeWithBrowserSize(!1),this._adjustWindowScroll())},n._hideDomOnMobile=function(){var e=this;yi.os!==pi.ANDROID&&yi.os!==pi.OHOS||(this.__autoResize&&qC.resizeWithBrowserSize(!0),setTimeout((function(){$Q||e.__fullscreen&&qC.enableAutoFullScreen(!0)}),400)),this._scrollBackWindow()},n._adjustWindowScroll=function(){var e=this;setTimeout((function(){window.scrollY<40&&e._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),400)},n._scrollBackWindow=function(){setTimeout((function(){yi.browserType!==hi.WECHAT||yi.os!==pi.IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)}),400)},n._updateMatrix=function(){if(this._edTxt){var e=this._delegate.node,t=qC.getScaleX(),n=qC.getScaleY(),r=1,o=1;i.GAME_VIEW&&(r=i.gameView.canvas.width/i.game.canvas.width,o=i.gameView.canvas.height/i.game.canvas.height),t*=r,n*=o;var a=qC.getViewportRect(),s=qC.getDevicePixelRatio();e.getWorldMatrix(ZQ);var c=e._uiProps.uiTransformComp;if(c&&yn.set(JQ,-c.anchorX*c.width,-c.anchorY*c.height,JQ.z),Mn.transform(ZQ,ZQ,JQ),e._uiProps.uiTransformComp){var l=SO.root.batcher2D.getFirstRenderCamera(e);if(l){l.node.getWorldRT(QQ);var u=QQ.m12,h=QQ.m13,_=HC.center;QQ.m12=_.x-(QQ.m00*u+QQ.m04*h),QQ.m13=_.y-(QQ.m01*u+QQ.m05*h),Mn.multiply(QQ,QQ,ZQ),t/=s,n/=s;var f=i.GAME_VIEW?i.gameView.container:UC.container,d=QQ.m00*t,p=ZQ.m01,m=ZQ.m04,g=QQ.m05*n,v=parseInt(f&&f.style.paddingLeft||"0");v+=a.x*r/s;var y=parseInt(f&&f.style.paddingBottom||"0");y+=a.y/s;var S="matrix("+d+","+-p+","+-m+","+g+","+(QQ.m12*t+v)+","+-(QQ.m13*n+y)+")";this._edTxt.style.transform=S,this._edTxt.style["-webkit-transform"]=S,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}}},n._updateInputType=function(){var e=this._delegate,t=e.inputMode,n=e.inputFlag,i=e.returnType,r=this._edTxt;if(this._inputMode!==t||this._inputFlag!==n||this._returnType!==i){if(this._inputMode=t,this._inputFlag=n,this._returnType=i,this._isTextArea){var o="none";return n===UZ.INITIAL_CAPS_ALL_CHARACTERS?o="uppercase":n===UZ.INITIAL_CAPS_WORD&&(o="capitalize"),void(r.style.textTransform=o)}if(r=r,n===UZ.PASSWORD)return r.type="password",void(r.style.textTransform="none");var a=r.type;t===zZ.EMAIL_ADDR?a="email":t===zZ.NUMERIC||t===zZ.DECIMAL?a="number":t===zZ.PHONE_NUMBER?(a="number",r.pattern="[0-9]*"):t===zZ.URL?a="url":(a="text",i===FZ.SEARCH&&(a="search")),r.type=a;var s="none";n===UZ.INITIAL_CAPS_ALL_CHARACTERS?s="uppercase":n===UZ.INITIAL_CAPS_WORD&&(s="capitalize"),r.style.textTransform=s}},n._updateMaxLength=function(){var e=this._delegate.maxLength;e<0&&(e=65535),this._edTxt.maxLength=e},n._initStyleSheet=function(){if(this._edTxt){var e=this._edTxt;e.style.color="#000000",e.style.border="0px",e.style.background="transparent",e.style.width="100%",e.style.height="100%",e.style.outline="medium",e.style.padding="0",e.style.textTransform="none",e.style.display="none",e.style.position="absolute",e.style.bottom="0px",e.style.left="2px",e.className="cocosEditBox",e.style.fontFamily="Arial",e.id=this._domId,this._isTextArea?(e.style.resize="none",e.style.overflowY="scroll"):((e=e).type="text",e.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")}},n._updateStyleSheet=function(){var e=this._delegate,t=this._edTxt;t&&e&&(t.value=e.string,t.placeholder=e.placeholder,this._updateTextLabel(e.textLabel),this._updatePlaceholderLabel(e.placeholderLabel))},n._updateTextLabel=function(e){if(e){var t=e.font;t=!t||t instanceof UU?e.fontFamily:t._fontFamily;var n=e.fontSize*e.node.scale.y;if((this._textLabelFont!==t||this._textLabelFontSize!==n||this._textLabelFontColor!==e.fontColor||this._textLabelAlign!==e.horizontalAlign)&&(this._textLabelFont=t,this._textLabelFontSize=n,this._textLabelFontColor=e.fontColor,this._textLabelAlign=e.horizontalAlign,this._edTxt)){var i=this._edTxt;switch(i.style.fontSize=n+"px",i.style.color=e.color.toCSS(),i.style.fontFamily=t,e.horizontalAlign){case yk.HorizontalAlign.LEFT:i.style.textAlign="left";break;case yk.HorizontalAlign.CENTER:i.style.textAlign="center";break;case yk.HorizontalAlign.RIGHT:i.style.textAlign="right"}}}},n._updatePlaceholderLabel=function(e){if(e){var t=e.font;t=!t||t instanceof UU?e.fontFamily:e.font._fontFamily;var n=e.fontSize*e.node.scale.y;if(this._placeholderLabelFont!==t||this._placeholderLabelFontSize!==n||this._placeholderLabelFontColor!==e.fontColor||this._placeholderLabelAlign!==e.horizontalAlign||this._placeholderLineHeight!==e.fontSize){this._placeholderLabelFont=t,this._placeholderLabelFontSize=n,this._placeholderLabelFontColor=e.fontColor,this._placeholderLabelAlign=e.horizontalAlign,this._placeholderLineHeight=e.fontSize;var i=this._placeholderStyleSheet,r=e.color.toCSS(),o=e.fontSize,a="";switch(e.horizontalAlign){case yk.HorizontalAlign.LEFT:a="left";break;case yk.HorizontalAlign.CENTER:a="center";break;case yk.HorizontalAlign.RIGHT:a="right"}i.innerHTML="#"+this._domId+"::-webkit-input-placeholder{text-transform: initial;-family: "+t+";font-size: "+n+"px;color: "+r+";line-height: "+o+"px;text-align: "+a+";}#"+this._domId+"::-moz-placeholder{text-transform: initial;-family: "+t+";font-size: "+n+"px;color: "+r+";line-height: "+o+"px;text-align: "+a+";}#"+this._domId+"::-ms-input-placeholder{text-transform: initial;-family: "+t+";font-size: "+n+"px;color: "+r+";line-height: "+o+"px;text-align: "+a+";}",yi.browserType===hi.EDGE&&(i.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},n._registerEventListeners=function(){var e=this;if(this._edTxt){var t=this._edTxt,n=!1,i=this.__eventListeners;i.compositionStart=function(){n=!0},i.compositionEnd=function(){n=!1,e._delegate._editBoxTextChanged(t.value)},i.onInput=function(){if(!n){var i=e._delegate,r=i.maxLength;r>=0&&(t.value=t.value.slice(0,r)),i._editBoxTextChanged(t.value)}},i.onClick=function(){e._editing&&eS.isMobile&&e._adjustWindowScroll()},i.onKeydown=function(n){n.keyCode===nt.KEY.enter?(n.propagationStopped=!0,e._delegate._editBoxEditingReturn(),e._isTextArea||t.blur()):n.keyCode===nt.KEY.tab&&(n.propagationStopped=!0,n.preventDefault(),GZ.next(e))},i.onBlur=function(){eS.isMobile&&n&&i.compositionEnd(),e._editing=!1,$Q=null,e._hideDom(),e._delegate._editBoxEditingDidEnded()},t.addEventListener("compositionstart",i.compositionStart),t.addEventListener("compositionend",i.compositionEnd),t.addEventListener("input",i.onInput),t.addEventListener("keydown",i.onKeydown),t.addEventListener("blur",i.onBlur),t.addEventListener("touchstart",i.onClick)}},n._removeEventListeners=function(){if(this._edTxt){var e=this._edTxt,t=this.__eventListeners;e.removeEventListener("compositionstart",t.compositionStart),e.removeEventListener("compositionend",t.compositionEnd),e.removeEventListener("input",t.onInput),e.removeEventListener("keydown",t.onKeydown),e.removeEventListener("blur",t.onBlur),e.removeEventListener("touchstart",t.onClick),t.compositionStart=null,t.compositionEnd=null,t.onInput=null,t.onKeydown=null,t.onBlur=null,t.onClick=null}},t}(KQ);!function(e){e.EDITING_DID_BEGAN="editing-did-began",e.EDITING_DID_ENDED="editing-did-ended",e.TEXT_CHANGED="text-changed",e.EDITING_RETURN="editing-return"}(YQ||(YQ={}));var nJ,iJ,rJ,oJ,aJ,sJ,cJ,lJ,uJ,hJ,_J,fJ,dJ,pJ,mJ,gJ,vJ,yJ,SJ,EJ,TJ,xJ,AJ,CJ,bJ,wJ,RJ,IJ,PJ,OJ,DJ,NJ,MJ,LJ,BJ,FJ,zJ,UJ,HJ,GJ,kJ,VJ,WJ,jJ,qJ,XJ,YJ,KJ,ZJ,QJ,JJ,$J,e$,t$,n$=function(t){return e({EditBox:t,EditBoxComponent:t}),t}((kZ=S_("cc.EditBox"),VZ=D_(),WZ=T_(110),jZ=R_(),qZ=E_(zH),XZ=k_(),YZ=B_(),KZ=k_(),ZZ=B_(),QZ=K_(yk),JZ=k_(),$Z=B_(),eQ=K_(yk),tQ=k_(),nQ=B_(),iQ=K_(vU),rQ=k_(),oQ=B_(),aQ=K_(UZ),sQ=k_(),cQ=B_(),lQ=K_(zZ),uQ=k_(),hQ=B_(),_Q=K_(FZ),fQ=k_(),dQ=B_(),pQ=k_(),mQ=B_(),gQ=k_(),vQ=B_(),yQ=K_([iM]),SQ=k_(),EQ=B_(),TQ=K_([iM]),xQ=k_(),AQ=B_(),CQ=K_([iM]),bQ=k_(),wQ=B_(),RQ=K_([iM]),IQ=k_(),PQ=B_(),kZ(OQ=VZ(OQ=WZ(OQ=jZ(OQ=qZ(OQ=w_((XQ=qQ=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"editingDidBegan",NQ,Q(t)),ee(t,"textChanged",MQ,Q(t)),ee(t,"editingDidEnded",LQ,Q(t)),ee(t,"editingReturn",BQ,Q(t)),t._impl=null,t._background=null,ee(t,"_textLabel",FQ,Q(t)),ee(t,"_placeholderLabel",zQ,Q(t)),ee(t,"_returnType",UQ,Q(t)),ee(t,"_string",HQ,Q(t)),ee(t,"_tabIndex",GQ,Q(t)),ee(t,"_backgroundImage",kQ,Q(t)),ee(t,"_inputFlag",VQ,Q(t)),ee(t,"_inputMode",WQ,Q(t)),ee(t,"_maxLength",jQ,Q(t)),t._isLabelVisible=!1,t}K(t,e);var n=t.prototype;return n.__preload=function(){this._init()},n.onEnable=function(){this._registerEvent(),this._impl&&this._impl.onEnable()},n.update=function(){this._impl&&this._impl.update()},n.onDisable=function(){this._unregisterEvent(),this._impl&&this._impl.onDisable()},n.onDestroy=function(){this._impl&&this._impl.clear()},n.setFocus=function(){this._impl&&this._impl.setFocus(!0)},n.focus=function(){this._impl&&this._impl.setFocus(!0)},n.blur=function(){this._impl&&this._impl.setFocus(!1)},n.isFocused=function(){return!!this._impl&&this._impl.isFocused()},n._editBoxEditingDidBegan=function(){iM.emitEvents(this.editingDidBegan,this),this.node.emit(YQ.EDITING_DID_BEGAN,this)},n._editBoxEditingDidEnded=function(){iM.emitEvents(this.editingDidEnded,this),this.node.emit(YQ.EDITING_DID_ENDED,this)},n._editBoxTextChanged=function(e){e=this._updateLabelStringStyle(e,!0),this.string=e,iM.emitEvents(this.textChanged,e,this),this.node.emit(YQ.TEXT_CHANGED,this)},n._editBoxEditingReturn=function(){iM.emitEvents(this.editingReturn,this),this.node.emit(YQ.EDITING_RETURN,this)},n._showLabels=function(){this._isLabelVisible=!0,this._updateLabels()},n._hideLabels=function(){this._isLabelVisible=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},n._onTouchBegan=function(e){e.propagationStopped=!0},n._onTouchCancel=function(e){e.propagationStopped=!0},n._onTouchEnded=function(e){this._impl&&this._impl.beginEditing(),e.propagationStopped=!0},n._init=function(){this._createBackgroundSprite(),this._updatePlaceholderLabel(),this._updateTextLabel(),this._isLabelVisible=!0,this.node.on(bm.SIZE_CHANGED,this._resizeChildNodes,this),(this._impl=new t._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},n._createBackgroundSprite=function(){this._background||(this._background=this.node.getComponent(sj),this._background||(this._background=this.node.addComponent(sj))),this._background.type=sj.Type.SLICED,this._background.spriteFrame=this._backgroundImage},n._updateTextLabel=function(){var e=this._textLabel;if(!e){var t=this.node.getChildByName("TEXT_LABEL");t||(t=new Vv("TEXT_LABEL")),(e=t.getComponent(yk))||(e=t.addComponent(yk)),t.parent=this.node,this._textLabel=e}this._textLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),e.overflow=yk.Overflow.CLAMP,this._inputMode===zZ.ANY?(e.verticalAlign=_k.TOP,e.enableWrapText=!0):e.enableWrapText=!1,e.string=this._updateLabelStringStyle(this._string)},n._updatePlaceholderLabel=function(){var e=this._placeholderLabel;if(!e){var t=this.node.getChildByName("PLACEHOLDER_LABEL");t||(t=new Vv("PLACEHOLDER_LABEL")),(e=t.getComponent(yk))||(e=t.addComponent(yk)),t.parent=this.node,this._placeholderLabel=e}this._placeholderLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),e.overflow=yk.Overflow.CLAMP,this._inputMode===zZ.ANY?(e.verticalAlign=_k.TOP,e.enableWrapText=!0):e.enableWrapText=!1,e.string=this.placeholder},n._syncSize=function(){var e=this.node._uiProps.uiTransformComp,t=e.contentSize;if(this._background){var n=this._background.node._uiProps.uiTransformComp;n.anchorPoint=e.anchorPoint,n.setContentSize(t)}this._updateLabelPosition(t),this._impl&&this._impl.setSize(t.width,t.height)},n._updateLabels=function(){if(this._isLabelVisible){var e=this._string;this._textLabel&&(this._textLabel.node.active=""!==e),this._placeholderLabel&&(this._placeholderLabel.node.active=""===e)}},n._updateString=function(e){var t=this._textLabel;if(t){var n=e;n&&(n=this._updateLabelStringStyle(n)),t.string=n,this._updateLabels()}},n._updateLabelStringStyle=function(e,t){void 0===t&&(t=!1);var n,i=this._inputFlag;if(t||i!==UZ.PASSWORD)i===UZ.INITIAL_CAPS_ALL_CHARACTERS?e=e.toUpperCase():i===UZ.INITIAL_CAPS_WORD?e=e.replace(/(?:^|\s)\S/g,(function(e){return e.toUpperCase()})):i===UZ.INITIAL_CAPS_SENTENCE&&(e=(n=e).charAt(0).toUpperCase()+n.slice(1));else{for(var r="",o=e.length,a=0;a<o;++a)r+="";e=r}return e},n._registerEvent=function(){this.node.on(bm.TOUCH_START,this._onTouchBegan,this),this.node.on(bm.TOUCH_END,this._onTouchEnded,this)},n._unregisterEvent=function(){this.node.off(bm.TOUCH_START,this._onTouchBegan,this),this.node.off(bm.TOUCH_END,this._onTouchEnded,this)},n._updateLabelPosition=function(e){var t=this.node._uiProps.uiTransformComp,n=-t.anchorX*t.width,i=-t.anchorY*t.height,r=this._placeholderLabel,o=this._textLabel;o&&(o.node._uiProps.uiTransformComp.setContentSize(e.width-2,e.height),o.node.setPosition(n+2,i+e.height,o.node.position.z),this._inputMode===zZ.ANY&&(o.verticalAlign=_k.TOP),o.enableWrapText=this._inputMode===zZ.ANY),r&&(r.node._uiProps.uiTransformComp.setContentSize(e.width-2,e.height),r.lineHeight=e.height,r.node.setPosition(n+2,i+e.height,r.node.position.z),this._inputMode===zZ.ANY&&(r.verticalAlign=_k.TOP),r.enableWrapText=this._inputMode===zZ.ANY)},n._resizeChildNodes=function(){var e=this.node._uiProps.uiTransformComp,t=this._textLabel&&this._textLabel.node;t&&(t.setPosition(-e.width/2,e.height/2,t.position.z),t._uiProps.uiTransformComp.setContentSize(e.contentSize));var n=this._placeholderLabel&&this._placeholderLabel.node;n&&(n.setPosition(-e.width/2,e.height/2,n.position.z),n._uiProps.uiTransformComp.setContentSize(e.contentSize));var i=this._background&&this._background.node;i&&i._uiProps.uiTransformComp.setContentSize(e.contentSize)},X(t,[{key:"string",get:function(){return this._string},set:function(e){this._maxLength>=0&&e.length>=this._maxLength&&(e=e.slice(0,this._maxLength)),this._string=e,this._updateString(e)}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(e){this._placeholderLabel&&(this._placeholderLabel.string=e)}},{key:"textLabel",get:function(){return this._textLabel},set:function(e){this._textLabel!==e&&(this._textLabel=e,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(e){this._placeholderLabel!==e&&(this._placeholderLabel=e,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(e){this._backgroundImage!==e&&(this._backgroundImage=e,this._createBackgroundSprite())}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(e){this._inputFlag=e,this._updateString(this._string)}},{key:"inputMode",get:function(){return this._inputMode},set:function(e){this._inputMode!==e&&(this._inputMode=e,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(e){this._returnType=e}},{key:"maxLength",get:function(){return this._maxLength},set:function(e){this._maxLength=e}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(e){this._tabIndex!==e&&(this._tabIndex=e,this._impl&&this._impl.setTabIndex(e))}}]),t}(Xd),qQ._EditBoxImpl=KQ,qQ.KeyboardReturnType=FZ,qQ.InputFlag=UZ,qQ.InputMode=zZ,qQ.EventType=YQ,te((DQ=XQ).prototype,"string",[XZ,YZ],Object.getOwnPropertyDescriptor(DQ.prototype,"string"),DQ.prototype),te(DQ.prototype,"placeholder",[KZ,ZZ],Object.getOwnPropertyDescriptor(DQ.prototype,"placeholder"),DQ.prototype),te(DQ.prototype,"textLabel",[QZ,JZ,$Z],Object.getOwnPropertyDescriptor(DQ.prototype,"textLabel"),DQ.prototype),te(DQ.prototype,"placeholderLabel",[eQ,tQ,nQ],Object.getOwnPropertyDescriptor(DQ.prototype,"placeholderLabel"),DQ.prototype),te(DQ.prototype,"backgroundImage",[iQ,rQ,oQ],Object.getOwnPropertyDescriptor(DQ.prototype,"backgroundImage"),DQ.prototype),te(DQ.prototype,"inputFlag",[aQ,sQ,cQ],Object.getOwnPropertyDescriptor(DQ.prototype,"inputFlag"),DQ.prototype),te(DQ.prototype,"inputMode",[lQ,uQ,hQ],Object.getOwnPropertyDescriptor(DQ.prototype,"inputMode"),DQ.prototype),te(DQ.prototype,"returnType",[_Q,fQ,dQ],Object.getOwnPropertyDescriptor(DQ.prototype,"returnType"),DQ.prototype),te(DQ.prototype,"maxLength",[pQ,mQ],Object.getOwnPropertyDescriptor(DQ.prototype,"maxLength"),DQ.prototype),te(DQ.prototype,"tabIndex",[gQ,vQ],Object.getOwnPropertyDescriptor(DQ.prototype,"tabIndex"),DQ.prototype),NQ=te(DQ.prototype,"editingDidBegan",[yQ,C_,SQ,EQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),MQ=te(DQ.prototype,"textChanged",[TQ,C_,xQ,AQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),LQ=te(DQ.prototype,"editingDidEnded",[CQ,C_,bQ,wQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),BQ=te(DQ.prototype,"editingReturn",[RQ,C_,IQ,PQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FQ=te(DQ.prototype,"_textLabel",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zQ=te(DQ.prototype,"_placeholderLabel",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),UQ=te(DQ.prototype,"_returnType",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FZ.DEFAULT}}),HQ=te(DQ.prototype,"_string",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),GQ=te(DQ.prototype,"_tabIndex",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kQ=te(DQ.prototype,"_backgroundImage",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VQ=te(DQ.prototype,"_inputFlag",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return UZ.DEFAULT}}),WQ=te(DQ.prototype,"_inputMode",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zZ.ANY}}),jQ=te(DQ.prototype,"_maxLength",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),OQ=DQ))||OQ)||OQ)||OQ)||OQ)||OQ)||OQ));"object"==typeof window&&"object"==typeof document&&(n$._EditBoxImpl=tJ);var i$,r$,o$,a$,s$,c$,l$=bm;!function(e){e[e.NONE=0]="NONE",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.GRID=3]="GRID"}(i$||(i$={})),et(i$),function(e){e[e.NONE=0]="NONE",e[e.CONTAINER=1]="CONTAINER",e[e.CHILDREN=2]="CHILDREN"}(r$||(r$={})),et(r$),function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL"}(o$||(o$={})),et(o$),function(e){e[e.BOTTOM_TO_TOP=0]="BOTTOM_TO_TOP",e[e.TOP_TO_BOTTOM=1]="TOP_TO_BOTTOM"}(a$||(a$={})),et(a$),function(e){e[e.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",e[e.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT"}(s$||(s$={})),et(s$),function(e){e[e.NONE=0]="NONE",e[e.FIXED_ROW=1]="FIXED_ROW",e[e.FIXED_COL=2]="FIXED_COL"}(c$||(c$={})),et(c$);var u$,h$,_$,f$,d$,p$,m$,g$,v$,y$,S$,E$,T$,x$,A$,C$,b$,w$,R$,I$,P$,O$,D$,N$=new yn,M$=function(t){return e({Layout:t,LayoutComponent:t}),t}((nJ=S_("cc.Layout"),iJ=D_(),rJ=T_(110),oJ=R_(),aJ=E_(zH),sJ=M_(),cJ=B_(),lJ=M_(),uJ=B_(),hJ=K_(i$),_J=B_(),fJ=K_(r$),dJ=M_(),pJ=B_(),mJ=M_(),gJ=B_(),vJ=K_(o$),yJ=B_(),SJ=B_(),EJ=B_(),TJ=B_(),xJ=B_(),AJ=B_(),CJ=B_(),bJ=K_(a$),wJ=B_(),RJ=K_(s$),IJ=B_(),PJ=K_(c$),OJ=M_(),DJ=B_(),NJ=M_(),MJ=B_(),LJ=B_(),nJ(BJ=iJ(BJ=rJ(BJ=oJ(BJ=aJ(BJ=w_((t$=e$=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_resizeMode",zJ,Q(t)),ee(t,"_layoutType",UJ,Q(t)),ee(t,"_cellSize",HJ,Q(t)),ee(t,"_startAxis",GJ,Q(t)),ee(t,"_paddingLeft",kJ,Q(t)),ee(t,"_paddingRight",VJ,Q(t)),ee(t,"_paddingTop",WJ,Q(t)),ee(t,"_paddingBottom",jJ,Q(t)),ee(t,"_spacingX",qJ,Q(t)),ee(t,"_spacingY",XJ,Q(t)),ee(t,"_verticalDirection",YJ,Q(t)),ee(t,"_horizontalDirection",KJ,Q(t)),ee(t,"_constraint",ZJ,Q(t)),ee(t,"_constraintNum",QJ,Q(t)),ee(t,"_affectedByScale",JJ,Q(t)),ee(t,"_isAlign",$J,Q(t)),t._layoutSize=new jn(300,200),t._layoutDirty=!0,t._childrenDirty=!1,t._usefulLayoutObj=[],t._init=!1,t}K(t,e);var n=t.prototype;return n.updateLayout=function(e){void 0===e&&(e=!1),(this._layoutDirty||e)&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)},n.onEnable=function(){this._addEventListeners();var e=this.node._uiProps.uiTransformComp;e.contentSize.equals(jn.ZERO)&&e.setContentSize(this._layoutSize),this._childrenChanged()},n.onDisable=function(){this._usefulLayoutObj.length=0,this._removeEventListeners()},n._checkUsefulObj=function(){this._usefulLayoutObj.length=0;for(var e=this.node.children,t=0;t<e.length;++t){var n=e[t],i=n._uiProps.uiTransformComp;n.activeInHierarchy&&i&&this._usefulLayoutObj.push(i)}},n._addEventListeners=function(){SO.on(yO.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(l$.SIZE_CHANGED,this._resized,this),this.node.on(l$.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(l$.CHILD_ADDED,this._childAdded,this),this.node.on(l$.CHILD_REMOVED,this._childRemoved,this),this.node.on(l$.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.on("childrenSiblingOrderChanged",this.updateLayout,this),this._addChildrenEventListeners()},n._removeEventListeners=function(){SO.off(yO.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(l$.SIZE_CHANGED,this._resized,this),this.node.off(l$.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(l$.CHILD_ADDED,this._childAdded,this),this.node.off(l$.CHILD_REMOVED,this._childRemoved,this),this.node.off(l$.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.off("childrenSiblingOrderChanged",this.updateLayout,this),this._removeChildrenEventListeners()},n._addChildrenEventListeners=function(){for(var e=this.node.children,t=0;t<e.length;++t){var n=e[t];n.on(l$.SIZE_CHANGED,this._doLayoutDirty,this),n.on(l$.TRANSFORM_CHANGED,this._transformDirty,this),n.on(l$.ANCHOR_CHANGED,this._doLayoutDirty,this),n.on("active-in-hierarchy-changed",this._childrenChanged,this)}},n._removeChildrenEventListeners=function(){for(var e=this.node.children,t=0;t<e.length;++t){var n=e[t];n.off(l$.SIZE_CHANGED,this._doLayoutDirty,this),n.off(l$.TRANSFORM_CHANGED,this._transformDirty,this),n.off(l$.ANCHOR_CHANGED,this._doLayoutDirty,this),n.off("active-in-hierarchy-changed",this._childrenChanged,this)}},n._childAdded=function(e){e.on(l$.SIZE_CHANGED,this._doLayoutDirty,this),e.on(l$.TRANSFORM_CHANGED,this._transformDirty,this),e.on(l$.ANCHOR_CHANGED,this._doLayoutDirty,this),e.on("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},n._childRemoved=function(e){e.off(l$.SIZE_CHANGED,this._doLayoutDirty,this),e.off(l$.TRANSFORM_CHANGED,this._transformDirty,this),e.off(l$.ANCHOR_CHANGED,this._doLayoutDirty,this),e.off("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},n._resized=function(){this._layoutSize.set(this.node._uiProps.uiTransformComp.contentSize),this._doLayoutDirty()},n._doLayoutHorizontally=function(e,t,n,i){var r=this.node._uiProps.uiTransformComp.anchorPoint,o=this._getFixedBreakingNum(),a=1,s=this._paddingLeft;this._horizontalDirection===s$.RIGHT_TO_LEFT&&(a=-1,s=this._paddingRight);var c=(this._horizontalDirection-r.x)*e+a*s,l=c-a*this._spacingX,u=0,h=0,_=0,f=0,d=!1,p=this._usefulLayoutObj.length,m=this._cellSize.width,g=this._getPaddingH();this._layoutType!==i$.GRID&&this._resizeMode===r$.CHILDREN&&(m=(e-g-(p-1)*this._spacingX)/p);for(var v=this._usefulLayoutObj,y=0;y<v.length;++y){var S=v[y],E=S.node,T=E.scale,x=this._getUsedScaleValue(T.x),A=this._getUsedScaleValue(T.y);this._resizeMode===r$.CHILDREN&&(S.width=m/x,this._layoutType===i$.GRID&&(S.height=this._cellSize.height/A));var C=Math.abs(this._horizontalDirection-S.anchorX),b=S.width*x,w=S.height*A;w>_&&(f=Math.max(_,f),h=_||w,_=w),l+=a*(C*b+this._spacingX);var R=a*(1-C)*b;if(t){if(o>0)(d=y/o>0&&y%o==0)&&(h=_>w?_:h);else if(b>e-g)l>c+a*C*b&&(d=!0);else{var I=(1-this._horizontalDirection-r.x)*e,P=l+R+a*(a>0?this._paddingRight:this._paddingLeft);d=Math.abs(P)>Math.abs(I)}d&&(l=c+a*C*b,w!==_&&(h=_),u+=h+this._spacingY,h=_=w)}var O=n(E,S,u);i&&E.setPosition(l,O),l+=R}return h=Math.max(h,_),Math.max(f,u+h)+this._getPaddingV()},n._doLayoutVertically=function(e,t,n,i){var r=this.node._uiProps.uiTransformComp.anchorPoint,o=this._getFixedBreakingNum(),a=1,s=this._paddingBottom;this._verticalDirection===a$.TOP_TO_BOTTOM&&(a=-1,s=this._paddingTop);var c=(this._verticalDirection-r.y)*e+a*s,l=c-a*this._spacingY,u=0,h=0,_=0,f=0,d=!1,p=this._usefulLayoutObj.length,m=this._cellSize.height,g=this._getPaddingV();this._layoutType!==i$.GRID&&this._resizeMode===r$.CHILDREN&&(m=(e-g-(p-1)*this._spacingY)/p);for(var v=this._usefulLayoutObj,y=0;y<v.length;++y){var S=v[y],E=S.node,T=E.scale,x=this._getUsedScaleValue(T.x),A=this._getUsedScaleValue(T.y);this._resizeMode===r$.CHILDREN&&(S.height=m/A,this._layoutType===i$.GRID&&(S.width=this._cellSize.width/x));var C=Math.abs(this._verticalDirection-S.anchorY),b=S.width*x,w=S.height*A;b>u&&(h=Math.max(u,h),_=u||b,u=b),l+=a*(C*w+this._spacingY);var R=a*(1-C)*w;if(t){if(o>0)(d=y/o>0&&y%o==0)&&(_=u>w?u:_);else if(w>e-g)l>c+a*C*w&&(d=!0);else{var I=(1-this._verticalDirection-r.y)*e,P=l+R+a*(a>0?this._paddingTop:this._paddingBottom);d=Math.abs(P)>Math.abs(I)}d&&(l=c+a*C*w,b!==u&&(_=u),f+=_+this._spacingX,_=u=b)}var O=n(E,S,f);i&&(E.getPosition(N$),E.setPosition(O,l,N$.z)),l+=R}return _=Math.max(_,u),Math.max(h,f+_)+this._getPaddingH()},n._doLayoutGridAxisHorizontal=function(e,t){var n=this,i=t.width,r=1,o=-e.y*t.height,a=this._paddingBottom;this._verticalDirection===a$.TOP_TO_BOTTOM&&(r=-1,o=(1-e.y)*t.height,a=this._paddingTop);var s=function(e,t,i){return o+r*(i+(1-t.anchorY)*t.height*n._getUsedScaleValue(e.scale.y)+a)},c=0;this._resizeMode===r$.CONTAINER&&(c=this._doLayoutHorizontally(i,!0,s,!1),o=-e.y*c,this._verticalDirection===a$.TOP_TO_BOTTOM&&(r=-1,o=(1-e.y)*c)),this._doLayoutHorizontally(i,!0,s,!0),this._resizeMode===r$.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(i,c)},n._doLayoutGridAxisVertical=function(e,t){var n=this,i=t.height,r=1,o=-e.x*t.width,a=this._paddingLeft;this._horizontalDirection===s$.RIGHT_TO_LEFT&&(r=-1,o=(1-e.x)*t.width,a=this._paddingRight);var s=function(e,t,i){return o+r*(i+(1-t.anchorX)*t.width*n._getUsedScaleValue(e.scale.x)+a)},c=0;this._resizeMode===r$.CONTAINER&&(c=this._doLayoutVertically(i,!0,s,!1),o=-e.x*c,this._horizontalDirection===s$.RIGHT_TO_LEFT&&(r=-1,o=(1-e.x)*c)),this._doLayoutVertically(i,!0,s,!0),this._resizeMode===r$.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(c,i)},n._doLayoutGrid=function(){var e=this.node._uiProps.uiTransformComp,t=e.anchorPoint,n=e.contentSize;this.startAxis===o$.HORIZONTAL?this._doLayoutGridAxisHorizontal(t,n):this.startAxis===o$.VERTICAL&&this._doLayoutGridAxisVertical(t,n)},n._getHorizontalBaseWidth=function(){var e=this._usefulLayoutObj,t=0,n=e.length;if(this._resizeMode===r$.CONTAINER){for(var i=0;i<e.length;++i){var r=e[i],o=r.node.scale;t+=r.width*this._getUsedScaleValue(o.x)}t+=(n-1)*this._spacingX+this._getPaddingH()}else t=this.node._uiProps.uiTransformComp.width;return t},n._getVerticalBaseHeight=function(){var e=this._usefulLayoutObj,t=0,n=e.length;if(this._resizeMode===r$.CONTAINER){for(var i=0;i<e.length;++i){var r=e[i],o=r.node.scale;t+=r.height*this._getUsedScaleValue(o.y)}t+=(n-1)*this._spacingY+this._getPaddingV()}else t=this.node._uiProps.uiTransformComp.height;return t},n._doLayout=function(){var e=this;if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),this._layoutType===i$.HORIZONTAL){var t=this._getHorizontalBaseWidth();this._doLayoutHorizontally(t,!1,(function(t){return(e._isAlign?yn.ZERO:t.position).y}),!0),this.node._uiProps.uiTransformComp.width=t}else if(this._layoutType===i$.VERTICAL){var n=this._getVerticalBaseHeight();this._doLayoutVertically(n,!1,(function(t){return(e._isAlign?yn.ZERO:t.position).x}),!0),this.node._uiProps.uiTransformComp.height=n}else this._layoutType===i$.GRID&&this._doLayoutGrid()},n._getUsedScaleValue=function(e){return this._affectedByScale?Math.abs(e):1},n._transformDirty=function(e){e&t_.SCALE&&e&t_.POSITION&&this._affectedByScale&&this._doLayoutDirty()},n._doLayoutDirty=function(){this._layoutDirty=!0},n._childrenChanged=function(){this._childrenDirty=!0,this._doLayoutDirty()},n._getPaddingH=function(){return this._paddingLeft+this._paddingRight},n._getPaddingV=function(){return this._paddingTop+this._paddingBottom},n._getFixedBreakingNum=function(){if(this._layoutType!==i$.GRID||this._constraint===c$.NONE||this._constraintNum<=0)return 0;var e=this._constraint===c$.FIXED_ROW?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return this._startAxis===o$.VERTICAL&&(e=this._constraint===c$.FIXED_COL?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),e},X(t,[{key:"alignHorizontal",get:function(){return this._isAlign},set:function(e){this._layoutType===i$.HORIZONTAL&&(this._isAlign=e,this._doLayoutDirty())}},{key:"alignVertical",get:function(){return this._isAlign},set:function(e){this._layoutType===i$.VERTICAL&&(this._isAlign=e,this._doLayoutDirty())}},{key:"type",get:function(){return this._layoutType},set:function(e){this._layoutType=e,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(e){this._layoutType!==i$.NONE&&(this._resizeMode=e,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(e){this._cellSize!==e&&(this._cellSize.set(e),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(e){this._startAxis!==e&&(this._startAxis=e,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(e){this._paddingLeft!==e&&(this._paddingLeft=e,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(e){this._paddingRight!==e&&(this._paddingRight=e,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(e){this._paddingTop!==e&&(this._paddingTop=e,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(e){this._paddingBottom!==e&&(this._paddingBottom=e,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(e){this._spacingX!==e&&(this._spacingX=e,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(e){this._spacingY!==e&&(this._spacingY=e,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(e){this._verticalDirection!==e&&(this._verticalDirection=e,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(e){this._horizontalDirection!==e&&(this._horizontalDirection=e,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(e){this.paddingLeft===e&&this._paddingRight===e&&this._paddingTop===e&&this._paddingBottom===e||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=e,this._doLayoutDirty())}},{key:"constraint",get:function(){return this._constraint},set:function(e){this._layoutType!==i$.NONE&&this._constraint!==e&&(this._constraint=e,this._doLayoutDirty())}},{key:"constraintNum",get:function(){return this._constraintNum},set:function(e){this._constraint!==c$.NONE&&this._constraintNum!==e&&(e<=0&&d("Limit values to be greater than 0"),this._constraintNum=e,this._doLayoutDirty())}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(e){this._affectedByScale=e,this._doLayoutDirty()}}]),t}(Xd),e$.Type=i$,e$.VerticalDirection=a$,e$.HorizontalDirection=s$,e$.ResizeMode=r$,e$.AxisDirection=o$,e$.Constraint=c$,te((FJ=t$).prototype,"alignHorizontal",[sJ,cJ],Object.getOwnPropertyDescriptor(FJ.prototype,"alignHorizontal"),FJ.prototype),te(FJ.prototype,"alignVertical",[lJ,uJ],Object.getOwnPropertyDescriptor(FJ.prototype,"alignVertical"),FJ.prototype),te(FJ.prototype,"type",[hJ,_J],Object.getOwnPropertyDescriptor(FJ.prototype,"type"),FJ.prototype),te(FJ.prototype,"resizeMode",[fJ,dJ,pJ],Object.getOwnPropertyDescriptor(FJ.prototype,"resizeMode"),FJ.prototype),te(FJ.prototype,"cellSize",[mJ,gJ],Object.getOwnPropertyDescriptor(FJ.prototype,"cellSize"),FJ.prototype),te(FJ.prototype,"startAxis",[vJ,yJ],Object.getOwnPropertyDescriptor(FJ.prototype,"startAxis"),FJ.prototype),te(FJ.prototype,"paddingLeft",[SJ],Object.getOwnPropertyDescriptor(FJ.prototype,"paddingLeft"),FJ.prototype),te(FJ.prototype,"paddingRight",[EJ],Object.getOwnPropertyDescriptor(FJ.prototype,"paddingRight"),FJ.prototype),te(FJ.prototype,"paddingTop",[TJ],Object.getOwnPropertyDescriptor(FJ.prototype,"paddingTop"),FJ.prototype),te(FJ.prototype,"paddingBottom",[xJ],Object.getOwnPropertyDescriptor(FJ.prototype,"paddingBottom"),FJ.prototype),te(FJ.prototype,"spacingX",[AJ],Object.getOwnPropertyDescriptor(FJ.prototype,"spacingX"),FJ.prototype),te(FJ.prototype,"spacingY",[CJ],Object.getOwnPropertyDescriptor(FJ.prototype,"spacingY"),FJ.prototype),te(FJ.prototype,"verticalDirection",[bJ,wJ],Object.getOwnPropertyDescriptor(FJ.prototype,"verticalDirection"),FJ.prototype),te(FJ.prototype,"horizontalDirection",[RJ,IJ],Object.getOwnPropertyDescriptor(FJ.prototype,"horizontalDirection"),FJ.prototype),te(FJ.prototype,"constraint",[PJ,OJ,DJ],Object.getOwnPropertyDescriptor(FJ.prototype,"constraint"),FJ.prototype),te(FJ.prototype,"constraintNum",[NJ,MJ],Object.getOwnPropertyDescriptor(FJ.prototype,"constraintNum"),FJ.prototype),te(FJ.prototype,"affectedByScale",[LJ],Object.getOwnPropertyDescriptor(FJ.prototype,"affectedByScale"),FJ.prototype),zJ=te(FJ.prototype,"_resizeMode",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return r$.NONE}}),UJ=te(FJ.prototype,"_layoutType",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return i$.NONE}}),HJ=te(FJ.prototype,"_cellSize",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new jn(40,40)}}),GJ=te(FJ.prototype,"_startAxis",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return o$.HORIZONTAL}}),kJ=te(FJ.prototype,"_paddingLeft",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),VJ=te(FJ.prototype,"_paddingRight",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WJ=te(FJ.prototype,"_paddingTop",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jJ=te(FJ.prototype,"_paddingBottom",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qJ=te(FJ.prototype,"_spacingX",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XJ=te(FJ.prototype,"_spacingY",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YJ=te(FJ.prototype,"_verticalDirection",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return a$.TOP_TO_BOTTOM}}),KJ=te(FJ.prototype,"_horizontalDirection",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s$.LEFT_TO_RIGHT}}),ZJ=te(FJ.prototype,"_constraint",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return c$.NONE}}),QJ=te(FJ.prototype,"_constraintNum",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),JJ=te(FJ.prototype,"_affectedByScale",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$J=te(FJ.prototype,"_isAlign",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),BJ=FJ))||BJ)||BJ)||BJ)||BJ)||BJ)||BJ));!function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL",e[e.FILLED=2]="FILLED"}(D$||(D$={})),Qe(D$);var L$,B$,F$,z$,U$,H$,G$,k$,V$,W$,j$,q$,X$,Y$,K$,Z$,Q$,J$,$$,e0,t0,n0,i0,r0,o0,a0=function(t){return e({ProgressBar:t,ProgressBarComponent:t}),t}((u$=S_("cc.ProgressBar"),h$=D_(),_$=T_(110),f$=R_(),d$=E_(zH),p$=K_(sj),m$=B_(),g$=K_(D$),v$=B_(),y$=B_(),S$=F_(),E$=B_(),T$=B_(),u$(x$=h$(x$=_$(x$=f$(x$=d$((O$=P$=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_barSprite",C$,Q(t)),ee(t,"_mode",b$,Q(t)),ee(t,"_totalLength",w$,Q(t)),ee(t,"_progress",R$,Q(t)),ee(t,"_reverse",I$,Q(t)),t}K(t,e);var n=t.prototype;return n._initBarSprite=function(){if(this._barSprite){var e=this._barSprite.node;if(!e)return;var t=this.node._uiProps.uiTransformComp,n=t.contentSize,i=t.anchorPoint,r=e._uiProps.uiTransformComp.contentSize;if(this._barSprite.fillType===sj.FillType.RADIAL&&(this._mode=D$.FILLED),this._mode===D$.HORIZONTAL?this.totalLength=r.width:this._mode===D$.VERTICAL?this.totalLength=r.height:this.totalLength=this._barSprite.fillRange,e.parent===this.node){var o=-n.width*i.x;e.setPosition(o,0,0)}}},n._updateBarStatus=function(){if(this._barSprite){var e=this._barSprite.node;if(!e)return;var t=e._uiProps.uiTransformComp,n=t.anchorPoint,i=t.contentSize,r=e.getPosition(),o=new zn(0,.5),a=$t(this._progress),s=this._totalLength*a,c=i,l=0,u=0;switch(this._mode){case D$.HORIZONTAL:this._reverse&&(o=new zn(1,.5)),c=new jn(s,i.height),l=this._totalLength,u=i.height;break;case D$.VERTICAL:o=this._reverse?new zn(.5,1):new zn(.5,0),c=new jn(i.width,s),l=i.width,u=this._totalLength}if(this._mode===D$.FILLED)this._barSprite.type!==sj.Type.FILLED?d("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this._reverse&&(s*=-1),this._barSprite.fillRange=s);else if(this._barSprite.type!==sj.Type.FILLED){var h=o.x-n.x,_=o.y-n.y,f=new yn(l*h,u*_,0);e.setPosition(r.x+f.x,r.y+f.y,r.z),t.setAnchorPoint(o),t.setContentSize(c)}else d("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},X(t,[{key:"barSprite",get:function(){return this._barSprite},set:function(e){this._barSprite!==e&&(this._barSprite=e,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(e){if(this._mode!==e&&(this._mode=e,this._barSprite)){var t=this._barSprite.node;if(!t)return;var n=t._uiProps.uiTransformComp.contentSize;this._mode===D$.HORIZONTAL?this.totalLength=n.width:this._mode===D$.VERTICAL?this.totalLength=n.height:this._mode===D$.FILLED&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(e){this._mode===D$.FILLED&&(e=$t(e)),this._totalLength=e,this._updateBarStatus()}},{key:"progress",get:function(){return this._progress},set:function(e){this._progress!==e&&(this._progress=e,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(e){this._reverse!==e&&(this._reverse=e,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),t}(Xd),P$.Mode=D$,te((A$=O$).prototype,"barSprite",[p$,m$],Object.getOwnPropertyDescriptor(A$.prototype,"barSprite"),A$.prototype),te(A$.prototype,"mode",[g$,v$],Object.getOwnPropertyDescriptor(A$.prototype,"mode"),A$.prototype),te(A$.prototype,"totalLength",[y$],Object.getOwnPropertyDescriptor(A$.prototype,"totalLength"),A$.prototype),te(A$.prototype,"progress",[S$,G_,E$],Object.getOwnPropertyDescriptor(A$.prototype,"progress"),A$.prototype),te(A$.prototype,"reverse",[T$],Object.getOwnPropertyDescriptor(A$.prototype,"reverse"),A$.prototype),C$=te(A$.prototype,"_barSprite",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b$=te(A$.prototype,"_mode",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return D$.HORIZONTAL}}),w$=te(A$.prototype,"_totalLength",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),R$=te(A$.prototype,"_progress",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),I$=te(A$.prototype,"_reverse",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),x$=A$))||x$)||x$)||x$)||x$)||x$)),s0=new yn,c0=new yn,l0=new yn,u0=new zn,h0=new gn,_0=new zn;!function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL"}(o0||(o0={})),et(o0);var f0,d0,p0,m0,g0,v0,y0,S0,E0,T0,x0,A0,C0,b0,w0,R0,I0,P0,O0,D0,N0,M0,L0,B0,F0,z0,U0,H0,G0,k0,V0,W0,j0,q0,X0,Y0,K0,Z0,Q0,J0,$0,e1,t1,n1,i1,r1,o1,a1,s1,c1=function(t){return e({ScrollBar:t,ScrollBarComponent:t}),t}((L$=S_("cc.ScrollBar"),B$=D_(),F$=T_(110),z$=R_(),U$=E_(zH),H$=K_(sj),G$=k_(),k$=B_(),V$=K_(o0),W$=k_(),j$=B_(),q$=k_(),X$=B_(),Y$=k_(),K$=B_(),L$(Z$=B$(Z$=F$(Z$=z$(Z$=U$((r0=i0=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_scrollView",J$,Q(t)),ee(t,"_handle",$$,Q(t)),ee(t,"_direction",e0,Q(t)),ee(t,"_enableAutoHide",t0,Q(t)),ee(t,"_autoHideTime",n0,Q(t)),t._touching=!1,t._opacity=255,t._autoHideRemainingTime=0,t}K(t,e);var n=t.prototype;return n.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},n.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity)},n.onScroll=function(e){if(this._scrollView){var t=this._scrollView.content;if(t){var n=t._uiProps.uiTransformComp.contentSize,i=this._scrollView.node._uiProps.uiTransformComp.contentSize,r=this.node._uiProps.uiTransformComp.contentSize;if(!this._conditionalDisableScrollBar(n,i)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var o=0,a=0,s=0,c=0,l=0,u=_0;u.set(0,0),this._direction===o0.HORIZONTAL?(o=n.width,a=i.width,l=r.width,s=e.x,this._convertToScrollViewSpace(u,t),c=-u.x):this._direction===o0.VERTICAL&&(o=n.height,a=i.height,l=r.height,s=e.y,this._convertToScrollViewSpace(u,t),c=-u.y);var h=this._calculateLength(o,a,l,s),_=_0;this._calculatePosition(_,o,a,l,c,s,h),this._updateLength(h),this._updateHandlerPosition(_)}}}},n.setScrollView=function(e){this._scrollView=e},n.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},n.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var e=this._scrollView.content;if(e){var t=e._uiProps.uiTransformComp.contentSize,n=this._scrollView.node._uiProps.uiTransformComp.contentSize;if(this._conditionalDisableScrollBar(t,n))return}}this._autoHideRemainingTime=this._autoHideTime}},n.onEnable=function(){var e=this.node.getComponent(sj);e&&(this._opacity=e.color.a)},n.start=function(){this._enableAutoHide&&this._setOpacity(0)},n.update=function(e){this._processAutoHide(e)},n._convertToScrollViewSpace=function(e,t){var n=this._scrollView&&this._scrollView.node._uiProps.uiTransformComp,i=t._uiProps.uiTransformComp;if(n&&i){s0.set(-i.anchorX*i.width,-i.anchorY*i.height,0),i.convertToWorldSpaceAR(s0,c0);var r=n.convertToNodeSpaceAR(c0);r.x+=n.anchorX*n.width,r.y+=n.anchorY*n.height,e.set(r.x,r.y)}else e.set(zn.ZERO)},n._setOpacity=function(e){if(this._handle){var t=this.node.getComponent(sj);t&&(h0.set(t.color),h0.a=e,t.color=h0),(t=this._handle.getComponent(sj))&&(h0.set(t.color),h0.a=e,t.color=h0)}},n._updateHandlerPosition=function(e){if(this._handle){var t=l0;this._fixupHandlerPosition(t),this._handle.node.setPosition(e.x+t.x,e.y+t.y,t.z)}},n._fixupHandlerPosition=function(e){var t=this.node._uiProps.uiTransformComp,n=t.contentSize,i=t.anchorPoint,r=this.handle.node._uiProps.uiTransformComp.contentSize,o=this.handle.node.parent;yn.set(s0,-n.width*i.x,-n.height*i.y,0);var a=this.node._uiProps.uiTransformComp.convertToWorldSpaceAR(s0,c0),s=e;s.set(0,0,0),o._uiProps.uiTransformComp.convertToNodeSpaceAR(a,s),this.direction===o0.HORIZONTAL?s.set(s.x,s.y+(n.height-r.height)/2,s.z):this.direction===o0.VERTICAL&&s.set(s.x+(n.width-r.width)/2,s.y,s.z),this.handle.node.setPosition(s)},n._conditionalDisableScrollBar=function(e,t){return e.width<=t.width&&this._direction===o0.HORIZONTAL||e.height<=t.height&&this._direction===o0.VERTICAL},n._calculateLength=function(e,t,n,i){var r=e;return i&&(r+=20*(i>0?i:-i)),n*(t/r)},n._calculatePosition=function(e,t,n,i,r,o,a){var s=t-n;o&&(s+=Math.abs(o));var c=0;s&&(c=$t(c=r/s));var l=(i-a)*c;this._direction===o0.VERTICAL?e.set(0,l):e.set(l,0)},n._updateLength=function(e){if(this._handle){var t=this._handle.node._uiProps.uiTransformComp,n=t.contentSize,i=t.anchorPoint;i.x===u0.x&&i.y===u0.y||t.setAnchorPoint(u0),this._direction===o0.HORIZONTAL?t.setContentSize(e,n.height):t.setContentSize(n.width,e)}},n._processAutoHide=function(e){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=e,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var t=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(t)}},X(t,[{key:"handle",get:function(){return this._handle},set:function(e){this._handle!==e&&(this._handle=e,this.onScroll(zn.ZERO))}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction!==e&&(this._direction=e,this.onScroll(zn.ZERO))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(e){this._enableAutoHide!==e&&(this._enableAutoHide=e,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(e){this._autoHideTime!==e&&(this._autoHideTime=e)}}]),t}(Xd),i0.Direction=o0,te((Q$=r0).prototype,"handle",[H$,G$,k$],Object.getOwnPropertyDescriptor(Q$.prototype,"handle"),Q$.prototype),te(Q$.prototype,"direction",[V$,W$,j$],Object.getOwnPropertyDescriptor(Q$.prototype,"direction"),Q$.prototype),te(Q$.prototype,"enableAutoHide",[q$,X$],Object.getOwnPropertyDescriptor(Q$.prototype,"enableAutoHide"),Q$.prototype),te(Q$.prototype,"autoHideTime",[Y$,K$],Object.getOwnPropertyDescriptor(Q$.prototype,"autoHideTime"),Q$.prototype),J$=te(Q$.prototype,"_scrollView",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$$=te(Q$.prototype,"_handle",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e0=te(Q$.prototype,"_direction",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return o0.HORIZONTAL}}),t0=te(Q$.prototype,"_enableAutoHide",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),n0=te(Q$.prototype,"_autoHideTime",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Z$=Q$))||Z$)||Z$)||Z$)||Z$)||Z$)),l1=e("ViewGroup",S_("cc.ViewGroup")(f0=T_(110)(f0=function(e){function t(){return e.apply(this,arguments)||this}return K(t,e),t}(Xd))||f0)||f0);i.ViewGroup=l1;var u1,h1=1e-4,_1=new yn,f1=new yn,d1=new zn,p1=new zn,m1=function(){return(new Date).getMilliseconds()},g1={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12};!function(e){e.SCROLL_TO_TOP="scroll-to-top",e.SCROLL_TO_BOTTOM="scroll-to-bottom",e.SCROLL_TO_LEFT="scroll-to-left",e.SCROLL_TO_RIGHT="scroll-to-right",e.SCROLL_BEGAN="scroll-began",e.SCROLL_ENDED="scroll-ended",e.BOUNCE_TOP="bounce-top",e.BOUNCE_BOTTOM="bounce-bottom",e.BOUNCE_LEFT="bounce-left",e.BOUNCE_RIGHT="bounce-right",e.SCROLLING="scrolling",e.SCROLL_ENG_WITH_THRESHOLD="scroll-ended-with-threshold",e.TOUCH_UP="touch-up"}(u1||(u1={}));var v1,y1,S1,E1,T1,x1,A1,C1,b1,w1,R1,I1,P1,O1,D1,N1,M1,L1,B1,F1,z1,U1,H1=function(t){return e({ScrollView:t,ScrollViewComponent:t}),t}((d0=S_("cc.ScrollView"),p0=D_(),m0=T_(110),g0=R_(),v0=E_(zH),y0=F_(),S0=k_(),E0=B_(),T0=F_(),x0=k_(),A0=B_(),C0=k_(),b0=B_(),w0=k_(),R0=B_(),I0=K_(Vv),P0=k_(),O0=B_(),D0=k_(),N0=B_(),M0=K_(c1),L0=k_(),B0=B_(),F0=k_(),z0=B_(),U0=K_(c1),H0=k_(),G0=B_(),k0=k_(),V0=B_(),W0=K_([iM]),j0=k_(),q0=B_(),d0(X0=p0(X0=m0(X0=g0(X0=v0((s1=a1=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"bounceDuration",K0,Q(t)),ee(t,"brake",Z0,Q(t)),ee(t,"elastic",Q0,Q(t)),ee(t,"inertia",J0,Q(t)),ee(t,"horizontal",$0,Q(t)),ee(t,"vertical",e1,Q(t)),ee(t,"cancelInnerEvents",t1,Q(t)),ee(t,"scrollEvents",n1,Q(t)),t._autoScrolling=!1,t._scrolling=!1,ee(t,"_content",i1,Q(t)),ee(t,"_horizontalScrollBar",r1,Q(t)),ee(t,"_verticalScrollBar",o1,Q(t)),t._topBoundary=0,t._bottomBoundary=0,t._leftBoundary=0,t._rightBoundary=0,t._touchMoveDisplacements=[],t._touchMoveTimeDeltas=[],t._touchMovePreviousTimestamp=0,t._touchMoved=!1,t._autoScrollAttenuate=!1,t._autoScrollStartPosition=new yn,t._autoScrollTargetDelta=new yn,t._autoScrollTotalTime=0,t._autoScrollAccumulatedTime=0,t._autoScrollCurrentlyOutOfBoundary=!1,t._autoScrollBraking=!1,t._autoScrollBrakingStartPosition=new yn,t._outOfBoundaryAmount=new yn,t._outOfBoundaryAmountDirty=!0,t._stopMouseWheel=!1,t._mouseWheelEventElapsedTime=0,t._isScrollEndedWithThresholdEventFired=!1,t._scrollEventEmitMask=0,t._isBouncing=!1,t._contentPos=new yn,t._deltaPos=new yn,t}K(t,e);var n=t.prototype;return n.scrollToBottom=function(e,t){void 0===t&&(t=!0);var n=this._calculateMovePercentDelta({anchor:new zn(0,0),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(n,e,!1!==t):this._moveContent(n,!0)},n.scrollToTop=function(e,t){void 0===t&&(t=!0);var n=this._calculateMovePercentDelta({anchor:new zn(0,1),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(n,e,!1!==t):this._moveContent(n)},n.scrollToLeft=function(e,t){void 0===t&&(t=!0);var n=this._calculateMovePercentDelta({anchor:new zn(0,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(n,e,!1!==t):this._moveContent(n)},n.scrollToRight=function(e,t){void 0===t&&(t=!0);var n=this._calculateMovePercentDelta({anchor:new zn(1,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(n,e,!1!==t):this._moveContent(n)},n.scrollToTopLeft=function(e,t){void 0===t&&(t=!0);var n=this._calculateMovePercentDelta({anchor:new zn(0,1),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(n,e,!1!==t):this._moveContent(n)},n.scrollToTopRight=function(e,t){void 0===t&&(t=!0);var n=this._calculateMovePercentDelta({anchor:new zn(1,1),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(n,e,!1!==t):this._moveContent(n)},n.scrollToBottomLeft=function(e,t){void 0===t&&(t=!0);var n=this._calculateMovePercentDelta({anchor:new zn(0,0),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(n,e,!1!==t):this._moveContent(n)},n.scrollToBottomRight=function(e,t){void 0===t&&(t=!0);var n=this._calculateMovePercentDelta({anchor:new zn(1,0),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(n,e,!1!==t):this._moveContent(n)},n.scrollToOffset=function(e,t,n){void 0===n&&(n=!0);var i=this.getMaxScrollOffset(),r=new zn(0,0);0===i.x?r.x=0:r.x=e.x/i.x,0===i.y?r.y=1:r.y=(i.y-e.y)/i.y,this.scrollTo(r,t,n)},n.getScrollOffset=function(){var e=this._getContentTopBoundary()-this._topBoundary,t=this._getContentLeftBoundary()-this._leftBoundary;return new zn(t,e)},n.getMaxScrollOffset=function(){if(!this._content||!this.view)return zn.ZERO;var e=this._content._uiProps.uiTransformComp.contentSize,t=e.width-this.view.width,n=e.height-this.view.height;return new zn(t=t>=0?t:0,n=n>=0?n:0)},n.scrollToPercentHorizontal=function(e,t,n){var i=this._calculateMovePercentDelta({anchor:new zn(e,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==n):this._moveContent(i)},n.scrollTo=function(e,t,n){var i=this._calculateMovePercentDelta({anchor:new zn(e),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,n):this._moveContent(i)},n.scrollToPercentVertical=function(e,t,n){var i=this._calculateMovePercentDelta({anchor:new zn(0,e),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,n):this._moveContent(i)},n.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},n.setContentPosition=function(e){this._setContentPosition(e)},n._setContentPosition=function(e){if(this._content){var t=this._getContentPosition();Math.abs(e.x-t.x)<h1&&Math.abs(e.y-t.y)<h1||(this._content.setPosition(e),this._outOfBoundaryAmountDirty=!0)}},n.getContentPosition=function(){return this._getContentPosition()},n._getContentPosition=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):yn.ZERO},n.isScrolling=function(){return this._scrolling},n.isAutoScrolling=function(){return this._autoScrolling},n.getScrollEndedEventTiming=function(){return h1},n.start=function(){this._calculateBoundary(),this._content&&SO.once(yO.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},n.onEnable=function(){this._registerEvent(),this._content&&(this._content.on(Vv.EventType.SIZE_CHANGED,this._calculateBoundary,this),this._content.on(Vv.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.on(Vv.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.on(Vv.EventType.SIZE_CHANGED,this._calculateBoundary,this))),this._calculateBoundary(),this._updateScrollBarState()},n.update=function(e){this._autoScrolling&&this._processAutoScrolling(e)},n.onDisable=function(){this._unregisterEvent(),this._content&&(this._content.off(Vv.EventType.SIZE_CHANGED,this._calculateBoundary,this),this._content.off(Vv.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.off(Vv.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.off(Vv.EventType.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollBar(),this.stopAutoScroll()},n._registerEvent=function(){this.node.on(Vv.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(Vv.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(Vv.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(Vv.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(Vv.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},n._unregisterEvent=function(){this.node.off(Vv.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(Vv.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(Vv.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(Vv.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(Vv.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},n._onMouseWheel=function(e,t){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(e,t)){var n=new yn,i=e.getScrollY();this.vertical?n.set(0,-.1*i,0):this.horizontal&&n.set(-.1*i,0,0),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(n),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60,NaN,0),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(e)}},n._onTouchBegan=function(e,t){this.enabledInHierarchy&&this._content&&(this._hasNestedViewGroup(e,t)||(this._handlePressLogic(),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(e)))},n._onTouchMoved=function(e,t){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(e,t)){var n=e.touch;if(this._handleMoveLogic(n),this.cancelInnerEvents){var i=n.getUILocation(d1);if(i.subtract(n.getUIStartLocation(p1)),i.length()>7&&!this._touchMoved&&e.target!==this.node){var r=new by(e.getTouches(),e.bubbles);r.type=Vv.EventType.TOUCH_CANCEL,r.touch=e.touch,r.simulate=!0,e.target.dispatchEvent(r),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(e)}}},n._onTouchEnded=function(e,t){if(this.enabledInHierarchy&&this._content&&e&&!this._hasNestedViewGroup(e,t)){this._dispatchEvent(u1.TOUCH_UP);var n=e.touch;this._handleReleaseLogic(n),this._touchMoved?e.propagationStopped=!0:this._stopPropagationIfTargetIsMe(e)}},n._onTouchCancelled=function(e,t){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(e,t)){if(e&&!e.simulate){var n=e.touch;this._handleReleaseLogic(n)}this._stopPropagationIfTargetIsMe(e)}},n._calculateBoundary=function(){if(this._content&&this.view){var e=this._content.getComponent(M$);e&&e.enabledInHierarchy&&e.updateLayout();var t=this.view,n=t.width*t.anchorX,i=t.height*t.anchorY;this._leftBoundary=-n,this._bottomBoundary=-i,this._rightBoundary=this._leftBoundary+t.width,this._topBoundary=this._bottomBoundary+t.height,this._moveContentToTopLeft(t.contentSize)}},n._hasNestedViewGroup=function(e,t){if(!e||e.eventPhase!==wf.CAPTURING_PHASE)return!1;if(t)for(var n,i=$(t);!(n=i()).done;){var r=n.value;if(this.node===r)return!(!e.target||!e.target.getComponent(l1));if(r.getComponent(l1))return!0}return!1},n._startInertiaScroll=function(e){var t=new yn(e);t.multiplyScalar(.7),this._startAttenuatingAutoScroll(t,e)},n._calculateAttenuatedFactor=function(e){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*e+e*e*8e-9))},n._startAttenuatingAutoScroll=function(e,t){var n=e.clone();if(n.normalize(),this._content&&this.view){var i=this._content._uiProps.uiTransformComp.contentSize,r=this.view.contentSize,o=i.width-r.width,a=i.height-r.height,s=this._calculateAttenuatedFactor(o),c=this._calculateAttenuatedFactor(a);n.x=n.x*o*(1-this.brake)*s,n.y=n.y*a*c*(1-this.brake),n.z=0}var l=e.length(),u=n.length()/l;if(n.add(e),this.brake>0&&u>7){u=Math.sqrt(u);var h=e.clone();h.multiplyScalar(u),n.set(h),n.add(e)}var _=this._calculateAutoScrollTimeByInitialSpeed(t.length());this.brake>0&&u>3&&(_*=u=3),0===this.brake&&u>1&&(_*=u),this._startAutoScroll(n,_,!0)},n._calculateAutoScrollTimeByInitialSpeed=function(e){return Math.sqrt(Math.sqrt(e/5))},n._startAutoScroll=function(e,t,n){void 0===n&&(n=!1);var i=this._flattenVectorByDirection(e);this._autoScrolling=!0,this._autoScrollTargetDelta=i,this._autoScrollAttenuate=n,yn.copy(this._autoScrollStartPosition,this._getContentPosition()),this._autoScrollTotalTime=t,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition.set(0,0,0),this._getHowMuchOutOfBoundary().equals(yn.ZERO,h1)||(this._autoScrollCurrentlyOutOfBoundary=!0)},n._calculateTouchMoveVelocity=function(){var e=new yn,t=0;if((t=this._touchMoveTimeDeltas.reduce((function(e,t){return e+t}),t))<=0||t>=.5)e.set(yn.ZERO);else{var n=new yn;n=this._touchMoveDisplacements.reduce((function(e,t){return e.add(t),e}),n),e.set(n.x*(1-this.brake)/t,n.y*(1-this.brake)/t,n.z)}return e},n._flattenVectorByDirection=function(e){var t=e;return t.x=this.horizontal?t.x:0,t.y=this.vertical?t.y:0,t},n._moveContent=function(e,t){var n=this._flattenVectorByDirection(e);_1.set(this._getContentPosition()),_1.add(n),_1.set(Math.floor(1e4*_1.x)*h1,Math.floor(1e4*_1.y)*h1,_1.z),this._setContentPosition(_1);var i=this._getHowMuchOutOfBoundary();d1.set(i.x,i.y),this._updateScrollBar(d1),this.elastic&&t&&this._startBounceBackIfNeeded()},n._getContentLeftBoundary=function(){if(!this._content)return-1;var e=this._getContentPosition(),t=this._content._uiProps.uiTransformComp;return e.x-t.anchorX*t.width},n._getContentRightBoundary=function(){if(!this._content)return-1;var e=this._content._uiProps.uiTransformComp;return this._getContentLeftBoundary()+e.width},n._getContentTopBoundary=function(){if(!this._content)return-1;var e=this._content._uiProps.uiTransformComp;return this._getContentBottomBoundary()+e.height},n._getContentBottomBoundary=function(){if(!this._content)return-1;var e=this._getContentPosition(),t=this._content._uiProps.uiTransformComp;return e.y-t.anchorY*t.height},n._getHowMuchOutOfBoundary=function(e){if((e=e||new yn).equals(yn.ZERO,h1)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var t=new yn;return this._getContentLeftBoundary()+e.x>this._leftBoundary?t.x=this._leftBoundary-(this._getContentLeftBoundary()+e.x):this._getContentRightBoundary()+e.x<this._rightBoundary&&(t.x=this._rightBoundary-(this._getContentRightBoundary()+e.x)),this._getContentTopBoundary()+e.y<this._topBoundary?t.y=this._topBoundary-(this._getContentTopBoundary()+e.y):this._getContentBottomBoundary()+e.y>this._bottomBoundary&&(t.y=this._bottomBoundary-(this._getContentBottomBoundary()+e.y)),e.equals(yn.ZERO,h1)&&(this._outOfBoundaryAmount=t,this._outOfBoundaryAmountDirty=!1),this._clampDelta(t),t},n._updateScrollBar=function(e){this._horizontalScrollBar&&this._horizontalScrollBar.onScroll(e),this.verticalScrollBar&&this.verticalScrollBar.onScroll(e)},n._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar.onTouchBegan()},n._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar.onTouchEnded()},n._dispatchEvent=function(e){if(e===u1.SCROLL_ENDED)this._scrollEventEmitMask=0;else if(e===u1.SCROLL_TO_TOP||e===u1.SCROLL_TO_BOTTOM||e===u1.SCROLL_TO_LEFT||e===u1.SCROLL_TO_RIGHT){var t=1<<g1[e];if(this._scrollEventEmitMask&t)return;this._scrollEventEmitMask|=t}iM.emitEvents(this.scrollEvents,this,g1[e]),this.node.emit(e,this)},n._adjustContentOutOfBoundary=function(){if(this._content&&(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary())){var e=this._getHowMuchOutOfBoundary();_1.set(this._getContentPosition()),_1.add(e),this._content.setPosition(_1),this._updateScrollBar(zn.ZERO)}},n._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.hide()},n._updateScrollBarState=function(){if(this._content&&this.view){var e=this.view,t=this._content._uiProps.uiTransformComp;this.verticalScrollBar&&(t.height<e.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(t.width<e.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show())}},n._stopPropagationIfTargetIsMe=function(e){e.eventPhase===wf.AT_TARGET&&e.target===this.node&&(e.propagationStopped=!0)},n._processDeltaMove=function(e){this._scrollChildren(e),this._gatherTouchMove(e)},n._handleMoveLogic=function(e){this._getLocalAxisAlignDelta(this._deltaPos,e),this._processDeltaMove(this._deltaPos)},n._handleReleaseLogic=function(e){this._getLocalAxisAlignDelta(this._deltaPos,e),this._gatherTouchMove(this._deltaPos),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(u1.SCROLL_ENDED))},n._getLocalAxisAlignDelta=function(e,t){var n=this.node._uiProps.uiTransformComp,i=new yn;n&&(t.getUILocation(d1),t.getUIPreviousLocation(p1),_1.set(d1.x,d1.y,0),f1.set(p1.x,p1.y,0),n.convertToNodeSpaceAR(_1,_1),n.convertToNodeSpaceAR(f1,f1),yn.subtract(i,_1,f1)),e.set(i)},n._scrollChildren=function(e){this._clampDelta(e);var t,n,i=e;if(this.elastic&&(t=this._getHowMuchOutOfBoundary(),i.x*=0===t.x?1:.5,i.y*=0===t.y?1:.5),this.elastic||(t=this._getHowMuchOutOfBoundary(i),i.add(t)),this._content){var r=this._content._uiProps.uiTransformComp,o=r.anchorX,a=r.anchorY,s=r.width,c=r.height,l=this._content.position||yn.ZERO;i.y>0?l.y-a*c+i.y>=this._bottomBoundary&&(n=u1.SCROLL_TO_BOTTOM):i.y<0&&l.y-a*c+c+i.y<=this._topBoundary&&(n=u1.SCROLL_TO_TOP),i.x<0?l.x-o*s+s+i.x<=this._rightBoundary&&(n=u1.SCROLL_TO_RIGHT):i.x>0&&l.x-o*s+i.x>=this._leftBoundary&&(n=u1.SCROLL_TO_LEFT)}this._moveContent(i,!1),0===i.x&&0===i.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent(u1.SCROLL_BEGAN)),this._dispatchEvent(u1.SCROLLING)),n&&n.length>0&&this._dispatchEvent(n)},n._handlePressLogic=function(){this._autoScrolling&&this._dispatchEvent(u1.SCROLL_ENDED),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=m1(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},n._clampDelta=function(e){if(this._content&&this.view){var t=this.view.contentSize,n=this._content._uiProps.uiTransformComp;n.width<t.width&&(e.x=0),n.height<t.height&&(e.y=0)}},n._gatherTouchMove=function(e){var t=e.clone();for(this._clampDelta(t);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(t);var n=m1();this._touchMoveTimeDeltas.push((n-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=n},n._startBounceBackIfNeeded=function(){if(!this.elastic)return!1;var e=this._getHowMuchOutOfBoundary();if(this._clampDelta(e),e.equals(yn.ZERO,h1))return!1;var t=Math.max(this.bounceDuration,0);return this._startAutoScroll(e,t,!0),this._isBouncing||(e.y>0&&this._dispatchEvent(u1.BOUNCE_TOP),e.y<0&&this._dispatchEvent(u1.BOUNCE_BOTTOM),e.x>0&&this._dispatchEvent(u1.BOUNCE_RIGHT),e.x<0&&this._dispatchEvent(u1.BOUNCE_LEFT),this._isBouncing=!0),!0},n._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var e=this._calculateTouchMoveVelocity();!e.equals(_1,h1)&&this.brake<1&&this._startInertiaScroll(e)}this._onScrollBarTouchEnded()},n._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals(yn.ZERO,h1)},n._isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this._getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},n._processAutoScrolling=function(e){var t=this._isNecessaryAutoScrollBrake(),n=t?.05:1;this._autoScrollAccumulatedTime+=e*(1/n);var i,r=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(i=r,r=(i-=1)*i*i*i*i+1);var o=this._autoScrollTargetDelta.clone();o.multiplyScalar(r);var a=this._autoScrollStartPosition.clone();a.add(o);var s=Math.abs(r-1)<=h1;if(Math.abs(r-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent(u1.SCROLL_ENG_WITH_THRESHOLD),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var c=a.clone();c.subtract(this._autoScrollBrakingStartPosition),t&&c.multiplyScalar(n),a.set(this._autoScrollBrakingStartPosition),a.add(c)}else{var l=a.clone();l.subtract(this.getContentPosition());var u=this._getHowMuchOutOfBoundary(l);u.equals(yn.ZERO,h1)||(a.add(u),s=!0)}s&&(this._autoScrolling=!1);var h=a.clone();h.subtract(this._getContentPosition()),this._clampDelta(h),this._moveContent(h,s),this._dispatchEvent(u1.SCROLLING),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent(u1.SCROLL_ENDED))},n._checkMouseWheel=function(e){if(!this._getHowMuchOutOfBoundary().equals(yn.ZERO,h1))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(u1.SCROLL_ENDED),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=e,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(u1.SCROLL_ENDED),this._stopMouseWheel=!1)},n._calculateMovePercentDelta=function(e){var t=e.anchor,n=e.applyToHorizontal,i=e.applyToVertical;this._calculateBoundary(),t.clampf(zn.ZERO,zn.ONE);var r=this._getContentBottomBoundary()-this._bottomBoundary;r=-r;var o=this._getContentLeftBoundary()-this._leftBoundary;o=-o;var a=new yn;if(this._content&&this.view){var s=0,c=this._content._uiProps.uiTransformComp.contentSize,l=this.view.contentSize;n&&(s=c.width-l.width,a.x=o-s*t.x),i&&(s=c.height-l.height,a.y=r-s*t.y)}return a},n._moveContentToTopLeft=function(e){var t=this._getContentBottomBoundary()-this._bottomBoundary;t=-t;var n=new yn,i=0,r=this._getContentLeftBoundary()-this._leftBoundary;if(r=-r,this._content){var o=this._content._uiProps.uiTransformComp.contentSize;o.height<e.height&&(i=o.height-e.height,n.y=t-i),o.width<e.width&&(i=o.width-e.width,n.x=r)}this._updateScrollBarState(),this._moveContent(n),this._adjustContentOutOfBoundary()},n._scaleChanged=function(e){e===t_.SCALE&&this._calculateBoundary()},X(t,[{key:"content",get:function(){return this._content},set:function(e){if(this._content!==e){var t=e&&e.parent&&e.parent._uiProps.uiTransformComp;!e||e&&t?(this._content=e,this._calculateBoundary()):T(4302)}}},{key:"horizontalScrollBar",get:function(){return this._horizontalScrollBar},set:function(e){this._horizontalScrollBar!==e&&(this._horizontalScrollBar=e,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(zn.ZERO)))}},{key:"verticalScrollBar",get:function(){return this._verticalScrollBar},set:function(e){this._verticalScrollBar!==e&&(this._verticalScrollBar=e,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(zn.ZERO)))}},{key:"view",get:function(){var e=this._content&&this._content.parent;return e?e._uiProps.uiTransformComp:null}}]),t}(l1),a1.EventType=u1,K0=te((Y0=s1).prototype,"bounceDuration",[C_,y0,S0,E0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Z0=te(Y0.prototype,"brake",[C_,T0,x0,A0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Q0=te(Y0.prototype,"elastic",[C_,C0,b0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),J0=te(Y0.prototype,"inertia",[C_,w0,R0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),te(Y0.prototype,"content",[I0,P0,O0],Object.getOwnPropertyDescriptor(Y0.prototype,"content"),Y0.prototype),$0=te(Y0.prototype,"horizontal",[C_,D0,N0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),te(Y0.prototype,"horizontalScrollBar",[M0,L0,B0],Object.getOwnPropertyDescriptor(Y0.prototype,"horizontalScrollBar"),Y0.prototype),e1=te(Y0.prototype,"vertical",[C_,F0,z0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),te(Y0.prototype,"verticalScrollBar",[U0,H0,G0],Object.getOwnPropertyDescriptor(Y0.prototype,"verticalScrollBar"),Y0.prototype),t1=te(Y0.prototype,"cancelInnerEvents",[C_,k0,V0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),n1=te(Y0.prototype,"scrollEvents",[W0,C_,j0,q0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),i1=te(Y0.prototype,"_content",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),r1=te(Y0.prototype,"_horizontalScrollBar",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),o1=te(Y0.prototype,"_verticalScrollBar",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X0=Y0))||X0)||X0)||X0)||X0)||X0)),G1=new yn;!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(U1||(U1={})),et(U1);var k1,V1,W1,j1,q1,X1,Y1,K1,Z1,Q1,J1,$1,e2,t2,n2,i2,r2,o2,a2,s2,c2=function(t){return e({Slider:t,SliderComponent:t}),t}((v1=S_("cc.Slider"),y1=D_(),S1=T_(110),E1=R_(),T1=E_(zH),x1=K_(sj),A1=B_(),C1=K_(U1),b1=B_(),w1=F_(),R1=B_(),I1=K_([iM]),P1=B_(),v1(O1=y1(O1=S1(O1=E1(O1=T1((z1=F1=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"slideEvents",N1,Q(t)),ee(t,"_handle",M1,Q(t)),ee(t,"_direction",L1,Q(t)),ee(t,"_progress",B1,Q(t)),t._offset=new yn,t._dragging=!1,t._touchHandle=!1,t._handleLocalPos=new yn,t._touchPos=new yn,t}K(t,e);var n=t.prototype;return n.__preload=function(){this._updateHandlePosition()},n.onEnable=function(){this._updateHandlePosition(),this.node.on(bm.TOUCH_START,this._onTouchBegan,this),this.node.on(bm.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(bm.TOUCH_END,this._onTouchEnded,this),this.node.on(bm.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.on(bm.TOUCH_START,this._onHandleDragStart,this),this._handle.node.on(bm.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.on(bm.TOUCH_END,this._onTouchEnded,this))},n.onDisable=function(){this.node.off(bm.TOUCH_START,this._onTouchBegan,this),this.node.off(bm.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(bm.TOUCH_END,this._onTouchEnded,this),this.node.off(bm.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.off(bm.TOUCH_START,this._onHandleDragStart,this),this._handle.node.off(bm.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.off(bm.TOUCH_END,this._onTouchEnded,this))},n._onHandleDragStart=function(e){if(e&&this._handle&&this._handle.node._uiProps.uiTransformComp){this._dragging=!0,this._touchHandle=!0;var t=e.touch.getUILocation();yn.set(this._touchPos,t.x,t.y,0),this._handle.node._uiProps.uiTransformComp.convertToNodeSpaceAR(this._touchPos,this._offset),e.propagationStopped=!0}},n._onTouchBegan=function(e){this._handle&&e&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(e.touch),e.propagationStopped=!0)},n._onTouchMoved=function(e){this._dragging&&e&&(this._handleSliderLogic(e.touch),e.propagationStopped=!0)},n._onTouchEnded=function(e){this._dragging=!1,this._touchHandle=!1,this._offset=new yn,e&&(e.propagationStopped=!0)},n._onTouchCancelled=function(e){this._dragging=!1,e&&(e.propagationStopped=!0)},n._handleSliderLogic=function(e){this._updateProgress(e),this._emitSlideEvent()},n._emitSlideEvent=function(){iM.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},n._updateProgress=function(e){if(this._handle&&e){var t=e.getUILocation();yn.set(this._touchPos,t.x,t.y,0);var n=this.node._uiProps.uiTransformComp,i=n.convertToNodeSpaceAR(this._touchPos,G1);this.direction===U1.Horizontal?this.progress=$t(.5+(i.x-this._offset.x)/n.width):this.progress=$t(.5+(i.y-this._offset.y)/n.height)}},n._updateHandlePosition=function(){if(this._handle){this._handleLocalPos.set(this._handle.node.getPosition());var e=this.node._uiProps.uiTransformComp;this._direction===U1.Horizontal?this._handleLocalPos.x=-e.width*e.anchorX+this.progress*e.width:this._handleLocalPos.y=-e.height*e.anchorY+this.progress*e.height,this._handle.node.setPosition(this._handleLocalPos)}},n._changeLayout=function(){var e=this.node._uiProps.uiTransformComp,t=e.contentSize;if(e.setContentSize(t.height,t.width),this._handle){var n=this._handle.node.position;this._direction===U1.Horizontal?this._handle.node.setPosition(n.x,0,n.z):this._handle.node.setPosition(0,n.y,n.z),this._updateHandlePosition()}},X(t,[{key:"handle",get:function(){return this._handle},set:function(e){this._handle!==e&&(this._handle=e)}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction!==e&&(this._direction=e,this._changeLayout())}},{key:"progress",get:function(){return this._progress},set:function(e){this._progress!==e&&(this._progress=e,this._updateHandlePosition())}}]),t}(Xd),F1.Direction=U1,te((D1=z1).prototype,"handle",[x1,A1],Object.getOwnPropertyDescriptor(D1.prototype,"handle"),D1.prototype),te(D1.prototype,"direction",[C1,b1],Object.getOwnPropertyDescriptor(D1.prototype,"direction"),D1.prototype),te(D1.prototype,"progress",[G_,w1,R1],Object.getOwnPropertyDescriptor(D1.prototype,"progress"),D1.prototype),N1=te(D1.prototype,"slideEvents",[I1,C_,P1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),M1=te(D1.prototype,"_handle",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L1=te(D1.prototype,"_direction",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return U1.Horizontal}}),B1=te(D1.prototype,"_progress",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),O1=D1))||O1)||O1)||O1)||O1)||O1));function l2(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Object.assign.apply(Object,[{}].concat(t))}!function(e){e.TOGGLE="toggle"}(s2||(s2={}));var u2,h2,_2,f2,d2,p2,m2,g2,v2,y2,S2,E2,T2,x2,A2,C2,b2,w2,R2,I2,P2,O2,D2,N2,M2,L2,B2,F2,z2,U2,H2,G2,k2,V2,W2,j2,q2,X2,Y2,K2,Z2,Q2,J2,$2,e4,t4,n4,i4,r4,o4,a4,s4,c4,l4,u4,h4,_4,f4,d4,p4=function(t){return e({Toggle:t,ToggleComponent:t}),t}((k1=S_("cc.Toggle"),V1=D_(),W1=T_(110),j1=R_(),q1=E_(zH),X1=k_(),Y1=B_(),K1=K_(sj),Z1=k_(),Q1=B_(),J1=K_([iM]),$1=B_(),k1(e2=V1(e2=W1(e2=j1(e2=q1((a2=o2=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"checkEvents",n2,Q(t)),ee(t,"_isChecked",i2,Q(t)),ee(t,"_checkMark",r2,Q(t)),t}K(t,e);var n=t.prototype;return n._internalToggle=function(){this.isChecked=!this.isChecked},n._set=function(e,t){if(void 0===t&&(t=!0),this._isChecked!=e){this._isChecked=e;var n=this._toggleContainer;n&&n.enabled&&this.enabled&&(e||!n.anyTogglesChecked()&&!n.allowSwitchOff)&&(this._isChecked=!0,n.notifyToggleCheck(this,t)),this.playEffect(),t&&this._emitToggleEvents()}},n.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},n.setIsCheckedWithoutNotify=function(e){this._set(e,!1)},n.onEnable=function(){e.prototype.onEnable.call(this),this.playEffect(),this.node.on(t.EventType.CLICK,this._internalToggle,this)},n.onDisable=function(){e.prototype.onDisable.call(this),this.node.off(t.EventType.CLICK,this._internalToggle,this)},n.OnDestroy=function(){var e=this._toggleContainer;e&&e.ensureValidState()},n._emitToggleEvents=function(){this.node.emit(t.EventType.TOGGLE,this),this.checkEvents&&iM.emitEvents(this.checkEvents,this)},X(t,[{key:"isChecked",get:function(){return this._isChecked},set:function(e){this._set(e)}},{key:"checkMark",get:function(){return this._checkMark},set:function(e){this._checkMark!==e&&(this._checkMark=e)}},{key:"_resizeToTarget",set:function(e){e&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var e=this.node.parent;return i.Node.isNode(e)?e.getComponent("cc.ToggleContainer"):null}}]),t}(HZ),o2.EventType=l2(s2,LZ),te((t2=a2).prototype,"isChecked",[X1,Y1],Object.getOwnPropertyDescriptor(t2.prototype,"isChecked"),t2.prototype),te(t2.prototype,"checkMark",[K1,Z1,Q1],Object.getOwnPropertyDescriptor(t2.prototype,"checkMark"),t2.prototype),n2=te(t2.prototype,"checkEvents",[J1,C_,$1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),i2=te(t2.prototype,"_isChecked",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),r2=te(t2.prototype,"_checkMark",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e2=t2))||e2)||e2)||e2)||e2)||e2)),m4=function(t){return e({ToggleContainer:t,ToggleContainerComponent:t}),t}((u2=S_("cc.ToggleContainer"),h2=D_(),_2=T_(110),f2=R_(),d2=B_(),p2=K_([iM]),m2=B_(),u2(g2=h2(g2=_2(g2=f2(g2=w_((E2=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_allowSwitchOff",y2,Q(t)),ee(t,"checkEvents",S2,Q(t)),t}K(t,e);var n=t.prototype;return n.onEnable=function(){this.ensureValidState(),this.node.on(bm.CHILD_ADDED,this.ensureValidState,this),this.node.on(bm.CHILD_REMOVED,this.ensureValidState,this)},n.onDisable=function(){this.node.off(bm.CHILD_ADDED,this.ensureValidState,this),this.node.off(bm.CHILD_REMOVED,this.ensureValidState,this)},n.activeToggles=function(){return this.toggleItems.filter((function(e){return e.isChecked}))},n.anyTogglesChecked=function(){return!!this.toggleItems.find((function(e){return e.isChecked}))},n.notifyToggleCheck=function(e,t){if(void 0===t&&(t=!0),this.enabledInHierarchy){for(var n=0;n<this.toggleItems.length;n++){var r=this.toggleItems[n];r!==e&&(t?r.isChecked=!1:r.setIsCheckedWithoutNotify(!1))}this.checkEvents&&i.Component.EventHandler.emitEvents(this.checkEvents,e)}},n.ensureValidState=function(){var e=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==e.length){var t=e[0];t.isChecked=!0,this.notifyToggleCheck(t)}var n=this.activeToggles();if(n.length>1)for(var i=n[0],r=0;r<n.length;++r){var o=n[r];o!==i&&(o.isChecked=!1)}},X(t,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(e){this._allowSwitchOff=e}},{key:"toggleItems",get:function(){return this.node.children.map((function(e){var t=e.getComponent("cc.Toggle");return t&&t.enabled?t:null})).filter(Boolean)}}]),t}(Xd),y2=te((v2=E2).prototype,"_allowSwitchOff",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),te(v2.prototype,"allowSwitchOff",[d2],Object.getOwnPropertyDescriptor(v2.prototype,"allowSwitchOff"),v2.prototype),S2=te(v2.prototype,"checkEvents",[p2,C_,m2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),g2=v2))||g2)||g2)||g2)||g2)||g2)),g4=new zn;function v4(e){return e instanceof OP?HC:e._uiProps.uiTransformComp?e._uiProps.uiTransformComp.contentSize:jn.ZERO}function y4(e,t,n,i){e.parent?g4.set(e.parent.getScale().x,e.parent.getScale().y):g4.set(0,0);for(var r=g4.x,o=g4.y,a=0,s=0,c=e.parent;;){if(!c)return n.x=n.y=0,void(i.x=i.y=1);var l=c.getPosition();if(a+=l.x,s+=l.y,(c=c.parent)===t)break;c?g4.set(c.getScale().x,c.getScale().y):g4.set(0,0);var u=g4.x,h=g4.y;a*=u,s*=h,r*=u,o*=h}i.x=0!==r?1/r:1,i.y=0!==o?1/o:1,n.x=-a,n.y=-s}!function(e){e[e.ONCE=0]="ONCE",e[e.ALWAYS=1]="ALWAYS",e[e.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(f4||(f4={})),et(f4),function(e){e[e.TOP=1]="TOP",e[e.MID=2]="MID",e[e.BOT=4]="BOT",e[e.LEFT=8]="LEFT",e[e.CENTER=16]="CENTER",e[e.RIGHT=32]="RIGHT",e[e.HORIZONTAL=56]="HORIZONTAL",e[e.VERTICAL=7]="VERTICAL"}(d4||(d4={}));var S4,E4,T4,x4,A4,C4,b4,w4,R4,I4,P4,O4,D4,N4,M4,L4,B4,F4,z4,U4=d4.TOP|d4.BOT,H4=d4.LEFT|d4.RIGHT,G4=function(t){return e({Widget:t,WidgetComponent:t}),t}((T2=S_("cc.Widget"),x2=D_(),A2=T_(110),C2=R_(),b2=E_(zH),w2=K_(Vv),R2=B_(),I2=B_(),P2=B_(),O2=B_(),D2=B_(),N2=B_(),M2=B_(),L2=M_(),B2=M_(),F2=B_(),z2=B_(),U2=B_(),H2=B_(),G2=B_(),k2=B_(),V2=K_(f4),W2=B_(),T2(j2=x2(j2=A2(j2=C2(j2=b2(j2=w_((_4=h4=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._lastPos=new yn,t._lastSize=new jn,t._dirty=!0,t._hadAlignOnce=!1,ee(t,"_alignFlags",X2,Q(t)),ee(t,"_target",Y2,Q(t)),ee(t,"_left",K2,Q(t)),ee(t,"_right",Z2,Q(t)),ee(t,"_top",Q2,Q(t)),ee(t,"_bottom",J2,Q(t)),ee(t,"_horizontalCenter",$2,Q(t)),ee(t,"_verticalCenter",e4,Q(t)),ee(t,"_isAbsLeft",t4,Q(t)),ee(t,"_isAbsRight",n4,Q(t)),ee(t,"_isAbsTop",i4,Q(t)),ee(t,"_isAbsBottom",r4,Q(t)),ee(t,"_isAbsHorizontalCenter",o4,Q(t)),ee(t,"_isAbsVerticalCenter",a4,Q(t)),ee(t,"_originalWidth",s4,Q(t)),ee(t,"_originalHeight",c4,Q(t)),ee(t,"_alignMode",l4,Q(t)),ee(t,"_lockFlags",u4,Q(t)),t}K(t,e);var n=t.prototype;return n.updateAlignment=function(){i._widgetManager.updateAlignment(this.node)},n._validateTargetInDEV=function(){},n.setDirty=function(){this._recursiveDirty()},n.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._uiProps.uiTransformComp.contentSize),i._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()},n.onDisable=function(){i._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},n.onDestroy=function(){this._removeParentEvent()},n._adjustWidgetToAllowMovingInEditor=function(){},n._adjustWidgetToAllowResizingInEditor=function(){},n._adjustWidgetToAnchorChanged=function(){this.setDirty()},n._adjustTargetToParentChanged=function(e){e&&this._unregisterOldParentEvents(e),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()},n._registerEvent=function(){this.node.on(bm.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.on(bm.SIZE_CHANGED,this._setDirtyByMode,this),this.node.on(bm.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(bm.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},n._unregisterEvent=function(){this.node.off(bm.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.off(bm.SIZE_CHANGED,this._setDirtyByMode,this),this.node.off(bm.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},n._removeParentEvent=function(){this.node.off(bm.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},n._autoChangedValue=function(e,t){if((this._alignFlags&e)>0){var n=this.node.parent&&this.node.parent._uiProps,i=n&&n.uiTransformComp,r=i?i.contentSize:HC;this.isAlignLeft&&e===d4.LEFT?this._left=t?this._left*r.width:this._left/r.width:this.isAlignRight&&e===d4.RIGHT?this._right=t?this._right*r.width:this._right/r.width:this.isAlignHorizontalCenter&&e===d4.CENTER?this._horizontalCenter=t?this._horizontalCenter*r.width:this._horizontalCenter/r.width:this.isAlignTop&&e===d4.TOP?this._top=t?this._top*r.height:this._top/r.height:this.isAlignBottom&&e===d4.BOT?this._bottom=t?this._bottom*r.height:this._bottom/r.height:this.isAbsoluteVerticalCenter&&e===d4.MID&&(this._verticalCenter=this._verticalCenter/r.height),this._recursiveDirty()}},n._registerTargetEvents=function(){var e=this._target||this.node.parent;e&&e.getComponent(zH)&&(e.on(bm.TRANSFORM_CHANGED,this._setDirtyByMode,this),e.on(bm.SIZE_CHANGED,this._setDirtyByMode,this))},n._unregisterTargetEvents=function(){var e=this._target||this.node.parent;e&&(e.off(bm.TRANSFORM_CHANGED,this._setDirtyByMode,this),e.off(bm.SIZE_CHANGED,this._setDirtyByMode,this))},n._unregisterOldParentEvents=function(e){var t=this._target||e;t&&(t.off(bm.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.off(bm.SIZE_CHANGED,this._setDirtyByMode,this))},n._setDirtyByMode=function(){this.alignMode===f4.ALWAYS&&this._recursiveDirty()},n._setAlign=function(e,t){if(t!==(this._alignFlags&e)>0){var n=(e&H4)>0,i=this.node._uiProps.uiTransformComp;t?(this._alignFlags|=e,n?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=i.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=i.height))):(n?this.isStretchWidth&&(i.width=this._originalWidth):this.isStretchHeight&&(i.height=this._originalHeight),this._alignFlags&=~e)}},n._recursiveDirty=function(){this._dirty||(this._dirty=!0)},X(t,[{key:"target",get:function(){return this._target},set:function(e){this._target!==e&&(this._unregisterTargetEvents(),this._target=e,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&d4.TOP)>0},set:function(e){this._setAlign(d4.TOP,e),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&d4.BOT)>0},set:function(e){this._setAlign(d4.BOT,e),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&d4.LEFT)>0},set:function(e){this._setAlign(d4.LEFT,e),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&d4.RIGHT)>0},set:function(e){this._setAlign(d4.RIGHT,e),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&d4.MID)>0},set:function(e){e?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=d4.MID):this._alignFlags&=~d4.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&d4.CENTER)>0},set:function(e){e?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=d4.CENTER):this._alignFlags&=~d4.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&H4)===H4}},{key:"isStretchHeight",get:function(){return(this._alignFlags&U4)===U4}},{key:"top",get:function(){return this._top},set:function(e){this._top=e,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(e){this._top=this._isAbsTop?e:e/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(e){this._bottom=e,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(e){this._bottom=this._isAbsBottom?e:e/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(e){this._left=e,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(e){this._left=this._isAbsLeft?e:e/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(e){this._right=e,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(e){this._right=this._isAbsRight?e:e/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(e){this._horizontalCenter=e,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(e){this._horizontalCenter=this._isAbsHorizontalCenter?e:e/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(e){this._verticalCenter=e,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(e){this._verticalCenter=this._isAbsVerticalCenter?e:e/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(e){this._isAbsTop!==e&&(this._isAbsTop=e,this._autoChangedValue(d4.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(e){this._isAbsBottom!==e&&(this._isAbsBottom=e,this._autoChangedValue(d4.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(e){this._isAbsLeft!==e&&(this._isAbsLeft=e,this._autoChangedValue(d4.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(e){this._isAbsRight!==e&&(this._isAbsRight=e,this._autoChangedValue(d4.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(e){this._isAbsHorizontalCenter!==e&&(this._isAbsHorizontalCenter=e,this._autoChangedValue(d4.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(e){this._isAbsVerticalCenter!==e&&(this._isAbsVerticalCenter=e,this._autoChangedValue(d4.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(e){this._alignMode=e,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(e){this._alignFlags!==e&&(this._alignFlags=e,this._recursiveDirty())}}]),t}(Xd),h4.AlignMode=f4,te((q2=_4).prototype,"target",[w2,R2],Object.getOwnPropertyDescriptor(q2.prototype,"target"),q2.prototype),te(q2.prototype,"isAlignTop",[I2],Object.getOwnPropertyDescriptor(q2.prototype,"isAlignTop"),q2.prototype),te(q2.prototype,"isAlignBottom",[P2],Object.getOwnPropertyDescriptor(q2.prototype,"isAlignBottom"),q2.prototype),te(q2.prototype,"isAlignLeft",[O2],Object.getOwnPropertyDescriptor(q2.prototype,"isAlignLeft"),q2.prototype),te(q2.prototype,"isAlignRight",[D2],Object.getOwnPropertyDescriptor(q2.prototype,"isAlignRight"),q2.prototype),te(q2.prototype,"isAlignVerticalCenter",[N2],Object.getOwnPropertyDescriptor(q2.prototype,"isAlignVerticalCenter"),q2.prototype),te(q2.prototype,"isAlignHorizontalCenter",[M2],Object.getOwnPropertyDescriptor(q2.prototype,"isAlignHorizontalCenter"),q2.prototype),te(q2.prototype,"isStretchWidth",[L2],Object.getOwnPropertyDescriptor(q2.prototype,"isStretchWidth"),q2.prototype),te(q2.prototype,"isStretchHeight",[B2],Object.getOwnPropertyDescriptor(q2.prototype,"isStretchHeight"),q2.prototype),te(q2.prototype,"top",[F2],Object.getOwnPropertyDescriptor(q2.prototype,"top"),q2.prototype),te(q2.prototype,"editorTop",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"editorTop"),q2.prototype),te(q2.prototype,"bottom",[z2],Object.getOwnPropertyDescriptor(q2.prototype,"bottom"),q2.prototype),te(q2.prototype,"editorBottom",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"editorBottom"),q2.prototype),te(q2.prototype,"left",[U2],Object.getOwnPropertyDescriptor(q2.prototype,"left"),q2.prototype),te(q2.prototype,"editorLeft",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"editorLeft"),q2.prototype),te(q2.prototype,"right",[H2],Object.getOwnPropertyDescriptor(q2.prototype,"right"),q2.prototype),te(q2.prototype,"editorRight",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"editorRight"),q2.prototype),te(q2.prototype,"horizontalCenter",[G2],Object.getOwnPropertyDescriptor(q2.prototype,"horizontalCenter"),q2.prototype),te(q2.prototype,"editorHorizontalCenter",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"editorHorizontalCenter"),q2.prototype),te(q2.prototype,"verticalCenter",[k2],Object.getOwnPropertyDescriptor(q2.prototype,"verticalCenter"),q2.prototype),te(q2.prototype,"editorVerticalCenter",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"editorVerticalCenter"),q2.prototype),te(q2.prototype,"isAbsoluteTop",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"isAbsoluteTop"),q2.prototype),te(q2.prototype,"isAbsoluteBottom",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"isAbsoluteBottom"),q2.prototype),te(q2.prototype,"isAbsoluteLeft",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"isAbsoluteLeft"),q2.prototype),te(q2.prototype,"isAbsoluteRight",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"isAbsoluteRight"),q2.prototype),te(q2.prototype,"isAbsoluteHorizontalCenter",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"isAbsoluteHorizontalCenter"),q2.prototype),te(q2.prototype,"isAbsoluteVerticalCenter",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"isAbsoluteVerticalCenter"),q2.prototype),te(q2.prototype,"alignMode",[V2,W2],Object.getOwnPropertyDescriptor(q2.prototype,"alignMode"),q2.prototype),te(q2.prototype,"alignFlags",[N_],Object.getOwnPropertyDescriptor(q2.prototype,"alignFlags"),q2.prototype),X2=te(q2.prototype,"_alignFlags",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Y2=te(q2.prototype,"_target",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K2=te(q2.prototype,"_left",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Z2=te(q2.prototype,"_right",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Q2=te(q2.prototype,"_top",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),J2=te(q2.prototype,"_bottom",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$2=te(q2.prototype,"_horizontalCenter",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),e4=te(q2.prototype,"_verticalCenter",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),t4=te(q2.prototype,"_isAbsLeft",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),n4=te(q2.prototype,"_isAbsRight",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i4=te(q2.prototype,"_isAbsTop",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),r4=te(q2.prototype,"_isAbsBottom",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),o4=te(q2.prototype,"_isAbsHorizontalCenter",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),a4=te(q2.prototype,"_isAbsVerticalCenter",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),s4=te(q2.prototype,"_originalWidth",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c4=te(q2.prototype,"_originalHeight",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l4=te(q2.prototype,"_alignMode",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return f4.ON_WINDOW_RESIZE}}),u4=te(q2.prototype,"_lockFlags",[C_,b_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),j2=q2))||j2)||j2)||j2)||j2)||j2)||j2));i.internal.computeInverseTransForTarget=y4,i.internal.getReadonlyNodeSize=v4;var k4,V4=new gn;!function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL"}(k4||(k4={})),et(k4);var W4,j4,q4,X4,Y4,K4,Z4,Q4,J4,$4,e3,t3,n3,i3,r3,o3,a3,s3,c3,l3,u3,h3,_3,f3,d3,p3,m3,g3,v3,y3,S3,E3,T3,x3,A3,C3,b3,w3,R3,I3,P3,O3,D3,N3,M3,L3=function(t){return e({PageViewIndicator:t,PageViewIndicatorComponent:t}),t}((S4=S_("cc.PageViewIndicator"),E4=D_(),T4=T_(110),x4=R_(),A4=K_(vU),C4=B_(),b4=K_(k4),w4=B_(),R4=K_(jn),I4=B_(),P4=B_(),S4(O4=E4(O4=T4(O4=x4((z4=F4=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"spacing",N4,Q(t)),ee(t,"_spriteFrame",M4,Q(t)),ee(t,"_direction",L4,Q(t)),ee(t,"_cellSize",B4,Q(t)),t._layout=null,t._pageView=null,t._indicators=[],t}K(t,e);var n=t.prototype;return n.onLoad=function(){this._updateLayout()},n.setPageView=function(e){this._pageView=e,this._refresh()},n._updateLayout=function(){this._layout=this.getComponent(M$),this._layout||(this._layout=this.addComponent(M$));var e=this._layout;this.direction===k4.HORIZONTAL?(e.type=M$.Type.HORIZONTAL,e.spacingX=this.spacing):this.direction===k4.VERTICAL&&(e.type=M$.Type.VERTICAL,e.spacingY=this.spacing),e.resizeMode=M$.ResizeMode.CONTAINER},n._createIndicator=function(){var e=new Vv;e.layer=this.node.layer;var t=e.addComponent(sj);return t.spriteFrame=this.spriteFrame,t.sizeMode=sj.SizeMode.CUSTOM,e.parent=this.node,e._uiProps.uiTransformComp.setContentSize(this._cellSize),e},n._changedState=function(){var e=this._indicators;if(0!==e.length&&this._pageView){var t=this._pageView.curPageIdx;if(!(t>=e.length)){for(var n=0;n<e.length;++n){var i=e[n];if(i._uiProps.uiComp){var r=i._uiProps.uiComp;V4.set(r.color),V4.a=127.5,r.color=V4}}if(e[t]._uiProps.uiComp){var o=e[t]._uiProps.uiComp;V4.set(o.color),V4.a=255,o.color=V4}}}},n._refresh=function(){if(this._pageView){var e=this._indicators,t=this._pageView.getPages();if(t.length!==e.length){var n=0;if(t.length>e.length)for(n=0;n<t.length;++n)e[n]||(e[n]=this._createIndicator());else for(n=e.length-t.length;n>0;--n){var i=e[n-1];this.node.removeChild(i),e.splice(n-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},X(t,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(e){this._spriteFrame!==e&&(this._spriteFrame=e)}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction!==e&&(this._direction=e)}},{key:"cellSize",get:function(){return this._cellSize},set:function(e){this._cellSize!==e&&(this._cellSize=e)}}]),t}(Xd),F4.Direction=k4,te((D4=z4).prototype,"spriteFrame",[A4,C4],Object.getOwnPropertyDescriptor(D4.prototype,"spriteFrame"),D4.prototype),te(D4.prototype,"direction",[b4,w4],Object.getOwnPropertyDescriptor(D4.prototype,"direction"),D4.prototype),te(D4.prototype,"cellSize",[R4,I4],Object.getOwnPropertyDescriptor(D4.prototype,"cellSize"),D4.prototype),N4=te(D4.prototype,"spacing",[C_,P4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),M4=te(D4.prototype,"_spriteFrame",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L4=te(D4.prototype,"_direction",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return k4.HORIZONTAL}}),B4=te(D4.prototype,"_cellSize",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new jn(20,20)}}),O4=D4))||O4)||O4)||O4)||O4)),B3=new zn;!function(e){e[e.Unified=0]="Unified",e[e.Free=1]="Free"}(D3||(D3={})),et(D3),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(N3||(N3={})),et(N3),function(e){e.PAGE_TURNING="page-turning"}(M3||(M3={}));var F3=function(t){return e({PageView:t,PageViewComponent:t}),t}((W4=S_("cc.PageView"),j4=D_(),q4=T_(110),X4=R_(),Y4=K_(D3),K4=B_(),Z4=K_(N3),Q4=B_(),J4=F_(),$4=B_(),e3=F_(),t3=B_(),n3=K_(L3),i3=B_(),r3=B_(),o3=K_(c1),a3=M_(),s3=K_(c1),c3=M_(),l3=M_(),u3=M_(),h3=M_(),_3=K_([iM]),f3=M_(),d3=K_([iM]),p3=B_(),W4(m3=j4(m3=q4(m3=X4((O3=P3=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"autoPageTurningThreshold",v3,Q(t)),ee(t,"horizontal",y3,Q(t)),ee(t,"vertical",S3,Q(t)),ee(t,"cancelInnerEvents",E3,Q(t)),ee(t,"scrollEvents",T3,Q(t)),ee(t,"pageTurningSpeed",x3,Q(t)),ee(t,"pageEvents",A3,Q(t)),ee(t,"_sizeMode",C3,Q(t)),ee(t,"_direction",b3,Q(t)),ee(t,"_scrollThreshold",w3,Q(t)),ee(t,"_pageTurningEventTiming",R3,Q(t)),ee(t,"_indicator",I3,Q(t)),t._curPageIdx=0,t._lastPageIdx=0,t._pages=[],t._initContentPos=new yn,t._scrollCenterOffsetX=[],t._scrollCenterOffsetY=[],t._touchBeganPosition=new zn,t._touchEndPosition=new zn,t}K(t,e);var n=t.prototype;return n.onEnable=function(){e.prototype.onEnable.call(this),this.node.on(bm.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.on(t.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onDisable=function(){e.prototype.onDisable.call(this),this.node.off(bm.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.off(t.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},n.getCurrentPageIndex=function(){return this._curPageIdx},n.setCurrentPageIndex=function(e){this.scrollToPage(e,1)},n.getPages=function(){return this._pages},n.addPage=function(e){e&&-1===this._pages.indexOf(e)&&this.content&&(e._uiProps.uiTransformComp?(this.content.addChild(e),this._pages.push(e),this._updatePageView()):T(4301))},n.insertPage=function(e,t){if(!(t<0)&&e&&-1===this._pages.indexOf(e)&&this.content)if(t>=this._pages.length)this.addPage(e);else{if(!e._uiProps.uiTransformComp)return void T(4301);this._pages.splice(t,0,e),this.content.insertChild(e,t),this._updatePageView()}},n.removePage=function(e){if(e&&this.content){var t=this._pages.indexOf(e);-1!==t?this.removePageAtIndex(t):A(4300,e.name)}},n.removePageAtIndex=function(e){var t=this._pages;if(!(e<0||e>=t.length)){var n=t[e];n&&this.content&&(this.content.removeChild(n),t.splice(e,1),this._updatePageView())}},n.removeAllPages=function(){if(this.content){for(var e=this._pages,t=0,n=e.length;t<n;t++)this.content.removeChild(e[t]);this._pages.length=0,this._updatePageView()}},n.scrollToPage=function(e,t){void 0===t&&(t=.3),e<0||e>=this._pages.length||(this._curPageIdx=e,this.scrollToOffset(this._moveOffsetValue(e),t,!0),this.indicator&&this.indicator._changedState())},n.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},n._updatePageView=function(){if(this.content){var e=this.content.getComponent(M$);e&&e.enabled&&e.updateLayout();var t=this._pages.length;this._curPageIdx>=t&&(this._curPageIdx=0===t?0:t-1,this._lastPageIdx=this._curPageIdx);for(var n=this._initContentPos,i=0;i<t;++i){var r=this._pages[i].position;this.direction===N3.Horizontal?this._scrollCenterOffsetX[i]=Math.abs(n.x+r.x):this._scrollCenterOffsetY[i]=Math.abs(n.y+r.y)}this.indicator&&this.indicator._refresh()}},n._updateAllPagesSize=function(){var e=this.view;if(this.content&&e&&this._sizeMode===D3.Unified)for(var t=this._pages,n=e.contentSize,i=0,r=t.length;i<r;i++)t[i]._uiProps.uiTransformComp.setContentSize(n)},n._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(t.EventType.SCROLL_ENDED))},n._onTouchBegan=function(t,n){t.touch.getUILocation(B3),zn.set(this._touchBeganPosition,B3.x,B3.y),e.prototype._onTouchBegan.call(this,t,n)},n._onTouchMoved=function(t,n){e.prototype._onTouchMoved.call(this,t,n)},n._onTouchEnded=function(t,n){t.touch.getUILocation(B3),zn.set(this._touchEndPosition,B3.x,B3.y),e.prototype._onTouchEnded.call(this,t,n)},n._onTouchCancelled=function(t,n){t.touch.getUILocation(B3),zn.set(this._touchEndPosition,B3.x,B3.y),e.prototype._onTouchCancelled.call(this,t,n)},n._onMouseWheel=function(){},n._syncScrollDirection=function(){this.horizontal=this.direction===N3.Horizontal,this.vertical=this.direction===N3.Vertical},n._syncSizeMode=function(){var e=this.view;if(this.content&&e){var t=this.content.getComponent(M$);if(t){if(this._sizeMode===D3.Free&&this._pages.length>0){var n=this._pages[0]._uiProps.uiTransformComp,i=this._pages[this._pages.length-1]._uiProps.uiTransformComp;this.direction===N3.Horizontal?(t.paddingLeft=(e.width-n.width)/2,t.paddingRight=(e.width-i.width)/2):this.direction===N3.Vertical&&(t.paddingTop=(e.height-n.height)/2,t.paddingBottom=(e.height-i.height)/2)}t.updateLayout()}}},n._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var e=this.content.children,t=0;t<e.length;++t){var n=e[t];this._pages.indexOf(n)>=0||this._pages.push(n)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},n._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,iM.emitEvents(this.pageEvents,this,M3.PAGE_TURNING),this.node.emit(M3.PAGE_TURNING,this))},n._isQuicklyScrollable=function(e){if(this.direction===N3.Horizontal){if(Math.abs(e.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===N3.Vertical&&Math.abs(e.y)>this.autoPageTurningThreshold)return!0;return!1},n._moveOffsetValue=function(e){var t=new zn;if(this._sizeMode===D3.Free)this.direction===N3.Horizontal?t.x=this._scrollCenterOffsetX[e]:this.direction===N3.Vertical&&(t.y=this._scrollCenterOffsetY[e]);else{var n=this.view;if(!n)return t;this.direction===N3.Horizontal?t.x=e*n.width:this.direction===N3.Vertical&&(t.y=e*n.height)}return t},n._getDragDirection=function(e){return this._direction===N3.Horizontal?0===e.x?0:e.x>0?1:-1:0===e.y?0:e.y<0?1:-1},n._isScrollable=function(e,t,n){if(this._sizeMode===D3.Free){var i=0,r=0;if(this.direction===N3.Horizontal)return i=this._scrollCenterOffsetX[t],r=this._scrollCenterOffsetX[n],Math.abs(e.x)>=Math.abs(i-r)*this.scrollThreshold;if(this.direction===N3.Vertical)return i=this._scrollCenterOffsetY[t],r=this._scrollCenterOffsetY[n],Math.abs(e.y)>=Math.abs(i-r)*this.scrollThreshold}else{var o=this.view;if(!o)return!1;if(this.direction===N3.Horizontal)return Math.abs(e.x)>=o.width*this.scrollThreshold;if(this.direction===N3.Vertical)return Math.abs(e.y)>=o.height*this.scrollThreshold}return!1},n._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var e=this._getHowMuchOutOfBoundary();this._clampDelta(e),(e.x>0||e.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(e.x<0||e.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var t=new zn;zn.subtract(t,this._touchBeganPosition,this._touchEndPosition);var n=this._curPageIdx,i=n+this._getDragDirection(t),r=this.pageTurningSpeed*Math.abs(n-i);if(i<this._pages.length){if(this._isScrollable(t,n,i))return void this.scrollToPage(i,r);var o=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(o))return void this.scrollToPage(i,r)}this.scrollToPage(n,r)}},X(t,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(e){this._sizeMode!==e&&(this._sizeMode=e,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction!==e&&(this._direction=e,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(e){this._scrollThreshold!==e&&(this._scrollThreshold=e)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(e){this._pageTurningEventTiming!==e&&(this._pageTurningEventTiming=e)}},{key:"indicator",get:function(){return this._indicator},set:function(e){this._indicator!==e&&(this._indicator=e,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return e.prototype.verticalScrollBar},set:function(e){this.verticalScrollBar=e}},{key:"horizontalScrollBar",get:function(){return e.prototype.horizontalScrollBar},set:function(e){this.horizontalScrollBar=e}}]),t}(H1),P3.SizeMode=D3,P3.Direction=N3,P3.EventType=l2(M3,u1),te((g3=O3).prototype,"sizeMode",[Y4,K4],Object.getOwnPropertyDescriptor(g3.prototype,"sizeMode"),g3.prototype),te(g3.prototype,"direction",[Z4,Q4],Object.getOwnPropertyDescriptor(g3.prototype,"direction"),g3.prototype),te(g3.prototype,"scrollThreshold",[G_,J4,$4],Object.getOwnPropertyDescriptor(g3.prototype,"scrollThreshold"),g3.prototype),te(g3.prototype,"pageTurningEventTiming",[G_,e3,t3],Object.getOwnPropertyDescriptor(g3.prototype,"pageTurningEventTiming"),g3.prototype),te(g3.prototype,"indicator",[n3,i3],Object.getOwnPropertyDescriptor(g3.prototype,"indicator"),g3.prototype),v3=te(g3.prototype,"autoPageTurningThreshold",[C_,r3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),te(g3.prototype,"verticalScrollBar",[o3,Z_,a3],Object.getOwnPropertyDescriptor(g3.prototype,"verticalScrollBar"),g3.prototype),te(g3.prototype,"horizontalScrollBar",[s3,Z_,c3],Object.getOwnPropertyDescriptor(g3.prototype,"horizontalScrollBar"),g3.prototype),y3=te(g3.prototype,"horizontal",[Z_,C_,l3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),S3=te(g3.prototype,"vertical",[Z_,C_,u3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),E3=te(g3.prototype,"cancelInnerEvents",[Z_,C_,h3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),T3=te(g3.prototype,"scrollEvents",[_3,C_,Z_,f3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),x3=te(g3.prototype,"pageTurningSpeed",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),A3=te(g3.prototype,"pageEvents",[d3,C_,p3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),C3=te(g3.prototype,"_sizeMode",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return D3.Unified}}),b3=te(g3.prototype,"_direction",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return N3.Horizontal}}),w3=te(g3.prototype,"_scrollThreshold",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),R3=te(g3.prototype,"_pageTurningEventTiming",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),I3=te(g3.prototype,"_indicator",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m3=g3))||m3)||m3)||m3)||m3)),z3=new yn,U3=new zn,H3=new zn,G3=new zn(1,1),k3=new zn,V3=new zn;function W3(e,t){if(!t._hadAlignOnce){t.alignMode===f4.ONCE&&(t._hadAlignOnce=!0);var n,i=t.target,r=H3,o=G3;i?y4(e,n=i,r,o):n=e.parent;var a=v4(n),s=n instanceof OP||!n.getComponent(zH),c=s?U3:n.getComponent(zH).anchorPoint,l=s;e.getPosition(z3);var u=e._uiProps.uiTransformComp,h=z3.x,_=z3.y,f=u.anchorPoint,d=e.getScale();if(t.alignFlags&d4.HORIZONTAL){var p=0,m=0,g=a.width;l?(p=HC.left.x,m=HC.right.x):m=(p=-c.x*g)+g,p+=t.isAbsoluteLeft?t.left:t.left*g,m-=t.isAbsoluteRight?t.right:t.right*g,i&&(p+=r.x,p*=o.x,m+=r.x,m*=o.x);var v=0,y=f.x,S=d.x;if(S<0&&(y=1-y,S=-S),t.isStretchWidth)v=m-p,0!==S&&(u.width=v/S),h=p+y*v;else if(v=u.width*S,t.isAlignHorizontalCenter){var E=t.isAbsoluteHorizontalCenter?t.horizontalCenter:t.horizontalCenter*g,T=(.5-c.x)*a.width;i&&(E*=o.x,T+=r.x,T*=o.x),h=T+(y-.5)*v+E}else h=t.isAlignLeft?p+y*v:m+(y-1)*v;t._lastSize.width=v}if(t.alignFlags&d4.VERTICAL){var x=0,A=0,C=a.height;l?(A=HC.bottom.y,x=HC.top.y):x=(A=-c.y*C)+C,A+=t.isAbsoluteBottom?t.bottom:t.bottom*C,x-=t.isAbsoluteTop?t.top:t.top*C,i&&(A+=r.y,A*=o.y,x+=r.y,x*=o.y);var b=0,w=f.y,R=d.y;if(R<0&&(w=1-w,R=-R),t.isStretchHeight)b=x-A,0!==R&&(u.height=b/R),_=A+w*b;else if(b=u.height*R,t.isAlignVerticalCenter){var I=t.isAbsoluteVerticalCenter?t.verticalCenter:t.verticalCenter*C,P=(.5-c.y)*a.height;i&&(I*=o.y,P+=r.y,P*=o.y),_=P+(w-.5)*b+I}else _=t.isAlignBottom?A+w*b:x+(w-1)*b;t._lastSize.height=b}e.setPosition(h,_,z3.z),yn.set(t._lastPos,h,_,z3.z)}}function j3(e){var t=e.getComponent(G4);if(t&&t.enabled){if(!i.isValid(e,!0))return;Y3.push(t)}for(var n,r=$(e.children);!(n=r()).done;){var o=n.value;o.active&&j3(o)}}function q3(){var e=SO.getScene();if(e){K3.isAligning=!0,K3._nodesOrderDirty&&(Y3.length=0,j3(e),K3._nodesOrderDirty=!1);var t=null,n=K3._activeWidgetsIterator;for(n.i=0;n.i<Y3.length;++n.i)(t=Y3[n.i])._dirty&&(W3(t.node,t),t._dirty=!1);K3.isAligning=!1}}var X3,Y3=[],K3=e("widgetManager",i._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new Ye.MutableForwardIterator(Y3),animationState:null,init:function(){SO.on(yO.EVENT_AFTER_UPDATE,q3),kC.instance.on("design-resolution-changed",this.onResized,this);var e=this.onResized.bind(this);kC.instance.on("canvas-resize",e),yi.onOrientationChange(e)},add:function(){this._nodesOrderDirty=!0},remove:function(e){this._activeWidgetsIterator.remove(e)},onResized:function(){var e=SO.getScene();e&&this.refreshWidgetOnResized(e)},refreshWidgetOnResized:function(e){var t=Vv.isNode(e)&&e.getComponent(G4);t&&t.enabled&&(t.alignMode===f4.ON_WINDOW_RESIZE||t.alignMode===f4.ALWAYS)&&t.setDirty();for(var n,i=$(e.children);!(n=i()).done;){var r=n.value;this.refreshWidgetOnResized(r)}},updateOffsetsToStayPut:function(e,t){function n(e,t){return Math.abs(e-t)>1e-10?t:e}var i=e.node,r=i.parent;if(r){var o=k3;o.set(0,0);var a=V3;if(a.set(1,1),e.target&&y4(i,r=e.target,o,a),!t)return;var s=r._uiProps&&r._uiProps.uiTransformComp,c=s?s.anchorPoint:U3,l=i._uiProps.uiTransformComp,u=v4(r),h=l.anchorPoint,_=i.getPosition(),f=d4,d=i.getScale(),p=0;if(t&f.LEFT){var m=-c.x*u.width;m+=o.x,m*=a.x,p=_.x-h.x*l.width*d.x-m,e.isAbsoluteLeft||(p/=u.width),p/=a.x,e.left=n(e.left,p)}if(t&f.RIGHT){var g=(1-c.x)*u.width;g+=o.x,p=(g*=a.x)-(_.x+(1-h.x)*l.width*d.x),e.isAbsoluteRight||(p/=u.width),p/=a.x,e.right=n(e.right,p)}if(t&f.TOP){var v=(1-c.y)*u.height;v+=o.y,p=(v*=a.y)-(_.y+(1-h.y)*l.height*d.y),e.isAbsoluteTop||(p/=u.height),p/=a.y,e.top=n(e.top,p)}if(t&f.BOT){var y=-c.y*u.height;y+=o.y,y*=a.y,p=_.y-h.y*l.height*d.y-y,e.isAbsoluteBottom||(p/=u.height),p/=a.y,e.bottom=n(e.bottom,p)}}},updateAlignment:function e(t){var n=t.parent;n&&Vv.isNode(n)&&e(n);var i=t.getComponent(G4);i&&n&&W3(t,i)},AlignMode:f4,AlignFlags:d4});SO.on(yO.EVENT_INIT,(function(){K3.init()}));var Z3,Q3,J3,$3,e5,t5,n5,i5,r5,o5,a5,s5,c5,l5,u5,h5,_5,f5,d5,p5,m5=function(t){return e({SafeArea:t,SafeAreaComponent:t}),t}(S_("cc.SafeArea")(X3=D_()(X3=T_(110)(X3=w_(X3=R_()(X3=E_(G4)(X3=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.onLoad=function(){this._boundUpdateArea=this.updateArea.bind(this)},n.onEnable=function(){this.updateArea(),yi.onViewResize(this._boundUpdateArea),yi.onOrientationChange(this._boundUpdateArea)},n.onDisable=function(){yi.offViewResize(this._boundUpdateArea),yi.offOrientationChange(this._boundUpdateArea)},n.updateArea=function(){var e=this.node.getComponent(G4),t=this.node.getComponent(zH);if(e&&t){e.updateAlignment();var n=this.node.position.clone(),r=t.anchorPoint.clone();e.isAlignTop=e.isAlignBottom=e.isAlignLeft=e.isAlignRight=!0;var o=i.winSize.width,a=i.winSize.height,s=eS.getSafeAreaRect();e.top=a-s.y-s.height,e.bottom=s.y,e.left=s.x,e.right=o-s.x-s.width,e.updateAlignment();var c=this.node.position.clone(),l=r.x-(c.x-n.x)/t.width,u=r.y-(c.y-n.y)/t.height;t.setAnchorPoint(l,u),K3.add(e)}},t}(Xd))||X3)||X3)||X3)||X3)||X3)||X3),g5=function(t){return e({UICoordinateTracker:t,UICoordinateTrackerComponent:t}),t}((Z3=S_("cc.UICoordinateTracker"),Q3=D_(),J3=R_(),$3=T_(110),e5=K_(Vv),t5=B_(),n5=K_(TM),i5=B_(),r5=B_(),o5=B_(),a5=K_([iM]),s5=B_(),Z3(c5=Q3(c5=J3(c5=$3((te((l5=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"syncEvents",u5,Q(t)),ee(t,"_target",h5,Q(t)),ee(t,"_camera",_5,Q(t)),ee(t,"_useScale",f5,Q(t)),ee(t,"_distance",d5,Q(t)),t._transformPos=new yn,t._viewPos=new yn,t._canMove=!0,t._lastWPos=new yn,t._lastCameraPos=new yn,t}K(t,e);var n=t.prototype;return n.onEnable=function(){this._checkCanMove()},n.update=function(){var e=this.node.worldPosition,t=this._camera;if(this._canMove&&t&&t.camera&&(!this._lastWPos.equals(e)||!this._lastCameraPos.equals(t.node.worldPosition))&&(this._lastWPos.set(e),this._lastCameraPos.set(t.node.worldPosition),t.camera.update(),t.convertToUINode(e,this._target,this._transformPos),this._useScale&&yn.transformMat4(this._viewPos,this.node.worldPosition,t.camera.matView),this.syncEvents.length>0)){var n=this._distance/Math.abs(this._viewPos.z);iM.emitEvents(this.syncEvents,this._transformPos,n)}},n._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},X(t,[{key:"target",get:function(){return this._target},set:function(e){this._target!==e&&(this._target=e,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(e){this._camera!==e&&(this._camera=e,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(e){this._useScale!==e&&(this._useScale=e)}},{key:"distance",get:function(){return this._distance},set:function(e){this._distance!==e&&(this._distance=e)}}]),t}(Xd)).prototype,"target",[e5,t5],Object.getOwnPropertyDescriptor(l5.prototype,"target"),l5.prototype),te(l5.prototype,"camera",[n5,i5],Object.getOwnPropertyDescriptor(l5.prototype,"camera"),l5.prototype),te(l5.prototype,"useScale",[r5],Object.getOwnPropertyDescriptor(l5.prototype,"useScale"),l5.prototype),te(l5.prototype,"distance",[o5],Object.getOwnPropertyDescriptor(l5.prototype,"distance"),l5.prototype),u5=te(l5.prototype,"syncEvents",[a5,C_,s5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),h5=te(l5.prototype,"_target",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_5=te(l5.prototype,"_camera",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f5=te(l5.prototype,"_useScale",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),d5=te(l5.prototype,"_distance",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),c5=l5))||c5)||c5)||c5)||c5)),v5=[bm.TOUCH_START,bm.TOUCH_END,bm.TOUCH_MOVE,bm.MOUSE_DOWN,bm.MOUSE_MOVE,bm.MOUSE_UP,bm.MOUSE_ENTER,bm.MOUSE_LEAVE,bm.MOUSE_WHEEL];function y5(e){e.propagationStopped=!0}var S5,E5,T5,x5,A5,C5,b5,w5,R5,I5,P5,O5,D5=function(t){return e({BlockInputEvents:t,BlockInputEventsComponent:t}),t}(S_("cc.BlockInputEvents")(p5=D_()(p5=R_()(p5=function(e){function t(){return e.apply(this,arguments)||this}K(t,e);var n=t.prototype;return n.onEnable=function(){for(var e=0;e<v5.length;e++)this.node.on(v5[e],y5,this)},n.onDisable=function(){for(var e=0;e<v5.length;e++)this.node.off(v5[e],y5,this)},t}(Xd))||p5)||p5)||p5),N5={},M5=e("SubContextView",(S5=S_("cc.SubContextView"),E5=D_(),T5=T_(110),x5=E_(zH),A5=R_(),C5=B_(),b5=B_(),S5(w5=E5(w5=T5(w5=x5(w5=A5((te((R5=function(e){function t(){var t;return ee(t=e.call(this)||this,"_fps",I5,Q(t)),t._sprite=void 0,t._imageAsset=void 0,t._updatedTime=0,t._updateInterval=0,t._openDataContext=void 0,t._content=void 0,ee(t,"_designResolutionSize",P5,Q(t)),t._content=new Vv("content"),t._content.hideFlags|=ei.Flags.DontSave|ei.Flags.HideInHierarchy,t._sprite=null,t._imageAsset=new Uf,t._openDataContext=null,t._updatedTime=performance.now(),t}K(t,e);var n=t.prototype;return n.onLoad=function(){N5.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._openDataContext=N5.getOpenDataContext(),this._initSharedCanvas(),this._initContentNode(),this._updateSubContextView(),this._updateContentLayer()):this.enabled=!1},n.onEnable=function(){this._registerNodeEvent()},n.onDisable=function(){this._unregisterNodeEvent()},n._initSharedCanvas=function(){if(this._openDataContext){var e=this._openDataContext.canvas;e.width=this._designResolutionSize.width,e.height=this._designResolutionSize.height}},n._initContentNode=function(){if(this._openDataContext){var e=this._openDataContext.canvas,t=this._imageAsset;if(t.reset(e),t._texture.create(e.width,e.height),this._sprite=this._content.getComponent(sj),this._sprite||(this._sprite=this._content.addComponent(sj)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._imageAsset._texture;else{var n=new vU;n.texture=this._imageAsset._texture,this._sprite.spriteFrame=n}this._content.parent=this.node}},n._updateSubContextView=function(){if(this._openDataContext&&N5.getSystemInfoSync){var e=this.node.getComponent(zH),t=this._content.getComponent(zH),n=e.width/t.width,i=e.height/t.height,r=n>i?i:n;t.width*=r,t.height*=r;var o=N5.getSystemInfoSync(),a=t.getBoundingBoxToWorld(),s=qC.getVisibleSize(),c=o.screenWidth*(a.x/s.width),l=o.screenHeight*(a.y/s.height),u=o.screenWidth*(a.width/s.width),h=o.screenHeight*(a.height/s.height);this._openDataContext.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:c,y:l,width:u,height:h})}},n._updateSubContextTexture=function(){var e=this._imageAsset;if(e&&this._openDataContext&&!(e.width<=0||e.height<=0)){var t=this._openDataContext.canvas;e.reset(t),(t.width>e.width||t.height>e.height)&&this._imageAsset._texture.create(t.width,t.height),this._imageAsset._texture.uploadData(t)}},n._registerNodeEvent=function(){this.node.on(Vv.EventType.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.on(Vv.EventType.SIZE_CHANGED,this._updateSubContextView,this),this.node.on(bm.LAYER_CHANGED,this._updateContentLayer,this)},n._unregisterNodeEvent=function(){this.node.off(Vv.EventType.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.off(Vv.EventType.SIZE_CHANGED,this._updateSubContextView,this),this.node.off(bm.LAYER_CHANGED,this._updateContentLayer,this)},n._updateContentLayer=function(){this._content.layer=this.node.layer},n.update=function(e){void 0===e?this._updateSubContextTexture():performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},X(t,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(e){this._fps!==e&&(this._fps=e,this._updateInterval=1e3/e)}}]),t}(Xd)).prototype,"designResolutionSize",[C5],Object.getOwnPropertyDescriptor(R5.prototype,"designResolutionSize"),R5.prototype),te(R5.prototype,"fps",[b5],Object.getOwnPropertyDescriptor(R5.prototype,"fps"),R5.prototype),I5=te(R5.prototype,"_fps",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),P5=te(R5.prototype,"_designResolutionSize",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new jn(640,960)}}),w5=R5))||w5)||w5)||w5)||w5)||w5));i.SubContextView=M5;var L5=e("UIReorderComponent",S_("cc.UIReorderComponent")(O5=function(){A(1408,"UIReorderComponent")})||O5);function B5(e,t,n,i){var r=(i.x-n.x)*(e.y-n.y)-(i.y-n.y)*(e.x-n.x),o=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),a=(i.y-n.y)*(t.x-e.x)-(i.x-n.x)*(t.y-e.y);if(0!==a){var s=r/a,c=o/a;if(s>=0&&s<=1&&c>=0&&c<=1)return!0}return!1}i.UIReorderComponent=L5,i.ButtonComponent=HZ,Ke.setClassAlias(HZ,"cc.ButtonComponent"),i.EditBoxComponent=n$,Ke.setClassAlias(n$,"cc.EditBoxComponent"),i.LayoutComponent=M$,Ke.setClassAlias(M$,"cc.LayoutComponent"),i.ProgressBarComponent=a0,Ke.setClassAlias(a0,"cc.ProgressBarComponent"),i.ScrollViewComponent=H1,Ke.setClassAlias(H1,"cc.ScrollViewComponent"),i.ScrollBarComponent=c1,Ke.setClassAlias(c1,"cc.ScrollBarComponent"),i.SliderComponent=c2,Ke.setClassAlias(c2,"cc.SliderComponent"),i.ToggleComponent=p4,Ke.setClassAlias(p4,"cc.ToggleComponent"),i.ToggleContainerComponent=m4,Ke.setClassAlias(m4,"cc.ToggleContainerComponent"),i.WidgetComponent=G4,Ke.setClassAlias(G4,"cc.WidgetComponent"),i.PageViewComponent=F3,Ke.setClassAlias(F3,"cc.PageViewComponent"),i.PageViewIndicatorComponent=L3,Ke.setClassAlias(L3,"cc.PageViewIndicatorComponent"),i.SafeAreaComponent=m5,Ke.setClassAlias(m5,"cc.SafeAreaComponent"),Ke.setClassAlias(g5,"cc.UICoordinateTrackerComponent"),i.BlockInputEventsComponent=D5,Ke.setClassAlias(D5,"cc.BlockInputEventsComponent");var F5=new zn,z5=new zn,U5=new zn,H5=new zn;function G5(e,t,n){for(var i=n.length,r=0;r<i;++r)if(B5(e,t,n[r],n[(r+1)%i]))return!0;return!1}function k5(e,t){for(var n=!1,i=e.x,r=e.y,o=t.length,a=0,s=o-1;a<o;s=a++){var c=t[a].x,l=t[a].y,u=t[s].x,h=t[s].y;l>r!=h>r&&i<(u-c)*(r-l)/(h-l)+c&&(n=!n)}return n}function V5(e,t,n,i){var r,o=n.x-t.x,a=n.y-t.y,s=o*o+a*a,c=((e.x-t.x)*o+(e.y-t.y)*a)/s;return r=i?s?c<0?t:c>1?n:F5.set(t.x+c*o,t.y+c*a):t:F5.set(t.x+c*o,t.y+c*a),o=e.x-r.x,a=e.y-r.y,Math.sqrt(o*o+a*a)}var W5=e("Intersection2D",(function(){}));W5.lineLine=B5,W5.lineRect=function(e,t,n){var i=F5.set(n.x,n.y),r=z5.set(n.x,n.yMax),o=U5.set(n.xMax,n.yMax),a=H5.set(n.xMax,n.y);return!!(B5(e,t,i,r)||B5(e,t,r,o)||B5(e,t,o,a)||B5(e,t,a,i))},W5.linePolygon=G5,W5.rectRect=function(e,t){var n=e.x,i=e.y,r=e.x+e.width,o=e.y+e.height,a=t.x,s=t.y,c=t.x+t.width,l=t.y+t.height;return n<=c&&r>=a&&i<=l&&o>=s},W5.rectPolygon=function(e,t){var n=F5.set(e.x,e.y),i=z5.set(e.x,e.yMax),r=U5.set(e.xMax,e.yMax),o=H5.set(e.xMax,e.y);if(G5(n,i,t))return!0;if(G5(i,r,t))return!0;if(G5(r,o,t))return!0;if(G5(o,n,t))return!0;for(var a=0,s=t.length;a<s;++a)if(e.contains(t[a]))return!0;return!!(k5(n,t)||k5(i,t)||k5(r,t)||k5(o,t))},W5.rectCircle=function(e,t,n){var i=t.x,r=t.y,o=e.x,a=e.y,s=e.width,c=e.height,l=i,u=r;i<o?l=o:i>o+s&&(l=o+s),r<a?u=a:r>a+c&&(u=a+c);var h=i-l,_=r-u;return Math.sqrt(h*h+_*_)<=n},W5.polygonPolygon=function(e,t){var n,i;for(n=0,i=e.length;n<i;++n)if(G5(e[n],e[(n+1)%i],t))return!0;for(n=0,i=t.length;n<i;++n)if(k5(t[n],e))return!0;for(n=0,i=e.length;n<i;++n)if(k5(e[n],t))return!0;return!1},W5.circleCircle=function(e,t,n,i){return zn.distance(e,n)<t+i},W5.polygonCircle=function(e,t,n){var i=t;if(k5(i,e))return!0;for(var r=0,o=e.length;r<o;r++)if(V5(i,0===r?e[e.length-1]:e[r-1],e[r],!0)<n)return!0;return!1},W5.pointInPolygon=k5,W5.pointLineDistance=V5;var j5,q5,X5,Y5,K5=Qe({GRAVITY:0,RADIUS:1}),Z5=Qe({FREE:0,RELATIVE:1,GROUPED:2}),Q5=new zn(0,0),J5=new zn,$5=new zn,e8=new zn,t8=new zn,n8=oV(iV),i8=function(){this.pos=new zn(0,0),this.startPos=new zn(0,0),this.color=new gn(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new zn(0,0),this.aspectRatio=1,this.dir=new zn(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},r8=new(function(e){function t(){return e.apply(this,arguments)||this}return K(t,e),t.prototype.get=function(){return this._get()||new i8},t}(Xe))((function(e){e.pos.set(Q5),e.startPos.set(Q5),e.color._val=4278190080,e.deltaColor.r=e.deltaColor.g=e.deltaColor.b=0,e.deltaColor.a=255,e.size=0,e.deltaSize=0,e.rotation=0,e.deltaRotation=0,e.timeToLive=0,e.drawPos.set(Q5),e.aspectRatio=1,e.dir.set(Q5),e.radialAccel=0,e.tangentialAccel=0,e.angle=0,e.degreesPerSecond=0,e.radius=0,e.deltaRadius=0}),1024),o8=function(){function e(e){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=e,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}var t=e.prototype;return t.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},t.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var e=this.particles,t=0;t<e.length;++t)r8.put(e[t]);e.length=0},t.emitParticle=function(e){var t=this.sys,n=r8.get();this.particles.push(n),n.timeToLive=t.life+t.lifeVar*(Math.random()-.5)*2;var i=n.timeToLive=Math.max(0,n.timeToLive);n.pos.x=t.sourcePos.x+t.posVar.x*(Math.random()-.5)*2,n.pos.y=t.sourcePos.y+t.posVar.y*(Math.random()-.5)*2;var r,o,a,s,c=t.startColor,l=t.startColorVar,u=t.endColor,h=t.endColorVar;n.color.r=r=dt(c.r+l.r*(Math.random()-.5)*2,0,255),n.color.g=o=dt(c.g+l.g*(Math.random()-.5)*2,0,255),n.color.b=a=dt(c.b+l.b*(Math.random()-.5)*2,0,255),n.color.a=s=dt(c.a+l.a*(Math.random()-.5)*2,0,255),n.deltaColor.r=(dt(u.r+h.r*(Math.random()-.5)*2,0,255)-r)/i,n.deltaColor.g=(dt(u.g+h.g*(Math.random()-.5)*2,0,255)-o)/i,n.deltaColor.b=(dt(u.b+h.b*(Math.random()-.5)*2,0,255)-a)/i,n.deltaColor.a=(dt(u.a+h.a*(Math.random()-.5)*2,0,255)-s)/i;var _=t.startSize+t.startSizeVar*(Math.random()-.5)*2;if(_=Math.max(0,_),n.size=_,-1===t.endSize)n.deltaSize=0;else{var f=t.endSize+t.endSizeVar*(Math.random()-.5)*2;f=Math.max(0,f),n.deltaSize=(f-_)/i}var d=t.startSpin+t.startSpinVar*(Math.random()-.5)*2,p=t.endSpin+t.endSpinVar*(Math.random()-.5)*2;n.rotation=d,n.deltaRotation=(p-d)/i,n.startPos.x=e.x,n.startPos.y=e.y,n.aspectRatio=t.aspectRatio||1;var m=pt(t.angle+this._worldRotation+t.angleVar*(Math.random()-.5)*2);if(t.emitterMode===K5.GRAVITY){var g=t.speed+t.speedVar*(Math.random()-.5)*2;n.dir.x=Math.cos(m),n.dir.y=Math.sin(m),n.dir.multiplyScalar(g),n.radialAccel=t.radialAccel+t.radialAccelVar*(Math.random()-.5)*2,n.tangentialAccel=t.tangentialAccel+t.tangentialAccelVar*(Math.random()-.5)*2,t.rotationIsDir&&(n.rotation=-mt(Math.atan2(n.dir.y,n.dir.x)))}else{var v=t.startRadius+t.startRadiusVar*(Math.random()-.5)*2,y=t.endRadius+t.endRadiusVar*(Math.random()-.5)*2;n.radius=v,n.deltaRadius=-1===t.endRadius?0:(y-v)/i,n.angle=m,n.degreesPerSecond=pt(t.rotatePerS+t.rotatePerSVar*(Math.random()-.5)*2)}},t.updateUVs=function(e){var t=this.renderData;if(t&&this.sys._renderSpriteFrame){for(var n=t.vData,i=this.sys._renderSpriteFrame.uv,r=e?0:this.uvFilled,o=this.particles.length,a=r;a<o;a++){var s=a*n8*4;n[s+3]=i[0],n[s+4]=i[1],n[s+12]=i[2],n[s+13]=i[3],n[s+21]=i[4],n[s+22]=i[5],n[s+30]=i[6],n[s+31]=i[7]}this.uvFilled=o}},t.updateParticleBuffer=function(e,t,n,i){var r=n.vData,o=t.x,a=t.y,s=e.size,c=s,l=e.aspectRatio;l>1?c=s/l:s=c*l;var u=s/2,h=c/2;if(e.rotation){var _=-u,f=-h,d=u,p=h,m=-pt(e.rotation),g=Math.cos(m),v=Math.sin(m);r[i]=_*g-f*v+o,r[i+1]=_*v+f*g+a,r[i+2]=0,r[i+9]=d*g-f*v+o,r[i+10]=d*v+f*g+a,r[i+11]=0,r[i+18]=_*g-p*v+o,r[i+19]=_*v+p*g+a,r[i+20]=0,r[i+27]=d*g-p*v+o,r[i+28]=d*v+p*g+a,r[i+29]=0}else r[i]=o-u,r[i+1]=a-h,r[i+2]=0,r[i+9]=o+u,r[i+10]=a-h,r[i+11]=0,r[i+18]=o-u,r[i+19]=a+h,r[i+20]=0,r[i+27]=o+u,r[i+28]=a+h,r[i+29]=0;gn.toArray(r,e.color,i+5),gn.toArray(r,e.color,i+14),gn.toArray(r,e.color,i+23),gn.toArray(r,e.color,i+32)},t.step=function(e){var t=this.sys.assembler,n=this.sys,i=n.node,r=this.particles;if(e=e>t.maxParticleDeltaTime?t.maxParticleDeltaTime:e,i.updateWorldTransform(),n.positionType===Z5.FREE){this._worldRotation=function(e){for(var t=0,n=e;n;)t+=n.eulerAngles.z,n=n.parent;return t}(i);var o=i.worldMatrix;J5.x=o.m12,J5.y=o.m13}else n.positionType===Z5.RELATIVE?(this._worldRotation=i.eulerAngles.z,J5.x=i.position.x,J5.y=i.position.y):this._worldRotation=0;if(this.active&&n.emissionRate){var a=1/n.emissionRate;for(r.length<n.totalParticles&&(this.emitCounter+=e);r.length<n.totalParticles&&this.emitCounter>a;)this.emitParticle(J5),this.emitCounter-=a;this.elapsed+=e,-1!==n.duration&&n.duration<this.elapsed&&n.stopSystem()}var s=this.renderData,c=r.length;s.reset(),this.requestData(4*c,6*c),c>this.uvFilled&&this.updateUVs();for(var l=0;l<r.length;){$5.x=$5.y=e8.x=e8.y=t8.x=t8.y=0;var u=r[l];if(u.timeToLive-=e,u.timeToLive>0){if(n.emitterMode===K5.GRAVITY){var h=t8,_=$5,f=e8;(u.pos.x||u.pos.y)&&(_.set(u.pos),_.normalize()),f.set(_),_.multiplyScalar(u.radialAccel);var d=f.x;f.x=-f.y,f.y=d,f.multiplyScalar(u.tangentialAccel),h.set(_),h.add(f),h.add(n.gravity),h.multiplyScalar(e),u.dir.add(h),h.set(u.dir),h.multiplyScalar(e),u.pos.add(h)}else u.angle+=u.degreesPerSecond*e,u.radius+=u.deltaRadius*e,u.pos.x=-Math.cos(u.angle)*u.radius,u.pos.y=-Math.sin(u.angle)*u.radius;u.color.r+=u.deltaColor.r*e,u.color.g+=u.deltaColor.g*e,u.color.b+=u.deltaColor.b*e,u.color.a+=u.deltaColor.a*e,u.size+=u.deltaSize*e,u.size<0&&(u.size=0),u.rotation+=u.deltaRotation*e;var p=$5;p.set(u.pos),n.positionType!==Z5.GROUPED&&p.add(u.startPos);var m=n8*l*4;this.updateParticleBuffer(u,p,s,m),++l}else{var g=r[l];l!==r.length-1&&(r[l]=r[r.length-1]),r8.put(g),r.length--,s.indicesCount-=6,s.vertexCount-=4}}0!==r.length||this.active||this.readyToPlay||(this.finished=!0,n._finishedSimulation())},t.requestData=function(e,t){var n=this.renderData.indicesCount;this.renderData.request(e,t);for(var i=this.renderData.indicesCount/6,r=this.renderData.iData,o=n;o<i;o++){var a=4*o;r[n++]=a,r[n++]=a+1,r[n++]=a+2,r[n++]=a+1,r[n++]=a+3,r[n++]=a+2}},e}(),a8=e("ParticleAsset",S_("cc.ParticleAsset")((Y5=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"spriteFrame",X5,Q(t)),t}return K(t,e),t}(Rf),X5=te((q5=Y5).prototype,"spriteFrame",[C_,N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j5=q5))||j5);i.ParticleAsset=a8;
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
var s8={};(function(){function e(e){throw e}var t=void 0,n=!0,i=this;function r(e,n){var r,o=e.split("."),a=i;!(o[0]in a)&&a.execScript&&a.execScript("var "+o[0]);for(;o.length&&(r=o.shift());)o.length||n===t?a=a[r]?a[r]:a[r]={}:a[r]=n}var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function a(e){if("string"==typeof e){var t,n,i=e.split("");for(t=0,n=i.length;t<n;t++)i[t]=(255&i[t].charCodeAt(0))>>>0;e=i}for(var r,o=1,a=0,s=e.length,c=0;0<s;){s-=r=1024<s?1024:s;do{a+=o+=e[c++]}while(--r);o%=65521,a%=65521}return(a<<16|o)>>>0}function s(t,n){this.index="number"==typeof n?n:0,this.i=0,this.buffer=t instanceof(o?Uint8Array:Array)?t:new(o?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&e(Error("invalid index")),this.buffer.length<=this.index&&this.f()}s.prototype.f=function(){var e,t=this.buffer,n=t.length,i=new(o?Uint8Array:Array)(n<<1);if(o)i.set(t);else for(e=0;e<n;++e)i[e]=t[e];return this.buffer=i},s.prototype.d=function(e,t,n){var i,r=this.buffer,o=this.index,a=this.i,s=r[o];if(n&&1<t&&(e=8<t?(f[255&e]<<24|f[e>>>8&255]<<16|f[e>>>16&255]<<8|f[e>>>24&255])>>32-t:f[e]>>8-t),8>t+a)s=s<<t|e,a+=t;else for(i=0;i<t;++i)s=s<<1|e>>t-i-1&1,8==++a&&(a=0,r[o++]=f[s],s=0,o===r.length&&(r=this.f()));r[o]=s,this.buffer=r,this.i=a,this.index=o},s.prototype.finish=function(){var e,t=this.buffer,n=this.index;return 0<this.i&&(t[n]<<=8-this.i,t[n]=f[t[n]],n++),o?e=t.subarray(0,n):(t.length=n,e=t),e};var c,l=new(o?Uint8Array:Array)(256);for(c=0;256>c;++c){for(var u=_=c,h=7,_=_>>>1;_;_>>>=1)u<<=1,u|=1&_,--h;l[c]=(u<<h&255)>>>0}var f=l;function d(e){this.buffer=new(o?Uint16Array:Array)(2*e),this.length=0}function p(e){var t,n,i,r,a,s,c,l,u,h=e.length,_=0,f=Number.POSITIVE_INFINITY;for(l=0;l<h;++l)e[l]>_&&(_=e[l]),e[l]<f&&(f=e[l]);for(t=1<<_,n=new(o?Uint32Array:Array)(t),i=1,r=0,a=2;i<=_;){for(l=0;l<h;++l)if(e[l]===i){for(s=0,c=r,u=0;u<i;++u)s=s<<1|1&c,c>>=1;for(u=s;u<t;u+=a)n[u]=i<<16|l;++r}++i,r<<=1,a<<=1}return[n,_,f]}function m(e,t){this.h=v,this.w=0,this.input=e,this.b=0,t&&(t.lazy&&(this.w=t.lazy),"number"==typeof t.compressionType&&(this.h=t.compressionType),t.outputBuffer&&(this.a=o&&t.outputBuffer instanceof Array?new Uint8Array(t.outputBuffer):t.outputBuffer),"number"==typeof t.outputIndex&&(this.b=t.outputIndex)),this.a||(this.a=new(o?Uint8Array:Array)(32768))}d.prototype.getParent=function(e){return 2*((e-2)/4|0)},d.prototype.push=function(e,t){var n,i,r,o=this.buffer;for(n=this.length,o[this.length++]=t,o[this.length++]=e;0<n&&(i=this.getParent(n),o[n]>o[i]);)r=o[n],o[n]=o[i],o[i]=r,r=o[n+1],o[n+1]=o[i+1],o[i+1]=r,n=i;return this.length},d.prototype.pop=function(){var e,t,n,i,r,o=this.buffer;for(t=o[0],e=o[1],this.length-=2,o[0]=o[this.length],o[1]=o[this.length+1],r=0;!((i=2*r+2)>=this.length)&&(i+2<this.length&&o[i+2]>o[i]&&(i+=2),o[i]>o[r]);)n=o[r],o[r]=o[i],o[i]=n,n=o[r+1],o[r+1]=o[i+1],o[i+1]=n,r=i;return{index:e,value:t,length:this.length}};var g,v=2,y={NONE:0,r:1,j:v,N:3},S=[];for(g=0;288>g;g++)switch(n){case 143>=g:S.push([g+48,8]);break;case 255>=g:S.push([g-144+400,9]);break;case 279>=g:S.push([g-256+0,7]);break;case 287>=g:S.push([g-280+192,8]);break;default:e("invalid literal: "+g)}function E(e,t){this.length=e,this.G=t}function T(){var t=x;switch(n){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}m.prototype.n=function(){var i,r,a,c,l=this.input;switch(this.h){case 0:for(a=0,c=l.length;a<c;){var u,h,_,f=r=o?l.subarray(a,a+65535):l.slice(a,a+65535),d=(a+=r.length)===c,p=t,m=t,g=this.a,y=this.b;if(o){for(g=new Uint8Array(this.a.buffer);g.length<=y+f.length+5;)g=new Uint8Array(g.length<<1);g.set(this.a)}if(u=d?1:0,g[y++]=0|u,_=65536+~(h=f.length)&65535,g[y++]=255&h,g[y++]=h>>>8&255,g[y++]=255&_,g[y++]=_>>>8&255,o)g.set(f,y),y+=f.length,g=g.subarray(0,y);else{for(p=0,m=f.length;p<m;++p)g[y++]=f[p];g.length=y}this.b=y,this.a=g}break;case 1:var E=new s(new Uint8Array(this.a.buffer),this.b);E.d(1,1,n),E.d(1,2,n);var T,x,A,C=w(this,l);for(T=0,x=C.length;T<x;T++)if(A=C[T],s.prototype.d.apply(E,S[A]),256<A)E.d(C[++T],C[++T],n),E.d(C[++T],5),E.d(C[++T],C[++T],n);else if(256===A)break;this.a=E.finish(),this.b=this.a.length;break;case v:var b,P,O,D,N,M,L,B,F,z,U,H,G,k,V,W=new s(new Uint8Array(this.a),this.b),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=Array(19);for(b=v,W.d(1,1,n),W.d(b,2,n),P=w(this,l),L=I(M=R(this.L,15)),F=I(B=R(this.K,7)),O=286;257<O&&0===M[O-1];O--);for(D=30;1<D&&0===B[D-1];D--);var X,Y,K,Z,Q,J,$=O,ee=D,te=new(o?Uint32Array:Array)($+ee),ne=new(o?Uint32Array:Array)(316),ie=new(o?Uint8Array:Array)(19);for(X=Y=0;X<$;X++)te[Y++]=M[X];for(X=0;X<ee;X++)te[Y++]=B[X];if(!o)for(X=0,Z=ie.length;X<Z;++X)ie[X]=0;for(X=Q=0,Z=te.length;X<Z;X+=Y){for(Y=1;X+Y<Z&&te[X+Y]===te[X];++Y);if(K=Y,0===te[X])if(3>K)for(;0<K--;)ne[Q++]=0,ie[0]++;else for(;0<K;)(J=138>K?K:138)>K-3&&J<K&&(J=K-3),10>=J?(ne[Q++]=17,ne[Q++]=J-3,ie[17]++):(ne[Q++]=18,ne[Q++]=J-11,ie[18]++),K-=J;else if(ne[Q++]=te[X],ie[te[X]]++,3>--K)for(;0<K--;)ne[Q++]=te[X],ie[te[X]]++;else for(;0<K;)(J=6>K?K:6)>K-3&&J<K&&(J=K-3),ne[Q++]=16,ne[Q++]=J-3,ie[16]++,K-=J}for(i=o?ne.subarray(0,Q):ne.slice(0,Q),z=R(ie,7),k=0;19>k;k++)q[k]=z[j[k]];for(N=19;4<N&&0===q[N-1];N--);for(U=I(z),W.d(O-257,5,n),W.d(D-1,5,n),W.d(N-4,4,n),k=0;k<N;k++)W.d(q[k],3,n);for(k=0,V=i.length;k<V;k++)if(H=i[k],W.d(U[H],z[H],n),16<=H){switch(k++,H){case 16:G=2;break;case 17:G=3;break;case 18:G=7;break;default:e("invalid code: "+H)}W.d(i[k],G,n)}var re,oe,ae,se,ce,le,ue,he,_e=[L,M],fe=[F,B];for(ce=_e[0],le=_e[1],ue=fe[0],he=fe[1],re=0,oe=P.length;re<oe;++re)if(ae=P[re],W.d(ce[ae],le[ae],n),256<ae)W.d(P[++re],P[++re],n),se=P[++re],W.d(ue[se],he[se],n),W.d(P[++re],P[++re],n);else if(256===ae)break;this.a=W.finish(),this.b=this.a.length;break;default:e("invalid compression type")}return this.a};var x,A,C=[];for(x=3;258>=x;x++)A=T(),C[x]=A[2]<<24|A[1]<<16|A[0];var b=o?new Uint32Array(C):C;function w(i,r){function a(t,i){var r,o,a,s,c=t.G,l=[],u=0;switch(r=b[t.length],l[u++]=65535&r,l[u++]=r>>16&255,l[u++]=r>>24,n){case 1===c:o=[0,c-1,0];break;case 2===c:o=[1,c-2,0];break;case 3===c:o=[2,c-3,0];break;case 4===c:o=[3,c-4,0];break;case 6>=c:o=[4,c-5,1];break;case 8>=c:o=[5,c-7,1];break;case 12>=c:o=[6,c-9,2];break;case 16>=c:o=[7,c-13,2];break;case 24>=c:o=[8,c-17,3];break;case 32>=c:o=[9,c-25,3];break;case 48>=c:o=[10,c-33,4];break;case 64>=c:o=[11,c-49,4];break;case 96>=c:o=[12,c-65,5];break;case 128>=c:o=[13,c-97,5];break;case 192>=c:o=[14,c-129,6];break;case 256>=c:o=[15,c-193,6];break;case 384>=c:o=[16,c-257,7];break;case 512>=c:o=[17,c-385,7];break;case 768>=c:o=[18,c-513,8];break;case 1024>=c:o=[19,c-769,8];break;case 1536>=c:o=[20,c-1025,9];break;case 2048>=c:o=[21,c-1537,9];break;case 3072>=c:o=[22,c-2049,10];break;case 4096>=c:o=[23,c-3073,10];break;case 6144>=c:o=[24,c-4097,11];break;case 8192>=c:o=[25,c-6145,11];break;case 12288>=c:o=[26,c-8193,12];break;case 16384>=c:o=[27,c-12289,12];break;case 24576>=c:o=[28,c-16385,13];break;case 32768>=c:o=[29,c-24577,13];break;default:e("invalid distance")}for(r=o,l[u++]=r[0],l[u++]=r[1],l[u++]=r[2],a=0,s=l.length;a<s;++a)g[v++]=l[a];S[l[0]]++,T[l[3]]++,y=t.length+i-1,d=null}var s,c,l,u,h,_,f,d,p,m={},g=o?new Uint16Array(2*r.length):[],v=0,y=0,S=new(o?Uint32Array:Array)(286),T=new(o?Uint32Array:Array)(30),x=i.w;if(!o){for(l=0;285>=l;)S[l++]=0;for(l=0;29>=l;)T[l++]=0}for(S[256]=1,s=0,c=r.length;s<c;++s){for(l=h=0,u=3;l<u&&s+l!==c;++l)h=h<<8|r[s+l];if(m[h]===t&&(m[h]=[]),_=m[h],!(0<y--)){for(;0<_.length&&32768<s-_[0];)_.shift();if(s+3>=c){for(d&&a(d,-1),l=0,u=c-s;l<u;++l)p=r[s+l],g[v++]=p,++S[p];break}if(0<_.length){var A=t,C=t,w=0,R=t,I=t,P=t,O=r.length,D=(I=0,_.length);e:for(;I<D;I++){if(A=_[D-I-1],R=3,3<w){for(P=w;3<P;P--)if(r[A+P-1]!==r[s+P-1])continue e;R=w}for(;258>R&&s+R<O&&r[A+R]===r[s+R];)++R;if(R>w&&(C=A,w=R),258===R)break}f=new E(w,s-C),d?d.length<f.length?(p=r[s-1],g[v++]=p,++S[p],a(f,0)):a(d,-1):f.length<x?d=f:a(f,0)}else d?a(d,-1):(p=r[s],g[v++]=p,++S[p])}_.push(s)}return g[v++]=256,S[256]++,i.L=S,i.K=T,o?g.subarray(0,v):g}function R(e,t){function n(e){var t=x[e][A[e]];t===v?(n(e+1),n(e+1)):--E[t],++A[e]}var i,r,a,s,c,l=e.length,u=new d(572),h=new(o?Uint8Array:Array)(l);if(!o)for(s=0;s<l;s++)h[s]=0;for(s=0;s<l;++s)0<e[s]&&u.push(s,e[s]);if(i=Array(u.length/2),r=new(o?Uint32Array:Array)(u.length/2),1===i.length)return h[u.pop().index]=1,h;for(s=0,c=u.length/2;s<c;++s)i[s]=u.pop(),r[s]=i[s].value;var _,f,p,m,g,v=r.length,y=new(o?Uint16Array:Array)(t),S=new(o?Uint8Array:Array)(t),E=new(o?Uint8Array:Array)(v),T=Array(t),x=Array(t),A=Array(t),C=(1<<t)-v,b=1<<t-1;for(y[t-1]=v,f=0;f<t;++f)C<b?S[f]=0:(S[f]=1,C-=b),C<<=1,y[t-2-f]=(y[t-1-f]/2|0)+v;for(y[0]=S[0],T[0]=Array(y[0]),x[0]=Array(y[0]),f=1;f<t;++f)y[f]>2*y[f-1]+S[f]&&(y[f]=2*y[f-1]+S[f]),T[f]=Array(y[f]),x[f]=Array(y[f]);for(_=0;_<v;++_)E[_]=t;for(p=0;p<y[t-1];++p)T[t-1][p]=r[p],x[t-1][p]=p;for(_=0;_<t;++_)A[_]=0;for(1===S[t-1]&&(--E[0],++A[t-1]),f=t-2;0<=f;--f){for(m=_=0,g=A[f+1],p=0;p<y[f];p++)(m=T[f+1][g]+T[f+1][g+1])>r[_]?(T[f][p]=m,x[f][p]=v,g+=2):(T[f][p]=r[_],x[f][p]=_,++_);A[f]=0,1===S[f]&&n(f)}for(a=E,s=0,c=i.length;s<c;++s)h[i[s].index]=a[s];return h}function I(t){var n,i,r,a,s=new(o?Uint16Array:Array)(t.length),c=[],l=[],u=0;for(n=0,i=t.length;n<i;n++)c[t[n]]=1+(0|c[t[n]]);for(n=1,i=16;n<=i;n++)l[n]=u,(u+=0|c[n])>1<<n&&e("overcommitted"),u<<=1;for(65536>u&&e("undercommitted"),n=0,i=t.length;n<i;n++)for(u=l[t[n]],l[t[n]]+=1,r=s[n]=0,a=t[n];r<a;r++)s[n]=s[n]<<1|1&u,u>>>=1;return s}function P(e,t){this.input=e,this.a=new(o?Uint8Array:Array)(32768),this.h=O.j;var n,i={};for(n in!t&&(t={})||"number"!=typeof t.compressionType||(this.h=t.compressionType),t)i[n]=t[n];i.outputBuffer=this.a,this.z=new m(this.input,i)}var O=y;function D(t,n){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=o?new Uint8Array(t):t,this.s=!1,this.m=M,this.B=!1,!n&&(n={})||(n.index&&(this.c=n.index),n.bufferSize&&(this.l=n.bufferSize),n.bufferType&&(this.m=n.bufferType),n.resize&&(this.B=n.resize)),this.m){case N:this.b=32768,this.a=new(o?Uint8Array:Array)(32768+this.l+258);break;case M:this.b=0,this.a=new(o?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:e(Error("invalid inflate mode"))}}P.prototype.n=function(){var t,n,i,r,s,c,l,u=0;switch(l=this.a,t=ue){case ue:n=Math.LOG2E*Math.log(32768)-8;break;default:e(Error("invalid compression method"))}switch(i=n<<4|t,l[u++]=i,t){case ue:switch(this.h){case O.NONE:s=0;break;case O.r:s=1;break;case O.j:s=2;break;default:e(Error("unsupported compression type"))}break;default:e(Error("invalid compression method"))}return r=s<<6|0,l[u++]=r|31-(256*i+r)%31,c=a(this.input),this.z.b=u,u=(l=this.z.n()).length,o&&((l=new Uint8Array(l.buffer)).length<=u+4&&(this.a=new Uint8Array(l.length+4),this.a.set(l),l=this.a),l=l.subarray(0,u+4)),l[u++]=c>>24&255,l[u++]=c>>16&255,l[u++]=c>>8&255,l[u++]=255&c,l},r("Zlib.Deflate",P),r("Zlib.Deflate.compress",(function(e,t){return new P(e,t).n()})),r("Zlib.Deflate.CompressionType",O),r("Zlib.Deflate.CompressionType.NONE",O.NONE),r("Zlib.Deflate.CompressionType.FIXED",O.r),r("Zlib.Deflate.CompressionType.DYNAMIC",O.j);var N=0,M=1,L={D:N,C:M};D.prototype.p=function(){for(;!this.s;){var i=ee(this,3);switch(1&i&&(this.s=n),i>>>=1){case 0:var r=this.input,a=this.c,s=this.a,c=this.b,l=t,u=t,h=t,_=s.length,f=t;switch(this.e=this.g=0,(l=r[a++])===t&&e(Error("invalid uncompressed block header: LEN (first byte)")),u=l,(l=r[a++])===t&&e(Error("invalid uncompressed block header: LEN (second byte)")),u|=l<<8,(l=r[a++])===t&&e(Error("invalid uncompressed block header: NLEN (first byte)")),h=l,(l=r[a++])===t&&e(Error("invalid uncompressed block header: NLEN (second byte)")),u===~(h|=l<<8)&&e(Error("invalid uncompressed block header: length verify")),a+u>r.length&&e(Error("input buffer is broken")),this.m){case N:for(;c+u>s.length;){if(u-=f=_-c,o)s.set(r.subarray(a,a+f),c),c+=f,a+=f;else for(;f--;)s[c++]=r[a++];this.b=c,s=this.f(),c=this.b}break;case M:for(;c+u>s.length;)s=this.f({v:2});break;default:e(Error("invalid inflate mode"))}if(o)s.set(r.subarray(a,a+u),c),c+=u,a+=u;else for(;u--;)s[c++]=r[a++];this.c=a,this.b=c,this.a=s;break;case 1:this.o(Q,$);break;case 2:ne(this);break;default:e(Error("unknown BTYPE: "+i))}}return this.t()};var B,F,z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],U=o?new Uint16Array(z):z,H=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],G=o?new Uint16Array(H):H,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],V=o?new Uint8Array(k):k,W=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],j=o?new Uint16Array(W):W,q=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],X=o?new Uint8Array(q):q,Y=new(o?Uint8Array:Array)(288);for(B=0,F=Y.length;B<F;++B)Y[B]=143>=B?8:255>=B?9:279>=B?7:8;var K,Z,Q=p(Y),J=new(o?Uint8Array:Array)(30);for(K=0,Z=J.length;K<Z;++K)J[K]=5;var $=p(J);function ee(n,i){for(var r,o=n.g,a=n.e,s=n.input,c=n.c;a<i;)(r=s[c++])===t&&e(Error("input buffer is broken")),o|=r<<a,a+=8;return r=o&(1<<i)-1,n.g=o>>>i,n.e=a-i,n.c=c,r}function te(n,i){for(var r,o,a,s=n.g,c=n.e,l=n.input,u=n.c,h=i[0],_=i[1];c<_;)(r=l[u++])===t&&e(Error("input buffer is broken")),s|=r<<c,c+=8;return a=(o=h[s&(1<<_)-1])>>>16,n.g=s>>a,n.e=c-a,n.c=u,65535&o}function ne(e){function t(e,t,n){var i,r,o,a;for(a=0;a<e;)switch(i=te(this,t)){case 16:for(o=3+ee(this,2);o--;)n[a++]=r;break;case 17:for(o=3+ee(this,3);o--;)n[a++]=0;r=0;break;case 18:for(o=11+ee(this,7);o--;)n[a++]=0;r=0;break;default:r=n[a++]=i}return n}var n,i,r,a,s=ee(e,5)+257,c=ee(e,5)+1,l=ee(e,4)+4,u=new(o?Uint8Array:Array)(U.length);for(a=0;a<l;++a)u[U[a]]=ee(e,3);n=p(u),i=new(o?Uint8Array:Array)(s),r=new(o?Uint8Array:Array)(c),e.o(p(t.call(e,s,n,i)),p(t.call(e,c,n,r)))}function ie(t,n){var i,r;switch(this.input=t,this.c=0,!n&&(n={})||(n.index&&(this.c=n.index),n.verify&&(this.M=n.verify)),i=t[this.c++],r=t[this.c++],15&i){case ue:this.method=ue;break;default:e(Error("unsupported compression method"))}0!=((i<<8)+r)%31&&e(Error("invalid fcheck flag:"+((i<<8)+r)%31)),32&r&&e(Error("fdict flag is not supported")),this.A=new D(t,{index:this.c,bufferSize:n.bufferSize,bufferType:n.bufferType,resize:n.resize})}D.prototype.o=function(e,t){var n=this.a,i=this.b;this.u=e;for(var r,o,a,s,c=n.length-258;256!==(r=te(this,e));)if(256>r)i>=c&&(this.b=i,n=this.f(),i=this.b),n[i++]=r;else for(s=G[o=r-257],0<V[o]&&(s+=ee(this,V[o])),r=te(this,t),a=j[r],0<X[r]&&(a+=ee(this,X[r])),i>=c&&(this.b=i,n=this.f(),i=this.b);s--;)n[i]=n[i++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},D.prototype.I=function(e,t){var n=this.a,i=this.b;this.u=e;for(var r,o,a,s,c=n.length;256!==(r=te(this,e));)if(256>r)i>=c&&(c=(n=this.f()).length),n[i++]=r;else for(s=G[o=r-257],0<V[o]&&(s+=ee(this,V[o])),r=te(this,t),a=j[r],0<X[r]&&(a+=ee(this,X[r])),i+s>c&&(c=(n=this.f()).length);s--;)n[i]=n[i++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},D.prototype.f=function(){var e,t,n=new(o?Uint8Array:Array)(this.b-32768),i=this.b-32768,r=this.a;if(o)n.set(r.subarray(32768,n.length));else for(e=0,t=n.length;e<t;++e)n[e]=r[e+32768];if(this.k.push(n),this.q+=n.length,o)r.set(r.subarray(i,i+32768));else for(e=0;32768>e;++e)r[e]=r[i+e];return this.b=32768,r},D.prototype.J=function(e){var t,n,i,r=this.input.length/this.c+1|0,a=this.input,s=this.a;return e&&("number"==typeof e.v&&(r=e.v),"number"==typeof e.F&&(r+=e.F)),n=2>r?(i=(a.length-this.c)/this.u[2]/2*258|0)<s.length?s.length+i:s.length<<1:s.length*r,o?(t=new Uint8Array(n)).set(s):t=s,this.a=t},D.prototype.t=function(){var e,t,n,i,r,a=0,s=this.a,c=this.k,l=new(o?Uint8Array:Array)(this.q+(this.b-32768));if(0===c.length)return o?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(t=0,n=c.length;t<n;++t)for(i=0,r=(e=c[t]).length;i<r;++i)l[a++]=e[i];for(t=32768,n=this.b;t<n;++t)l[a++]=s[t];return this.k=[],this.buffer=l},D.prototype.H=function(){var e,t=this.b;return o?this.B?(e=new Uint8Array(t)).set(this.a.subarray(0,t)):e=this.a.subarray(0,t):(this.a.length>t&&(this.a.length=t),e=this.a),this.buffer=e},ie.prototype.p=function(){var t,n=this.input;return t=this.A.p(),this.c=this.A.c,this.M&&(n[this.c++]<<24|n[this.c++]<<16|n[this.c++]<<8|n[this.c++])>>>0!==a(t)&&e(Error("invalid adler-32 checksum")),t},r("Zlib.Inflate",ie),r("Zlib.Inflate.BufferType",L),L.ADAPTIVE=L.C,L.BLOCK=L.D,r("Zlib.Inflate.prototype.decompress",ie.prototype.p);var re,oe,ae=new(o?Uint8Array:Array)(288);for(re=0,oe=ae.length;re<oe;++re)ae[re]=143>=re?8:255>=re?9:279>=re?7:8;p(ae);var se,ce,le=new(o?Uint8Array:Array)(30);for(se=0,ce=le.length;se<ce;++se)le[se]=5;p(le);var ue=8}).call(s8);var c8=s8.Zlib;c8.Deflate=c8.Deflate,c8.Deflate.compress=c8.Deflate.compress,c8.Inflate=c8.Inflate,c8.Inflate.BufferType=c8.Inflate.BufferType,c8.Inflate.prototype.decompress=c8.Inflate.prototype.decompress;for(var l8=function(){function e(e){var t,n=this;this.pos=8,this.palette=[],this.imgData=[],this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this.data=e,this.transparency={indexed:[],rgb:0,grayscale:0};for(var i=0,r=0,o=0;;){o=this.readUInt32();var a=function(){var e=[];for(i=0;i<4;++i)e.push(String.fromCharCode(n.data[n.pos++]));return e}.call(this).join("");switch(a){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(o);break;case"fcTL":t&&this.animation.frames.push(t),this.pos+=4,t={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var s=this.readUInt16(),c=this.readUInt16()||100;t.delay=1e3*s/c,t.disposeOp=this.data[this.pos++],t.blendOp=this.data[this.pos++],t.data=[];break;case"IDAT":case"fdAT":for("fdAT"===a&&(this.pos+=4,o-=4),e=(null!=t?t.data:void 0)||this.imgData,i=0;o>=0?i<o:i>o;o>=0?++i:--i)e.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(o);var l=255-this.transparency.indexed.length;if(l>0)for(r=0;l>=0?r<l:r>l;l>=0?++r:--r)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(o)[0];break;case 2:this.transparency.rgb=this.read(o)}break;case"tEXt":var u=this.read(o),h=u.indexOf(0),_=String.fromCharCode.apply(String,u.slice(0,h));this.text[_]=String.fromCharCode.apply(String,u.slice(h+1));break;case"IEND":t&&this.animation.frames.push(t),this.colors=function(){switch(n.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this);var f=this.colorType;this.hasAlphaChannel=4===f||6===f;var d=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*d,this.colorSpace=function(){switch(n.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData instanceof Uint8Array||(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=o}if(this.pos+=4,this.pos>this.data.length)throw new Error(P(6017))}}var t=e.prototype;return t.read=function(e){var t=0,n=[];for(t=0;e>=0?t<e:t>e;e>=0?++t:--t)n.push(this.data[this.pos++]);return n},t.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},t.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},t.decodePixels=function(e){if(null==e&&(e=this.imgData),0===e.length)return new Uint8Array(0);e=new c8.Inflate(e,{index:0,verify:!1}).decompress();for(var t=this.pixelBitlength/8,n=t*this.width,i=new Uint8Array(n*this.height),r=e.length,o=0,a=0,s=0,c=0,l=0,u=0,h=0,_=0,f=0,d=0,p=0,m=0,g=0,v=0,y=0,S=0,E=0,T=0,x=0;a<r;){switch(e[a++]){case 0:for(u=h=0;h<n;u=h+=1)i[s++]=e[a++];break;case 1:for(u=_=0;_<n;u=_+=1)c=e[a++],m=u<t?0:i[s-t],i[s++]=(c+m)%256;break;case 2:for(u=f=0;f<n;u=f+=1)c=e[a++],l=(u-u%t)/t,T=o&&i[(o-1)*n+l*t+u%t],i[s++]=(T+c)%256;break;case 3:for(u=d=0;d<n;u=d+=1)c=e[a++],l=(u-u%t)/t,m=u<t?0:i[s-t],T=o&&i[(o-1)*n+l*t+u%t],i[s++]=(c+Math.floor((m+T)/2))%256;break;case 4:for(u=p=0;p<n;u=p+=1)c=e[a++],l=(u-u%t)/t,m=u<t?0:i[s-t],0===o?T=x=0:(T=i[(o-1)*n+l*t+u%t],x=l&&i[(o-1)*n+(l-1)*t+u%t]),g=m+T-x,v=Math.abs(g-m),S=Math.abs(g-T),E=Math.abs(g-x),y=v<=S&&v<=E?m:S<=E?T:x,i[s++]=(c+y)%256;break;default:throw new Error(P(6018,e[a-1]))}o++}return i},t.copyToImageData=function(e,t){var n,i=this.hasAlphaChannel,r=this.colors;this.palette.length&&(n=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),r=4,i=!0);var o=e.data||e,a=o.length,s=n||t,c=0,l=0,u=0,h=0;if(1===r)for(;c<a;)u=n?4*t[c/4]:l,h=s[u++],o[c++]=h,o[c++]=h,o[c++]=h,o[c++]=i?s[u++]:255,l=u;else for(;c<a;)u=n?4*t[c/4]:l,o[c++]=s[u++],o[c++]=s[u++],o[c++]=s[u++],o[c++]=i?s[u++]:255,l=u},t.decodePalette=function(){for(var e=this.palette,t=this.transparency.indexed||[],n=new Uint8Array((t.length||0)+e.length),i=0,r=0,o=0,a=0,s=0,c=e.length;s<c;a=s+=3)n[i++]=e[a],n[i++]=e[a+1],n[i++]=e[a+2],o=t[r++],n[i++]=null!=o?o:255;return n},t.render=function(e){e.width=this.width,e.height=this.height;var t=e.getContext("2d"),n=t.createImageData(this.width,this.height);return this.copyToImageData(n,this.decodePixels(null)),t.putImageData(n,0,0)},e}(),u8=function(){function e(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[]}var t=e.prototype;return t.getUint8=function(e){return this._tiffData[e]},t.getUint16=function(e){return this._littleEndian?this._tiffData[e+1]<<8|this._tiffData[e]:this._tiffData[e]<<8|this._tiffData[e+1]},t.getUint32=function(e){var t=this._tiffData;return this._littleEndian?t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]:t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]},t.checkLittleEndian=function(){var e=this.getUint16(0);if(18761===e)this._littleEndian=!0;else{if(19789!==e)throw console.log(e),TypeError(P(6019));this._littleEndian=!1}return this._littleEndian},t.hasTowel=function(){if(42!==this.getUint16(2))throw RangeError(P(6020));return!0},t.getFieldTypeName=function(e){return e in _8?_8[e]:null},t.getFieldTagName=function(e){return e in h8?h8[e]:(T(6021,e),"Tag"+e)},t.getFieldTypeLength=function(e){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(e)?1:-1!==["SHORT","SSHORT"].indexOf(e)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(e)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(e)?8:0},t.getFieldValues=function(e,t,n,i){var r=[],o=this.getFieldTypeLength(t);if(o*n<=4)!1===this._littleEndian?r.push(i>>>8*(4-o)):r.push(i);else for(var a=0;a<n;a++){var s=o*a;o>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(t)?(r.push(this.getUint32(i+s)),r.push(this.getUint32(i+s+4))):T(8e3):r.push(this.getBytes(o,i+s))}return"ASCII"===t&&r.forEach((function(e,t,n){n[t]=String.fromCharCode(e)})),r},t.getBytes=function(e,t){if(e<=0)T(8001);else{if(e<=1)return this.getUint8(t);if(e<=2)return this.getUint16(t);if(e<=3)return this.getUint32(t)>>>8;if(e<=4)return this.getUint32(t);T(8002)}return 0},t.getBits=function(e,t,n){n=n||0;var i=t+Math.floor(n/8),r=n+e,o=32-e,a=0,s=0;return r<=0?T(6023):r<=8?(a=24+n,s=this.getUint8(i)):r<=16?(a=16+n,s=this.getUint16(i)):r<=32?(a=n,s=this.getUint32(i)):T(6022),{bits:s<<a>>>o,byteOffset:i+Math.floor(r/8),bitOffset:r%8}},t.parseFileDirectory=function(e){var t=this.getUint16(e),n=[],i=0,r=0;for(i=e+2,r=0;r<t;i+=12,r++){var o=this.getUint16(i),a=this.getUint16(i+2),s=this.getUint32(i+4),c=this.getUint32(i+8),l=this.getFieldTagName(o),u=this.getFieldTypeName(a),h=this.getFieldValues(l,u,s,c);n[l]={type:u,values:h}}this._fileDirectories.push(n);var _=this.getUint32(i);0!==_&&this.parseFileDirectory(_)},t.clampColorSample=function(e,t){var n=Math.pow(2,8-t);return Math.floor(e*n+(n-1))},t.parseTIFF=function(e,t){var n=this;if(t=t||document.createElement("canvas"),this._tiffData=e,this._canvas=t,this.checkLittleEndian(),this.hasTowel()){var i=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(i);var r=this._fileDirectories[0],o=r.ImageWidth.values[0],a=r.ImageLength.values[0];this._canvas.width=o,this._canvas.height=a;var s=[],c=r.Compression?r.Compression.values[0]:1,l=r.SamplesPerPixel.values[0],u=[],h=0,_=!1;r.BitsPerSample.values.forEach((function(e,t){u[t]={bitsPerSample:e,hasBytesPerSample:!1,bytesPerSample:void 0},e%8==0&&(u[t].hasBytesPerSample=!0,u[t].bytesPerSample=e/8),h+=e}),this);var f=0;h%8==0&&(_=!0,f=h/8);var d,p=r.StripOffsets.values,m=p.length;if(r.StripByteCounts)d=r.StripByteCounts.values;else{if(T(8003),1!==m)throw Error(P(6024));d=[Math.ceil(o*a*h/8)]}for(var g=1,v=1,y=0;y<m;y++){var S=p[y];s[y]=[];for(var E=d[y],x=0,A=0,C=1,b=!0,w=[],R=0,I=0,O=0;x<E;x+=C)switch(c){case 1:w=[];for(var D=0;D<l;D++){var N=u[D];if(!N.hasBytesPerSample){var M=this.getBits(N.bitsPerSample,S+x,A);throw w.push(M.bits),x=M.byteOffset-S,A=M.bitOffset,RangeError(P(6025))}var L=N.bytesPerSample*D;w.push(this.getBytes(N.bytesPerSample,S+x+L))}if(s[y].push(w),!_)throw C=0,RangeError(P(6026));C=f;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(b){b=!1;var B=this.getUint8(S+x);B>=0&&B<=127?g=B+1:B>=-127&&B<=-1?v=1-B:b=!0}else{for(var F=this.getUint8(S+x),z=0;z<v;z++){var U=u[I];if(!U.hasBytesPerSample)throw RangeError(P(6025));O=O<<8*R|F,++R===U.bytesPerSample&&(w.push(O),O=R=0,I++),I===l&&(s[y].push(w),w=[],I=0)}0==--g&&(b=!0)}C=1}}if(t.getContext){var H=this._canvas.getContext("2d");H.fillStyle="rgba(255, 255, 255, 0)";var G=r.RowsPerStrip?r.RowsPerStrip.values[0]:a,k=s.length,V=a%G,W=0===V?G:V,j=G,q=0,X=r.PhotometricInterpretation.values[0],Y=[],K=0;r.ExtraSamples&&(K=(Y=r.ExtraSamples.values).length);var Z=[],Q=0;r.ColorMap&&(Z=r.ColorMap.values,Q=Math.pow(2,u[0].bitsPerSample));for(var J=0;J<k;J++){J+1===k&&(j=W);for(var $=s[J].length,ee=q*J,te=0,ne=0;te<j&&ne<$;te++)for(var ie=0;ie<o;ie++,ne++){var re=s[J][ne],oe=0,ae=0,se=0,ce=1;if(K>0)for(var le=0;le<K;le++)if(1===Y[le]||2===Y[le]){ce=re[3+le]/256;break}!function(){switch(X){case 0:var e=0;u[0].hasBytesPerSample&&(e=Math.pow(16,2*u[0].bytesPerSample)),re.forEach((function(t,n,i){i[n]=e-t}));case 1:oe=ae=se=n.clampColorSample(re[0],u[0].bitsPerSample);break;case 2:oe=n.clampColorSample(re[0],u[0].bitsPerSample),ae=n.clampColorSample(re[1],u[1].bitsPerSample),se=n.clampColorSample(re[2],u[2].bitsPerSample);break;case 3:if(void 0===Z)throw Error(P(6027));var t=re[0];oe=n.clampColorSample(Z[t],16),ae=n.clampColorSample(Z[Q+t],16),se=n.clampColorSample(Z[2*Q+t],16);break;default:throw RangeError(P(6028,X))}}(),H.fillStyle="rgba("+oe+", "+ae+", "+se+", "+ce+")",H.fillRect(ie,ee+te,1,1)}q=j}}return this._canvas}},e}(),h8={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},_8={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},f8=new Array(123),d8=0;d8<123;++d8)f8[d8]=64;for(var p8=0;p8<64;++p8)f8["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(p8)]=p8;var m8={name:"Jacob__Codec__Base64",decode:function(e){var t,n,i,r,o,a,s=[],c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)t=f8[e.charCodeAt(c++)]<<2|(r=f8[e.charCodeAt(c++)])>>4,n=(15&r)<<4|(o=f8[e.charCodeAt(c++)])>>2,i=(3&o)<<6|(a=f8[e.charCodeAt(c++)]),s.push(String.fromCharCode(t)),64!==o&&s.push(String.fromCharCode(n)),64!==a&&s.push(String.fromCharCode(i));return s.join("")},decodeAsArray:function(e,t){var n,i,r,o=this.decode(e),a=[];for(n=0,r=o.length/t;n<r;n++)for(a[n]=0,i=t-1;i>=0;--i)a[n]+=o.charCodeAt(n*t+i)<<8*i;return a}},g8=function(e){this.data=e,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(g8.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};g8.gunzip=function(e){return e.constructor===Array||e.constructor,new g8(e).gunzip()[0][0]},g8.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},g8.LITERALS=288,g8.NAMEMAX=256,g8.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],g8.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],g8.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],g8.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],g8.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],g8.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],g8.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},g8.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},g8.prototype.byteAlign=function(){this.bb=1},g8.prototype.readBit=function(){var e;return this.bits++,e=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),e=1&this.bb,this.bb=this.bb>>1|128),e},g8.prototype.readBits=function(e){for(var t=0,n=e;n--;)t=t<<1|this.readBit();return e&&(t=g8.bitReverse[t]>>8-e),t},g8.prototype.flushBuffer=function(){this.bIdx=0},g8.prototype.addBuffer=function(e){this.buf32k[this.bIdx++]=e,this.outputArr.push(String.fromCharCode(e)),32768===this.bIdx&&(this.bIdx=0)},g8.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},g8.prototype.Rec=function(){var e,t=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(e=this.IsPat())>=0)t.b0=e;else if(t.b0=32768,this.Rec())return-1;if((e=this.IsPat())>=0)t.b1=e,t.jump=null;else if(t.b1=32768,t.jump=this.Places[this.treepos],t.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},g8.prototype.CreateTree=function(e,t,n){var i;for(this.Places=e,this.treepos=0,this.flens=n,this.fmax=t,i=0;i<17;i++)this.fpos[i]=0;return this.len=0,this.Rec()?-1:0},g8.prototype.DecodeValue=function(e){for(var t,n,i=0,r=e[i];;)if(this.readBit()){if(!(32768&r.b1))return r.b1;for(r=r.jump,t=e.length,n=0;n<t;n++)if(e[n]===r){i=n;break}}else{if(!(32768&r.b0))return r.b0;r=e[++i]}return-1},g8.prototype.DeflateLoop=function(){var e,t,n;do{var i,r;if(e=this.readBit(),0===(t=this.readBits(2)))for(this.byteAlign(),i=this.readByte(),i|=this.readByte()<<8,r=this.readByte(),65535&(i^~(r|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");i--;)o=this.readByte(),this.addBuffer(o);else if(1===t)for(;;)if((a=g8.bitReverse[this.readBits(7)]>>1)>23?(a=a<<1|this.readBit())>199?a=(a-=128)<<1|this.readBit():(a-=48)>143&&(a+=136):a+=256,a<256)this.addBuffer(a);else{if(256===a)break;for(a-=257,d=this.readBits(g8.cplext[a])+g8.cplens[a],a=g8.bitReverse[this.readBits(5)]>>3,g8.cpdext[a]>8?(p=this.readBits(8),p|=this.readBits(g8.cpdext[a]-8)<<8):p=this.readBits(g8.cpdext[a]),p+=g8.cpdist[a],a=0;a<d;a++){var o=this.buf32k[this.bIdx-p&32767];this.addBuffer(o)}}else if(2===t){var a,s,c,l,u,h=new Array(320);for(c=257+this.readBits(5),l=1+this.readBits(5),u=4+this.readBits(4),a=0;a<19;a++)h[a]=0;for(a=0;a<u;a++)h[g8.border[a]]=this.readBits(3);for(d=this.distanceTree.length,n=0;n<d;n++)this.distanceTree[n]=new g8.HufNode;if(this.CreateTree(this.distanceTree,19,h,0))return this.flushBuffer(),1;for(s=c+l,n=0;n<s;)if((a=this.DecodeValue(this.distanceTree))<16)h[n++]=a;else if(16===a){var _;if(n+(a=3+this.readBits(2))>s)return this.flushBuffer(),1;for(_=n?h[n-1]:0;a--;)h[n++]=_}else{if(n+(a=17===a?3+this.readBits(3):11+this.readBits(7))>s)return this.flushBuffer(),1;for(;a--;)h[n++]=0}for(d=this.literalTree.length,n=0;n<d;n++)this.literalTree[n]=new g8.HufNode;if(this.CreateTree(this.literalTree,c,h,0))return this.flushBuffer(),1;for(d=this.literalTree.length,n=0;n<d;n++)this.distanceTree[n]=new g8.HufNode;var f=new Array;for(n=c;n<h.length;n++)f[n-c]=h[n];if(this.CreateTree(this.distanceTree,l,f,0))return this.flushBuffer(),1;for(;;)if((a=this.DecodeValue(this.literalTree))>=256){var d,p;if(0==(a-=256))break;for(a--,d=this.readBits(g8.cplext[a])+g8.cplens[a],a=this.DecodeValue(this.distanceTree),g8.cpdext[a]>8?(p=this.readBits(8),p|=this.readBits(g8.cpdext[a]-8)<<8):p=this.readBits(g8.cpdext[a]),p+=g8.cpdist[a];d--;)o=this.buf32k[this.bIdx-p&32767],this.addBuffer(o)}else this.addBuffer(a)}}while(!e);return this.flushBuffer(),this.byteAlign(),0},g8.prototype.unzipFile=function(e){var t;for(this.gunzip(),t=0;t<this.unzipped.length;t++)if(this.unzipped[t][1]===e)return this.unzipped[t][0]},g8.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var e=[];if(e[0]=this.readByte(),e[1]=this.readByte(),120===e[0]&&218===e[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===e[0]&&139===e[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===e[0]&&75===e[1]&&(this.modeZIP=!0,e[2]=this.readByte(),e[3]=this.readByte(),3===e[2]&&4===e[3])){e[0]=this.readByte(),e[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var t=this.readByte();t|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var n=this.readByte();n|=this.readByte()<<8;var i=this.readByte();for(i|=this.readByte()<<8,o=0,this.nameBuf=[];n--;){var r=this.readByte();"/"===r|":"===r?o=0:o<g8.NAMEMAX-1&&(this.nameBuf[o++]=String.fromCharCode(r))}this.fileout||(this.fileout=this.nameBuf);for(var o=0;o<i;)r=this.readByte(),o++;8===t&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},g8.prototype.skipdir=function(){var e,t,n=[];if(8&this.gpflags&&(n[0]=this.readByte(),n[1]=this.readByte(),n[2]=this.readByte(),n[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),n[0]=this.readByte(),8!==n[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(n[0]=this.readByte(),n[2]=this.readByte(),this.len=n[0]+256*n[1],e=0;e<this.len;e++)this.readByte();if(8&this.gpflags)for(e=0,this.nameBuf=[];t=this.readByte();)"7"!==t&&":"!==t||(e=0),e<g8.NAMEMAX-1&&(this.nameBuf[e++]=t);if(16&this.gpflags)for(;t=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()};var v8,y8,S8,E8,T8,x8,A8,C8,b8,w8,R8,I8,P8,O8,D8,N8,M8,L8,B8,F8,z8,U8,H8,G8,k8,V8,W8,j8,q8,X8,Y8,K8,Z8,Q8,J8,$8,e6,t6,n6,i6,r6,o6,a6,s6,c6,l6,u6,h6,_6,f6,d6,p6,m6,g6,v6,y6,S6,E6,T6,x6,A6,C6,b6,w6,R6,I6,P6,O6,D6,N6,M6,L6,B6,F6,z6,U6,H6,G6,k6,V6,W6,j6,q6,X6,Y6,K6,Z6,Q6,J6,$6,e7,t7,n7,i7,r7,o7,a7={name:"Jacob__Codec"};function s7(e){var t=e.parent,n=e.getComponent(T7);return t&&n?s7(t):e.getComponentsInChildren(T7)}a7.Base64=m8,a7.GZip=g8,a7.unzip=function(){return a7.GZip.gunzip.apply(a7.GZip,arguments)},a7.unzipBase64=function(){var e=a7.Base64.decode.apply(a7.Base64,arguments);try{return a7.GZip.gunzip.call(a7.GZip,e)}catch(t){return e.slice(7)}},a7.unzipBase64AsArray=function(e,t){t=t||1;var n,i,r,o=this.unzipBase64(e),a=[];for(n=0,r=o.length/t;n<r;n++)for(a[n]=0,i=t-1;i>=0;--i)a[n]+=o.charCodeAt(n*t+i)<<8*i;return a},a7.unzipAsArray=function(e,t){t=t||1;var n,i,r,o=this.unzip(e),a=[];for(n=0,r=o.length/t;n<r;n++)for(a[n]=0,i=t-1;i>=0;--i)a[n]+=o.charCodeAt(n*t+i)<<8*i;return a},function(e){e[e.JPG=0]="JPG",e[e.PNG=1]="PNG",e[e.TIFF=2]="TIFF",e[e.WEBP=3]="WEBP",e[e.PVR=4]="PVR",e[e.ETC=5]="ETC",e[e.S3TC=6]="S3TC",e[e.ATITC=7]="ATITC",e[e.TGA=8]="TGA",e[e.RAWDATA=9]="RAWDATA",e[e.UNKNOWN=10]="UNKNOWN"}(o7||(o7={}));var c7,l7,u7,h7,_7,f7,d7,p7,m7,g7,v7,y7,S7,E7,T7=e("ParticleSystem2D",(v8=S_("cc.ParticleSystem2D"),y8=R_(),S8=B_(),E8=K_(a8),T8=B_(),x8=K_(vU),A8=B_(),C8=B_(),b8=B_(),w8=B_(),R8=B_(),I8=B_(),P8=B_(),O8=B_(),D8=B_(),N8=B_(),M8=B_(),L8=B_(),B8=B_(),F8=B_(),z8=B_(),U8=B_(),H8=B_(),G8=B_(),k8=B_(),V8=B_(),W8=B_(),j8=K_(Z5),q8=B_(),X8=K_(K5),Y8=B_(),K8=B_(),Z8=B_(),Q8=B_(),J8=B_(),$8=B_(),e6=B_(),t6=B_(),n6=B_(),i6=B_(),r6=B_(),o6=B_(),a6=B_(),s6=B_(),c6=B_(),l6=B_(),u6=B_(),h6=B_(),v8(_6=y8(_6=I_(_6=w_((r7=i7=function(e){function t(){var t;return ee(t=e.call(this)||this,"duration",d6,Q(t)),ee(t,"emissionRate",p6,Q(t)),ee(t,"life",m6,Q(t)),ee(t,"lifeVar",g6,Q(t)),ee(t,"angle",v6,Q(t)),ee(t,"angleVar",y6,Q(t)),ee(t,"startSize",S6,Q(t)),ee(t,"startSizeVar",E6,Q(t)),ee(t,"endSize",T6,Q(t)),ee(t,"endSizeVar",x6,Q(t)),ee(t,"startSpin",A6,Q(t)),ee(t,"startSpinVar",C6,Q(t)),ee(t,"endSpin",b6,Q(t)),ee(t,"endSpinVar",w6,Q(t)),ee(t,"sourcePos",R6,Q(t)),ee(t,"posVar",I6,Q(t)),ee(t,"emitterMode",P6,Q(t)),ee(t,"gravity",O6,Q(t)),ee(t,"speed",D6,Q(t)),ee(t,"speedVar",N6,Q(t)),ee(t,"tangentialAccel",M6,Q(t)),ee(t,"tangentialAccelVar",L6,Q(t)),ee(t,"radialAccel",B6,Q(t)),ee(t,"radialAccelVar",F6,Q(t)),ee(t,"rotationIsDir",z6,Q(t)),ee(t,"startRadius",U6,Q(t)),ee(t,"startRadiusVar",H6,Q(t)),ee(t,"endRadius",G6,Q(t)),ee(t,"endRadiusVar",k6,Q(t)),ee(t,"rotatePerS",V6,Q(t)),ee(t,"rotatePerSVar",W6,Q(t)),t.aspectRatio=1,ee(t,"playOnLoad",j6,Q(t)),ee(t,"autoRemoveOnFinish",q6,Q(t)),ee(t,"preview",X6,Q(t)),ee(t,"_custom",Y6,Q(t)),ee(t,"_file",K6,Q(t)),ee(t,"_spriteFrame",Z6,Q(t)),ee(t,"_totalParticles",Q6,Q(t)),ee(t,"_startColor",J6,Q(t)),ee(t,"_startColorVar",$6,Q(t)),ee(t,"_endColor",e7,Q(t)),ee(t,"_endColorVar",t7,Q(t)),ee(t,"_positionType",n7,Q(t)),t._stopped=!0,t._deferredloaded=!1,t.initProperties(),t}K(t,e);var n=t.prototype;return n.onEnable=function(){e.prototype.onEnable.call(this),this._updateMaterial()},n.onDestroy=function(){e.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0},n.initProperties=function(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new o8(this)},n.onFocusInEditor=function(){this._focused=!0;for(var e=s7(this.node),t=0;t<e.length;++t)e[t]._startPreview()},n.onLostFocusInEditor=function(){this._focused=!1;for(var e=s7(this.node),t=0;t<e.length;++t)e[t]._stopPreview()},n._startPreview=function(){this.preview&&this.resetSystem()},n._stopPreview=function(){this.preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)},n.__preload=function(){e.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},n._flushAssembler=function(){var e=t.Assembler.getAssembler(this);this._assembler!==e&&(this._assembler=e),this._assembler&&this._assembler.createData&&(this._simulator.renderData=this._assembler.createData(this))},n.lateUpdate=function(e){this._simulator.finished||this._simulator.step(e)},n.addParticle=function(){},n.stopSystem=function(){this._stopped=!0,this._simulator.stop()},n.resetSystem=function(){this._stopped=!1,this._simulator.reset(),this._renderFlag=this._canRender()},n.isFull=function(){return this.particleCount>=this.totalParticles},n._applyFile=function(){var e=this,t=this._file;if(t){var n=function(n){!n&&t?e.isValid&&(e._plistFile=t.nativeUrl,e._custom||(e._spriteFrame!==t.spriteFrame&&(e.spriteFrame=t.spriteFrame),e._initWithDictionary(t._nativeAsset)),e._spriteFrame?!e._renderSpriteFrame&&e._spriteFrame&&e._applySpriteFrame():t.spriteFrame?e.spriteFrame=t.spriteFrame:e._custom&&e._initTextureWithDictionary(t._nativeAsset),e._deferredloaded=!1):b(6029)};t._nativeAsset?n(null):(this._deferredloaded=!0,SD.postLoadNative(t,n))}},n._initTextureWithDictionary=function(e){var t,n=this;if(e.spriteFrameUuid){var i=e.spriteFrameUuid;SD.loadAny(i,(function(t,i){t?(e.spriteFrameUuid=void 0,n._initTextureWithDictionary(e),p(t)):n.spriteFrame=i}))}else{var r=Ii(this._plistFile,e.textureFileName||"");if(e.textureFileName)SD.loadRemote(r,(function(t,i){t?(e.textureFileName=void 0,n._initTextureWithDictionary(e),p(t)):n.spriteFrame=vU.createWithImage(i)}));else if(e.textureImageData){var o=e.textureImageData;if(!(o&&o.length>0))return!1;var a=SD.assets.get(r);if(!a){var s=a7.unzipBase64AsArray(o,1);if(!s)return A(6030,this._file.name),!1;var c=(t=s).length>8&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]?o7.PNG:t.length>2&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1])?o7.TIFF:o7.UNKNOWN;if(c!==o7.TIFF&&c!==o7.PNG)return A(6031,this._file.name),!1;var l=document.createElement("canvas");c===o7.PNG?new l8(s).render(l):(this._tiffReader||(this._tiffReader=new u8),this._tiffReader.parseTIFF(s,l)),a=new Uf(l),SD.assets.add(r,a)}a||A(6032,this._file.name),this.spriteFrame=vU.createWithImage(a)}}return!0},n._initWithDictionary=function(e){this.totalParticles=parseInt(e.maxParticles||0),this.life=parseFloat(e.particleLifespan||0),this.lifeVar=parseFloat(e.particleLifespanVariance||0);var t=e.emissionRate;this.emissionRate=t||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(e.duration||0),this._srcBlendFactor=parseInt(e.blendFuncSource||Ma.SRC_ALPHA),this._dstBlendFactor=parseInt(e.blendFuncDestination||Ma.ONE_MINUS_SRC_ALPHA);var n=this._startColor;n.r=255*parseFloat(e.startColorRed||0),n.g=255*parseFloat(e.startColorGreen||0),n.b=255*parseFloat(e.startColorBlue||0),n.a=255*parseFloat(e.startColorAlpha||0);var i=this._startColorVar;i.r=255*parseFloat(e.startColorVarianceRed||0),i.g=255*parseFloat(e.startColorVarianceGreen||0),i.b=255*parseFloat(e.startColorVarianceBlue||0),i.a=255*parseFloat(e.startColorVarianceAlpha||0);var r=this._endColor;r.r=255*parseFloat(e.finishColorRed||0),r.g=255*parseFloat(e.finishColorGreen||0),r.b=255*parseFloat(e.finishColorBlue||0),r.a=255*parseFloat(e.finishColorAlpha||0);var o=this._endColorVar;if(o.r=255*parseFloat(e.finishColorVarianceRed||0),o.g=255*parseFloat(e.finishColorVarianceGreen||0),o.b=255*parseFloat(e.finishColorVarianceBlue||0),o.a=255*parseFloat(e.finishColorVarianceAlpha||0),this.startSize=parseFloat(e.startParticleSize||0),this.startSizeVar=parseFloat(e.startParticleSizeVariance||0),this.endSize=parseFloat(e.finishParticleSize||0),this.endSizeVar=parseFloat(e.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==e.positionType?e.positionType:Z5.FREE),this.sourcePos.set(0,0),this.posVar.set(parseFloat(e.sourcePositionVariancex||0),parseFloat(e.sourcePositionVariancey||0)),this.angle=parseFloat(e.angle||0),this.angleVar=parseFloat(e.angleVariance||0),this.startSpin=parseFloat(e.rotationStart||0),this.startSpinVar=parseFloat(e.rotationStartVariance||0),this.endSpin=parseFloat(e.rotationEnd||0),this.endSpinVar=parseFloat(e.rotationEndVariance||0),this.emitterMode=parseInt(e.emitterType||K5.GRAVITY),this.emitterMode===K5.GRAVITY){this.gravity.set(parseFloat(e.gravityx||0),parseFloat(e.gravityy||0)),this.speed=parseFloat(e.speed||0),this.speedVar=parseFloat(e.speedVariance||0),this.radialAccel=parseFloat(e.radialAcceleration||0),this.radialAccelVar=parseFloat(e.radialAccelVariance||0),this.tangentialAccel=parseFloat(e.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(e.tangentialAccelVariance||0);var a=e.rotationIsDir||"";null!==a?(a=a.toString().toLowerCase(),this.rotationIsDir="true"===a||"1"===a):this.rotationIsDir=!1}else{if(this.emitterMode!==K5.RADIUS)return A(6009),!1;this.startRadius=parseFloat(e.maxRadius||0),this.startRadiusVar=parseFloat(e.maxRadiusVariance||0),this.endRadius=parseFloat(e.minRadius||0),this.endRadiusVar=parseFloat(e.minRadiusVariance||0),this.rotatePerS=parseFloat(e.rotatePerSecond||0),this.rotatePerSVar=parseFloat(e.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(e),!0},n._onTextureLoaded=function(){this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this._renderFlag=this._canRender()},n._syncAspect=function(){if(this._renderSpriteFrame){var e=this._renderSpriteFrame.rect;this.aspectRatio=e.width/e.height}},n._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.textureLoaded()?this._onTextureLoaded():this._renderSpriteFrame.once("load",this._onTextureLoaded,this):this.resetSystem()},n._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},n._updateMaterial=function(){var e=this.getMaterialInstance(0);e&&e.recompileShaders({USE_LOCAL:this._positionType!==Z5.FREE})},n._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this._renderFlag=this._canRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()},n._canRender=function(){return e.prototype._canRender.call(this)&&!this._stopped&&!this._deferredloaded&&null!==this._renderSpriteFrame},n._render=function(e){e.commitComp(this,this._renderSpriteFrame,this._assembler,this._positionType===Z5.RELATIVE?this.node.parent:null)},X(t,[{key:"custom",get:function(){return this._custom},set:function(e){this._custom!==e&&(this._custom=e,this._applyFile())}},{key:"file",get:function(){return this._file},set:function(e){this._file!==e&&(this._file=e,e?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(e){this._renderSpriteFrame!==e&&(this._renderSpriteFrame=e,e&&!e._uuid||(this._spriteFrame=e),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(e){this._totalParticles!==e&&(this._totalParticles=e)}},{key:"startColor",get:function(){return this._startColor},set:function(e){this._startColor.r=e.r,this._startColor.g=e.g,this._startColor.b=e.b,this._startColor.a=e.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(e){this._startColorVar.r=e.r,this._startColorVar.g=e.g,this._startColorVar.b=e.b,this._startColorVar.a=e.a}},{key:"endColor",get:function(){return this._endColor},set:function(e){this._endColor.r=e.r,this._endColor.g=e.g,this._endColor.b=e.b,this._endColor.a=e.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(e){this._endColorVar.r=e.r,this._endColorVar.g=e.g,this._endColorVar.b=e.b,this._endColorVar.a=e.a}},{key:"positionType",get:function(){return this._positionType},set:function(e){this._positionType=e,this._updateMaterial()}},{key:"stopped",get:function(){return this._stopped}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]),t}(pk),i7.EmitterMode=K5,i7.PositionType=Z5,i7.DURATION_INFINITY=-1,i7.START_SIZE_EQUAL_TO_END_SIZE=-1,i7.START_RADIUS_EQUAL_TO_END_RADIUS=-1,te((f6=r7).prototype,"custom",[N_,S8],Object.getOwnPropertyDescriptor(f6.prototype,"custom"),f6.prototype),te(f6.prototype,"file",[E8,T8],Object.getOwnPropertyDescriptor(f6.prototype,"file"),f6.prototype),te(f6.prototype,"spriteFrame",[x8,A8],Object.getOwnPropertyDescriptor(f6.prototype,"spriteFrame"),f6.prototype),te(f6.prototype,"totalParticles",[N_,C8],Object.getOwnPropertyDescriptor(f6.prototype,"totalParticles"),f6.prototype),d6=te(f6.prototype,"duration",[C_,N_,b8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),p6=te(f6.prototype,"emissionRate",[C_,N_,w8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),m6=te(f6.prototype,"life",[C_,N_,R8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),g6=te(f6.prototype,"lifeVar",[C_,N_,I8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),te(f6.prototype,"startColor",[N_,P8],Object.getOwnPropertyDescriptor(f6.prototype,"startColor"),f6.prototype),te(f6.prototype,"startColorVar",[N_,O8],Object.getOwnPropertyDescriptor(f6.prototype,"startColorVar"),f6.prototype),te(f6.prototype,"endColor",[N_,D8],Object.getOwnPropertyDescriptor(f6.prototype,"endColor"),f6.prototype),te(f6.prototype,"endColorVar",[N_,N8],Object.getOwnPropertyDescriptor(f6.prototype,"endColorVar"),f6.prototype),v6=te(f6.prototype,"angle",[C_,N_,M8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),y6=te(f6.prototype,"angleVar",[C_,N_,L8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),S6=te(f6.prototype,"startSize",[C_,N_,B8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),E6=te(f6.prototype,"startSizeVar",[C_,N_,F8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),T6=te(f6.prototype,"endSize",[C_,N_,z8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),x6=te(f6.prototype,"endSizeVar",[C_,N_,U8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),A6=te(f6.prototype,"startSpin",[C_,N_,H8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C6=te(f6.prototype,"startSpinVar",[C_,N_,G8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b6=te(f6.prototype,"endSpin",[C_,N_,k8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),w6=te(f6.prototype,"endSpinVar",[C_,N_,V8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),R6=te(f6.prototype,"sourcePos",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zn.ZERO.clone()}}),I6=te(f6.prototype,"posVar",[C_,N_,W8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zn.ZERO.clone()}}),te(f6.prototype,"positionType",[j8,q8],Object.getOwnPropertyDescriptor(f6.prototype,"positionType"),f6.prototype),P6=te(f6.prototype,"emitterMode",[C_,N_,X8,Y8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return K5.GRAVITY}}),O6=te(f6.prototype,"gravity",[C_,N_,K8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zn.ZERO.clone()}}),D6=te(f6.prototype,"speed",[C_,N_,Z8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),N6=te(f6.prototype,"speedVar",[C_,N_,Q8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),M6=te(f6.prototype,"tangentialAccel",[C_,N_,J8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),L6=te(f6.prototype,"tangentialAccelVar",[C_,N_,$8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),B6=te(f6.prototype,"radialAccel",[C_,N_,e6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),F6=te(f6.prototype,"radialAccelVar",[C_,N_,t6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),z6=te(f6.prototype,"rotationIsDir",[C_,N_,n6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),U6=te(f6.prototype,"startRadius",[C_,N_,i6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),H6=te(f6.prototype,"startRadiusVar",[C_,N_,r6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),G6=te(f6.prototype,"endRadius",[C_,N_,o6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),k6=te(f6.prototype,"endRadiusVar",[C_,N_,a6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),V6=te(f6.prototype,"rotatePerS",[C_,N_,s6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),W6=te(f6.prototype,"rotatePerSVar",[C_,N_,c6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),j6=te(f6.prototype,"playOnLoad",[C_,N_,l6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),q6=te(f6.prototype,"autoRemoveOnFinish",[C_,N_,u6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),X6=te(f6.prototype,"preview",[C_,N_,h6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Y6=te(f6.prototype,"_custom",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),K6=te(f6.prototype,"_file",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z6=te(f6.prototype,"_spriteFrame",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q6=te(f6.prototype,"_totalParticles",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),J6=te(f6.prototype,"_startColor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn(255,255,255,255)}}),$6=te(f6.prototype,"_startColorVar",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn(0,0,0,0)}}),e7=te(f6.prototype,"_endColor",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn(255,255,255,0)}}),t7=te(f6.prototype,"_endColorVar",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gn(0,0,0,0)}}),n7=te(f6.prototype,"_positionType",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Z5.FREE}}),_6=f6))||_6)||_6)||_6)||_6)),x7=function(){function e(e,t){this.point=new zn,this.dir=new zn,this.distance=0,this.time=0,e&&this.point.set(e),t&&this.dir.set(t)}var t=e.prototype;return t.setPoint=function(e,t){this.point.x=e,this.point.y=t},t.setDir=function(e,t){this.dir.x=e,this.dir.y=t},e}(),A7=e("MotionStreak",(c7=S_("cc.MotionStreak"),l7=R_(),u7=D_(),h7=K_(dp),c7(_7=w_(_7=I_(_7=l7(_7=u7((E7=S7=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ee(t=e.call.apply(e,[this].concat(i))||this,"_preview",d7,Q(t)),ee(t,"_fadeTime",p7,Q(t)),ee(t,"_minSeg",m7,Q(t)),ee(t,"_stroke",g7,Q(t)),ee(t,"_texture",v7,Q(t)),ee(t,"_fastMode",y7,Q(t)),t._points=[],t}K(t,e);var n=t.prototype;return n.onEnable=function(){e.prototype.onEnable.call(this),this.reset()},n._flushAssembler=function(){var e=t.Assembler.getAssembler(this);this._assembler!==e&&(this._assembler=e),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},n.onFocusInEditor=function(){this._preview&&this.reset()},n.onLostFocusInEditor=function(){this._preview&&this.reset()},n.reset=function(){this._points.length=0,this._renderData&&this._renderData.clear()},n.lateUpdate=function(e){this._assembler&&this._assembler.update(this,e)},n._render=function(e){e.commitComp(this,this._texture,this._assembler,null)},X(t,[{key:"preview",get:function(){return this._preview},set:function(e){this._preview=e,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(e){this._fadeTime=e,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(e){this._minSeg=e}},{key:"stroke",get:function(){return this._stroke},set:function(e){this._stroke=e}},{key:"texture",get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e)}},{key:"fastMode",get:function(){return this._fastMode},set:function(e){this._fastMode=e}},{key:"points",get:function(){return this._points}}]),t}(pk),S7.Point=x7,te((f7=E7).prototype,"preview",[N_],Object.getOwnPropertyDescriptor(f7.prototype,"preview"),f7.prototype),te(f7.prototype,"fadeTime",[N_],Object.getOwnPropertyDescriptor(f7.prototype,"fadeTime"),f7.prototype),te(f7.prototype,"minSeg",[N_],Object.getOwnPropertyDescriptor(f7.prototype,"minSeg"),f7.prototype),te(f7.prototype,"stroke",[N_],Object.getOwnPropertyDescriptor(f7.prototype,"stroke"),f7.prototype),te(f7.prototype,"texture",[h7],Object.getOwnPropertyDescriptor(f7.prototype,"texture"),f7.prototype),te(f7.prototype,"fastMode",[N_],Object.getOwnPropertyDescriptor(f7.prototype,"fastMode"),f7.prototype),d7=te(f7.prototype,"_preview",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),p7=te(f7.prototype,"_fadeTime",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),m7=te(f7.prototype,"_minSeg",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),g7=te(f7.prototype,"_stroke",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),v7=te(f7.prototype,"_texture",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y7=te(f7.prototype,"_fastMode",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_7=f7))||_7)||_7)||_7)||_7)||_7)),C7=(new zn,new zn),b7=new zn;function w7(e,t){return e.x=-t.y,e.y=t.x,e}var R7={createData:function(e){var t=e.requestRenderData();return t.dataLength=4,t.vertexCount=16,t.indicesCount=42,t},update:function(e,t){var n,i=e.stroke/2,r=e.node.worldMatrix,o=r.m12,a=r.m13,s=e.points;if(s.length>1){var c=s[0],l=c.point.x-o,u=c.point.y-a;l*l+u*u<e.minSeg&&(n=c)}n||(n=new A7.Point,s.splice(0,0,n)),n.setPoint(o,a),n.time=e.fadeTime+t;var h,_=0;if(!(s.length<2)){var f=e.renderData,d=e.color,p=d.r,m=d.g,g=d.b,v=d.a,y=s[1];y.distance=zn.subtract(b7,n.point,y.point).length(),b7.normalize(),y.setDir(b7.x,b7.y),n.setDir(b7.x,b7.y),f.dataLength=2*s.length;for(var S=f.data,E=e.fadeTime,T=!1,x=s.length-1;x>=0;x--){var A=s[x],C=A.point,b=A.dir;if(A.time-=t,A.time<0)s.splice(x,1);else{var w=A.time/E,R=s[x-1];if(!T){if(!R){s.splice(x,1);continue}C.x=R.point.x-b.x*w,C.y=R.point.y-b.y*w}T=!0,w7(C7,b);var I=(w*v<<24>>>0)+(g<<16)+(m<<8)+p,P=_;S[P].x=C.x+C7.x*i,S[P].y=C.y+C7.y*i,S[P].u=1,S[P].v=w,S[P].color._val=I,S[P+=1].x=C.x-C7.x*i,S[P].y=C.y-C7.y*i,S[P].u=0,S[P].v=w,S[P].color._val=I,_+=2}}h=_<=2?0:3*(_-2),f.vertexCount=_,f.indicesCount=h}},updateRenderData:function(){},fillBuffers:function(e,t){var n=e.renderData,i=n.data,r=(e.node,t.acquireBufferBatch()),o=r.byteOffset>>2,a=r.indicesOffset,s=r.vertexOffset;r.request(n.vertexCount,n.indicesCount)||(r=t.currBufferBatch,a=0,s=0);for(var c=r.vData,l=r.iData,u=n.vertexCount,h=n.indicesCount,_=0;_<u;_++){var f=i[_];c[o++]=f.x,c[o++]=f.y,c[o++]=f.z,c[o++]=f.u,c[o++]=f.v,gn.toArray(c,f.color,o),o+=4}for(var d=0,p=h;d<p;d+=2){var m=s+d;l[a++]=m,l[a++]=m+2,l[a++]=m+1,l[a++]=m+1,l[a++]=m+2,l[a++]=m+3}}},I7=e("MotionStreakAssemblerManager",{getAssembler:function(){return R7}});A7.Assembler=I7;var P7={maxParticleDeltaTime:0,createData:function(){return wH.add()},updateRenderData:function(){},fillBuffers:function(e,t){if(null!==e){var n=e._simulator.renderData;if(0!==n.vertexCount&&0!==n.indicesCount){var i=t.acquireBufferBatch(),r=i.byteOffset>>2,o=i.indicesOffset,a=i.vertexOffset;i.request(n.vertexCount,n.indicesCount)||(i=t.currBufferBatch,o=0,a=0);for(var s=i.vData,c=i.iData,l=n.vData,u=n.iData,h=9*n.vertexCount,_=0;_<h;_++)s[r++]=l[_];for(var f=n.indicesCount,d=0;d<f;d++)c[o++]=u[d]+a}}}},O7=e("ParticleSystem2DAssembler",{getAssembler:function(){return P7.maxParticleDeltaTime||(P7.maxParticleDeltaTime=i.game.frameTime/1e3*2),P7}});T7.Assembler=O7}}}));
